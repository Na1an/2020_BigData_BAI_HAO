<!DOCTYPE html>
<!-- saved from url=(0090)https://stephanegaiffas.github.io/big_data_course/slides/slides07_spark-deeper-dive.html#1 -->
<html class="remark-container"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css" title="remark">html.remark-container,body.remark-container{height:100%;width:100%;-webkit-print-color-adjust:exact}.remark-container{background:#d7d8d2;margin:0;overflow:hidden}.remark-container:focus{outline-style:solid;outline-width:1px}.remark-container:-webkit-full-screen{width:100%;height:100%}body:-webkit-full-screen{background:#000000}body:-moz-full-screen{background:#000000}body:fullscreen{background:#000000}.remark-slides-area{position:relative;height:100%;width:100%}.remark-slide-container{display:none;position:absolute;height:100%;width:100%;page-break-after:always}.remark-slide-scaler{background-color:transparent;overflow:hidden;position:absolute;-webkit-transform-origin:top left;-moz-transform-origin:top left;transform-origin:top-left;-moz-box-shadow:0 0 30px #888;-webkit-box-shadow:0 0 30px #888;box-shadow:0 0 30px #888}.remark-slide{height:100%;width:100%;display:table;table-layout:fixed}.remark-slide>.left{text-align:left}.remark-slide>.center{text-align:center}.remark-slide>.right{text-align:right}.remark-slide>.top{vertical-align:top}.remark-slide>.middle{vertical-align:middle}.remark-slide>.bottom{vertical-align:bottom}.remark-slide-content{background-color:#fff;background-position:center;background-repeat:no-repeat;display:table-cell;font-size:20px;padding:1em 4em 1em 4em}.remark-slide-content h1{font-size:55px}.remark-slide-content h2{font-size:45px}.remark-slide-content h3{font-size:35px}.remark-slide-content .left{display:block;text-align:left}.remark-slide-content .center{display:block;text-align:center}.remark-slide-content .right{display:block;text-align:right}.remark-slide-number{bottom:12px;opacity:.5;position:absolute;right:20px}.remark-slide-notes{border-top:3px solid black;position:absolute;display:none}.remark-code{font-size:18px}.remark-code-line{min-height:1em}.remark-code-line-highlighted{background-color:rgba(255,255,0,0.5)}.remark-code-span-highlighted{background-color:rgba(255,255,0,0.5);padding:1px 2px 2px 2px}.remark-visible{display:block;z-index:2}.remark-fading{display:block;z-index:1}.remark-fading .remark-slide-scaler{-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none}.remark-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;display:none;background:#000;z-index:2}.remark-pause{bottom:0;top:0;right:0;left:0;display:none;position:absolute;z-index:1000}.remark-pause .remark-pause-lozenge{margin-top:30%;text-align:center}.remark-pause .remark-pause-lozenge span{color:white;background:black;border:2px solid black;border-radius:20px;padding:20px 30px;font-family:Helvetica,arial,freesans,clean,sans-serif;font-size:42pt;font-weight:bold}.remark-container.remark-presenter-mode.remark-pause-mode .remark-pause{display:block}.remark-container.remark-presenter-mode.remark-pause-mode .remark-backdrop{display:block;opacity:.5}.remark-help{bottom:0;top:0;right:0;left:0;display:none;position:absolute;z-index:1000;-webkit-transform-origin:top left;-moz-transform-origin:top left;transform-origin:top-left}.remark-help .remark-help-content{color:white;font-family:Helvetica,arial,freesans,clean,sans-serif;font-size:12pt;position:absolute;top:5%;bottom:10%;height:10%;left:5%;width:90%}.remark-help .remark-help-content h1{font-size:36px}.remark-help .remark-help-content td{color:white;font-size:12pt;padding:10px}.remark-help .remark-help-content td:first-child{padding-left:0}.remark-help .remark-help-content .key{background:white;color:black;min-width:1em;display:inline-block;padding:3px 6px;text-align:center;border-radius:4px;font-size:14px}.remark-help .dismiss{top:85%}.remark-container.remark-help-mode .remark-help{display:block}.remark-container.remark-help-mode .remark-backdrop{display:block;opacity:.95}.remark-preview-area{bottom:2%;left:2%;display:none;opacity:.5;position:absolute;height:47.25%;width:48%}.remark-preview-area .remark-slide-container{display:block}.remark-notes-area{background:#fff;bottom:0;color:black;display:none;left:52%;overflow:hidden;position:absolute;right:0;top:0}.remark-notes-area .remark-top-area{height:50px;left:20px;position:absolute;right:10px;top:10px}.remark-notes-area .remark-bottom-area{position:absolute;top:75px;bottom:10px;left:20px;right:10px}.remark-notes-area .remark-bottom-area .remark-toggle{display:block;text-decoration:none;font-family:Helvetica,arial,freesans,clean,sans-serif;height:21px;font-size:.75em;text-transform:uppercase;color:#ccc}.remark-notes-area .remark-bottom-area .remark-notes-current-area{height:70%;position:relative}.remark-notes-area .remark-bottom-area .remark-notes-current-area .remark-notes{clear:both;border-top:1px solid #f5f5f5;position:absolute;top:22px;bottom:0;left:0;right:0;overflow-y:auto;margin-bottom:20px;padding-top:10px}.remark-notes-area .remark-bottom-area .remark-notes-preview-area{height:30%;position:relative}.remark-notes-area .remark-bottom-area .remark-notes-preview-area .remark-notes-preview{border-top:1px solid #f5f5f5;position:absolute;top:22px;bottom:0;left:0;right:0;overflow-y:auto}.remark-notes-area .remark-bottom-area .remark-notes>*:first-child,.remark-notes-area .remark-bottom-area .remark-notes-preview>*:first-child{margin-top:5px}.remark-notes-area .remark-bottom-area .remark-notes>*:last-child,.remark-notes-area .remark-bottom-area .remark-notes-preview>*:last-child{margin-bottom:0}.remark-toolbar{color:#979892;vertical-align:middle}.remark-toolbar .remark-toolbar-link{border:2px solid #d7d8d2;color:#979892;display:inline-block;padding:2px 2px;text-decoration:none;text-align:center;min-width:20px}.remark-toolbar .remark-toolbar-link:hover{border-color:#979892;color:#676862}.remark-toolbar .remark-toolbar-timer{border:2px solid black;border-radius:10px;background:black;color:white;display:inline-block;float:right;padding:5px 10px;font-family:sans-serif;font-weight:bold;font-size:175%;text-decoration:none;text-align:center}.remark-container.remark-presenter-mode .remark-slides-area{top:2%;left:2%;height:47.25%;width:48%}.remark-container.remark-presenter-mode .remark-preview-area{display:block}.remark-container.remark-presenter-mode .remark-notes-area{display:block}.remark-container.remark-blackout-mode:not(.remark-presenter-mode) .remark-backdrop{display:block;opacity:.99}.remark-container.remark-mirrored-mode:not(.remark-presenter-mode) .remark-slides-area{-webkit-transform:scaleX(-1);-moz-transform:scaleX(-1);-ms-transform:scaleX(-1);-o-transform:scaleX(-1)}@media print{.remark-container{overflow:visible;background-color:#fff}.remark-container.remark-presenter-mode .remark-slides-area{top:0;left:0;height:100%;width:681px}.remark-container.remark-presenter-mode .remark-preview-area,.remark-container.remark-presenter-mode .remark-notes-area{display:none}.remark-container.remark-presenter-mode .remark-slide-notes{display:block;margin-left:30px;width:621px}.remark-slide-container{display:block;position:relative}.remark-slide-scaler{-moz-box-shadow:none;-webkit-box-shadow:none;-webkit-transform-origin:initial;box-shadow:none}}@page{margin:0}.hljs-agate{/*! * Agate by Taufik Nurrohman <https://github.com/tovic> * ---------------------------------------------------- * * #ade5fc * #a2fca2 * #c6b4f0 * #d36363 * #fcc28c * #fc9b9b * #ffa * #fff * #333 * #62c8f3 * #888 * */}.hljs-agate .hljs{display:block;overflow-x:auto;padding:.5em;background:#333;color:white}.hljs-agate .hljs-name,.hljs-agate .hljs-strong{font-weight:bold}.hljs-agate .hljs-code,.hljs-agate .hljs-emphasis{font-style:italic}.hljs-agate .hljs-tag{color:#62c8f3}.hljs-agate .hljs-variable,.hljs-agate .hljs-template-variable,.hljs-agate .hljs-selector-id,.hljs-agate .hljs-selector-class{color:#ade5fc}.hljs-agate .hljs-string,.hljs-agate .hljs-bullet{color:#a2fca2}.hljs-agate .hljs-type,.hljs-agate .hljs-title,.hljs-agate .hljs-section,.hljs-agate .hljs-attribute,.hljs-agate .hljs-quote,.hljs-agate .hljs-built_in,.hljs-agate .hljs-builtin-name{color:#ffa}.hljs-agate .hljs-number,.hljs-agate .hljs-symbol,.hljs-agate .hljs-bullet{color:#d36363}.hljs-agate .hljs-keyword,.hljs-agate .hljs-selector-tag,.hljs-agate .hljs-literal{color:#fcc28c}.hljs-agate .hljs-comment,.hljs-agate .hljs-deletion,.hljs-agate .hljs-code{color:#888}.hljs-agate .hljs-regexp,.hljs-agate .hljs-link{color:#c6b4f0}.hljs-agate .hljs-meta{color:#fc9b9b}.hljs-agate .hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-agate .hljs-addition{background-color:#a2fca2;color:#333}.hljs-agate .hljs a{color:inherit}.hljs-agate .hljs a:focus,.hljs-agate .hljs a:hover{color:inherit;text-decoration:underline}.hljs-androidstudio .hljs{color:#a9b7c6;background:#282b2e;display:block;overflow-x:auto;padding:.5em}.hljs-androidstudio .hljs-number,.hljs-androidstudio .hljs-literal,.hljs-androidstudio .hljs-symbol,.hljs-androidstudio .hljs-bullet{color:#6897BB}.hljs-androidstudio .hljs-keyword,.hljs-androidstudio .hljs-selector-tag,.hljs-androidstudio .hljs-deletion{color:#cc7832}.hljs-androidstudio .hljs-variable,.hljs-androidstudio .hljs-template-variable,.hljs-androidstudio .hljs-link{color:#629755}.hljs-androidstudio .hljs-comment,.hljs-androidstudio .hljs-quote{color:#808080}.hljs-androidstudio .hljs-meta{color:#bbb529}.hljs-androidstudio .hljs-string,.hljs-androidstudio .hljs-attribute,.hljs-androidstudio .hljs-addition{color:#6A8759}.hljs-androidstudio .hljs-section,.hljs-androidstudio .hljs-title,.hljs-androidstudio .hljs-type{color:#ffc66d}.hljs-androidstudio .hljs-name,.hljs-androidstudio .hljs-selector-id,.hljs-androidstudio .hljs-selector-class{color:#e8bf6a}.hljs-androidstudio .hljs-emphasis{font-style:italic}.hljs-androidstudio .hljs-strong{font-weight:bold}.hljs-arduino-light .hljs{display:block;overflow-x:auto;padding:.5em;background:#FFFFFF}.hljs-arduino-light .hljs,.hljs-arduino-light .hljs-subst{color:#434f54}.hljs-arduino-light .hljs-keyword,.hljs-arduino-light .hljs-attribute,.hljs-arduino-light .hljs-selector-tag,.hljs-arduino-light .hljs-doctag,.hljs-arduino-light .hljs-name{color:#00979D}.hljs-arduino-light .hljs-built_in,.hljs-arduino-light .hljs-literal,.hljs-arduino-light .hljs-bullet,.hljs-arduino-light .hljs-code,.hljs-arduino-light .hljs-addition{color:#D35400}.hljs-arduino-light .hljs-regexp,.hljs-arduino-light .hljs-symbol,.hljs-arduino-light .hljs-variable,.hljs-arduino-light .hljs-template-variable,.hljs-arduino-light .hljs-link,.hljs-arduino-light .hljs-selector-attr,.hljs-arduino-light .hljs-selector-pseudo{color:#00979D}.hljs-arduino-light .hljs-type,.hljs-arduino-light .hljs-string,.hljs-arduino-light .hljs-selector-id,.hljs-arduino-light .hljs-selector-class,.hljs-arduino-light .hljs-quote,.hljs-arduino-light .hljs-template-tag,.hljs-arduino-light .hljs-deletion{color:#005C5F}.hljs-arduino-light .hljs-title,.hljs-arduino-light .hljs-section{color:#880000;font-weight:bold}.hljs-arduino-light .hljs-comment{color:rgba(149,165,166,0.8)}.hljs-arduino-light .hljs-meta-keyword{color:#728E00}.hljs-arduino-light .hljs-meta{color:#728E00;color:#434f54}.hljs-arduino-light .hljs-emphasis{font-style:italic}.hljs-arduino-light .hljs-strong{font-weight:bold}.hljs-arduino-light .hljs-function{color:#728E00}.hljs-arduino-light .hljs-number{color:#8A7B52}.hljs-arta .hljs{display:block;overflow-x:auto;padding:.5em;background:#222}.hljs-arta .hljs,.hljs-arta .hljs-subst{color:#aaa}.hljs-arta .hljs-section{color:#fff}.hljs-arta .hljs-comment,.hljs-arta .hljs-quote,.hljs-arta .hljs-meta{color:#444}.hljs-arta .hljs-string,.hljs-arta .hljs-symbol,.hljs-arta .hljs-bullet,.hljs-arta .hljs-regexp{color:#ffcc33}.hljs-arta .hljs-number,.hljs-arta .hljs-addition{color:#00cc66}.hljs-arta .hljs-built_in,.hljs-arta .hljs-builtin-name,.hljs-arta .hljs-literal,.hljs-arta .hljs-type,.hljs-arta .hljs-template-variable,.hljs-arta .hljs-attribute,.hljs-arta .hljs-link{color:#32aaee}.hljs-arta .hljs-keyword,.hljs-arta .hljs-selector-tag,.hljs-arta .hljs-name,.hljs-arta .hljs-selector-id,.hljs-arta .hljs-selector-class{color:#6644aa}.hljs-arta .hljs-title,.hljs-arta .hljs-variable,.hljs-arta .hljs-deletion,.hljs-arta .hljs-template-tag{color:#bb1166}.hljs-arta .hljs-section,.hljs-arta .hljs-doctag,.hljs-arta .hljs-strong{font-weight:bold}.hljs-arta .hljs-emphasis{font-style:italic}.hljs-ascetic .hljs{display:block;overflow-x:auto;padding:.5em;background:white;color:black}.hljs-ascetic .hljs-string,.hljs-ascetic .hljs-variable,.hljs-ascetic .hljs-template-variable,.hljs-ascetic .hljs-symbol,.hljs-ascetic .hljs-bullet,.hljs-ascetic .hljs-section,.hljs-ascetic .hljs-addition,.hljs-ascetic .hljs-attribute,.hljs-ascetic .hljs-link{color:#888}.hljs-ascetic .hljs-comment,.hljs-ascetic .hljs-quote,.hljs-ascetic .hljs-meta,.hljs-ascetic .hljs-deletion{color:#ccc}.hljs-ascetic .hljs-keyword,.hljs-ascetic .hljs-selector-tag,.hljs-ascetic .hljs-section,.hljs-ascetic .hljs-name,.hljs-ascetic .hljs-type,.hljs-ascetic .hljs-strong{font-weight:bold}.hljs-ascetic .hljs-emphasis{font-style:italic}.hljs-atelier-cave-dark .hljs-comment,.hljs-atelier-cave-dark .hljs-quote{color:#7e7887}.hljs-atelier-cave-dark .hljs-variable,.hljs-atelier-cave-dark .hljs-template-variable,.hljs-atelier-cave-dark .hljs-attribute,.hljs-atelier-cave-dark .hljs-regexp,.hljs-atelier-cave-dark .hljs-link,.hljs-atelier-cave-dark .hljs-tag,.hljs-atelier-cave-dark .hljs-name,.hljs-atelier-cave-dark .hljs-selector-id,.hljs-atelier-cave-dark .hljs-selector-class{color:#be4678}.hljs-atelier-cave-dark .hljs-number,.hljs-atelier-cave-dark .hljs-meta,.hljs-atelier-cave-dark .hljs-built_in,.hljs-atelier-cave-dark .hljs-builtin-name,.hljs-atelier-cave-dark .hljs-literal,.hljs-atelier-cave-dark .hljs-type,.hljs-atelier-cave-dark .hljs-params{color:#aa573c}.hljs-atelier-cave-dark .hljs-string,.hljs-atelier-cave-dark .hljs-symbol,.hljs-atelier-cave-dark .hljs-bullet{color:#2a9292}.hljs-atelier-cave-dark .hljs-title,.hljs-atelier-cave-dark .hljs-section{color:#576ddb}.hljs-atelier-cave-dark .hljs-keyword,.hljs-atelier-cave-dark .hljs-selector-tag{color:#955ae7}.hljs-atelier-cave-dark .hljs-deletion,.hljs-atelier-cave-dark .hljs-addition{color:#19171c;display:inline-block;width:100%}.hljs-atelier-cave-dark .hljs-deletion{background-color:#be4678}.hljs-atelier-cave-dark .hljs-addition{background-color:#2a9292}.hljs-atelier-cave-dark .hljs{display:block;overflow-x:auto;background:#19171c;color:#8b8792;padding:.5em}.hljs-atelier-cave-dark .hljs-emphasis{font-style:italic}.hljs-atelier-cave-dark .hljs-strong{font-weight:bold}.hljs-atelier-cave-light .hljs-comment,.hljs-atelier-cave-light .hljs-quote{color:#655f6d}.hljs-atelier-cave-light .hljs-variable,.hljs-atelier-cave-light .hljs-template-variable,.hljs-atelier-cave-light .hljs-attribute,.hljs-atelier-cave-light .hljs-tag,.hljs-atelier-cave-light .hljs-name,.hljs-atelier-cave-light .hljs-regexp,.hljs-atelier-cave-light .hljs-link,.hljs-atelier-cave-light .hljs-name,.hljs-atelier-cave-light .hljs-name,.hljs-atelier-cave-light .hljs-selector-id,.hljs-atelier-cave-light .hljs-selector-class{color:#be4678}.hljs-atelier-cave-light .hljs-number,.hljs-atelier-cave-light .hljs-meta,.hljs-atelier-cave-light .hljs-built_in,.hljs-atelier-cave-light .hljs-builtin-name,.hljs-atelier-cave-light .hljs-literal,.hljs-atelier-cave-light .hljs-type,.hljs-atelier-cave-light .hljs-params{color:#aa573c}.hljs-atelier-cave-light .hljs-string,.hljs-atelier-cave-light .hljs-symbol,.hljs-atelier-cave-light .hljs-bullet{color:#2a9292}.hljs-atelier-cave-light .hljs-title,.hljs-atelier-cave-light .hljs-section{color:#576ddb}.hljs-atelier-cave-light .hljs-keyword,.hljs-atelier-cave-light .hljs-selector-tag{color:#955ae7}.hljs-atelier-cave-light .hljs-deletion,.hljs-atelier-cave-light .hljs-addition{color:#19171c;display:inline-block;width:100%}.hljs-atelier-cave-light .hljs-deletion{background-color:#be4678}.hljs-atelier-cave-light .hljs-addition{background-color:#2a9292}.hljs-atelier-cave-light .hljs{display:block;overflow-x:auto;background:#efecf4;color:#585260;padding:.5em}.hljs-atelier-cave-light .hljs-emphasis{font-style:italic}.hljs-atelier-cave-light .hljs-strong{font-weight:bold}.hljs-atelier-dune-dark .hljs-comment,.hljs-atelier-dune-dark .hljs-quote{color:#999580}.hljs-atelier-dune-dark .hljs-variable,.hljs-atelier-dune-dark .hljs-template-variable,.hljs-atelier-dune-dark .hljs-attribute,.hljs-atelier-dune-dark .hljs-tag,.hljs-atelier-dune-dark .hljs-name,.hljs-atelier-dune-dark .hljs-regexp,.hljs-atelier-dune-dark .hljs-link,.hljs-atelier-dune-dark .hljs-name,.hljs-atelier-dune-dark .hljs-selector-id,.hljs-atelier-dune-dark .hljs-selector-class{color:#d73737}.hljs-atelier-dune-dark .hljs-number,.hljs-atelier-dune-dark .hljs-meta,.hljs-atelier-dune-dark .hljs-built_in,.hljs-atelier-dune-dark .hljs-builtin-name,.hljs-atelier-dune-dark .hljs-literal,.hljs-atelier-dune-dark .hljs-type,.hljs-atelier-dune-dark .hljs-params{color:#b65611}.hljs-atelier-dune-dark .hljs-string,.hljs-atelier-dune-dark .hljs-symbol,.hljs-atelier-dune-dark .hljs-bullet{color:#60ac39}.hljs-atelier-dune-dark .hljs-title,.hljs-atelier-dune-dark .hljs-section{color:#6684e1}.hljs-atelier-dune-dark .hljs-keyword,.hljs-atelier-dune-dark .hljs-selector-tag{color:#b854d4}.hljs-atelier-dune-dark .hljs{display:block;overflow-x:auto;background:#20201d;color:#a6a28c;padding:.5em}.hljs-atelier-dune-dark .hljs-emphasis{font-style:italic}.hljs-atelier-dune-dark .hljs-strong{font-weight:bold}.hljs-atelier-dune-light .hljs-comment,.hljs-atelier-dune-light .hljs-quote{color:#7d7a68}.hljs-atelier-dune-light .hljs-variable,.hljs-atelier-dune-light .hljs-template-variable,.hljs-atelier-dune-light .hljs-attribute,.hljs-atelier-dune-light .hljs-tag,.hljs-atelier-dune-light .hljs-name,.hljs-atelier-dune-light .hljs-regexp,.hljs-atelier-dune-light .hljs-link,.hljs-atelier-dune-light .hljs-name,.hljs-atelier-dune-light .hljs-selector-id,.hljs-atelier-dune-light .hljs-selector-class{color:#d73737}.hljs-atelier-dune-light .hljs-number,.hljs-atelier-dune-light .hljs-meta,.hljs-atelier-dune-light .hljs-built_in,.hljs-atelier-dune-light .hljs-builtin-name,.hljs-atelier-dune-light .hljs-literal,.hljs-atelier-dune-light .hljs-type,.hljs-atelier-dune-light .hljs-params{color:#b65611}.hljs-atelier-dune-light .hljs-string,.hljs-atelier-dune-light .hljs-symbol,.hljs-atelier-dune-light .hljs-bullet{color:#60ac39}.hljs-atelier-dune-light .hljs-title,.hljs-atelier-dune-light .hljs-section{color:#6684e1}.hljs-atelier-dune-light .hljs-keyword,.hljs-atelier-dune-light .hljs-selector-tag{color:#b854d4}.hljs-atelier-dune-light .hljs{display:block;overflow-x:auto;background:#fefbec;color:#6e6b5e;padding:.5em}.hljs-atelier-dune-light .hljs-emphasis{font-style:italic}.hljs-atelier-dune-light .hljs-strong{font-weight:bold}.hljs-atelier-estuary-dark .hljs-comment,.hljs-atelier-estuary-dark .hljs-quote{color:#878573}.hljs-atelier-estuary-dark .hljs-variable,.hljs-atelier-estuary-dark .hljs-template-variable,.hljs-atelier-estuary-dark .hljs-attribute,.hljs-atelier-estuary-dark .hljs-tag,.hljs-atelier-estuary-dark .hljs-name,.hljs-atelier-estuary-dark .hljs-regexp,.hljs-atelier-estuary-dark .hljs-link,.hljs-atelier-estuary-dark .hljs-name,.hljs-atelier-estuary-dark .hljs-selector-id,.hljs-atelier-estuary-dark .hljs-selector-class{color:#ba6236}.hljs-atelier-estuary-dark .hljs-number,.hljs-atelier-estuary-dark .hljs-meta,.hljs-atelier-estuary-dark .hljs-built_in,.hljs-atelier-estuary-dark .hljs-builtin-name,.hljs-atelier-estuary-dark .hljs-literal,.hljs-atelier-estuary-dark .hljs-type,.hljs-atelier-estuary-dark .hljs-params{color:#ae7313}.hljs-atelier-estuary-dark .hljs-string,.hljs-atelier-estuary-dark .hljs-symbol,.hljs-atelier-estuary-dark .hljs-bullet{color:#7d9726}.hljs-atelier-estuary-dark .hljs-title,.hljs-atelier-estuary-dark .hljs-section{color:#36a166}.hljs-atelier-estuary-dark .hljs-keyword,.hljs-atelier-estuary-dark .hljs-selector-tag{color:#5f9182}.hljs-atelier-estuary-dark .hljs-deletion,.hljs-atelier-estuary-dark .hljs-addition{color:#22221b;display:inline-block;width:100%}.hljs-atelier-estuary-dark .hljs-deletion{background-color:#ba6236}.hljs-atelier-estuary-dark .hljs-addition{background-color:#7d9726}.hljs-atelier-estuary-dark .hljs{display:block;overflow-x:auto;background:#22221b;color:#929181;padding:.5em}.hljs-atelier-estuary-dark .hljs-emphasis{font-style:italic}.hljs-atelier-estuary-dark .hljs-strong{font-weight:bold}.hljs-atelier-estuary-light .hljs-comment,.hljs-atelier-estuary-light .hljs-quote{color:#6c6b5a}.hljs-atelier-estuary-light .hljs-variable,.hljs-atelier-estuary-light .hljs-template-variable,.hljs-atelier-estuary-light .hljs-attribute,.hljs-atelier-estuary-light .hljs-tag,.hljs-atelier-estuary-light .hljs-name,.hljs-atelier-estuary-light .hljs-regexp,.hljs-atelier-estuary-light .hljs-link,.hljs-atelier-estuary-light .hljs-name,.hljs-atelier-estuary-light .hljs-selector-id,.hljs-atelier-estuary-light .hljs-selector-class{color:#ba6236}.hljs-atelier-estuary-light .hljs-number,.hljs-atelier-estuary-light .hljs-meta,.hljs-atelier-estuary-light .hljs-built_in,.hljs-atelier-estuary-light .hljs-builtin-name,.hljs-atelier-estuary-light .hljs-literal,.hljs-atelier-estuary-light .hljs-type,.hljs-atelier-estuary-light .hljs-params{color:#ae7313}.hljs-atelier-estuary-light .hljs-string,.hljs-atelier-estuary-light .hljs-symbol,.hljs-atelier-estuary-light .hljs-bullet{color:#7d9726}.hljs-atelier-estuary-light .hljs-title,.hljs-atelier-estuary-light .hljs-section{color:#36a166}.hljs-atelier-estuary-light .hljs-keyword,.hljs-atelier-estuary-light .hljs-selector-tag{color:#5f9182}.hljs-atelier-estuary-light .hljs-deletion,.hljs-atelier-estuary-light .hljs-addition{color:#22221b;display:inline-block;width:100%}.hljs-atelier-estuary-light .hljs-deletion{background-color:#ba6236}.hljs-atelier-estuary-light .hljs-addition{background-color:#7d9726}.hljs-atelier-estuary-light .hljs{display:block;overflow-x:auto;background:#f4f3ec;color:#5f5e4e;padding:.5em}.hljs-atelier-estuary-light .hljs-emphasis{font-style:italic}.hljs-atelier-estuary-light .hljs-strong{font-weight:bold}.hljs-atelier-forest-dark .hljs-comment,.hljs-atelier-forest-dark .hljs-quote{color:#9c9491}.hljs-atelier-forest-dark .hljs-variable,.hljs-atelier-forest-dark .hljs-template-variable,.hljs-atelier-forest-dark .hljs-attribute,.hljs-atelier-forest-dark .hljs-tag,.hljs-atelier-forest-dark .hljs-name,.hljs-atelier-forest-dark .hljs-regexp,.hljs-atelier-forest-dark .hljs-link,.hljs-atelier-forest-dark .hljs-name,.hljs-atelier-forest-dark .hljs-selector-id,.hljs-atelier-forest-dark .hljs-selector-class{color:#f22c40}.hljs-atelier-forest-dark .hljs-number,.hljs-atelier-forest-dark .hljs-meta,.hljs-atelier-forest-dark .hljs-built_in,.hljs-atelier-forest-dark .hljs-builtin-name,.hljs-atelier-forest-dark .hljs-literal,.hljs-atelier-forest-dark .hljs-type,.hljs-atelier-forest-dark .hljs-params{color:#df5320}.hljs-atelier-forest-dark .hljs-string,.hljs-atelier-forest-dark .hljs-symbol,.hljs-atelier-forest-dark .hljs-bullet{color:#7b9726}.hljs-atelier-forest-dark .hljs-title,.hljs-atelier-forest-dark .hljs-section{color:#407ee7}.hljs-atelier-forest-dark .hljs-keyword,.hljs-atelier-forest-dark .hljs-selector-tag{color:#6666ea}.hljs-atelier-forest-dark .hljs{display:block;overflow-x:auto;background:#1b1918;color:#a8a19f;padding:.5em}.hljs-atelier-forest-dark .hljs-emphasis{font-style:italic}.hljs-atelier-forest-dark .hljs-strong{font-weight:bold}.hljs-atelier-forest-light .hljs-comment,.hljs-atelier-forest-light .hljs-quote{color:#766e6b}.hljs-atelier-forest-light .hljs-variable,.hljs-atelier-forest-light .hljs-template-variable,.hljs-atelier-forest-light .hljs-attribute,.hljs-atelier-forest-light .hljs-tag,.hljs-atelier-forest-light .hljs-name,.hljs-atelier-forest-light .hljs-regexp,.hljs-atelier-forest-light .hljs-link,.hljs-atelier-forest-light .hljs-name,.hljs-atelier-forest-light .hljs-selector-id,.hljs-atelier-forest-light .hljs-selector-class{color:#f22c40}.hljs-atelier-forest-light .hljs-number,.hljs-atelier-forest-light .hljs-meta,.hljs-atelier-forest-light .hljs-built_in,.hljs-atelier-forest-light .hljs-builtin-name,.hljs-atelier-forest-light .hljs-literal,.hljs-atelier-forest-light .hljs-type,.hljs-atelier-forest-light .hljs-params{color:#df5320}.hljs-atelier-forest-light .hljs-string,.hljs-atelier-forest-light .hljs-symbol,.hljs-atelier-forest-light .hljs-bullet{color:#7b9726}.hljs-atelier-forest-light .hljs-title,.hljs-atelier-forest-light .hljs-section{color:#407ee7}.hljs-atelier-forest-light .hljs-keyword,.hljs-atelier-forest-light .hljs-selector-tag{color:#6666ea}.hljs-atelier-forest-light .hljs{display:block;overflow-x:auto;background:#f1efee;color:#68615e;padding:.5em}.hljs-atelier-forest-light .hljs-emphasis{font-style:italic}.hljs-atelier-forest-light .hljs-strong{font-weight:bold}.hljs-atelier-heath-dark .hljs-comment,.hljs-atelier-heath-dark .hljs-quote{color:#9e8f9e}.hljs-atelier-heath-dark .hljs-variable,.hljs-atelier-heath-dark .hljs-template-variable,.hljs-atelier-heath-dark .hljs-attribute,.hljs-atelier-heath-dark .hljs-tag,.hljs-atelier-heath-dark .hljs-name,.hljs-atelier-heath-dark .hljs-regexp,.hljs-atelier-heath-dark .hljs-link,.hljs-atelier-heath-dark .hljs-name,.hljs-atelier-heath-dark .hljs-selector-id,.hljs-atelier-heath-dark .hljs-selector-class{color:#ca402b}.hljs-atelier-heath-dark .hljs-number,.hljs-atelier-heath-dark .hljs-meta,.hljs-atelier-heath-dark .hljs-built_in,.hljs-atelier-heath-dark .hljs-builtin-name,.hljs-atelier-heath-dark .hljs-literal,.hljs-atelier-heath-dark .hljs-type,.hljs-atelier-heath-dark .hljs-params{color:#a65926}.hljs-atelier-heath-dark .hljs-string,.hljs-atelier-heath-dark .hljs-symbol,.hljs-atelier-heath-dark .hljs-bullet{color:#918b3b}.hljs-atelier-heath-dark .hljs-title,.hljs-atelier-heath-dark .hljs-section{color:#516aec}.hljs-atelier-heath-dark .hljs-keyword,.hljs-atelier-heath-dark .hljs-selector-tag{color:#7b59c0}.hljs-atelier-heath-dark .hljs{display:block;overflow-x:auto;background:#1b181b;color:#ab9bab;padding:.5em}.hljs-atelier-heath-dark .hljs-emphasis{font-style:italic}.hljs-atelier-heath-dark .hljs-strong{font-weight:bold}.hljs-atelier-heath-light .hljs-comment,.hljs-atelier-heath-light .hljs-quote{color:#776977}.hljs-atelier-heath-light .hljs-variable,.hljs-atelier-heath-light .hljs-template-variable,.hljs-atelier-heath-light .hljs-attribute,.hljs-atelier-heath-light .hljs-tag,.hljs-atelier-heath-light .hljs-name,.hljs-atelier-heath-light .hljs-regexp,.hljs-atelier-heath-light .hljs-link,.hljs-atelier-heath-light .hljs-name,.hljs-atelier-heath-light .hljs-selector-id,.hljs-atelier-heath-light .hljs-selector-class{color:#ca402b}.hljs-atelier-heath-light .hljs-number,.hljs-atelier-heath-light .hljs-meta,.hljs-atelier-heath-light .hljs-built_in,.hljs-atelier-heath-light .hljs-builtin-name,.hljs-atelier-heath-light .hljs-literal,.hljs-atelier-heath-light .hljs-type,.hljs-atelier-heath-light .hljs-params{color:#a65926}.hljs-atelier-heath-light .hljs-string,.hljs-atelier-heath-light .hljs-symbol,.hljs-atelier-heath-light .hljs-bullet{color:#918b3b}.hljs-atelier-heath-light .hljs-title,.hljs-atelier-heath-light .hljs-section{color:#516aec}.hljs-atelier-heath-light .hljs-keyword,.hljs-atelier-heath-light .hljs-selector-tag{color:#7b59c0}.hljs-atelier-heath-light .hljs{display:block;overflow-x:auto;background:#f7f3f7;color:#695d69;padding:.5em}.hljs-atelier-heath-light .hljs-emphasis{font-style:italic}.hljs-atelier-heath-light .hljs-strong{font-weight:bold}.hljs-atelier-lakeside-dark .hljs-comment,.hljs-atelier-lakeside-dark .hljs-quote{color:#7195a8}.hljs-atelier-lakeside-dark .hljs-variable,.hljs-atelier-lakeside-dark .hljs-template-variable,.hljs-atelier-lakeside-dark .hljs-attribute,.hljs-atelier-lakeside-dark .hljs-tag,.hljs-atelier-lakeside-dark .hljs-name,.hljs-atelier-lakeside-dark .hljs-regexp,.hljs-atelier-lakeside-dark .hljs-link,.hljs-atelier-lakeside-dark .hljs-name,.hljs-atelier-lakeside-dark .hljs-selector-id,.hljs-atelier-lakeside-dark .hljs-selector-class{color:#d22d72}.hljs-atelier-lakeside-dark .hljs-number,.hljs-atelier-lakeside-dark .hljs-meta,.hljs-atelier-lakeside-dark .hljs-built_in,.hljs-atelier-lakeside-dark .hljs-builtin-name,.hljs-atelier-lakeside-dark .hljs-literal,.hljs-atelier-lakeside-dark .hljs-type,.hljs-atelier-lakeside-dark .hljs-params{color:#935c25}.hljs-atelier-lakeside-dark .hljs-string,.hljs-atelier-lakeside-dark .hljs-symbol,.hljs-atelier-lakeside-dark .hljs-bullet{color:#568c3b}.hljs-atelier-lakeside-dark .hljs-title,.hljs-atelier-lakeside-dark .hljs-section{color:#257fad}.hljs-atelier-lakeside-dark .hljs-keyword,.hljs-atelier-lakeside-dark .hljs-selector-tag{color:#6b6bb8}.hljs-atelier-lakeside-dark .hljs{display:block;overflow-x:auto;background:#161b1d;color:#7ea2b4;padding:.5em}.hljs-atelier-lakeside-dark .hljs-emphasis{font-style:italic}.hljs-atelier-lakeside-dark .hljs-strong{font-weight:bold}.hljs-atelier-lakeside-light .hljs-comment,.hljs-atelier-lakeside-light .hljs-quote{color:#5a7b8c}.hljs-atelier-lakeside-light .hljs-variable,.hljs-atelier-lakeside-light .hljs-template-variable,.hljs-atelier-lakeside-light .hljs-attribute,.hljs-atelier-lakeside-light .hljs-tag,.hljs-atelier-lakeside-light .hljs-name,.hljs-atelier-lakeside-light .hljs-regexp,.hljs-atelier-lakeside-light .hljs-link,.hljs-atelier-lakeside-light .hljs-name,.hljs-atelier-lakeside-light .hljs-selector-id,.hljs-atelier-lakeside-light .hljs-selector-class{color:#d22d72}.hljs-atelier-lakeside-light .hljs-number,.hljs-atelier-lakeside-light .hljs-meta,.hljs-atelier-lakeside-light .hljs-built_in,.hljs-atelier-lakeside-light .hljs-builtin-name,.hljs-atelier-lakeside-light .hljs-literal,.hljs-atelier-lakeside-light .hljs-type,.hljs-atelier-lakeside-light .hljs-params{color:#935c25}.hljs-atelier-lakeside-light .hljs-string,.hljs-atelier-lakeside-light .hljs-symbol,.hljs-atelier-lakeside-light .hljs-bullet{color:#568c3b}.hljs-atelier-lakeside-light .hljs-title,.hljs-atelier-lakeside-light .hljs-section{color:#257fad}.hljs-atelier-lakeside-light .hljs-keyword,.hljs-atelier-lakeside-light .hljs-selector-tag{color:#6b6bb8}.hljs-atelier-lakeside-light .hljs{display:block;overflow-x:auto;background:#ebf8ff;color:#516d7b;padding:.5em}.hljs-atelier-lakeside-light .hljs-emphasis{font-style:italic}.hljs-atelier-lakeside-light .hljs-strong{font-weight:bold}.hljs-atelier-plateau-dark .hljs-comment,.hljs-atelier-plateau-dark .hljs-quote{color:#7e7777}.hljs-atelier-plateau-dark .hljs-variable,.hljs-atelier-plateau-dark .hljs-template-variable,.hljs-atelier-plateau-dark .hljs-attribute,.hljs-atelier-plateau-dark .hljs-tag,.hljs-atelier-plateau-dark .hljs-name,.hljs-atelier-plateau-dark .hljs-regexp,.hljs-atelier-plateau-dark .hljs-link,.hljs-atelier-plateau-dark .hljs-name,.hljs-atelier-plateau-dark .hljs-selector-id,.hljs-atelier-plateau-dark .hljs-selector-class{color:#ca4949}.hljs-atelier-plateau-dark .hljs-number,.hljs-atelier-plateau-dark .hljs-meta,.hljs-atelier-plateau-dark .hljs-built_in,.hljs-atelier-plateau-dark .hljs-builtin-name,.hljs-atelier-plateau-dark .hljs-literal,.hljs-atelier-plateau-dark .hljs-type,.hljs-atelier-plateau-dark .hljs-params{color:#b45a3c}.hljs-atelier-plateau-dark .hljs-string,.hljs-atelier-plateau-dark .hljs-symbol,.hljs-atelier-plateau-dark .hljs-bullet{color:#4b8b8b}.hljs-atelier-plateau-dark .hljs-title,.hljs-atelier-plateau-dark .hljs-section{color:#7272ca}.hljs-atelier-plateau-dark .hljs-keyword,.hljs-atelier-plateau-dark .hljs-selector-tag{color:#8464c4}.hljs-atelier-plateau-dark .hljs-deletion,.hljs-atelier-plateau-dark .hljs-addition{color:#1b1818;display:inline-block;width:100%}.hljs-atelier-plateau-dark .hljs-deletion{background-color:#ca4949}.hljs-atelier-plateau-dark .hljs-addition{background-color:#4b8b8b}.hljs-atelier-plateau-dark .hljs{display:block;overflow-x:auto;background:#1b1818;color:#8a8585;padding:.5em}.hljs-atelier-plateau-dark .hljs-emphasis{font-style:italic}.hljs-atelier-plateau-dark .hljs-strong{font-weight:bold}.hljs-atelier-plateau-light .hljs-comment,.hljs-atelier-plateau-light .hljs-quote{color:#655d5d}.hljs-atelier-plateau-light .hljs-variable,.hljs-atelier-plateau-light .hljs-template-variable,.hljs-atelier-plateau-light .hljs-attribute,.hljs-atelier-plateau-light .hljs-tag,.hljs-atelier-plateau-light .hljs-name,.hljs-atelier-plateau-light .hljs-regexp,.hljs-atelier-plateau-light .hljs-link,.hljs-atelier-plateau-light .hljs-name,.hljs-atelier-plateau-light .hljs-selector-id,.hljs-atelier-plateau-light .hljs-selector-class{color:#ca4949}.hljs-atelier-plateau-light .hljs-number,.hljs-atelier-plateau-light .hljs-meta,.hljs-atelier-plateau-light .hljs-built_in,.hljs-atelier-plateau-light .hljs-builtin-name,.hljs-atelier-plateau-light .hljs-literal,.hljs-atelier-plateau-light .hljs-type,.hljs-atelier-plateau-light .hljs-params{color:#b45a3c}.hljs-atelier-plateau-light .hljs-string,.hljs-atelier-plateau-light .hljs-symbol,.hljs-atelier-plateau-light .hljs-bullet{color:#4b8b8b}.hljs-atelier-plateau-light .hljs-title,.hljs-atelier-plateau-light .hljs-section{color:#7272ca}.hljs-atelier-plateau-light .hljs-keyword,.hljs-atelier-plateau-light .hljs-selector-tag{color:#8464c4}.hljs-atelier-plateau-light .hljs-deletion,.hljs-atelier-plateau-light .hljs-addition{color:#1b1818;display:inline-block;width:100%}.hljs-atelier-plateau-light .hljs-deletion{background-color:#ca4949}.hljs-atelier-plateau-light .hljs-addition{background-color:#4b8b8b}.hljs-atelier-plateau-light .hljs{display:block;overflow-x:auto;background:#f4ecec;color:#585050;padding:.5em}.hljs-atelier-plateau-light .hljs-emphasis{font-style:italic}.hljs-atelier-plateau-light .hljs-strong{font-weight:bold}.hljs-atelier-savanna-dark .hljs-comment,.hljs-atelier-savanna-dark .hljs-quote{color:#78877d}.hljs-atelier-savanna-dark .hljs-variable,.hljs-atelier-savanna-dark .hljs-template-variable,.hljs-atelier-savanna-dark .hljs-attribute,.hljs-atelier-savanna-dark .hljs-tag,.hljs-atelier-savanna-dark .hljs-name,.hljs-atelier-savanna-dark .hljs-regexp,.hljs-atelier-savanna-dark .hljs-link,.hljs-atelier-savanna-dark .hljs-name,.hljs-atelier-savanna-dark .hljs-selector-id,.hljs-atelier-savanna-dark .hljs-selector-class{color:#b16139}.hljs-atelier-savanna-dark .hljs-number,.hljs-atelier-savanna-dark .hljs-meta,.hljs-atelier-savanna-dark .hljs-built_in,.hljs-atelier-savanna-dark .hljs-builtin-name,.hljs-atelier-savanna-dark .hljs-literal,.hljs-atelier-savanna-dark .hljs-type,.hljs-atelier-savanna-dark .hljs-params{color:#9f713c}.hljs-atelier-savanna-dark .hljs-string,.hljs-atelier-savanna-dark .hljs-symbol,.hljs-atelier-savanna-dark .hljs-bullet{color:#489963}.hljs-atelier-savanna-dark .hljs-title,.hljs-atelier-savanna-dark .hljs-section{color:#478c90}.hljs-atelier-savanna-dark .hljs-keyword,.hljs-atelier-savanna-dark .hljs-selector-tag{color:#55859b}.hljs-atelier-savanna-dark .hljs-deletion,.hljs-atelier-savanna-dark .hljs-addition{color:#171c19;display:inline-block;width:100%}.hljs-atelier-savanna-dark .hljs-deletion{background-color:#b16139}.hljs-atelier-savanna-dark .hljs-addition{background-color:#489963}.hljs-atelier-savanna-dark .hljs{display:block;overflow-x:auto;background:#171c19;color:#87928a;padding:.5em}.hljs-atelier-savanna-dark .hljs-emphasis{font-style:italic}.hljs-atelier-savanna-dark .hljs-strong{font-weight:bold}.hljs-atelier-savanna-light .hljs-comment,.hljs-atelier-savanna-light .hljs-quote{color:#5f6d64}.hljs-atelier-savanna-light .hljs-variable,.hljs-atelier-savanna-light .hljs-template-variable,.hljs-atelier-savanna-light .hljs-attribute,.hljs-atelier-savanna-light .hljs-tag,.hljs-atelier-savanna-light .hljs-name,.hljs-atelier-savanna-light .hljs-regexp,.hljs-atelier-savanna-light .hljs-link,.hljs-atelier-savanna-light .hljs-name,.hljs-atelier-savanna-light .hljs-selector-id,.hljs-atelier-savanna-light .hljs-selector-class{color:#b16139}.hljs-atelier-savanna-light .hljs-number,.hljs-atelier-savanna-light .hljs-meta,.hljs-atelier-savanna-light .hljs-built_in,.hljs-atelier-savanna-light .hljs-builtin-name,.hljs-atelier-savanna-light .hljs-literal,.hljs-atelier-savanna-light .hljs-type,.hljs-atelier-savanna-light .hljs-params{color:#9f713c}.hljs-atelier-savanna-light .hljs-string,.hljs-atelier-savanna-light .hljs-symbol,.hljs-atelier-savanna-light .hljs-bullet{color:#489963}.hljs-atelier-savanna-light .hljs-title,.hljs-atelier-savanna-light .hljs-section{color:#478c90}.hljs-atelier-savanna-light .hljs-keyword,.hljs-atelier-savanna-light .hljs-selector-tag{color:#55859b}.hljs-atelier-savanna-light .hljs-deletion,.hljs-atelier-savanna-light .hljs-addition{color:#171c19;display:inline-block;width:100%}.hljs-atelier-savanna-light .hljs-deletion{background-color:#b16139}.hljs-atelier-savanna-light .hljs-addition{background-color:#489963}.hljs-atelier-savanna-light .hljs{display:block;overflow-x:auto;background:#ecf4ee;color:#526057;padding:.5em}.hljs-atelier-savanna-light .hljs-emphasis{font-style:italic}.hljs-atelier-savanna-light .hljs-strong{font-weight:bold}.hljs-atelier-seaside-dark .hljs-comment,.hljs-atelier-seaside-dark .hljs-quote{color:#809980}.hljs-atelier-seaside-dark .hljs-variable,.hljs-atelier-seaside-dark .hljs-template-variable,.hljs-atelier-seaside-dark .hljs-attribute,.hljs-atelier-seaside-dark .hljs-tag,.hljs-atelier-seaside-dark .hljs-name,.hljs-atelier-seaside-dark .hljs-regexp,.hljs-atelier-seaside-dark .hljs-link,.hljs-atelier-seaside-dark .hljs-name,.hljs-atelier-seaside-dark .hljs-selector-id,.hljs-atelier-seaside-dark .hljs-selector-class{color:#e6193c}.hljs-atelier-seaside-dark .hljs-number,.hljs-atelier-seaside-dark .hljs-meta,.hljs-atelier-seaside-dark .hljs-built_in,.hljs-atelier-seaside-dark .hljs-builtin-name,.hljs-atelier-seaside-dark .hljs-literal,.hljs-atelier-seaside-dark .hljs-type,.hljs-atelier-seaside-dark .hljs-params{color:#87711d}.hljs-atelier-seaside-dark .hljs-string,.hljs-atelier-seaside-dark .hljs-symbol,.hljs-atelier-seaside-dark .hljs-bullet{color:#29a329}.hljs-atelier-seaside-dark .hljs-title,.hljs-atelier-seaside-dark .hljs-section{color:#3d62f5}.hljs-atelier-seaside-dark .hljs-keyword,.hljs-atelier-seaside-dark .hljs-selector-tag{color:#ad2bee}.hljs-atelier-seaside-dark .hljs{display:block;overflow-x:auto;background:#131513;color:#8ca68c;padding:.5em}.hljs-atelier-seaside-dark .hljs-emphasis{font-style:italic}.hljs-atelier-seaside-dark .hljs-strong{font-weight:bold}.hljs-atelier-seaside-light .hljs-comment,.hljs-atelier-seaside-light .hljs-quote{color:#687d68}.hljs-atelier-seaside-light .hljs-variable,.hljs-atelier-seaside-light .hljs-template-variable,.hljs-atelier-seaside-light .hljs-attribute,.hljs-atelier-seaside-light .hljs-tag,.hljs-atelier-seaside-light .hljs-name,.hljs-atelier-seaside-light .hljs-regexp,.hljs-atelier-seaside-light .hljs-link,.hljs-atelier-seaside-light .hljs-name,.hljs-atelier-seaside-light .hljs-selector-id,.hljs-atelier-seaside-light .hljs-selector-class{color:#e6193c}.hljs-atelier-seaside-light .hljs-number,.hljs-atelier-seaside-light .hljs-meta,.hljs-atelier-seaside-light .hljs-built_in,.hljs-atelier-seaside-light .hljs-builtin-name,.hljs-atelier-seaside-light .hljs-literal,.hljs-atelier-seaside-light .hljs-type,.hljs-atelier-seaside-light .hljs-params{color:#87711d}.hljs-atelier-seaside-light .hljs-string,.hljs-atelier-seaside-light .hljs-symbol,.hljs-atelier-seaside-light .hljs-bullet{color:#29a329}.hljs-atelier-seaside-light .hljs-title,.hljs-atelier-seaside-light .hljs-section{color:#3d62f5}.hljs-atelier-seaside-light .hljs-keyword,.hljs-atelier-seaside-light .hljs-selector-tag{color:#ad2bee}.hljs-atelier-seaside-light .hljs{display:block;overflow-x:auto;background:#f4fbf4;color:#5e6e5e;padding:.5em}.hljs-atelier-seaside-light .hljs-emphasis{font-style:italic}.hljs-atelier-seaside-light .hljs-strong{font-weight:bold}.hljs-atelier-sulphurpool-dark .hljs-comment,.hljs-atelier-sulphurpool-dark .hljs-quote{color:#898ea4}.hljs-atelier-sulphurpool-dark .hljs-variable,.hljs-atelier-sulphurpool-dark .hljs-template-variable,.hljs-atelier-sulphurpool-dark .hljs-attribute,.hljs-atelier-sulphurpool-dark .hljs-tag,.hljs-atelier-sulphurpool-dark .hljs-name,.hljs-atelier-sulphurpool-dark .hljs-regexp,.hljs-atelier-sulphurpool-dark .hljs-link,.hljs-atelier-sulphurpool-dark .hljs-name,.hljs-atelier-sulphurpool-dark .hljs-selector-id,.hljs-atelier-sulphurpool-dark .hljs-selector-class{color:#c94922}.hljs-atelier-sulphurpool-dark .hljs-number,.hljs-atelier-sulphurpool-dark .hljs-meta,.hljs-atelier-sulphurpool-dark .hljs-built_in,.hljs-atelier-sulphurpool-dark .hljs-builtin-name,.hljs-atelier-sulphurpool-dark .hljs-literal,.hljs-atelier-sulphurpool-dark .hljs-type,.hljs-atelier-sulphurpool-dark .hljs-params{color:#c76b29}.hljs-atelier-sulphurpool-dark .hljs-string,.hljs-atelier-sulphurpool-dark .hljs-symbol,.hljs-atelier-sulphurpool-dark .hljs-bullet{color:#ac9739}.hljs-atelier-sulphurpool-dark .hljs-title,.hljs-atelier-sulphurpool-dark .hljs-section{color:#3d8fd1}.hljs-atelier-sulphurpool-dark .hljs-keyword,.hljs-atelier-sulphurpool-dark .hljs-selector-tag{color:#6679cc}.hljs-atelier-sulphurpool-dark .hljs{display:block;overflow-x:auto;background:#202746;color:#979db4;padding:.5em}.hljs-atelier-sulphurpool-dark .hljs-emphasis{font-style:italic}.hljs-atelier-sulphurpool-dark .hljs-strong{font-weight:bold}.hljs-atelier-sulphurpool-light .hljs-comment,.hljs-atelier-sulphurpool-light .hljs-quote{color:#6b7394}.hljs-atelier-sulphurpool-light .hljs-variable,.hljs-atelier-sulphurpool-light .hljs-template-variable,.hljs-atelier-sulphurpool-light .hljs-attribute,.hljs-atelier-sulphurpool-light .hljs-tag,.hljs-atelier-sulphurpool-light .hljs-name,.hljs-atelier-sulphurpool-light .hljs-regexp,.hljs-atelier-sulphurpool-light .hljs-link,.hljs-atelier-sulphurpool-light .hljs-name,.hljs-atelier-sulphurpool-light .hljs-selector-id,.hljs-atelier-sulphurpool-light .hljs-selector-class{color:#c94922}.hljs-atelier-sulphurpool-light .hljs-number,.hljs-atelier-sulphurpool-light .hljs-meta,.hljs-atelier-sulphurpool-light .hljs-built_in,.hljs-atelier-sulphurpool-light .hljs-builtin-name,.hljs-atelier-sulphurpool-light .hljs-literal,.hljs-atelier-sulphurpool-light .hljs-type,.hljs-atelier-sulphurpool-light .hljs-params{color:#c76b29}.hljs-atelier-sulphurpool-light .hljs-string,.hljs-atelier-sulphurpool-light .hljs-symbol,.hljs-atelier-sulphurpool-light .hljs-bullet{color:#ac9739}.hljs-atelier-sulphurpool-light .hljs-title,.hljs-atelier-sulphurpool-light .hljs-section{color:#3d8fd1}.hljs-atelier-sulphurpool-light .hljs-keyword,.hljs-atelier-sulphurpool-light .hljs-selector-tag{color:#6679cc}.hljs-atelier-sulphurpool-light .hljs{display:block;overflow-x:auto;background:#f5f7ff;color:#5e6687;padding:.5em}.hljs-atelier-sulphurpool-light .hljs-emphasis{font-style:italic}.hljs-atelier-sulphurpool-light .hljs-strong{font-weight:bold}.hljs-atom-one-dark .hljs{display:block;overflow-x:auto;padding:.5em;color:#abb2bf;background:#282c34}.hljs-atom-one-dark .hljs-comment,.hljs-atom-one-dark .hljs-quote{color:#5c6370;font-style:italic}.hljs-atom-one-dark .hljs-doctag,.hljs-atom-one-dark .hljs-keyword,.hljs-atom-one-dark .hljs-formula{color:#c678dd}.hljs-atom-one-dark .hljs-section,.hljs-atom-one-dark .hljs-name,.hljs-atom-one-dark .hljs-selector-tag,.hljs-atom-one-dark .hljs-deletion,.hljs-atom-one-dark .hljs-subst{color:#e06c75}.hljs-atom-one-dark .hljs-literal{color:#56b6c2}.hljs-atom-one-dark .hljs-string,.hljs-atom-one-dark .hljs-regexp,.hljs-atom-one-dark .hljs-addition,.hljs-atom-one-dark .hljs-attribute,.hljs-atom-one-dark .hljs-meta-string{color:#98c379}.hljs-atom-one-dark .hljs-built_in,.hljs-atom-one-dark .hljs-class .hljs-title{color:#e6c07b}.hljs-atom-one-dark .hljs-variable,.hljs-atom-one-dark .hljs-template-variable,.hljs-atom-one-dark .hljs-type,.hljs-atom-one-dark .hljs-selector-class,.hljs-atom-one-dark .hljs-selector-attr,.hljs-atom-one-dark .hljs-selector-pseudo,.hljs-atom-one-dark .hljs-number{color:#d19a66}.hljs-atom-one-dark .hljs-symbol,.hljs-atom-one-dark .hljs-bullet,.hljs-atom-one-dark .hljs-link,.hljs-atom-one-dark .hljs-meta,.hljs-atom-one-dark .hljs-selector-id,.hljs-atom-one-dark .hljs-title{color:#61aeee}.hljs-atom-one-dark .hljs-emphasis{font-style:italic}.hljs-atom-one-dark .hljs-strong{font-weight:bold}.hljs-atom-one-dark .hljs-link{text-decoration:underline}.hljs-atom-one-light .hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-atom-one-light .hljs-comment,.hljs-atom-one-light .hljs-quote{color:#a0a1a7;font-style:italic}.hljs-atom-one-light .hljs-doctag,.hljs-atom-one-light .hljs-keyword,.hljs-atom-one-light .hljs-formula{color:#a626a4}.hljs-atom-one-light .hljs-section,.hljs-atom-one-light .hljs-name,.hljs-atom-one-light .hljs-selector-tag,.hljs-atom-one-light .hljs-deletion,.hljs-atom-one-light .hljs-subst{color:#e45649}.hljs-atom-one-light .hljs-literal{color:#0184bb}.hljs-atom-one-light .hljs-string,.hljs-atom-one-light .hljs-regexp,.hljs-atom-one-light .hljs-addition,.hljs-atom-one-light .hljs-attribute,.hljs-atom-one-light .hljs-meta-string{color:#50a14f}.hljs-atom-one-light .hljs-built_in,.hljs-atom-one-light .hljs-class .hljs-title{color:#c18401}.hljs-atom-one-light .hljs-variable,.hljs-atom-one-light .hljs-template-variable,.hljs-atom-one-light .hljs-type,.hljs-atom-one-light .hljs-selector-class,.hljs-atom-one-light .hljs-selector-attr,.hljs-atom-one-light .hljs-selector-pseudo,.hljs-atom-one-light .hljs-number{color:#986801}.hljs-atom-one-light .hljs-symbol,.hljs-atom-one-light .hljs-bullet,.hljs-atom-one-light .hljs-link,.hljs-atom-one-light .hljs-meta,.hljs-atom-one-light .hljs-selector-id,.hljs-atom-one-light .hljs-title{color:#4078f2}.hljs-atom-one-light .hljs-emphasis{font-style:italic}.hljs-atom-one-light .hljs-strong{font-weight:bold}.hljs-atom-one-light .hljs-link{text-decoration:underline}.hljs-brown-paper .hljs{display:block;overflow-x:auto;padding:.5em;background:#b7a68e url(brown-papersq.png)}.hljs-brown-paper .hljs-keyword,.hljs-brown-paper .hljs-selector-tag,.hljs-brown-paper .hljs-literal{color:#005599;font-weight:bold}.hljs-brown-paper .hljs,.hljs-brown-paper .hljs-subst{color:#363c69}.hljs-brown-paper .hljs-string,.hljs-brown-paper .hljs-title,.hljs-brown-paper .hljs-section,.hljs-brown-paper .hljs-type,.hljs-brown-paper .hljs-attribute,.hljs-brown-paper .hljs-symbol,.hljs-brown-paper .hljs-bullet,.hljs-brown-paper .hljs-built_in,.hljs-brown-paper .hljs-addition,.hljs-brown-paper .hljs-variable,.hljs-brown-paper .hljs-template-tag,.hljs-brown-paper .hljs-template-variable,.hljs-brown-paper .hljs-link,.hljs-brown-paper .hljs-name{color:#2c009f}.hljs-brown-paper .hljs-comment,.hljs-brown-paper .hljs-quote,.hljs-brown-paper .hljs-meta,.hljs-brown-paper .hljs-deletion{color:#802022}.hljs-brown-paper .hljs-keyword,.hljs-brown-paper .hljs-selector-tag,.hljs-brown-paper .hljs-literal,.hljs-brown-paper .hljs-doctag,.hljs-brown-paper .hljs-title,.hljs-brown-paper .hljs-section,.hljs-brown-paper .hljs-type,.hljs-brown-paper .hljs-name,.hljs-brown-paper .hljs-strong{font-weight:bold}.hljs-brown-paper .hljs-emphasis{font-style:italic}.hljs-codepen-embed .hljs{display:block;overflow-x:auto;padding:.5em;background:#222;color:#fff}.hljs-codepen-embed .hljs-comment,.hljs-codepen-embed .hljs-quote{color:#777}.hljs-codepen-embed .hljs-variable,.hljs-codepen-embed .hljs-template-variable,.hljs-codepen-embed .hljs-tag,.hljs-codepen-embed .hljs-regexp,.hljs-codepen-embed .hljs-meta,.hljs-codepen-embed .hljs-number,.hljs-codepen-embed .hljs-built_in,.hljs-codepen-embed .hljs-builtin-name,.hljs-codepen-embed .hljs-literal,.hljs-codepen-embed .hljs-params,.hljs-codepen-embed .hljs-symbol,.hljs-codepen-embed .hljs-bullet,.hljs-codepen-embed .hljs-link,.hljs-codepen-embed .hljs-deletion{color:#ab875d}.hljs-codepen-embed .hljs-section,.hljs-codepen-embed .hljs-title,.hljs-codepen-embed .hljs-name,.hljs-codepen-embed .hljs-selector-id,.hljs-codepen-embed .hljs-selector-class,.hljs-codepen-embed .hljs-type,.hljs-codepen-embed .hljs-attribute{color:#9b869b}.hljs-codepen-embed .hljs-string,.hljs-codepen-embed .hljs-keyword,.hljs-codepen-embed .hljs-selector-tag,.hljs-codepen-embed .hljs-addition{color:#8f9c6c}.hljs-codepen-embed .hljs-emphasis{font-style:italic}.hljs-codepen-embed .hljs-strong{font-weight:bold}.hljs-color-brewer .hljs{display:block;overflow-x:auto;padding:.5em;background:#fff}.hljs-color-brewer .hljs,.hljs-color-brewer .hljs-subst{color:#000}.hljs-color-brewer .hljs-string,.hljs-color-brewer .hljs-meta,.hljs-color-brewer .hljs-symbol,.hljs-color-brewer .hljs-template-tag,.hljs-color-brewer .hljs-template-variable,.hljs-color-brewer .hljs-addition{color:#756bb1}.hljs-color-brewer .hljs-comment,.hljs-color-brewer .hljs-quote{color:#636363}.hljs-color-brewer .hljs-number,.hljs-color-brewer .hljs-regexp,.hljs-color-brewer .hljs-literal,.hljs-color-brewer .hljs-bullet,.hljs-color-brewer .hljs-link{color:#31a354}.hljs-color-brewer .hljs-deletion,.hljs-color-brewer .hljs-variable{color:#88f}.hljs-color-brewer .hljs-keyword,.hljs-color-brewer .hljs-selector-tag,.hljs-color-brewer .hljs-title,.hljs-color-brewer .hljs-section,.hljs-color-brewer .hljs-built_in,.hljs-color-brewer .hljs-doctag,.hljs-color-brewer .hljs-type,.hljs-color-brewer .hljs-tag,.hljs-color-brewer .hljs-name,.hljs-color-brewer .hljs-selector-id,.hljs-color-brewer .hljs-selector-class,.hljs-color-brewer .hljs-strong{color:#3182bd}.hljs-color-brewer .hljs-emphasis{font-style:italic}.hljs-color-brewer .hljs-attribute{color:#e6550d}.hljs-darcula .hljs{display:block;overflow-x:auto;padding:.5em;background:#2b2b2b}.hljs-darcula .hljs{color:#bababa}.hljs-darcula .hljs-strong,.hljs-darcula .hljs-emphasis{color:#a8a8a2}.hljs-darcula .hljs-bullet,.hljs-darcula .hljs-quote,.hljs-darcula .hljs-link,.hljs-darcula .hljs-number,.hljs-darcula .hljs-regexp,.hljs-darcula .hljs-literal{color:#6896ba}.hljs-darcula .hljs-code,.hljs-darcula .hljs-selector-class{color:#a6e22e}.hljs-darcula .hljs-emphasis{font-style:italic}.hljs-darcula .hljs-keyword,.hljs-darcula .hljs-selector-tag,.hljs-darcula .hljs-section,.hljs-darcula .hljs-attribute,.hljs-darcula .hljs-name,.hljs-darcula .hljs-variable{color:#cb7832}.hljs-darcula .hljs-params{color:#b9b9b9}.hljs-darcula .hljs-string{color:#6a8759}.hljs-darcula .hljs-subst,.hljs-darcula .hljs-type,.hljs-darcula .hljs-built_in,.hljs-darcula .hljs-builtin-name,.hljs-darcula .hljs-symbol,.hljs-darcula .hljs-selector-id,.hljs-darcula .hljs-selector-attr,.hljs-darcula .hljs-selector-pseudo,.hljs-darcula .hljs-template-tag,.hljs-darcula .hljs-template-variable,.hljs-darcula .hljs-addition{color:#e0c46c}.hljs-darcula .hljs-comment,.hljs-darcula .hljs-deletion,.hljs-darcula .hljs-meta{color:#7f7f7f}.hljs-dark .hljs{display:block;overflow-x:auto;padding:.5em;background:#444}.hljs-dark .hljs-keyword,.hljs-dark .hljs-selector-tag,.hljs-dark .hljs-literal,.hljs-dark .hljs-section,.hljs-dark .hljs-link{color:white}.hljs-dark .hljs,.hljs-dark .hljs-subst{color:#ddd}.hljs-dark .hljs-string,.hljs-dark .hljs-title,.hljs-dark .hljs-name,.hljs-dark .hljs-type,.hljs-dark .hljs-attribute,.hljs-dark .hljs-symbol,.hljs-dark .hljs-bullet,.hljs-dark .hljs-built_in,.hljs-dark .hljs-addition,.hljs-dark .hljs-variable,.hljs-dark .hljs-template-tag,.hljs-dark .hljs-template-variable{color:#d88}.hljs-dark .hljs-comment,.hljs-dark .hljs-quote,.hljs-dark .hljs-deletion,.hljs-dark .hljs-meta{color:#777}.hljs-dark .hljs-keyword,.hljs-dark .hljs-selector-tag,.hljs-dark .hljs-literal,.hljs-dark .hljs-title,.hljs-dark .hljs-section,.hljs-dark .hljs-doctag,.hljs-dark .hljs-type,.hljs-dark .hljs-name,.hljs-dark .hljs-strong{font-weight:bold}.hljs-dark .hljs-emphasis{font-style:italic}.hljs-darkula{@import url('darcula.css');}.hljs-default .hljs{display:block;overflow-x:auto;padding:.5em;background:#F0F0F0}.hljs-default .hljs,.hljs-default .hljs-subst{color:#444}.hljs-default .hljs-comment{color:#888888}.hljs-default .hljs-keyword,.hljs-default .hljs-attribute,.hljs-default .hljs-selector-tag,.hljs-default .hljs-meta-keyword,.hljs-default .hljs-doctag,.hljs-default .hljs-name{font-weight:bold}.hljs-default .hljs-type,.hljs-default .hljs-string,.hljs-default .hljs-number,.hljs-default .hljs-selector-id,.hljs-default .hljs-selector-class,.hljs-default .hljs-quote,.hljs-default .hljs-template-tag,.hljs-default .hljs-deletion{color:#880000}.hljs-default .hljs-title,.hljs-default .hljs-section{color:#880000;font-weight:bold}.hljs-default .hljs-regexp,.hljs-default .hljs-symbol,.hljs-default .hljs-variable,.hljs-default .hljs-template-variable,.hljs-default .hljs-link,.hljs-default .hljs-selector-attr,.hljs-default .hljs-selector-pseudo{color:#BC6060}.hljs-default .hljs-literal{color:#78A960}.hljs-default .hljs-built_in,.hljs-default .hljs-bullet,.hljs-default .hljs-code,.hljs-default .hljs-addition{color:#397300}.hljs-default .hljs-meta{color:#1f7199}.hljs-default .hljs-meta-string{color:#4d99bf}.hljs-default .hljs-emphasis{font-style:italic}.hljs-default .hljs-strong{font-weight:bold}.hljs-docco .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}.hljs-docco .hljs-comment,.hljs-docco .hljs-quote{color:#408080;font-style:italic}.hljs-docco .hljs-keyword,.hljs-docco .hljs-selector-tag,.hljs-docco .hljs-literal,.hljs-docco .hljs-subst{color:#954121}.hljs-docco .hljs-number{color:#40a070}.hljs-docco .hljs-string,.hljs-docco .hljs-doctag{color:#219161}.hljs-docco .hljs-selector-id,.hljs-docco .hljs-selector-class,.hljs-docco .hljs-section,.hljs-docco .hljs-type{color:#19469d}.hljs-docco .hljs-params{color:#00f}.hljs-docco .hljs-title{color:#458;font-weight:bold}.hljs-docco .hljs-tag,.hljs-docco .hljs-name,.hljs-docco .hljs-attribute{color:#000080;font-weight:normal}.hljs-docco .hljs-variable,.hljs-docco .hljs-template-variable{color:#008080}.hljs-docco .hljs-regexp,.hljs-docco .hljs-link{color:#b68}.hljs-docco .hljs-symbol,.hljs-docco .hljs-bullet{color:#990073}.hljs-docco .hljs-built_in,.hljs-docco .hljs-builtin-name{color:#0086b3}.hljs-docco .hljs-meta{color:#999;font-weight:bold}.hljs-docco .hljs-deletion{background:#fdd}.hljs-docco .hljs-addition{background:#dfd}.hljs-docco .hljs-emphasis{font-style:italic}.hljs-docco .hljs-strong{font-weight:bold}.hljs-dracula .hljs{display:block;overflow-x:auto;padding:.5em;background:#282a36}.hljs-dracula .hljs-keyword,.hljs-dracula .hljs-selector-tag,.hljs-dracula .hljs-literal,.hljs-dracula .hljs-section,.hljs-dracula .hljs-link{color:#8be9fd}.hljs-dracula .hljs-function .hljs-keyword{color:#ff79c6}.hljs-dracula .hljs,.hljs-dracula .hljs-subst{color:#f8f8f2}.hljs-dracula .hljs-string,.hljs-dracula .hljs-title,.hljs-dracula .hljs-name,.hljs-dracula .hljs-type,.hljs-dracula .hljs-attribute,.hljs-dracula .hljs-symbol,.hljs-dracula .hljs-bullet,.hljs-dracula .hljs-addition,.hljs-dracula .hljs-variable,.hljs-dracula .hljs-template-tag,.hljs-dracula .hljs-template-variable{color:#f1fa8c}.hljs-dracula .hljs-comment,.hljs-dracula .hljs-quote,.hljs-dracula .hljs-deletion,.hljs-dracula .hljs-meta{color:#6272a4}.hljs-dracula .hljs-keyword,.hljs-dracula .hljs-selector-tag,.hljs-dracula .hljs-literal,.hljs-dracula .hljs-title,.hljs-dracula .hljs-section,.hljs-dracula .hljs-doctag,.hljs-dracula .hljs-type,.hljs-dracula .hljs-name,.hljs-dracula .hljs-strong{font-weight:bold}.hljs-dracula .hljs-emphasis{font-style:italic}.hljs-far .hljs{display:block;overflow-x:auto;padding:.5em;background:#000080}.hljs-far .hljs,.hljs-far .hljs-subst{color:#0ff}.hljs-far .hljs-string,.hljs-far .hljs-attribute,.hljs-far .hljs-symbol,.hljs-far .hljs-bullet,.hljs-far .hljs-built_in,.hljs-far .hljs-builtin-name,.hljs-far .hljs-template-tag,.hljs-far .hljs-template-variable,.hljs-far .hljs-addition{color:#ff0}.hljs-far .hljs-keyword,.hljs-far .hljs-selector-tag,.hljs-far .hljs-section,.hljs-far .hljs-type,.hljs-far .hljs-name,.hljs-far .hljs-selector-id,.hljs-far .hljs-selector-class,.hljs-far .hljs-variable{color:#fff}.hljs-far .hljs-comment,.hljs-far .hljs-quote,.hljs-far .hljs-doctag,.hljs-far .hljs-deletion{color:#888}.hljs-far .hljs-number,.hljs-far .hljs-regexp,.hljs-far .hljs-literal,.hljs-far .hljs-link{color:#0f0}.hljs-far .hljs-meta{color:#008080}.hljs-far .hljs-keyword,.hljs-far .hljs-selector-tag,.hljs-far .hljs-title,.hljs-far .hljs-section,.hljs-far .hljs-name,.hljs-far .hljs-strong{font-weight:bold}.hljs-far .hljs-emphasis{font-style:italic}.hljs-foundation .hljs{display:block;overflow-x:auto;padding:.5em;background:#eee;color:black}.hljs-foundation .hljs-link,.hljs-foundation .hljs-emphasis,.hljs-foundation .hljs-attribute,.hljs-foundation .hljs-addition{color:#070}.hljs-foundation .hljs-emphasis{font-style:italic}.hljs-foundation .hljs-strong,.hljs-foundation .hljs-string,.hljs-foundation .hljs-deletion{color:#d14}.hljs-foundation .hljs-strong{font-weight:bold}.hljs-foundation .hljs-quote,.hljs-foundation .hljs-comment{color:#998;font-style:italic}.hljs-foundation .hljs-section,.hljs-foundation .hljs-title{color:#900}.hljs-foundation .hljs-class .hljs-title,.hljs-foundation .hljs-type{color:#458}.hljs-foundation .hljs-variable,.hljs-foundation .hljs-template-variable{color:#336699}.hljs-foundation .hljs-bullet{color:#997700}.hljs-foundation .hljs-meta{color:#3344bb}.hljs-foundation .hljs-code,.hljs-foundation .hljs-number,.hljs-foundation .hljs-literal,.hljs-foundation .hljs-keyword,.hljs-foundation .hljs-selector-tag{color:#099}.hljs-foundation .hljs-regexp{background-color:#fff0ff;color:#880088}.hljs-foundation .hljs-symbol{color:#990073}.hljs-foundation .hljs-tag,.hljs-foundation .hljs-name,.hljs-foundation .hljs-selector-id,.hljs-foundation .hljs-selector-class{color:#007700}.hljs-github-gist .hljs{display:block;background:white;padding:.5em;color:#333333;overflow-x:auto}.hljs-github-gist .hljs-comment,.hljs-github-gist .hljs-meta{color:#969896}.hljs-github-gist .hljs-string,.hljs-github-gist .hljs-variable,.hljs-github-gist .hljs-template-variable,.hljs-github-gist .hljs-strong,.hljs-github-gist .hljs-emphasis,.hljs-github-gist .hljs-quote{color:#df5000}.hljs-github-gist .hljs-keyword,.hljs-github-gist .hljs-selector-tag,.hljs-github-gist .hljs-type{color:#a71d5d}.hljs-github-gist .hljs-literal,.hljs-github-gist .hljs-symbol,.hljs-github-gist .hljs-bullet,.hljs-github-gist .hljs-attribute{color:#0086b3}.hljs-github-gist .hljs-section,.hljs-github-gist .hljs-name{color:#63a35c}.hljs-github-gist .hljs-tag{color:#333333}.hljs-github-gist .hljs-title,.hljs-github-gist .hljs-attr,.hljs-github-gist .hljs-selector-id,.hljs-github-gist .hljs-selector-class,.hljs-github-gist .hljs-selector-attr,.hljs-github-gist .hljs-selector-pseudo{color:#795da3}.hljs-github-gist .hljs-addition{color:#55a532;background-color:#eaffea}.hljs-github-gist .hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-github-gist .hljs-link{text-decoration:underline}.hljs-github .hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-github .hljs-comment,.hljs-github .hljs-quote{color:#998;font-style:italic}.hljs-github .hljs-keyword,.hljs-github .hljs-selector-tag,.hljs-github .hljs-subst{color:#333;font-weight:bold}.hljs-github .hljs-number,.hljs-github .hljs-literal,.hljs-github .hljs-variable,.hljs-github .hljs-template-variable,.hljs-github .hljs-tag .hljs-attr{color:#008080}.hljs-github .hljs-string,.hljs-github .hljs-doctag{color:#d14}.hljs-github .hljs-title,.hljs-github .hljs-section,.hljs-github .hljs-selector-id{color:#900;font-weight:bold}.hljs-github .hljs-subst{font-weight:normal}.hljs-github .hljs-type,.hljs-github .hljs-class .hljs-title{color:#458;font-weight:bold}.hljs-github .hljs-tag,.hljs-github .hljs-name,.hljs-github .hljs-attribute{color:#000080;font-weight:normal}.hljs-github .hljs-regexp,.hljs-github .hljs-link{color:#009926}.hljs-github .hljs-symbol,.hljs-github .hljs-bullet{color:#990073}.hljs-github .hljs-built_in,.hljs-github .hljs-builtin-name{color:#0086b3}.hljs-github .hljs-meta{color:#999;font-weight:bold}.hljs-github .hljs-deletion{background:#fdd}.hljs-github .hljs-addition{background:#dfd}.hljs-github .hljs-emphasis{font-style:italic}.hljs-github .hljs-strong{font-weight:bold}.hljs-googlecode .hljs{display:block;overflow-x:auto;padding:.5em;background:white;color:black}.hljs-googlecode .hljs-comment,.hljs-googlecode .hljs-quote{color:#800}.hljs-googlecode .hljs-keyword,.hljs-googlecode .hljs-selector-tag,.hljs-googlecode .hljs-section,.hljs-googlecode .hljs-title,.hljs-googlecode .hljs-name{color:#008}.hljs-googlecode .hljs-variable,.hljs-googlecode .hljs-template-variable{color:#660}.hljs-googlecode .hljs-string,.hljs-googlecode .hljs-selector-attr,.hljs-googlecode .hljs-selector-pseudo,.hljs-googlecode .hljs-regexp{color:#080}.hljs-googlecode .hljs-literal,.hljs-googlecode .hljs-symbol,.hljs-googlecode .hljs-bullet,.hljs-googlecode .hljs-meta,.hljs-googlecode .hljs-number,.hljs-googlecode .hljs-link{color:#066}.hljs-googlecode .hljs-title,.hljs-googlecode .hljs-doctag,.hljs-googlecode .hljs-type,.hljs-googlecode .hljs-attr,.hljs-googlecode .hljs-built_in,.hljs-googlecode .hljs-builtin-name,.hljs-googlecode .hljs-params{color:#606}.hljs-googlecode .hljs-attribute,.hljs-googlecode .hljs-subst{color:#000}.hljs-googlecode .hljs-formula{background-color:#eee;font-style:italic}.hljs-googlecode .hljs-selector-id,.hljs-googlecode .hljs-selector-class{color:#9B703F}.hljs-googlecode .hljs-addition{background-color:#baeeba}.hljs-googlecode .hljs-deletion{background-color:#ffc8bd}.hljs-googlecode .hljs-doctag,.hljs-googlecode .hljs-strong{font-weight:bold}.hljs-googlecode .hljs-emphasis{font-style:italic}.hljs-grayscale .hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#fff}.hljs-grayscale .hljs-comment,.hljs-grayscale .hljs-quote{color:#777;font-style:italic}.hljs-grayscale .hljs-keyword,.hljs-grayscale .hljs-selector-tag,.hljs-grayscale .hljs-subst{color:#333;font-weight:bold}.hljs-grayscale .hljs-number,.hljs-grayscale .hljs-literal{color:#777}.hljs-grayscale .hljs-string,.hljs-grayscale .hljs-doctag,.hljs-grayscale .hljs-formula{color:#333;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAJ0lEQVQIW2O8e/fufwYGBgZBQUEQxcCIIfDu3Tuwivfv30NUoAsAALHpFMMLqZlPAAAAAElFTkSuQmCC) repeat}.hljs-grayscale .hljs-title,.hljs-grayscale .hljs-section,.hljs-grayscale .hljs-selector-id{color:#000;font-weight:bold}.hljs-grayscale .hljs-subst{font-weight:normal}.hljs-grayscale .hljs-class .hljs-title,.hljs-grayscale .hljs-type,.hljs-grayscale .hljs-name{color:#333;font-weight:bold}.hljs-grayscale .hljs-tag{color:#333}.hljs-grayscale .hljs-regexp{color:#333;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAAPUlEQVQYV2NkQAN37979r6yszIgujiIAU4RNMVwhuiQ6H6wQl3XI4oy4FMHcCJPHcDS6J2A2EqUQpJhohQDexSef15DBCwAAAABJRU5ErkJggg==) repeat}.hljs-grayscale .hljs-symbol,.hljs-grayscale .hljs-bullet,.hljs-grayscale .hljs-link{color:#000;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAKElEQVQIW2NkQAO7d+/+z4gsBhJwdXVlhAvCBECKwIIwAbhKZBUwBQA6hBpm5efZsgAAAABJRU5ErkJggg==) repeat}.hljs-grayscale .hljs-built_in,.hljs-grayscale .hljs-builtin-name{color:#000;text-decoration:underline}.hljs-grayscale .hljs-meta{color:#999;font-weight:bold}.hljs-grayscale .hljs-deletion{color:#fff;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAADCAYAAABS3WWCAAAAE0lEQVQIW2MMDQ39zzhz5kwIAQAyxweWgUHd1AAAAABJRU5ErkJggg==) repeat}.hljs-grayscale .hljs-addition{color:#000;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAALUlEQVQYV2N89+7dfwYk8P79ewZBQUFkIQZGOiu6e/cuiptQHAPl0NtNxAQBAM97Oejj3Dg7AAAAAElFTkSuQmCC) repeat}.hljs-grayscale .hljs-emphasis{font-style:italic}.hljs-grayscale .hljs-strong{font-weight:bold}.hljs-gruvbox-dark .hljs{display:block;overflow-x:auto;padding:.5em;background:#282828}.hljs-gruvbox-dark .hljs,.hljs-gruvbox-dark .hljs-subst{color:#ebdbb2}.hljs-gruvbox-dark .hljs-deletion,.hljs-gruvbox-dark .hljs-formula,.hljs-gruvbox-dark .hljs-keyword,.hljs-gruvbox-dark .hljs-link,.hljs-gruvbox-dark .hljs-selector-tag{color:#fb4934}.hljs-gruvbox-dark .hljs-built_in,.hljs-gruvbox-dark .hljs-emphasis,.hljs-gruvbox-dark .hljs-name,.hljs-gruvbox-dark .hljs-quote,.hljs-gruvbox-dark .hljs-strong,.hljs-gruvbox-dark .hljs-title,.hljs-gruvbox-dark .hljs-variable{color:#83a598}.hljs-gruvbox-dark .hljs-attr,.hljs-gruvbox-dark .hljs-params,.hljs-gruvbox-dark .hljs-template-tag,.hljs-gruvbox-dark .hljs-type{color:#fabd2f}.hljs-gruvbox-dark .hljs-builtin-name,.hljs-gruvbox-dark .hljs-doctag,.hljs-gruvbox-dark .hljs-literal,.hljs-gruvbox-dark .hljs-number{color:#8f3f71}.hljs-gruvbox-dark .hljs-code,.hljs-gruvbox-dark .hljs-meta,.hljs-gruvbox-dark .hljs-regexp,.hljs-gruvbox-dark .hljs-selector-id,.hljs-gruvbox-dark .hljs-template-variable{color:#fe8019}.hljs-gruvbox-dark .hljs-addition,.hljs-gruvbox-dark .hljs-meta-string,.hljs-gruvbox-dark .hljs-section,.hljs-gruvbox-dark .hljs-selector-attr,.hljs-gruvbox-dark .hljs-selector-class,.hljs-gruvbox-dark .hljs-string,.hljs-gruvbox-dark .hljs-symbol{color:#b8bb26}.hljs-gruvbox-dark .hljs-attribute,.hljs-gruvbox-dark .hljs-bullet,.hljs-gruvbox-dark .hljs-class,.hljs-gruvbox-dark .hljs-function,.hljs-gruvbox-dark .hljs-function .hljs-keyword,.hljs-gruvbox-dark .hljs-meta-keyword,.hljs-gruvbox-dark .hljs-selector-pseudo,.hljs-gruvbox-dark .hljs-tag{color:#8ec07c}.hljs-gruvbox-dark .hljs-comment{color:#928374}.hljs-gruvbox-dark .hljs-link_label,.hljs-gruvbox-dark .hljs-literal,.hljs-gruvbox-dark .hljs-number{color:#d3869b}.hljs-gruvbox-dark .hljs-comment,.hljs-gruvbox-dark .hljs-emphasis{font-style:italic}.hljs-gruvbox-dark .hljs-section,.hljs-gruvbox-dark .hljs-strong,.hljs-gruvbox-dark .hljs-tag{font-weight:bold}.hljs-gruvbox-light .hljs{display:block;overflow-x:auto;padding:.5em;background:#fbf1c7}.hljs-gruvbox-light .hljs,.hljs-gruvbox-light .hljs-subst{color:#3c3836}.hljs-gruvbox-light .hljs-deletion,.hljs-gruvbox-light .hljs-formula,.hljs-gruvbox-light .hljs-keyword,.hljs-gruvbox-light .hljs-link,.hljs-gruvbox-light .hljs-selector-tag{color:#9d0006}.hljs-gruvbox-light .hljs-built_in,.hljs-gruvbox-light .hljs-emphasis,.hljs-gruvbox-light .hljs-name,.hljs-gruvbox-light .hljs-quote,.hljs-gruvbox-light .hljs-strong,.hljs-gruvbox-light .hljs-title,.hljs-gruvbox-light .hljs-variable{color:#076678}.hljs-gruvbox-light .hljs-attr,.hljs-gruvbox-light .hljs-params,.hljs-gruvbox-light .hljs-template-tag,.hljs-gruvbox-light .hljs-type{color:#b57614}.hljs-gruvbox-light .hljs-builtin-name,.hljs-gruvbox-light .hljs-doctag,.hljs-gruvbox-light .hljs-literal,.hljs-gruvbox-light .hljs-number{color:#8f3f71}.hljs-gruvbox-light .hljs-code,.hljs-gruvbox-light .hljs-meta,.hljs-gruvbox-light .hljs-regexp,.hljs-gruvbox-light .hljs-selector-id,.hljs-gruvbox-light .hljs-template-variable{color:#af3a03}.hljs-gruvbox-light .hljs-addition,.hljs-gruvbox-light .hljs-meta-string,.hljs-gruvbox-light .hljs-section,.hljs-gruvbox-light .hljs-selector-attr,.hljs-gruvbox-light .hljs-selector-class,.hljs-gruvbox-light .hljs-string,.hljs-gruvbox-light .hljs-symbol{color:#79740e}.hljs-gruvbox-light .hljs-attribute,.hljs-gruvbox-light .hljs-bullet,.hljs-gruvbox-light .hljs-class,.hljs-gruvbox-light .hljs-function,.hljs-gruvbox-light .hljs-function .hljs-keyword,.hljs-gruvbox-light .hljs-meta-keyword,.hljs-gruvbox-light .hljs-selector-pseudo,.hljs-gruvbox-light .hljs-tag{color:#427b58}.hljs-gruvbox-light .hljs-comment{color:#928374}.hljs-gruvbox-light .hljs-link_label,.hljs-gruvbox-light .hljs-literal,.hljs-gruvbox-light .hljs-number{color:#8f3f71}.hljs-gruvbox-light .hljs-comment,.hljs-gruvbox-light .hljs-emphasis{font-style:italic}.hljs-gruvbox-light .hljs-section,.hljs-gruvbox-light .hljs-strong,.hljs-gruvbox-light .hljs-tag{font-weight:bold}.hljs-hopscotch .hljs-comment,.hljs-hopscotch .hljs-quote{color:#989498}.hljs-hopscotch .hljs-variable,.hljs-hopscotch .hljs-template-variable,.hljs-hopscotch .hljs-attribute,.hljs-hopscotch .hljs-tag,.hljs-hopscotch .hljs-name,.hljs-hopscotch .hljs-selector-id,.hljs-hopscotch .hljs-selector-class,.hljs-hopscotch .hljs-regexp,.hljs-hopscotch .hljs-link,.hljs-hopscotch .hljs-deletion{color:#dd464c}.hljs-hopscotch .hljs-number,.hljs-hopscotch .hljs-built_in,.hljs-hopscotch .hljs-builtin-name,.hljs-hopscotch .hljs-literal,.hljs-hopscotch .hljs-type,.hljs-hopscotch .hljs-params{color:#fd8b19}.hljs-hopscotch .hljs-class .hljs-title{color:#fdcc59}.hljs-hopscotch .hljs-string,.hljs-hopscotch .hljs-symbol,.hljs-hopscotch .hljs-bullet,.hljs-hopscotch .hljs-addition{color:#8fc13e}.hljs-hopscotch .hljs-meta{color:#149b93}.hljs-hopscotch .hljs-function,.hljs-hopscotch .hljs-section,.hljs-hopscotch .hljs-title{color:#1290bf}.hljs-hopscotch .hljs-keyword,.hljs-hopscotch .hljs-selector-tag{color:#c85e7c}.hljs-hopscotch .hljs{display:block;background:#322931;color:#b9b5b8;padding:.5em}.hljs-hopscotch .hljs-emphasis{font-style:italic}.hljs-hopscotch .hljs-strong{font-weight:bold}.hljs-hybrid .hljs{display:block;overflow-x:auto;padding:.5em;background:#1d1f21}.hljs-hybrid .hljs::selection,.hljs-hybrid .hljs span::selection{background:#373b41}.hljs-hybrid .hljs::-moz-selection,.hljs-hybrid .hljs span::-moz-selection{background:#373b41}.hljs-hybrid .hljs{color:#c5c8c6}.hljs-hybrid .hljs-title,.hljs-hybrid .hljs-name{color:#f0c674}.hljs-hybrid .hljs-comment,.hljs-hybrid .hljs-meta,.hljs-hybrid .hljs-meta .hljs-keyword{color:#707880}.hljs-hybrid .hljs-number,.hljs-hybrid .hljs-symbol,.hljs-hybrid .hljs-literal,.hljs-hybrid .hljs-deletion,.hljs-hybrid .hljs-link{color:#cc6666}.hljs-hybrid .hljs-string,.hljs-hybrid .hljs-doctag,.hljs-hybrid .hljs-addition,.hljs-hybrid .hljs-regexp,.hljs-hybrid .hljs-selector-attr,.hljs-hybrid .hljs-selector-pseudo{color:#b5bd68}.hljs-hybrid .hljs-attribute,.hljs-hybrid .hljs-code,.hljs-hybrid .hljs-selector-id{color:#b294bb}.hljs-hybrid .hljs-keyword,.hljs-hybrid .hljs-selector-tag,.hljs-hybrid .hljs-bullet,.hljs-hybrid .hljs-tag{color:#81a2be}.hljs-hybrid .hljs-subst,.hljs-hybrid .hljs-variable,.hljs-hybrid .hljs-template-tag,.hljs-hybrid .hljs-template-variable{color:#8abeb7}.hljs-hybrid .hljs-type,.hljs-hybrid .hljs-built_in,.hljs-hybrid .hljs-builtin-name,.hljs-hybrid .hljs-quote,.hljs-hybrid .hljs-section,.hljs-hybrid .hljs-selector-class{color:#de935f}.hljs-hybrid .hljs-emphasis{font-style:italic}.hljs-hybrid .hljs-strong{font-weight:bold}.hljs-idea .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff}.hljs-idea .hljs-subst,.hljs-idea .hljs-title{font-weight:normal;color:#000}.hljs-idea .hljs-comment,.hljs-idea .hljs-quote{color:#808080;font-style:italic}.hljs-idea .hljs-meta{color:#808000}.hljs-idea .hljs-tag{background:#efefef}.hljs-idea .hljs-section,.hljs-idea .hljs-name,.hljs-idea .hljs-literal,.hljs-idea .hljs-keyword,.hljs-idea .hljs-selector-tag,.hljs-idea .hljs-type,.hljs-idea .hljs-selector-id,.hljs-idea .hljs-selector-class{font-weight:bold;color:#000080}.hljs-idea .hljs-attribute,.hljs-idea .hljs-number,.hljs-idea .hljs-regexp,.hljs-idea .hljs-link{font-weight:bold;color:#0000ff}.hljs-idea .hljs-number,.hljs-idea .hljs-regexp,.hljs-idea .hljs-link{font-weight:normal}.hljs-idea .hljs-string{color:#008000;font-weight:bold}.hljs-idea .hljs-symbol,.hljs-idea .hljs-bullet,.hljs-idea .hljs-formula{color:#000;background:#d0eded;font-style:italic}.hljs-idea .hljs-doctag{text-decoration:underline}.hljs-idea .hljs-variable,.hljs-idea .hljs-template-variable{color:#660e7a}.hljs-idea .hljs-addition{background:#baeeba}.hljs-idea .hljs-deletion{background:#ffc8bd}.hljs-idea .hljs-emphasis{font-style:italic}.hljs-idea .hljs-strong{font-weight:bold}.hljs-ir-black .hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}.hljs-ir-black .hljs-comment,.hljs-ir-black .hljs-quote,.hljs-ir-black .hljs-meta{color:#7c7c7c}.hljs-ir-black .hljs-keyword,.hljs-ir-black .hljs-selector-tag,.hljs-ir-black .hljs-tag,.hljs-ir-black .hljs-name{color:#96cbfe}.hljs-ir-black .hljs-attribute,.hljs-ir-black .hljs-selector-id{color:#ffffb6}.hljs-ir-black .hljs-string,.hljs-ir-black .hljs-selector-attr,.hljs-ir-black .hljs-selector-pseudo,.hljs-ir-black .hljs-addition{color:#a8ff60}.hljs-ir-black .hljs-subst{color:#daefa3}.hljs-ir-black .hljs-regexp,.hljs-ir-black .hljs-link{color:#e9c062}.hljs-ir-black .hljs-title,.hljs-ir-black .hljs-section,.hljs-ir-black .hljs-type,.hljs-ir-black .hljs-doctag{color:#ffffb6}.hljs-ir-black .hljs-symbol,.hljs-ir-black .hljs-bullet,.hljs-ir-black .hljs-variable,.hljs-ir-black .hljs-template-variable,.hljs-ir-black .hljs-literal{color:#c6c5fe}.hljs-ir-black .hljs-number,.hljs-ir-black .hljs-deletion{color:#ff73fd}.hljs-ir-black .hljs-emphasis{font-style:italic}.hljs-ir-black .hljs-strong{font-weight:bold}.hljs-kimbie.dark .hljs-comment,.hljs-kimbie.dark .hljs-quote{color:#d6baad}.hljs-kimbie.dark .hljs-variable,.hljs-kimbie.dark .hljs-template-variable,.hljs-kimbie.dark .hljs-tag,.hljs-kimbie.dark .hljs-name,.hljs-kimbie.dark .hljs-selector-id,.hljs-kimbie.dark .hljs-selector-class,.hljs-kimbie.dark .hljs-regexp,.hljs-kimbie.dark .hljs-meta{color:#dc3958}.hljs-kimbie.dark .hljs-number,.hljs-kimbie.dark .hljs-built_in,.hljs-kimbie.dark .hljs-builtin-name,.hljs-kimbie.dark .hljs-literal,.hljs-kimbie.dark .hljs-type,.hljs-kimbie.dark .hljs-params,.hljs-kimbie.dark .hljs-deletion,.hljs-kimbie.dark .hljs-link{color:#f79a32}.hljs-kimbie.dark .hljs-title,.hljs-kimbie.dark .hljs-section,.hljs-kimbie.dark .hljs-attribute{color:#f06431}.hljs-kimbie.dark .hljs-string,.hljs-kimbie.dark .hljs-symbol,.hljs-kimbie.dark .hljs-bullet,.hljs-kimbie.dark .hljs-addition{color:#889b4a}.hljs-kimbie.dark .hljs-keyword,.hljs-kimbie.dark .hljs-selector-tag,.hljs-kimbie.dark .hljs-function{color:#98676a}.hljs-kimbie.dark .hljs{display:block;overflow-x:auto;background:#221a0f;color:#d3af86;padding:.5em}.hljs-kimbie.dark .hljs-emphasis{font-style:italic}.hljs-kimbie.dark .hljs-strong{font-weight:bold}.hljs-kimbie.light .hljs-comment,.hljs-kimbie.light .hljs-quote{color:#a57a4c}.hljs-kimbie.light .hljs-variable,.hljs-kimbie.light .hljs-template-variable,.hljs-kimbie.light .hljs-tag,.hljs-kimbie.light .hljs-name,.hljs-kimbie.light .hljs-selector-id,.hljs-kimbie.light .hljs-selector-class,.hljs-kimbie.light .hljs-regexp,.hljs-kimbie.light .hljs-meta{color:#dc3958}.hljs-kimbie.light .hljs-number,.hljs-kimbie.light .hljs-built_in,.hljs-kimbie.light .hljs-builtin-name,.hljs-kimbie.light .hljs-literal,.hljs-kimbie.light .hljs-type,.hljs-kimbie.light .hljs-params,.hljs-kimbie.light .hljs-deletion,.hljs-kimbie.light .hljs-link{color:#f79a32}.hljs-kimbie.light .hljs-title,.hljs-kimbie.light .hljs-section,.hljs-kimbie.light .hljs-attribute{color:#f06431}.hljs-kimbie.light .hljs-string,.hljs-kimbie.light .hljs-symbol,.hljs-kimbie.light .hljs-bullet,.hljs-kimbie.light .hljs-addition{color:#889b4a}.hljs-kimbie.light .hljs-keyword,.hljs-kimbie.light .hljs-selector-tag,.hljs-kimbie.light .hljs-function{color:#98676a}.hljs-kimbie.light .hljs{display:block;overflow-x:auto;background:#fbebd4;color:#84613d;padding:.5em}.hljs-kimbie.light .hljs-emphasis{font-style:italic}.hljs-kimbie.light .hljs-strong{font-weight:bold}.hljs-magula .hljs{display:block;overflow-x:auto;padding:.5em;background-color:#f4f4f4}.hljs-magula .hljs,.hljs-magula .hljs-subst{color:black}.hljs-magula .hljs-string,.hljs-magula .hljs-title,.hljs-magula .hljs-symbol,.hljs-magula .hljs-bullet,.hljs-magula .hljs-attribute,.hljs-magula .hljs-addition,.hljs-magula .hljs-variable,.hljs-magula .hljs-template-tag,.hljs-magula .hljs-template-variable{color:#050}.hljs-magula .hljs-comment,.hljs-magula .hljs-quote{color:#777}.hljs-magula .hljs-number,.hljs-magula .hljs-regexp,.hljs-magula .hljs-literal,.hljs-magula .hljs-type,.hljs-magula .hljs-link{color:#800}.hljs-magula .hljs-deletion,.hljs-magula .hljs-meta{color:#00e}.hljs-magula .hljs-keyword,.hljs-magula .hljs-selector-tag,.hljs-magula .hljs-doctag,.hljs-magula .hljs-title,.hljs-magula .hljs-section,.hljs-magula .hljs-built_in,.hljs-magula .hljs-tag,.hljs-magula .hljs-name{font-weight:bold;color:navy}.hljs-magula .hljs-emphasis{font-style:italic}.hljs-magula .hljs-strong{font-weight:bold}.hljs-mono-blue .hljs{display:block;overflow-x:auto;padding:.5em;background:#eaeef3}.hljs-mono-blue .hljs{color:#00193a}.hljs-mono-blue .hljs-keyword,.hljs-mono-blue .hljs-selector-tag,.hljs-mono-blue .hljs-title,.hljs-mono-blue .hljs-section,.hljs-mono-blue .hljs-doctag,.hljs-mono-blue .hljs-name,.hljs-mono-blue .hljs-strong{font-weight:bold}.hljs-mono-blue .hljs-comment{color:#738191}.hljs-mono-blue .hljs-string,.hljs-mono-blue .hljs-title,.hljs-mono-blue .hljs-section,.hljs-mono-blue .hljs-built_in,.hljs-mono-blue .hljs-literal,.hljs-mono-blue .hljs-type,.hljs-mono-blue .hljs-addition,.hljs-mono-blue .hljs-tag,.hljs-mono-blue .hljs-quote,.hljs-mono-blue .hljs-name,.hljs-mono-blue .hljs-selector-id,.hljs-mono-blue .hljs-selector-class{color:#0048ab}.hljs-mono-blue .hljs-meta,.hljs-mono-blue .hljs-subst,.hljs-mono-blue .hljs-symbol,.hljs-mono-blue .hljs-regexp,.hljs-mono-blue .hljs-attribute,.hljs-mono-blue .hljs-deletion,.hljs-mono-blue .hljs-variable,.hljs-mono-blue .hljs-template-variable,.hljs-mono-blue .hljs-link,.hljs-mono-blue .hljs-bullet{color:#4c81c9}.hljs-mono-blue .hljs-emphasis{font-style:italic}.hljs-monokai-sublime .hljs{display:block;overflow-x:auto;padding:.5em;background:#23241f}.hljs-monokai-sublime .hljs,.hljs-monokai-sublime .hljs-tag,.hljs-monokai-sublime .hljs-subst{color:#f8f8f2}.hljs-monokai-sublime .hljs-strong,.hljs-monokai-sublime .hljs-emphasis{color:#a8a8a2}.hljs-monokai-sublime .hljs-bullet,.hljs-monokai-sublime .hljs-quote,.hljs-monokai-sublime .hljs-number,.hljs-monokai-sublime .hljs-regexp,.hljs-monokai-sublime .hljs-literal,.hljs-monokai-sublime .hljs-link{color:#ae81ff}.hljs-monokai-sublime .hljs-code,.hljs-monokai-sublime .hljs-title,.hljs-monokai-sublime .hljs-section,.hljs-monokai-sublime .hljs-selector-class{color:#a6e22e}.hljs-monokai-sublime .hljs-strong{font-weight:bold}.hljs-monokai-sublime .hljs-emphasis{font-style:italic}.hljs-monokai-sublime .hljs-keyword,.hljs-monokai-sublime .hljs-selector-tag,.hljs-monokai-sublime .hljs-name,.hljs-monokai-sublime .hljs-attr{color:#f92672}.hljs-monokai-sublime .hljs-symbol,.hljs-monokai-sublime .hljs-attribute{color:#66d9ef}.hljs-monokai-sublime .hljs-params,.hljs-monokai-sublime .hljs-class .hljs-title{color:#f8f8f2}.hljs-monokai-sublime .hljs-string,.hljs-monokai-sublime .hljs-type,.hljs-monokai-sublime .hljs-built_in,.hljs-monokai-sublime .hljs-builtin-name,.hljs-monokai-sublime .hljs-selector-id,.hljs-monokai-sublime .hljs-selector-attr,.hljs-monokai-sublime .hljs-selector-pseudo,.hljs-monokai-sublime .hljs-addition,.hljs-monokai-sublime .hljs-variable,.hljs-monokai-sublime .hljs-template-variable{color:#e6db74}.hljs-monokai-sublime .hljs-comment,.hljs-monokai-sublime .hljs-deletion,.hljs-monokai-sublime .hljs-meta{color:#75715e}.hljs-monokai .hljs{display:block;overflow-x:auto;padding:.5em;background:#272822;color:#ddd}.hljs-monokai .hljs-tag,.hljs-monokai .hljs-keyword,.hljs-monokai .hljs-selector-tag,.hljs-monokai .hljs-literal,.hljs-monokai .hljs-strong,.hljs-monokai .hljs-name{color:#f92672}.hljs-monokai .hljs-code{color:#66d9ef}.hljs-monokai .hljs-class .hljs-title{color:white}.hljs-monokai .hljs-attribute,.hljs-monokai .hljs-symbol,.hljs-monokai .hljs-regexp,.hljs-monokai .hljs-link{color:#bf79db}.hljs-monokai .hljs-string,.hljs-monokai .hljs-bullet,.hljs-monokai .hljs-subst,.hljs-monokai .hljs-title,.hljs-monokai .hljs-section,.hljs-monokai .hljs-emphasis,.hljs-monokai .hljs-type,.hljs-monokai .hljs-built_in,.hljs-monokai .hljs-builtin-name,.hljs-monokai .hljs-selector-attr,.hljs-monokai .hljs-selector-pseudo,.hljs-monokai .hljs-addition,.hljs-monokai .hljs-variable,.hljs-monokai .hljs-template-tag,.hljs-monokai .hljs-template-variable{color:#a6e22e}.hljs-monokai .hljs-comment,.hljs-monokai .hljs-quote,.hljs-monokai .hljs-deletion,.hljs-monokai .hljs-meta{color:#75715e}.hljs-monokai .hljs-keyword,.hljs-monokai .hljs-selector-tag,.hljs-monokai .hljs-literal,.hljs-monokai .hljs-doctag,.hljs-monokai .hljs-title,.hljs-monokai .hljs-section,.hljs-monokai .hljs-type,.hljs-monokai .hljs-selector-id{font-weight:bold}.hljs-obsidian .hljs{display:block;overflow-x:auto;padding:.5em;background:#282b2e}.hljs-obsidian .hljs-keyword,.hljs-obsidian .hljs-selector-tag,.hljs-obsidian .hljs-literal,.hljs-obsidian .hljs-selector-id{color:#93c763}.hljs-obsidian .hljs-number{color:#ffcd22}.hljs-obsidian .hljs{color:#e0e2e4}.hljs-obsidian .hljs-attribute{color:#668bb0}.hljs-obsidian .hljs-code,.hljs-obsidian .hljs-class .hljs-title,.hljs-obsidian .hljs-section{color:white}.hljs-obsidian .hljs-regexp,.hljs-obsidian .hljs-link{color:#d39745}.hljs-obsidian .hljs-meta{color:#557182}.hljs-obsidian .hljs-tag,.hljs-obsidian .hljs-name,.hljs-obsidian .hljs-bullet,.hljs-obsidian .hljs-subst,.hljs-obsidian .hljs-emphasis,.hljs-obsidian .hljs-type,.hljs-obsidian .hljs-built_in,.hljs-obsidian .hljs-selector-attr,.hljs-obsidian .hljs-selector-pseudo,.hljs-obsidian .hljs-addition,.hljs-obsidian .hljs-variable,.hljs-obsidian .hljs-template-tag,.hljs-obsidian .hljs-template-variable{color:#8cbbad}.hljs-obsidian .hljs-string,.hljs-obsidian .hljs-symbol{color:#ec7600}.hljs-obsidian .hljs-comment,.hljs-obsidian .hljs-quote,.hljs-obsidian .hljs-deletion{color:#818e96}.hljs-obsidian .hljs-selector-class{color:#A082BD}.hljs-obsidian .hljs-keyword,.hljs-obsidian .hljs-selector-tag,.hljs-obsidian .hljs-literal,.hljs-obsidian .hljs-doctag,.hljs-obsidian .hljs-title,.hljs-obsidian .hljs-section,.hljs-obsidian .hljs-type,.hljs-obsidian .hljs-name,.hljs-obsidian .hljs-strong{font-weight:bold}.hljs-ocean .hljs-comment,.hljs-ocean .hljs-quote{color:#65737e}.hljs-ocean .hljs-variable,.hljs-ocean .hljs-template-variable,.hljs-ocean .hljs-tag,.hljs-ocean .hljs-name,.hljs-ocean .hljs-selector-id,.hljs-ocean .hljs-selector-class,.hljs-ocean .hljs-regexp,.hljs-ocean .hljs-deletion{color:#bf616a}.hljs-ocean .hljs-number,.hljs-ocean .hljs-built_in,.hljs-ocean .hljs-builtin-name,.hljs-ocean .hljs-literal,.hljs-ocean .hljs-type,.hljs-ocean .hljs-params,.hljs-ocean .hljs-meta,.hljs-ocean .hljs-link{color:#d08770}.hljs-ocean .hljs-attribute{color:#ebcb8b}.hljs-ocean .hljs-string,.hljs-ocean .hljs-symbol,.hljs-ocean .hljs-bullet,.hljs-ocean .hljs-addition{color:#a3be8c}.hljs-ocean .hljs-title,.hljs-ocean .hljs-section{color:#8fa1b3}.hljs-ocean .hljs-keyword,.hljs-ocean .hljs-selector-tag{color:#b48ead}.hljs-ocean .hljs{display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:.5em}.hljs-ocean .hljs-emphasis{font-style:italic}.hljs-ocean .hljs-strong{font-weight:bold}.hljs-paraiso-dark .hljs-comment,.hljs-paraiso-dark .hljs-quote{color:#8d8687}.hljs-paraiso-dark .hljs-variable,.hljs-paraiso-dark .hljs-template-variable,.hljs-paraiso-dark .hljs-tag,.hljs-paraiso-dark .hljs-name,.hljs-paraiso-dark .hljs-selector-id,.hljs-paraiso-dark .hljs-selector-class,.hljs-paraiso-dark .hljs-regexp,.hljs-paraiso-dark .hljs-link,.hljs-paraiso-dark .hljs-meta{color:#ef6155}.hljs-paraiso-dark .hljs-number,.hljs-paraiso-dark .hljs-built_in,.hljs-paraiso-dark .hljs-builtin-name,.hljs-paraiso-dark .hljs-literal,.hljs-paraiso-dark .hljs-type,.hljs-paraiso-dark .hljs-params,.hljs-paraiso-dark .hljs-deletion{color:#f99b15}.hljs-paraiso-dark .hljs-title,.hljs-paraiso-dark .hljs-section,.hljs-paraiso-dark .hljs-attribute{color:#fec418}.hljs-paraiso-dark .hljs-string,.hljs-paraiso-dark .hljs-symbol,.hljs-paraiso-dark .hljs-bullet,.hljs-paraiso-dark .hljs-addition{color:#48b685}.hljs-paraiso-dark .hljs-keyword,.hljs-paraiso-dark .hljs-selector-tag{color:#815ba4}.hljs-paraiso-dark .hljs{display:block;overflow-x:auto;background:#2f1e2e;color:#a39e9b;padding:.5em}.hljs-paraiso-dark .hljs-emphasis{font-style:italic}.hljs-paraiso-dark .hljs-strong{font-weight:bold}.hljs-paraiso-light .hljs-comment,.hljs-paraiso-light .hljs-quote{color:#776e71}.hljs-paraiso-light .hljs-variable,.hljs-paraiso-light .hljs-template-variable,.hljs-paraiso-light .hljs-tag,.hljs-paraiso-light .hljs-name,.hljs-paraiso-light .hljs-selector-id,.hljs-paraiso-light .hljs-selector-class,.hljs-paraiso-light .hljs-regexp,.hljs-paraiso-light .hljs-link,.hljs-paraiso-light .hljs-meta{color:#ef6155}.hljs-paraiso-light .hljs-number,.hljs-paraiso-light .hljs-built_in,.hljs-paraiso-light .hljs-builtin-name,.hljs-paraiso-light .hljs-literal,.hljs-paraiso-light .hljs-type,.hljs-paraiso-light .hljs-params,.hljs-paraiso-light .hljs-deletion{color:#f99b15}.hljs-paraiso-light .hljs-title,.hljs-paraiso-light .hljs-section,.hljs-paraiso-light .hljs-attribute{color:#fec418}.hljs-paraiso-light .hljs-string,.hljs-paraiso-light .hljs-symbol,.hljs-paraiso-light .hljs-bullet,.hljs-paraiso-light .hljs-addition{color:#48b685}.hljs-paraiso-light .hljs-keyword,.hljs-paraiso-light .hljs-selector-tag{color:#815ba4}.hljs-paraiso-light .hljs{display:block;overflow-x:auto;background:#e7e9db;color:#4f424c;padding:.5em}.hljs-paraiso-light .hljs-emphasis{font-style:italic}.hljs-paraiso-light .hljs-strong{font-weight:bold}.hljs-purebasic .hljs{display:block;overflow-x:auto;padding:.5em;background:#FFFFDF}.hljs-purebasic .hljs,.hljs-purebasic .hljs-type,.hljs-purebasic .hljs-function,.hljs-purebasic .hljs-name,.hljs-purebasic .hljs-number,.hljs-purebasic .hljs-attr,.hljs-purebasic .hljs-params,.hljs-purebasic .hljs-subst{color:#000000}.hljs-purebasic .hljs-comment,.hljs-purebasic .hljs-regexp,.hljs-purebasic .hljs-section,.hljs-purebasic .hljs-selector-pseudo,.hljs-purebasic .hljs-addition{color:#00AAAA}.hljs-purebasic .hljs-title,.hljs-purebasic .hljs-tag,.hljs-purebasic .hljs-variable,.hljs-purebasic .hljs-code{color:#006666}.hljs-purebasic .hljs-keyword,.hljs-purebasic .hljs-class,.hljs-purebasic .hljs-meta-keyword,.hljs-purebasic .hljs-selector-class,.hljs-purebasic .hljs-built_in,.hljs-purebasic .hljs-builtin-name{color:#006666;font-weight:bold}.hljs-purebasic .hljs-string,.hljs-purebasic .hljs-selector-attr{color:#0080FF}.hljs-purebasic .hljs-symbol,.hljs-purebasic .hljs-link,.hljs-purebasic .hljs-deletion,.hljs-purebasic .hljs-attribute{color:#924B72}.hljs-purebasic .hljs-meta,.hljs-purebasic .hljs-literal,.hljs-purebasic .hljs-selector-id{color:#924B72;font-weight:bold}.hljs-purebasic .hljs-strong,.hljs-purebasic .hljs-name{font-weight:bold}.hljs-purebasic .hljs-emphasis{font-style:italic}.hljs-qtcreator_dark .hljs{display:block;overflow-x:auto;padding:.5em;background:#000000}.hljs-qtcreator_dark .hljs,.hljs-qtcreator_dark .hljs-subst,.hljs-qtcreator_dark .hljs-tag,.hljs-qtcreator_dark .hljs-title{color:#aaaaaa}.hljs-qtcreator_dark .hljs-strong,.hljs-qtcreator_dark .hljs-emphasis{color:#a8a8a2}.hljs-qtcreator_dark .hljs-bullet,.hljs-qtcreator_dark .hljs-quote,.hljs-qtcreator_dark .hljs-number,.hljs-qtcreator_dark .hljs-regexp,.hljs-qtcreator_dark .hljs-literal{color:#ff55ff}.hljs-qtcreator_dark .hljs-code .hljs-selector-class{color:#aaaaff}.hljs-qtcreator_dark .hljs-emphasis,.hljs-qtcreator_dark .hljs-stronge,.hljs-qtcreator_dark .hljs-type{font-style:italic}.hljs-qtcreator_dark .hljs-keyword,.hljs-qtcreator_dark .hljs-selector-tag,.hljs-qtcreator_dark .hljs-function,.hljs-qtcreator_dark .hljs-section,.hljs-qtcreator_dark .hljs-symbol,.hljs-qtcreator_dark .hljs-name{color:#ffff55}.hljs-qtcreator_dark .hljs-attribute{color:#ff5555}.hljs-qtcreator_dark .hljs-variable,.hljs-qtcreator_dark .hljs-params,.hljs-qtcreator_dark .hljs-class .hljs-title{color:#8888ff}.hljs-qtcreator_dark .hljs-string,.hljs-qtcreator_dark .hljs-selector-id,.hljs-qtcreator_dark .hljs-selector-attr,.hljs-qtcreator_dark .hljs-selector-pseudo,.hljs-qtcreator_dark .hljs-type,.hljs-qtcreator_dark .hljs-built_in,.hljs-qtcreator_dark .hljs-builtin-name,.hljs-qtcreator_dark .hljs-template-tag,.hljs-qtcreator_dark .hljs-template-variable,.hljs-qtcreator_dark .hljs-addition,.hljs-qtcreator_dark .hljs-link{color:#ff55ff}.hljs-qtcreator_dark .hljs-comment,.hljs-qtcreator_dark .hljs-meta,.hljs-qtcreator_dark .hljs-deletion{color:#55ffff}.hljs-qtcreator_light .hljs{display:block;overflow-x:auto;padding:.5em;background:#ffffff}.hljs-qtcreator_light .hljs,.hljs-qtcreator_light .hljs-subst,.hljs-qtcreator_light .hljs-tag,.hljs-qtcreator_light .hljs-title{color:#000000}.hljs-qtcreator_light .hljs-strong,.hljs-qtcreator_light .hljs-emphasis{color:#000000}.hljs-qtcreator_light .hljs-bullet,.hljs-qtcreator_light .hljs-quote,.hljs-qtcreator_light .hljs-number,.hljs-qtcreator_light .hljs-regexp,.hljs-qtcreator_light .hljs-literal{color:#000080}.hljs-qtcreator_light .hljs-code .hljs-selector-class{color:#800080}.hljs-qtcreator_light .hljs-emphasis,.hljs-qtcreator_light .hljs-stronge,.hljs-qtcreator_light .hljs-type{font-style:italic}.hljs-qtcreator_light .hljs-keyword,.hljs-qtcreator_light .hljs-selector-tag,.hljs-qtcreator_light .hljs-function,.hljs-qtcreator_light .hljs-section,.hljs-qtcreator_light .hljs-symbol,.hljs-qtcreator_light .hljs-name{color:#808000}.hljs-qtcreator_light .hljs-attribute{color:#800000}.hljs-qtcreator_light .hljs-variable,.hljs-qtcreator_light .hljs-params,.hljs-qtcreator_light .hljs-class .hljs-title{color:#0055AF}.hljs-qtcreator_light .hljs-string,.hljs-qtcreator_light .hljs-selector-id,.hljs-qtcreator_light .hljs-selector-attr,.hljs-qtcreator_light .hljs-selector-pseudo,.hljs-qtcreator_light .hljs-type,.hljs-qtcreator_light .hljs-built_in,.hljs-qtcreator_light .hljs-builtin-name,.hljs-qtcreator_light .hljs-template-tag,.hljs-qtcreator_light .hljs-template-variable,.hljs-qtcreator_light .hljs-addition,.hljs-qtcreator_light .hljs-link{color:#008000}.hljs-qtcreator_light .hljs-comment,.hljs-qtcreator_light .hljs-meta,.hljs-qtcreator_light .hljs-deletion{color:#008000}.hljs-railscasts .hljs{display:block;overflow-x:auto;padding:.5em;background:#232323;color:#e6e1dc}.hljs-railscasts .hljs-comment,.hljs-railscasts .hljs-quote{color:#bc9458;font-style:italic}.hljs-railscasts .hljs-keyword,.hljs-railscasts .hljs-selector-tag{color:#c26230}.hljs-railscasts .hljs-string,.hljs-railscasts .hljs-number,.hljs-railscasts .hljs-regexp,.hljs-railscasts .hljs-variable,.hljs-railscasts .hljs-template-variable{color:#a5c261}.hljs-railscasts .hljs-subst{color:#519f50}.hljs-railscasts .hljs-tag,.hljs-railscasts .hljs-name{color:#e8bf6a}.hljs-railscasts .hljs-type{color:#da4939}.hljs-railscasts .hljs-symbol,.hljs-railscasts .hljs-bullet,.hljs-railscasts .hljs-built_in,.hljs-railscasts .hljs-builtin-name,.hljs-railscasts .hljs-attr,.hljs-railscasts .hljs-link{color:#6d9cbe}.hljs-railscasts .hljs-params{color:#d0d0ff}.hljs-railscasts .hljs-attribute{color:#cda869}.hljs-railscasts .hljs-meta{color:#9b859d}.hljs-railscasts .hljs-title,.hljs-railscasts .hljs-section{color:#ffc66d}.hljs-railscasts .hljs-addition{background-color:#144212;color:#e6e1dc;display:inline-block;width:100%}.hljs-railscasts .hljs-deletion{background-color:#600;color:#e6e1dc;display:inline-block;width:100%}.hljs-railscasts .hljs-selector-class{color:#9b703f}.hljs-railscasts .hljs-selector-id{color:#8b98ab}.hljs-railscasts .hljs-emphasis{font-style:italic}.hljs-railscasts .hljs-strong{font-weight:bold}.hljs-railscasts .hljs-link{text-decoration:underline}.hljs-rainbow .hljs{display:block;overflow-x:auto;padding:.5em;background:#474949;color:#d1d9e1}.hljs-rainbow .hljs-comment,.hljs-rainbow .hljs-quote{color:#969896;font-style:italic}.hljs-rainbow .hljs-keyword,.hljs-rainbow .hljs-selector-tag,.hljs-rainbow .hljs-literal,.hljs-rainbow .hljs-type,.hljs-rainbow .hljs-addition{color:#cc99cc}.hljs-rainbow .hljs-number,.hljs-rainbow .hljs-selector-attr,.hljs-rainbow .hljs-selector-pseudo{color:#f99157}.hljs-rainbow .hljs-string,.hljs-rainbow .hljs-doctag,.hljs-rainbow .hljs-regexp{color:#8abeb7}.hljs-rainbow .hljs-title,.hljs-rainbow .hljs-name,.hljs-rainbow .hljs-section,.hljs-rainbow .hljs-built_in{color:#b5bd68}.hljs-rainbow .hljs-variable,.hljs-rainbow .hljs-template-variable,.hljs-rainbow .hljs-selector-id,.hljs-rainbow .hljs-class .hljs-title{color:#ffcc66}.hljs-rainbow .hljs-section,.hljs-rainbow .hljs-name,.hljs-rainbow .hljs-strong{font-weight:bold}.hljs-rainbow .hljs-symbol,.hljs-rainbow .hljs-bullet,.hljs-rainbow .hljs-subst,.hljs-rainbow .hljs-meta,.hljs-rainbow .hljs-link{color:#f99157}.hljs-rainbow .hljs-deletion{color:#dc322f}.hljs-rainbow .hljs-formula{background:#eee8d5}.hljs-rainbow .hljs-attr,.hljs-rainbow .hljs-attribute{color:#81a2be}.hljs-rainbow .hljs-emphasis{font-style:italic}.hljs-school-book .hljs{display:block;overflow-x:auto;padding:15px .5em .5em 30px;font-size:11px;line-height:16px}.hljs-school-book pre{background:#f6f6ae url(school-book.png);border-top:solid 2px #d2e8b9;border-bottom:solid 1px #d2e8b9}.hljs-school-book .hljs-keyword,.hljs-school-book .hljs-selector-tag,.hljs-school-book .hljs-literal{color:#005599;font-weight:bold}.hljs-school-book .hljs,.hljs-school-book .hljs-subst{color:#3e5915}.hljs-school-book .hljs-string,.hljs-school-book .hljs-title,.hljs-school-book .hljs-section,.hljs-school-book .hljs-type,.hljs-school-book .hljs-symbol,.hljs-school-book .hljs-bullet,.hljs-school-book .hljs-attribute,.hljs-school-book .hljs-built_in,.hljs-school-book .hljs-builtin-name,.hljs-school-book .hljs-addition,.hljs-school-book .hljs-variable,.hljs-school-book .hljs-template-tag,.hljs-school-book .hljs-template-variable,.hljs-school-book .hljs-link{color:#2c009f}.hljs-school-book .hljs-comment,.hljs-school-book .hljs-quote,.hljs-school-book .hljs-deletion,.hljs-school-book .hljs-meta{color:#e60415}.hljs-school-book .hljs-keyword,.hljs-school-book .hljs-selector-tag,.hljs-school-book .hljs-literal,.hljs-school-book .hljs-doctag,.hljs-school-book .hljs-title,.hljs-school-book .hljs-section,.hljs-school-book .hljs-type,.hljs-school-book .hljs-name,.hljs-school-book .hljs-selector-id,.hljs-school-book .hljs-strong{font-weight:bold}.hljs-school-book .hljs-emphasis{font-style:italic}.hljs-solarized-dark .hljs{display:block;overflow-x:auto;padding:.5em;background:#002b36;color:#839496}.hljs-solarized-dark .hljs-comment,.hljs-solarized-dark .hljs-quote{color:#586e75}.hljs-solarized-dark .hljs-keyword,.hljs-solarized-dark .hljs-selector-tag,.hljs-solarized-dark .hljs-addition{color:#859900}.hljs-solarized-dark .hljs-number,.hljs-solarized-dark .hljs-string,.hljs-solarized-dark .hljs-meta .hljs-meta-string,.hljs-solarized-dark .hljs-literal,.hljs-solarized-dark .hljs-doctag,.hljs-solarized-dark .hljs-regexp{color:#2aa198}.hljs-solarized-dark .hljs-title,.hljs-solarized-dark .hljs-section,.hljs-solarized-dark .hljs-name,.hljs-solarized-dark .hljs-selector-id,.hljs-solarized-dark .hljs-selector-class{color:#268bd2}.hljs-solarized-dark .hljs-attribute,.hljs-solarized-dark .hljs-attr,.hljs-solarized-dark .hljs-variable,.hljs-solarized-dark .hljs-template-variable,.hljs-solarized-dark .hljs-class .hljs-title,.hljs-solarized-dark .hljs-type{color:#b58900}.hljs-solarized-dark .hljs-symbol,.hljs-solarized-dark .hljs-bullet,.hljs-solarized-dark .hljs-subst,.hljs-solarized-dark .hljs-meta,.hljs-solarized-dark .hljs-meta .hljs-keyword,.hljs-solarized-dark .hljs-selector-attr,.hljs-solarized-dark .hljs-selector-pseudo,.hljs-solarized-dark .hljs-link{color:#cb4b16}.hljs-solarized-dark .hljs-built_in,.hljs-solarized-dark .hljs-deletion{color:#dc322f}.hljs-solarized-dark .hljs-formula{background:#073642}.hljs-solarized-dark .hljs-emphasis{font-style:italic}.hljs-solarized-dark .hljs-strong{font-weight:bold}.hljs-solarized-light .hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83}.hljs-solarized-light .hljs-comment,.hljs-solarized-light .hljs-quote{color:#93a1a1}.hljs-solarized-light .hljs-keyword,.hljs-solarized-light .hljs-selector-tag,.hljs-solarized-light .hljs-addition{color:#859900}.hljs-solarized-light .hljs-number,.hljs-solarized-light .hljs-string,.hljs-solarized-light .hljs-meta .hljs-meta-string,.hljs-solarized-light .hljs-literal,.hljs-solarized-light .hljs-doctag,.hljs-solarized-light .hljs-regexp{color:#2aa198}.hljs-solarized-light .hljs-title,.hljs-solarized-light .hljs-section,.hljs-solarized-light .hljs-name,.hljs-solarized-light .hljs-selector-id,.hljs-solarized-light .hljs-selector-class{color:#268bd2}.hljs-solarized-light .hljs-attribute,.hljs-solarized-light .hljs-attr,.hljs-solarized-light .hljs-variable,.hljs-solarized-light .hljs-template-variable,.hljs-solarized-light .hljs-class .hljs-title,.hljs-solarized-light .hljs-type{color:#b58900}.hljs-solarized-light .hljs-symbol,.hljs-solarized-light .hljs-bullet,.hljs-solarized-light .hljs-subst,.hljs-solarized-light .hljs-meta,.hljs-solarized-light .hljs-meta .hljs-keyword,.hljs-solarized-light .hljs-selector-attr,.hljs-solarized-light .hljs-selector-pseudo,.hljs-solarized-light .hljs-link{color:#cb4b16}.hljs-solarized-light .hljs-built_in,.hljs-solarized-light .hljs-deletion{color:#dc322f}.hljs-solarized-light .hljs-formula{background:#eee8d5}.hljs-solarized-light .hljs-emphasis{font-style:italic}.hljs-solarized-light .hljs-strong{font-weight:bold}.hljs-sunburst .hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}.hljs-sunburst .hljs-comment,.hljs-sunburst .hljs-quote{color:#aeaeae;font-style:italic}.hljs-sunburst .hljs-keyword,.hljs-sunburst .hljs-selector-tag,.hljs-sunburst .hljs-type{color:#e28964}.hljs-sunburst .hljs-string{color:#65b042}.hljs-sunburst .hljs-subst{color:#daefa3}.hljs-sunburst .hljs-regexp,.hljs-sunburst .hljs-link{color:#e9c062}.hljs-sunburst .hljs-title,.hljs-sunburst .hljs-section,.hljs-sunburst .hljs-tag,.hljs-sunburst .hljs-name{color:#89bdff}.hljs-sunburst .hljs-class .hljs-title,.hljs-sunburst .hljs-doctag{text-decoration:underline}.hljs-sunburst .hljs-symbol,.hljs-sunburst .hljs-bullet,.hljs-sunburst .hljs-number{color:#3387cc}.hljs-sunburst .hljs-params,.hljs-sunburst .hljs-variable,.hljs-sunburst .hljs-template-variable{color:#3e87e3}.hljs-sunburst .hljs-attribute{color:#cda869}.hljs-sunburst .hljs-meta{color:#8996a8}.hljs-sunburst .hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}.hljs-sunburst .hljs-addition{background-color:#253b22;color:#f8f8f8}.hljs-sunburst .hljs-deletion{background-color:#420e09;color:#f8f8f8}.hljs-sunburst .hljs-selector-class{color:#9b703f}.hljs-sunburst .hljs-selector-id{color:#8b98ab}.hljs-sunburst .hljs-emphasis{font-style:italic}.hljs-sunburst .hljs-strong{font-weight:bold}.hljs-tomorrow-night-blue .hljs-comment,.hljs-tomorrow-night-blue .hljs-quote{color:#7285b7}.hljs-tomorrow-night-blue .hljs-variable,.hljs-tomorrow-night-blue .hljs-template-variable,.hljs-tomorrow-night-blue .hljs-tag,.hljs-tomorrow-night-blue .hljs-name,.hljs-tomorrow-night-blue .hljs-selector-id,.hljs-tomorrow-night-blue .hljs-selector-class,.hljs-tomorrow-night-blue .hljs-regexp,.hljs-tomorrow-night-blue .hljs-deletion{color:#ff9da4}.hljs-tomorrow-night-blue .hljs-number,.hljs-tomorrow-night-blue .hljs-built_in,.hljs-tomorrow-night-blue .hljs-builtin-name,.hljs-tomorrow-night-blue .hljs-literal,.hljs-tomorrow-night-blue .hljs-type,.hljs-tomorrow-night-blue .hljs-params,.hljs-tomorrow-night-blue .hljs-meta,.hljs-tomorrow-night-blue .hljs-link{color:#ffc58f}.hljs-tomorrow-night-blue .hljs-attribute{color:#ffeead}.hljs-tomorrow-night-blue .hljs-string,.hljs-tomorrow-night-blue .hljs-symbol,.hljs-tomorrow-night-blue .hljs-bullet,.hljs-tomorrow-night-blue .hljs-addition{color:#d1f1a9}.hljs-tomorrow-night-blue .hljs-title,.hljs-tomorrow-night-blue .hljs-section{color:#bbdaff}.hljs-tomorrow-night-blue .hljs-keyword,.hljs-tomorrow-night-blue .hljs-selector-tag{color:#ebbbff}.hljs-tomorrow-night-blue .hljs{display:block;overflow-x:auto;background:#002451;color:white;padding:.5em}.hljs-tomorrow-night-blue .hljs-emphasis{font-style:italic}.hljs-tomorrow-night-blue .hljs-strong{font-weight:bold}.hljs-tomorrow-night-bright .hljs-comment,.hljs-tomorrow-night-bright .hljs-quote{color:#969896}.hljs-tomorrow-night-bright .hljs-variable,.hljs-tomorrow-night-bright .hljs-template-variable,.hljs-tomorrow-night-bright .hljs-tag,.hljs-tomorrow-night-bright .hljs-name,.hljs-tomorrow-night-bright .hljs-selector-id,.hljs-tomorrow-night-bright .hljs-selector-class,.hljs-tomorrow-night-bright .hljs-regexp,.hljs-tomorrow-night-bright .hljs-deletion{color:#d54e53}.hljs-tomorrow-night-bright .hljs-number,.hljs-tomorrow-night-bright .hljs-built_in,.hljs-tomorrow-night-bright .hljs-builtin-name,.hljs-tomorrow-night-bright .hljs-literal,.hljs-tomorrow-night-bright .hljs-type,.hljs-tomorrow-night-bright .hljs-params,.hljs-tomorrow-night-bright .hljs-meta,.hljs-tomorrow-night-bright .hljs-link{color:#e78c45}.hljs-tomorrow-night-bright .hljs-attribute{color:#e7c547}.hljs-tomorrow-night-bright .hljs-string,.hljs-tomorrow-night-bright .hljs-symbol,.hljs-tomorrow-night-bright .hljs-bullet,.hljs-tomorrow-night-bright .hljs-addition{color:#b9ca4a}.hljs-tomorrow-night-bright .hljs-title,.hljs-tomorrow-night-bright .hljs-section{color:#7aa6da}.hljs-tomorrow-night-bright .hljs-keyword,.hljs-tomorrow-night-bright .hljs-selector-tag{color:#c397d8}.hljs-tomorrow-night-bright .hljs{display:block;overflow-x:auto;background:black;color:#eaeaea;padding:.5em}.hljs-tomorrow-night-bright .hljs-emphasis{font-style:italic}.hljs-tomorrow-night-bright .hljs-strong{font-weight:bold}.hljs-tomorrow-night-eighties .hljs-comment,.hljs-tomorrow-night-eighties .hljs-quote{color:#999999}.hljs-tomorrow-night-eighties .hljs-variable,.hljs-tomorrow-night-eighties .hljs-template-variable,.hljs-tomorrow-night-eighties .hljs-tag,.hljs-tomorrow-night-eighties .hljs-name,.hljs-tomorrow-night-eighties .hljs-selector-id,.hljs-tomorrow-night-eighties .hljs-selector-class,.hljs-tomorrow-night-eighties .hljs-regexp,.hljs-tomorrow-night-eighties .hljs-deletion{color:#f2777a}.hljs-tomorrow-night-eighties .hljs-number,.hljs-tomorrow-night-eighties .hljs-built_in,.hljs-tomorrow-night-eighties .hljs-builtin-name,.hljs-tomorrow-night-eighties .hljs-literal,.hljs-tomorrow-night-eighties .hljs-type,.hljs-tomorrow-night-eighties .hljs-params,.hljs-tomorrow-night-eighties .hljs-meta,.hljs-tomorrow-night-eighties .hljs-link{color:#f99157}.hljs-tomorrow-night-eighties .hljs-attribute{color:#ffcc66}.hljs-tomorrow-night-eighties .hljs-string,.hljs-tomorrow-night-eighties .hljs-symbol,.hljs-tomorrow-night-eighties .hljs-bullet,.hljs-tomorrow-night-eighties .hljs-addition{color:#99cc99}.hljs-tomorrow-night-eighties .hljs-title,.hljs-tomorrow-night-eighties .hljs-section{color:#6699cc}.hljs-tomorrow-night-eighties .hljs-keyword,.hljs-tomorrow-night-eighties .hljs-selector-tag{color:#cc99cc}.hljs-tomorrow-night-eighties .hljs{display:block;overflow-x:auto;background:#2d2d2d;color:#cccccc;padding:.5em}.hljs-tomorrow-night-eighties .hljs-emphasis{font-style:italic}.hljs-tomorrow-night-eighties .hljs-strong{font-weight:bold}.hljs-tomorrow-night .hljs-comment,.hljs-tomorrow-night .hljs-quote{color:#969896}.hljs-tomorrow-night .hljs-variable,.hljs-tomorrow-night .hljs-template-variable,.hljs-tomorrow-night .hljs-tag,.hljs-tomorrow-night .hljs-name,.hljs-tomorrow-night .hljs-selector-id,.hljs-tomorrow-night .hljs-selector-class,.hljs-tomorrow-night .hljs-regexp,.hljs-tomorrow-night .hljs-deletion{color:#cc6666}.hljs-tomorrow-night .hljs-number,.hljs-tomorrow-night .hljs-built_in,.hljs-tomorrow-night .hljs-builtin-name,.hljs-tomorrow-night .hljs-literal,.hljs-tomorrow-night .hljs-type,.hljs-tomorrow-night .hljs-params,.hljs-tomorrow-night .hljs-meta,.hljs-tomorrow-night .hljs-link{color:#de935f}.hljs-tomorrow-night .hljs-attribute{color:#f0c674}.hljs-tomorrow-night .hljs-string,.hljs-tomorrow-night .hljs-symbol,.hljs-tomorrow-night .hljs-bullet,.hljs-tomorrow-night .hljs-addition{color:#b5bd68}.hljs-tomorrow-night .hljs-title,.hljs-tomorrow-night .hljs-section{color:#81a2be}.hljs-tomorrow-night .hljs-keyword,.hljs-tomorrow-night .hljs-selector-tag{color:#b294bb}.hljs-tomorrow-night .hljs{display:block;overflow-x:auto;background:#1d1f21;color:#c5c8c6;padding:.5em}.hljs-tomorrow-night .hljs-emphasis{font-style:italic}.hljs-tomorrow-night .hljs-strong{font-weight:bold}.hljs-tomorrow .hljs-comment,.hljs-tomorrow .hljs-quote{color:#8e908c}.hljs-tomorrow .hljs-variable,.hljs-tomorrow .hljs-template-variable,.hljs-tomorrow .hljs-tag,.hljs-tomorrow .hljs-name,.hljs-tomorrow .hljs-selector-id,.hljs-tomorrow .hljs-selector-class,.hljs-tomorrow .hljs-regexp,.hljs-tomorrow .hljs-deletion{color:#c82829}.hljs-tomorrow .hljs-number,.hljs-tomorrow .hljs-built_in,.hljs-tomorrow .hljs-builtin-name,.hljs-tomorrow .hljs-literal,.hljs-tomorrow .hljs-type,.hljs-tomorrow .hljs-params,.hljs-tomorrow .hljs-meta,.hljs-tomorrow .hljs-link{color:#f5871f}.hljs-tomorrow .hljs-attribute{color:#eab700}.hljs-tomorrow .hljs-string,.hljs-tomorrow .hljs-symbol,.hljs-tomorrow .hljs-bullet,.hljs-tomorrow .hljs-addition{color:#718c00}.hljs-tomorrow .hljs-title,.hljs-tomorrow .hljs-section{color:#4271ae}.hljs-tomorrow .hljs-keyword,.hljs-tomorrow .hljs-selector-tag{color:#8959a8}.hljs-tomorrow .hljs{display:block;overflow-x:auto;background:white;color:#4d4d4c;padding:.5em}.hljs-tomorrow .hljs-emphasis{font-style:italic}.hljs-tomorrow .hljs-strong{font-weight:bold}.hljs-vs .hljs{display:block;overflow-x:auto;padding:.5em;background:white;color:black}.hljs-vs .hljs-comment,.hljs-vs .hljs-quote,.hljs-vs .hljs-variable{color:#008000}.hljs-vs .hljs-keyword,.hljs-vs .hljs-selector-tag,.hljs-vs .hljs-built_in,.hljs-vs .hljs-name,.hljs-vs .hljs-tag{color:#00f}.hljs-vs .hljs-string,.hljs-vs .hljs-title,.hljs-vs .hljs-section,.hljs-vs .hljs-attribute,.hljs-vs .hljs-literal,.hljs-vs .hljs-template-tag,.hljs-vs .hljs-template-variable,.hljs-vs .hljs-type,.hljs-vs .hljs-addition{color:#a31515}.hljs-vs .hljs-deletion,.hljs-vs .hljs-selector-attr,.hljs-vs .hljs-selector-pseudo,.hljs-vs .hljs-meta{color:#2b91af}.hljs-vs .hljs-doctag{color:#808080}.hljs-vs .hljs-attr{color:#f00}.hljs-vs .hljs-symbol,.hljs-vs .hljs-bullet,.hljs-vs .hljs-link{color:#00b0e8}.hljs-vs .hljs-emphasis{font-style:italic}.hljs-vs .hljs-strong{font-weight:bold}.hljs-xcode .hljs{display:block;overflow-x:auto;padding:.5em;background:#fff;color:black}.hljs-xcode .hljs-comment,.hljs-xcode .hljs-quote{color:#006a00}.hljs-xcode .hljs-keyword,.hljs-xcode .hljs-selector-tag,.hljs-xcode .hljs-literal{color:#aa0d91}.hljs-xcode .hljs-name{color:#008}.hljs-xcode .hljs-variable,.hljs-xcode .hljs-template-variable{color:#660}.hljs-xcode .hljs-string{color:#c41a16}.hljs-xcode .hljs-regexp,.hljs-xcode .hljs-link{color:#080}.hljs-xcode .hljs-title,.hljs-xcode .hljs-tag,.hljs-xcode .hljs-symbol,.hljs-xcode .hljs-bullet,.hljs-xcode .hljs-number,.hljs-xcode .hljs-meta{color:#1c00cf}.hljs-xcode .hljs-section,.hljs-xcode .hljs-class .hljs-title,.hljs-xcode .hljs-type,.hljs-xcode .hljs-attr,.hljs-xcode .hljs-built_in,.hljs-xcode .hljs-builtin-name,.hljs-xcode .hljs-params{color:#5c2699}.hljs-xcode .hljs-attribute,.hljs-xcode .hljs-subst{color:#000}.hljs-xcode .hljs-formula{background-color:#eee;font-style:italic}.hljs-xcode .hljs-addition{background-color:#baeeba}.hljs-xcode .hljs-deletion{background-color:#ffc8bd}.hljs-xcode .hljs-selector-id,.hljs-xcode .hljs-selector-class{color:#9b703f}.hljs-xcode .hljs-doctag,.hljs-xcode .hljs-strong{font-weight:bold}.hljs-xcode .hljs-emphasis{font-style:italic}.hljs-xt256 .hljs{display:block;overflow-x:auto;color:#eaeaea;background:#000;padding:.5}.hljs-xt256 .hljs-subst{color:#eaeaea}.hljs-xt256 .hljs-emphasis{font-style:italic}.hljs-xt256 .hljs-strong{font-weight:bold}.hljs-xt256 .hljs-builtin-name,.hljs-xt256 .hljs-type{color:#eaeaea}.hljs-xt256 .hljs-params{color:#da0000}.hljs-xt256 .hljs-literal,.hljs-xt256 .hljs-number,.hljs-xt256 .hljs-name{color:#ff0000;font-weight:bolder}.hljs-xt256 .hljs-comment{color:#969896}.hljs-xt256 .hljs-selector-id,.hljs-xt256 .hljs-quote{color:#00ffff}.hljs-xt256 .hljs-template-variable,.hljs-xt256 .hljs-variable,.hljs-xt256 .hljs-title{color:#00ffff;font-weight:bold}.hljs-xt256 .hljs-selector-class,.hljs-xt256 .hljs-keyword,.hljs-xt256 .hljs-symbol{color:#fff000}.hljs-xt256 .hljs-string,.hljs-xt256 .hljs-bullet{color:#00ff00}.hljs-xt256 .hljs-tag,.hljs-xt256 .hljs-section{color:#000fff}.hljs-xt256 .hljs-selector-tag{color:#000fff;font-weight:bold}.hljs-xt256 .hljs-attribute,.hljs-xt256 .hljs-built_in,.hljs-xt256 .hljs-regexp,.hljs-xt256 .hljs-link{color:#ff00ff}.hljs-xt256 .hljs-meta{color:#fff;font-weight:bolder}.hljs-zenburn .hljs{display:block;overflow-x:auto;padding:.5em;background:#3f3f3f;color:#dcdcdc}.hljs-zenburn .hljs-keyword,.hljs-zenburn .hljs-selector-tag,.hljs-zenburn .hljs-tag{color:#e3ceab}.hljs-zenburn .hljs-template-tag{color:#dcdcdc}.hljs-zenburn .hljs-number{color:#8cd0d3}.hljs-zenburn .hljs-variable,.hljs-zenburn .hljs-template-variable,.hljs-zenburn .hljs-attribute{color:#efdcbc}.hljs-zenburn .hljs-literal{color:#efefaf}.hljs-zenburn .hljs-subst{color:#8f8f8f}.hljs-zenburn .hljs-title,.hljs-zenburn .hljs-name,.hljs-zenburn .hljs-selector-id,.hljs-zenburn .hljs-selector-class,.hljs-zenburn .hljs-section,.hljs-zenburn .hljs-type{color:#efef8f}.hljs-zenburn .hljs-symbol,.hljs-zenburn .hljs-bullet,.hljs-zenburn .hljs-link{color:#dca3a3}.hljs-zenburn .hljs-deletion,.hljs-zenburn .hljs-string,.hljs-zenburn .hljs-built_in,.hljs-zenburn .hljs-builtin-name{color:#cc9393}.hljs-zenburn .hljs-addition,.hljs-zenburn .hljs-comment,.hljs-zenburn .hljs-quote,.hljs-zenburn .hljs-meta{color:#7f9f7f}.hljs-zenburn .hljs-emphasis{font-style:italic}.hljs-zenburn .hljs-strong{font-weight:bold}</style>
    
    <meta name="keywords" content="remark,remarkjs,markdown,slideshow,presentation">
    <meta name="description" content="A simple, in-browser, markdown-driven slideshow tool.">
    <title>Remark</title>
    <style>
      /* modified to point to our local separate files */
      @import url("common/fonts.css");
      @import url("common/style.css"); 
    </style>
  </head>

  <body class="remark-container">

<textarea id="source" style="display: none;">class: center, middle

# Big Data Technologies

## Master Mathematics and Informatics

.medium[Stphane Gaffas - Stphane Boucheron]

.center[
    &lt;img src="figs/lpsm.png" style="height: 160px;" /&gt;
    &lt;img src="" style="width: 30px;" /&gt;
    &lt;img src="figs/paris-diderot.png" style="height: 90px;" /&gt;
    &lt;img src="" style="width: 30px;" /&gt;
    &lt;img src="figs/uparis.png" style="height: 120px;" /&gt;
]

---

layout: true
class: top

---

class: center, middle, inverse

# 6. A deeper dive into Spark

---

class: center, middle, inverse

# 6.1. Shuffles

---


# Shuffles

What happens when we do a `reduceByKey` on a RDD?
```python
&gt;&gt;&gt; rdd = sc.parallelize([("a", 1), ("b", 1), ("a", 1)])
&gt;&gt;&gt; rdd.reduceByKey(lambda a, b: a + b).collect()
```

Let's have a look at the .stress[Spark UI] available at :

.center[http://localhost:4040/jobs/]

.center[&lt;img src="figs/sparkui.png" style="width: 100%;" /&gt;]

---

# Shuffles


.center[
  &lt;img src="figs/dag_reducebykey1.png" style="width: 30%;" /&gt;
  &lt;img src="" style="width: 10%;" /&gt;
  &lt;img src="figs/dag_reducebykey2.png" style="width: 30%;" /&gt;
]

- Spark has to **move data from one node to another** to be "grouped" with its "key"

- Doing this is called .stress[shuffling]. It is never called directly, it happens behind the curtains for some other functions as `reduceByKey` above.

- This might be .stress[very expensive] because of **latency**

---

# Shuffles

- `reduceByKey` results in .stress[one] key-value pair **per key**

- This single key-value pair **cannot** span across **multiple workers**.

### Example

```python
&gt;&gt;&gt; from collections import namedtuple
&gt;&gt;&gt; columns = ["client_id", "destination", "price"]
&gt;&gt;&gt; CFFPurchase = namedtuple("CFFPurchase", columns)
&gt;&gt;&gt; CFFPurchase(100, "Geneva", 22.25)
CFFPurchase(client_id=100, destination='Geneva', price=22.25)
```

**Goal**: calculate *how many trips and how much money was spent by each client*

---

# Shuffles

### Example (cont.)

```python
&gt;&gt;&gt; purchases = [
        CFFPurchase(100, "Geneva", 22.25),
        CFFPurchase(100, "Zurich", 42.10),
        CFFPurchase(100, "Fribourg", 12.40),
        CFFPurchase(101, "St.Gallen", 8.20),
        CFFPurchase(101, "Lucerne", 31.60),
        CFFPurchase(100, "Basel", 16.20)
    ]
&gt;&gt;&gt; purchases = sc.parallelize(purchases)
&gt;&gt;&gt; purchases.collect()
[CFFPurchase(client_id=100, destination='Geneva', price=22.25),
 CFFPurchase(client_id=100, destination='Zurich', price=42.1),
 CFFPurchase(client_id=100, destination='Fribourg', price=12.4),
 CFFPurchase(client_id=101, destination='St.Gallen', price=8.2),
 CFFPurchase(client_id=101, destination='Lucerne', price=31.6),
 CFFPurchase(client_id=100, destination='Basel', price=16.2)]
```

---

# Shuffles

### Example (cont.)

```python
&gt;&gt;&gt; purchases_per_client = (purchases
        # Pair RDD
        .map(lambda p: (p.client_id, p.price))
        # RDD[p.customerId, List[p.price]]
        .groupByKey()                          
        .map(lambda p: (p[0], (len(p[1]), sum(p[1]))))
        .collect()
    )
&gt;&gt;&gt; purchases_per_client
[(100, (4, 92.95)), (101, (2, 39.8))]
```

How would this **looks on a cluster?** (imagine that the dataset has millions of purchases)

---

# Shuffles

- Lets say we have **3 worker nodes** and our data is **evenly distributed on it**, so the operations above look like this:
.center[&lt;img src="figs/shuffline.png" style="width: 95%;" /&gt;]

- This shuffling is very expensive because of .stress[latency]

- Can we do a **better job**?

---

# Shuffles

Perhaps we can .stress[reduce before we shuffle] in order to greatly reduce the amount of data sent over network. We use `reduceByKey`.

```python
&gt;&gt;&gt; purchases_per_client = (purchases
        .map(lambda p: (p.client_id, (1, p.price)))
        .reduceByKey(lambda v1, v2: (v1[0] + v2[0], v1[1] + v2[1]))
        .collect()
    )
```

This looks like on the cluster:
.center[&lt;img src="figs/shuffline_2.png" style="width: 80%;" /&gt;]

---

# Shuffles

- `groupByKey` (left) VS `reduceByKey` (right) :

.center[
&lt;img src="figs/shuffline.png" style="width: 49%;" /&gt;
&lt;img src="figs/shuffline_2.png" style="width: 49%;" /&gt;
]
- With `reduceByKey` we shuffle considerably less amount of data

**Benefits of this approach:** 

- by .stress[reducing the data first], the amount of data sent during the shuffle is **greatly reduced**, leading to strong performance gains!
- This is because `groupByKey` requires collecting **all key-value pairs with the same key on the same machine** while `reduceByKey` **reduces locally** before shuffling.

---

class: center, middle, inverse

# 6.2. Partitions

---


# Partitioning

How does Spark know which key to put on which machine?

- By default, Spark uses .stress[hash partitioning] to determine **which key-value pair** should be sent to **which machine**.

The data **within an RDD** is .stress[split] into several .stress[partitions]. Some properties of partitions:

- Partitions **never** span .stress[multiple machines], data in the **same partition** is always on the **same worker machine**.
- **Each machine** in the cluster contains **one** or **more** partitions.
- The .stress[number of partitions] to use is **configurable**. By default, it is the .stress[total number of cores on all executor nodes];  6 workers with 4 cores should lead to 24 partitions.

---

# Partitioning

Two kinds of partitioning are available in Spark: 
- .stress[Hash] partitioning
- .stress[Range] partitioning

Customizing a partitioning is only possible on a `PairRDD` and `DataFrame`, namely **something with keys**.

### Hash Partitioning

Given a Pair RDD that should be grouped, `groupByKey` first computes per tuple `(k,v)` its partition `p`:
```python
p = k.hashCode() % numPartitions
```

Then, all tuples in the same partition `p` are sent to the machine hosting `p`.

---

# Partitioning

**Intuition:** hash partitioning attempts to .stress[spread data evenly] across partitions **based on the key**.

The other kind of partitioning is .stress[range partitioning]

### Range Partitioning

- Pair RDDs may contain keys that have an .stress[ordering] defined, such as `int`, `String`, etc.
- For such RDDs, .stress[range partitioning] may be more efficient.

Using a **range partitioner**, keys are partitioned according to 2 things:

1. an **ordering** for keys
1. a set of **sorted ranges** of keys

(key, value) pairs with keys in the **same range** end up in the **same partition**.

---

# Partitioning

Consider a Pair RDD with keys: `[8, 96, 240, 400, 401, 800]`, and a desired number of partitions of 4.

With **hash partitioning**
```python
p = k.hashCode() % numPartitions
  = k % 4
``` 
leads to
- Partition 0: `[8, 96, 240, 400, 800]`
- Partition 1: `[401]`
- Partition 2: `[]`
- Partition 3: `[]`

This results in a .stress[very unbalanced distribution] which **hurts performance**, since the data is **spread mostly on 1 node**, so not very parallel.

---

# Partitioning

In this case, using **range partitioning** can .stress[improve the distribution] significantly.

- Assumptions: (a) keys are non-negative, (b) 800 is the biggest key
- Ranges: `[1-200], [201-400], [401-600], [601-800]`

Based on this the keys are distributed as follows:

- Partition 0: `[8, 96]`
- Partition 1: `[240, 400]`
- Partition 2: `[401]`
- Partition 3: `[800]`

This is .stress[much more balanced].

---

# Partitioning

How do we set a partitioning for our data?

1. On a Pair RDD: call `partitionBy`, providing an explicit `Partitioner` (`scala` only, use a partitioning function in `pyspark`)
1. On a DataFrame: Call `repartition` for **hash partitioning** and `repartitionByRange` for **range partitioning**
1. Using transformations that return a RDD or a DataFrame with **specific partitioners**.

### Partitioning a `RDD` using `partitionBy`

```python
&gt;&gt;&gt; pairs = purchases.map(lambda p: (p.client_id, p.price))
&gt;&gt;&gt; pairs = pairs.partitionBy(3, "client_id")
&gt;&gt;&gt; pairs.getNumPartitions()
3
```

---

# Partitioning

Using `RangePartitioner` with `pyspark` requires
1. Specifying the desired number of partitions
1. Providing a DataFrame with **orderable keys**

```python
pairs = purchases.map(lambda p: (p.client_id, p.price))
pairs = spark.createDataFrame(pairs, ["id", "price"])
pairs.repartitionByRange(3, "price").persist()
pairs.show()
```

### Important

- The result of `partitionBy`, `repartition`, `repartitionByRange` .stress[should be persisted]. 
- Otherwise **partitioning is repeatedly applied** (with shuffling!) each time the partitioned data is used.

---

# Partitioning

### Partitioning using transformations

- Pair RDDs that are **result of a transformation** on a .stress[partitioned] Pair RDD use typically the .stress[same] hash partitioner
- Some operations on RDDs **automatically** result in an RDD with a **known** partitioner - when it makes sense. 
- Example: when using `sortByKey`, a `RangePartitioner` is used. With `groupByKey`, a default hash partitioner is used.

Operations on Pair RDDs that **hold to** and **propagate** a partitioner:

- `cogroup`, `groupWith`, `join`, `leftOuterJoin`, `rightOuterJoin`
- `[group,reduce,fold,combine]ByKey`, `partitionBy`, `sort`
- `mapValues`, `flatMapValues`, `filter` (if parent has a partitioner)

**All other operations** will produce a result .stress[without partitioner]! Why ???

---

# Partitioning

Consider the `map` transformation. Given that we have a hash-partitioned Pair RDD, .stress[why loosing the partitioner] in its result RDD?

Because its possible for `map` or `flatMap` to .stress[change] the key:
```python
hashPartitionedRdd.map(lambda k, v: ("ooooops", v))
```
If the `map` transformation preserved the previous partitioner, it would no longer makes sense: the keys are all same after this `map`

Hence, use `mapValues`, since it enables to do `map` transformations **without changing the keys**, thereby preserving the partitioner.

---

class: center, middle, inverse

# 6.3. Optimizing shuffles with partitioning

---

# Optimizing with partitioning

**Why would we want to repartition the data?**

- Because it can bring .stress[substantial performance gains], especially before **shuffles**.

- We saw that using `reduceByKey` instead of `groupByKey` .stress[localizes data better] due to different **partitioning** strategies and thus **reduces latency** to deliver **performance gains**.

- By manually repartitioning the data for the same example as before, we can .stress[improve the performance even further].

- By using **range partitioners** we can optimize the use of `reduceByKey` in that example so that it .stress[does not involve any shuffling] over the network at all!

---

# Optimizing with partitioning

Compared to what we did previously, we use `sortByKey` to produce a range partitioner for the RDD that we immediately persist.

```python
&gt;&gt;&gt; pairs = purchases.map(lambda p: (p.client_id, (1, p.price)))
&gt;&gt;&gt; pairs = pairs.sortByKey().persist()
&gt;&gt;&gt; pairs.reduceByKey(
       lambda v1, v2: (v1[0] + v2[0], v1[1] + v2[1])
    ).collect()
```

This typically leads to .stress[much faster computations] in this case (for large RDD, not the small toy example from before).

---

class: center, middle, inverse

# 6.4. Optimizing with broadcast join

---

# Optimizing with broadcasting

When joining two DataDrames, where one is small enough to **fit in memory**, it is .stress[broadcasted] over **all the workers** where the large DataFrame resides (and a hash join is performed). This has two phases:

- **Broadcast**: the smaller DataFrame is broadcasted across workers containing the large one
- **Hash join**: a standard hash join is executed on each workder

There is therefore .stress[no shuffling] involved and this can be **much faster** than a regular join.

The default threshold for broadcasting is
```python
&gt;&gt;&gt; spark.conf.get("spark.sql.autoBroadcastJoinThreshold")
'10485760'
```
meaning 10MB

---

# Optimizing with broadcasting

Can be changed using
```python
&gt;&gt;&gt; spark.conf.set("spark.sql.autoBroadcastJoinThreshold", "20971520")
```

`"spark.broadcast.compress"` can be used to configure whether to compress the data before sending it (`True` by default). 

It uses the compression specified in `"spark.io.compression.codec config"` and the default is `"lz4"`. We can use other compression codecs but what the hell. 

More important: even though a DataFrame is small, sometimes Spark can't estimate the size of it. We can **enforce** using a .stress[broadcast hint]:
```python
&gt;&gt;&gt; from pyspark.sql.functions import broadcast
&gt;&gt;&gt; largeDF.join(broadcast(smallDF))
```

---

# Optimizing with broadcasting

- If a **broadcast hint** is specified, the side with the hint will be .stress[broadcasted] irrespective of `autoBroadcastJoinThreshold`. 

- If **both sides** have broadcast hints, the side **with a smallest estimated size** will be broadcasted. 

- If there is **no hint** and the estimated size of DataFrame &lt; `autoBroadcastJoinThreshold`, that table is usually broadcasted

- Spark has a **BitTorrent-like** implementation to perform broadcast. Allows to **avoid the driver being the bottleneck** when sending data to multiple executors. 

---

# Optimizing with broadcasting

- **Usually**, a **broadcast join** performs .stress[faster] than other join algorithms when the broadcast side is small enough. 

- However, broadcasting tables is **network-intensive** and can cause `out of memory` errors or even **perform worse** than other joins if the .stress[broadcasted table is too large].

- Broadcast join is **not** supported for a **full outer join**. For **right outer join**, only **left side** table can be broadcasted and for other **left joins** only the **right table** can be broadcasted.


---

class: center, middle, inverse

# 6.5. Shuffle hash VS sort merge joins 

---

# Shuffle hash VS sort merge joins 

Spark can use mainly **two strategies** for joining:

- .stress[Shuffle hash] join
- .stress[Sort merge] join

Sort merge join is the **default join strategy**, since it is very scalable and .stress[performs better] than other joins **most of the times**.

**Shuffle hash join** is used as the join strategy when: 
- `"spark.sql.join.preferSortMergeJoin"` is set to `False`
- the cost to build a hash map is **less** than sorting the data. 

---

# Shuffle hash

**Shuffle hash** join has 2 phases:

1. A .stress[shuffle] phase, where data from the join tables are **partitioned based on the join key**. This **shuffles data** across the partitions. Data with the .stress[same keys] end up in the .stress[same partition]: the **data required** for joins is available in the **same partition**.
1. .stress[Hash join] phase: data on **each partition** performs a **single node** hash join.

Thus, shuffle hash join **breaks apart** the big join of two tables into **localized smaller chunks**.

- Shuffle is **very expensive**, the creation of Hash tables is also **expensive** and **memory bound**. 
- Shuffle hash join is **not suited** for joins that .stress[wouldn't fit in memory].

---

# Shuffle hash

- The **performance** of shuffle hash join depends on the .stress[distribution of the keys]. The **greater** number of **unique** join keys the **better** data distribution we get.
- Maximum amount of **achievable parallelism** is proportional to the **number of unique keys**.

By default, **sort merge join** is .stress[preferred] over **shuffle hash join**.
`ShuffledHashJoin` is still useful when:

- Any partition of the resulting table can **fit in memory**
- One table is **much smaller** than the other one, so that building a **hash table** of the **small** table is .stress[smaller] than **sorting the large table**.

This explains why this shuffle is used for **broadcast joins**.

---

# Sort merge join

**Sort merge join** is Spark's .stress[default join strategy] if:
- matching join keys are **sortable** 
- **not eligible** for **broadcast join** or **shuffle hash join**. 

It is **very scalable** and is an **inheritance of Hadoop** and map-reduce programs.
What makes it **scalable** is that it can **spill data to the disk** and doesn't require the **entire data** to .stress[fit inside the memory].

It has **three** phases:
1. .stress[Shuffle] phase: the two large tables are **(re)partitioned** using the join key(s) across the partitions in the cluster.
1. .stress[Sort] phase: **sort** the data **within each partition** in parallel.
1. .stress[Merge] phase: **join** the **sorted** and **partitioned** data. This is simply **merging the datasets** by iterating over the elements and joining the rows having the **same value for the join key**.
---

# Sort merge join

- For ideal performance of the sort merge join, all rows **with the same join key(s)** are available in the **same partition**. This can help with the infamous partition exchange (shuffle) between workers.
- **Collocated partitions** can .stress[avoid unnecessary data shuffle]. 
- Data needs to be .stress[evenly distributed] in the join keys, so that they can be **equally distributed across the cluster** to achieve the **maximum parallelism** from the available partitions.

### Other join types

There are **other join types**, such as `BroadcastNestedLoopJoin` in weird situations where .stress[no joining keys are specified] and either there is a broadcast hint or the size of a table is &lt; `autoBroadcastJoinThreshold`.

In summary: .stress[don't use these], if you see these in an execution plan or in the Spark UI, it usually means that something **has been done poorly**.

---

# Take home messages on joins

- **Sort merge join** is the .stress[default] join and performs well in most of the scenarios.

- In **some** cases, if you are confident enough that **shuffle hash join** is .stress[better] than sort merge join, you can **disable sort merge join** for those scenarios. 

- Tune `spark.sql.autoBroadcastJoinThreshold` accordingly if deemed necessary. Try to use .stress[broadcast joins] wherever possible and .stress[filter out the irrelevant rows] to the join key **before** the join to **avoid unnecessary data shuffling**.

- Joins **without unique join keys** or **no join keys** can often be very expensive and .stress[should be avoided].

---

# How do I know when a shuffle will occur?

**Rule of thumb**: a shuffle **can** occur when the resulting data .stress[depends on other data] (can be the same or another RDD/DataFrame).

We can also **figure out** if a .stress[shuffle] has been **planned** or **executed** via:
1. The return type of certain transformations (in `scala` only)
1. By looking at the .stress[Spark UI]
1. Using `toDebugString` on a RDD to see its execution plan: 

```python
&gt;&gt;&gt; print(pairs.toDebugString().decode("utf-8"))
(3) PythonRDD[157] at RDD at PythonRDD.scala:53 [Memory Serialized 1x Replicated]
 |       CachedPartitions: 3; MemorySize: 233.0 B; ExternalBlockStoreSize: 0.0 B; DiskSize: 0.0 B
 |  MapPartitionsRDD[156] at mapPartitions at PythonRDD.scala:133 [Memory Serialized 1x Replicated]
 |  ShuffledRDD[155] at partitionBy at &lt;unknown&gt;:0 [Memory Serialized 1x Replicated]
 +-(8) PairwiseRDD[154] at sortByKey at &lt;ipython-input-35-112008c310ec&gt;:2 [Memory Serialized 1x Replicated]
    |  PythonRDD[153] at sortByKey at &lt;ipython-input-35-112008c310ec&gt;:2 [Memory Serialized 1x Replicated]
    |  ParallelCollectionRDD[0] at parallelize at PythonRDD.scala:195 [Memory Serialized 1x Replicated]
```

---

# How do I know when a shuffle will occur?

Operations that **might** cause a shuffle:

- `cogroup`, `groupWith`, `join`, `leftOuterJoin`, `rightOuterJoin`, `groupByKey`, `reduceByKey`, `combineByKey`, `distinct`, `intersection`, `repartition`, `coalesce`

When can we .stress[avoid shuffles] using **partitioning** ?

1. `reduceByKey` running on a pre-partitioned RDD will cause the values to be computed **locally**, requiring only the final reduced value to be sent to the driver.
1. `join` called on 2 RDDs that are pre-partitioned with the same partitioner and cached on the same machine will cause the join to be computed **locally**, with no shuffling across the network.

---

class: center, middle, inverse

# 6.6. Wide versus narrow dependencies

---

# Wide versus narrow dependencies

- We have seen that some transformations are **significantly more expensive (latency)** than others

- This is often explained by .stress[wide] versus .stress[narrow dependencies], which dictate **relationships between RDDs** in **graphs of computation**, that has a lot to do with .stress[shuffling]

### Lineages

- Computations on RDDs are represented as a .stress[lineage graph]: a .stress[DAG] representing the **computations done on the RDD**. 

- This DAG is what Spark **analyzes** to do **optimizations**. Thanks to this, it is possible for an operation to step back and figure out how a result is derived from a particular point.

---

# Wide versus narrow dependencies

**Example**
```python
rdd = sc.textFile(...)
filtered = rdd.map(...).filter(...).persist()
count = filtered.count()
reduced = filtered.reduce()
```

.center[&lt;img src="figs/lineage_graph.png" style="width: 40%;" /&gt;]

---

# Wide versus narrow dependencies

RDDs are made up of **4 parts**: 

- **Partitions**: .stress[atomic pieces] of the dataset. **One** or **many** per worker.
- **Dependencies**: models .stress[relationship] between **this RDD** and **its partitions** with the RDD(s) it was derived from (dependencies maybe modeled per partition). 
- A **function** for .stress[computing the dataset] based on its parent RDDs.
- **Metadata** about it partitioning .stress[scheme] and data placement.

.center[
  &lt;img src="figs/rdd_anatomy_1.png" style="width: 30%;" /&gt;
  &lt;img src="" style="width: 10%;" /&gt;
  &lt;img src="figs/rdd_anatomy_2.png" style="width: 31%;" /&gt;
]

---

# Wide versus narrow dependencies

**RDD dependencies and shuffles**

- We saw a **rule of thumb**: a .stress[shuffle] can occur when the **resulting RDD depends on other elements** from the same RDD or another RDD.
- In fact, .stress[RDD dependencies] **encode** when data .stress[must be shuffled].

Transformations cause shuffles, and can have **2 kinds of dependencies**:

- **Narrow dependencies:** each partition of the parent RDD is used by .stress[at most] one partition of the child RDD. 
.center[
```bash
[parent RDD partition] --&gt; [child RDD partition]
```
]
**Fast!** .stress[No shuffle] necessary. Optimizations like **pipelining** possible. **Transformations with narrow dependencies are fast**.

---

# Wide versus narrow dependencies

- **Wide dependencies:** each partition of the parent RDD may be used by .stress[multiple] child partitions
```bash
                           ---&gt; [child RDD partition 1]
[parent RDD partition] ---&gt; [child RDD partition 2]
                           ---&gt; [child RDD partition 3]
```
**Slow!** .stress[Shuffle necessary] for **all** or **some** data over the network. **Transformations with wide dependencies are slow.**

---

# Wide versus narrow dependencies

.center[
  &lt;img src="figs/narrow_vs_wide_dependencies.png" style="width: 100%;" /&gt;
]

---

# Wide versus narrow dependencies

Assume that we have a following DAG: 

.center[&lt;img src="figs/visual_dag.png" style="width: 55%;" /&gt;]

---

# Wide versus narrow dependencies

What do the dependencies look like? Which is **wide** and which is **narrow?**

.center[&lt;img src="figs/visual_dag_resolved.png" style="width: 85%;" /&gt;]

- The B to G `join` is .stress[narrow] because `groupByKey` **already partitions** the keys and places them appropriately in B.
- Thus, `join` operations can be .stress[narrow or wide] depending on **lineage**

---

# Wide versus narrow dependencies

Transformations with (usually) .stress[narrow] dependencies:

- `map`, `mapValues`, `flatMap`, `filter`, `mapPartitions`, `mapPartitionsWithIndex`

Transformations with (usually) .stress[wide] dependencies (might cause a **shuffle**):

- `cogroup`, `groupWith`, `join`, `leftOuterJoin`, `rightOuterJoin`, `groupByKey`, `reduceByKey`, `combineByKey`, `distinct`, `intersection`, `repartition`, `coalesce`

These list are usually correct, but as seen above for `join`, a correct answer **depends on lineage**

---

# Wide versus narrow dependencies

How do we **find out** if an operation is **wide** or **narrow**?

- Monitor the job with the .stress[Spark UI] and check if **ShuffleRDD** are used.

- Use the `toDebugString` method. It prints the **RDD lineage** along with other information relevant to scheduling. Indentations separate **groups of narrow transformations** that may be **pipelined** together with wide transformations that require shuffles. These groupings are called **stages**.

```python
&gt;&gt;&gt; print(pairs.toDebugString().decode("utf-8"))
(3) PythonRDD[157] at RDD at PythonRDD.scala:53 [Memory Serialized 1x Replicated]
 |       CachedPartitions: 3; MemorySize: 233.0 B; ExternalBlockStoreSize: 0.0 B; DiskSize: 0.0 B
 |  MapPartitionsRDD[156] at mapPartitions at PythonRDD.scala:133 [Memory Serialized 1x Replicated]
 |  ShuffledRDD[155] at partitionBy at &lt;unknown&gt;:0 [Memory Serialized 1x Replicated]
 +-(8) PairwiseRDD[154] at sortByKey at &lt;ipython-input-35-112008c310ec&gt;:2 [Memory Serialized 1x Replicated]
    |  PythonRDD[153] at sortByKey at &lt;ipython-input-35-112008c310ec&gt;:2 [Memory Serialized 1x Replicated]
    |  ParallelCollectionRDD[0] at parallelize at PythonRDD.scala:195 [Memory Serialized 1x Replicated]
```

---

# Wide versus narrow dependencies

- Check the .stress[dependencies] (only with `scala` and `java` APIs): there is a `dependencies` method on RDDs. It returns a sequence of `Dependency` objects, which are the dependencies used by **Spark's scheduler** to know how this RDD **depends on other (or itself) RDDs**.

The types of **dependency objects** that this method may return include:

- **Narrow** dependency objects: `OneToOneDependency`, `PruneDependency`, `RangeDependency`
- **Wide** dependency objects: `ShuffleDependency`

Example in `scala`:
```scala
val wordsRDD = sc.parallelize(largeList)
val pairs = wordsRdd.map(c=&gt;(c,1))
                    .groupByKey
                    .dependencies
// pairs: Seq[org.apache.spark.Dependency[_]] 
//   = List(org.apache.spark.ShuffleDependency@4294a23d)
```

---

# Wide versus narrow dependencies

Also, `toDebugString` is more precise with the `scala` API:
```scala
val pairs = wordsRdd.map(c=&gt;(c,1))
                    .groupByKey
                    .toDebugString
// pairs: String =
// (8) ShuffledRDD[219] at groupByKey at &lt;console&gt;:38 []
//  +-(8) MapPartitionsRDD[218] at map at &lt;console&gt;:37 []
//     | ParallelCollectionRDD[217] at parallelize at &lt;console&gt;:36 []
```
We can see immediately that a `ShuffledRDD` is used

---

class: center, middle, inverse

# 6.7. Lineage allows fault tolerance

---

# Lineage allows fault tolerance

**Lineages** are the key to .stress[fault tolerance] in Spark

Ideas from **functional programming** enable fault tolerance in Spark:
- RDDs are .stress[immutable]
- Use **higher order functions** like `map`, `flatMap`, `filter` to do .stress[functional] transformations on this **immutable** data
- A function for **computing an RDD based on its parent RDDs** is part the RDD's representation

This is all done in Spark RDDs: a by product of these ideas is .stress[fault tolerance]:

- We just need to **keep the information** required by these 3 properties.
- **Recovering from failures** is simply achieved by .stress[recomputing lost partitions] using the lineage graph

---

# Lineage allows fault tolerance

Aren't you amazed by this ?!?
- Spark provides **fault tolerance** .stress[without having to write data on disk!] 
- Data can be **rebuilt** using the above information.
.pull-left-40[
If a partition **fails**:
&lt;img src="figs/fault_tol_1.png" style="width: 100%;" /&gt;
]
.pull-right-40[
Spark **recomputes it** to get back on track:
&lt;img src="figs/fault_tol_2.png" style="width: 100%;" /&gt;
]

---

class: center, middle, inverse

# 6.8. Catalyst: the secret weapon of `spark.sql`

---

# Catalyst optimizer

What is the .stress[Catalyst] **optimizer** ?

- An **optimizer** that **automatically finds** out the .stress[most efficient plan] to execute data operations specified in the user's program.

- It .stress[translates transformations] used to build the dataset to an **optimized physical plan of execution**, which is a DAG of **low-level operations on RDDs**.

- A .stress[precious tool] for `spark.sql` in terms of **performance**. It understands the **structure** of the data used and of the **operations** made on it, so the optimizer .stress[can make some decisions] helping to **reduce execution time**.

---

# Catalyst optimizer

Let's first define some terminology used in the optimizer

- .stress[Logical plan]: **series of algebraic** or **language constructs**, for example: SELECT, GROUP BY, UNION, etc. Usually **represented as a DAG** where **nodes** are the constructs.
- .stress[Physical plan]: similar to the logical plan, also **represented by a DAG** but concerning **low-level operations** (operations on RDDs).
- .stress[Unoptimized / optimized plans]:  a plan becomes **optimized** when the optimizer passed on it and **made some optimizations**, such as merging `filter()` methods, replacing some instructions by faster another ones, etc.


Catalyst helps to move from **an unoptimized logical query plan** to an **optimized physical plan** 

---

# Catalyst optimizer: how it works?

.center[&lt;img src="figs/catalyst01.png" style="width: 90%;" /&gt;]


---

# Catalyst optimizer: how it works?

- Try to .stress[optimize logical plan] through **predefined rule-based optimizations**. Some optimizations are:
  - **predicate or projection pushdown**, helps to eliminate data not respecting preconditions earlier in the computation;
  - **rearrange filter**;
  - **conversion of decimals operations** to long integer operations;
  - **replacement of some RegEx** expressions by Java's methods `startsWith` or `contains`;
  - **if-else** clauses simplification.

- Create the **optimized logical plan**.

- Construct .stress[multiple physical plans] from the **optimized logical plan**. These are also optimized, some examples are: **merging** different `filter()`, sending **predicate/projection pushdown** to the **data source** to eliminate data directly from the source.

---

# Catalyst optimizer: how it works?

- Determine **which physical plan** has the .stress[lowest cost of execution] and choses it as the **physical plan used for the computation**.

- Generate .stress[bytecode] for the **best physical plan** thanks to a `scala` feature called `quasiquotes`.

- Once a physical plan is defined, its .stress[executed] and retrieved data is put to the output DataFrame.

---

# Catalyst optimizer

Lets understand how Catalyst optimizer works for a given query

.center[&lt;img src="figs/catalyst02.png" style="width: 80%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst03.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst04.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst05.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst06.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst07.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst08.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst09.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst10.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst11.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

.center[&lt;img src="figs/catalyst12.png" style="width: 100%;" /&gt;]

---

# Catalyst optimizer

- By performing these **transformations**, Catalyst .stress[improves the execution times] of relational queries and **mitigates the importance of semantics**

- Catalyst makes use of some **powerful functional programming** features from `Scala` to allow developers to concisely specify complex relational optimizations.

- Catalyst helps .stress[but only when it can]: **explicit** schemas, **precise function calls**, **clever** order of operations **can only help** Catalyst.

---

class: center, middle, inverse

# Thank you !

</textarea>

  <script src="./Remark07_files/remark-latest.min.js"></script>
  <!-- <script>mermaid.initialize({startOnLoad:true});</script>  -->
    <script>
      var hljs = remark.highlighter.engine;
    </script>
   <script>
      var slideshow = remark.create({
          /* sourceUrl: './slides.md', */
          highlightLanguage: 'remark',
          highlightLines: true 
        });
    </script><div class="remark-notes-area">
  <div class="remark-top-area">
    <div class="remark-toolbar">
      <a class="remark-toolbar-link" href="https://stephanegaiffas.github.io/big_data_course/slides/slides07_spark-deeper-dive.html#increase">+</a>
      <a class="remark-toolbar-link" href="https://stephanegaiffas.github.io/big_data_course/slides/slides07_spark-deeper-dive.html#decrease">-</a>
      <span class="remark-toolbar-timer">0:00:00</span>
    </div>
  </div>
  <div class="remark-bottom-area">
    <div class="remark-notes-current-area">
      <div class="remark-toggle">Notes for current slide</div>
      <div class="remark-notes"></div>
    </div>
    <div class="remark-notes-preview-area">
      <div class="remark-toggle">Notes for next slide</div>
      <div class="remark-notes-preview"></div>
    </div>
  </div>
</div>
<div class="remark-slides-area"><div class="remark-slide-container remark-visible"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content center middle hljs-default"><h1 id="big-data-technologies">Big Data Technologies</h1>
<h2 id="master-mathematics-and-informatics">Master Mathematics and Informatics</h2>
<p><span class="medium">Stphane Gaffas - Stphane Boucheron</span></p>
<div class="center"><p><img src="./Remark07_files/lpsm.png" style="height: 160px;">
    <img src="https://stephanegaiffas.github.io/big_data_course/slides/slides07_spark-deeper-dive.html" style="width: 30px;">
    <img src="./Remark07_files/paris-diderot.png" style="height: 90px;">
    <img src="https://stephanegaiffas.github.io/big_data_course/slides/slides07_spark-deeper-dive.html" style="width: 30px;">
    <img src="./Remark07_files/uparis.png" style="height: 120px;"></p>
</div><div class="remark-slide-number">1 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-a-deeper-dive-into-spark">6. A deeper dive into Spark</h1><div class="remark-slide-number">2 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-1-shuffles">6.1. Shuffles</h1><div class="remark-slide-number">3 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffles">Shuffles</h1>
<p>What happens when we do a <code class="remark remark-inline-code">reduceByKey</code> on a RDD?</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([(<span class="hljs-string">"a"</span>, <span class="hljs-number">1</span>), (<span class="hljs-string">"b"</span>, <span class="hljs-number">1</span>), (<span class="hljs-string">"a"</span>, <span class="hljs-number">1</span>)])</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>rdd.reduceByKey(<span class="hljs-keyword">lambda</span> a, b: a + b).collect()</div></code></pre>
<p>Let's have a look at the <span class="stress">Spark UI</span> available at :</p>
<p><span class="center"><a href="http://localhost:4040/jobs/"></a><a href="http://localhost:4040/jobs/">http://localhost:4040/jobs/</a></span></p>
<p><span class="center"><img src="./Remark07_files/sparkui.png" style="width: 100%;"></span></p><div class="remark-slide-number">4 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffles">Shuffles</h1>
<div class="center"><p><img src="./Remark07_files/dag_reducebykey1.png" style="width: 30%;">
  <img src="https://stephanegaiffas.github.io/big_data_course/slides/slides07_spark-deeper-dive.html" style="width: 10%;">
  <img src="./Remark07_files/dag_reducebykey2.png" style="width: 30%;"></p>
</div>

<ul>
<li><p>Spark has to <strong>move data from one node to another</strong> to be "grouped" with its "key"</p>
</li>
<li><p>Doing this is called <span class="stress">shuffling</span>. It is never called directly, it happens behind the curtains for some other functions as <code class="remark remark-inline-code">reduceByKey</code> above.</p>
</li>
<li><p>This might be <span class="stress">very expensive</span> because of <strong>latency</strong></p>
</li>
</ul><div class="remark-slide-number">5 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffles">Shuffles</h1>
<ul>
<li><p><code class="remark remark-inline-code">reduceByKey</code> results in <span class="stress">one</span> key-value pair <strong>per key</strong></p>
</li>
<li><p>This single key-value pair <strong>cannot</strong> span across <strong>multiple workers</strong>.</p>
</li>
</ul>
<h3 id="example">Example</h3>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> namedtuple</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>columns = [<span class="hljs-string">"client_id"</span>, <span class="hljs-string">"destination"</span>, <span class="hljs-string">"price"</span>]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>CFFPurchase = namedtuple(<span class="hljs-string">"CFFPurchase"</span>, columns)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>CFFPurchase(<span class="hljs-number">100</span>, <span class="hljs-string">"Geneva"</span>, <span class="hljs-number">22.25</span>)</div><div class="remark-code-line">CFFPurchase(client_id=<span class="hljs-number">100</span>, destination=<span class="hljs-string">'Geneva'</span>, price=<span class="hljs-number">22.25</span>)</div></code></pre>
<p><strong>Goal</strong>: calculate <em>how many trips and how much money was spent by each client</em></p><div class="remark-slide-number">6 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffles">Shuffles</h1>
<h3 id="example-cont-">Example (cont.)</h3>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases = [</div><div class="remark-code-line">        CFFPurchase(<span class="hljs-number">100</span>, <span class="hljs-string">"Geneva"</span>, <span class="hljs-number">22.25</span>),</div><div class="remark-code-line">        CFFPurchase(<span class="hljs-number">100</span>, <span class="hljs-string">"Zurich"</span>, <span class="hljs-number">42.10</span>),</div><div class="remark-code-line">        CFFPurchase(<span class="hljs-number">100</span>, <span class="hljs-string">"Fribourg"</span>, <span class="hljs-number">12.40</span>),</div><div class="remark-code-line">        CFFPurchase(<span class="hljs-number">101</span>, <span class="hljs-string">"St.Gallen"</span>, <span class="hljs-number">8.20</span>),</div><div class="remark-code-line">        CFFPurchase(<span class="hljs-number">101</span>, <span class="hljs-string">"Lucerne"</span>, <span class="hljs-number">31.60</span>),</div><div class="remark-code-line">        CFFPurchase(<span class="hljs-number">100</span>, <span class="hljs-string">"Basel"</span>, <span class="hljs-number">16.20</span>)</div><div class="remark-code-line">    ]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases = sc.parallelize(purchases)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases.collect()</div><div class="remark-code-line">[CFFPurchase(client_id=<span class="hljs-number">100</span>, destination=<span class="hljs-string">'Geneva'</span>, price=<span class="hljs-number">22.25</span>),</div><div class="remark-code-line"> CFFPurchase(client_id=<span class="hljs-number">100</span>, destination=<span class="hljs-string">'Zurich'</span>, price=<span class="hljs-number">42.1</span>),</div><div class="remark-code-line"> CFFPurchase(client_id=<span class="hljs-number">100</span>, destination=<span class="hljs-string">'Fribourg'</span>, price=<span class="hljs-number">12.4</span>),</div><div class="remark-code-line"> CFFPurchase(client_id=<span class="hljs-number">101</span>, destination=<span class="hljs-string">'St.Gallen'</span>, price=<span class="hljs-number">8.2</span>),</div><div class="remark-code-line"> CFFPurchase(client_id=<span class="hljs-number">101</span>, destination=<span class="hljs-string">'Lucerne'</span>, price=<span class="hljs-number">31.6</span>),</div><div class="remark-code-line"> CFFPurchase(client_id=<span class="hljs-number">100</span>, destination=<span class="hljs-string">'Basel'</span>, price=<span class="hljs-number">16.2</span>)]</div></code></pre><div class="remark-slide-number">7 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffles">Shuffles</h1>
<h3 id="example-cont-">Example (cont.)</h3>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases_per_client = (purchases</div><div class="remark-code-line">        <span class="hljs-comment"># Pair RDD</span></div><div class="remark-code-line">        .map(<span class="hljs-keyword">lambda</span> p: (p.client_id, p.price))</div><div class="remark-code-line">        <span class="hljs-comment"># RDD[p.customerId, List[p.price]]</span></div><div class="remark-code-line">        .groupByKey()                          </div><div class="remark-code-line">        .map(<span class="hljs-keyword">lambda</span> p: (p[<span class="hljs-number">0</span>], (len(p[<span class="hljs-number">1</span>]), sum(p[<span class="hljs-number">1</span>]))))</div><div class="remark-code-line">        .collect()</div><div class="remark-code-line">    )</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases_per_client</div><div class="remark-code-line">[(<span class="hljs-number">100</span>, (<span class="hljs-number">4</span>, <span class="hljs-number">92.95</span>)), (<span class="hljs-number">101</span>, (<span class="hljs-number">2</span>, <span class="hljs-number">39.8</span>))]</div></code></pre>
<p>How would this <strong>looks on a cluster?</strong> (imagine that the dataset has millions of purchases)</p><div class="remark-slide-number">8 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffles">Shuffles</h1>
<ul>
<li><p>Lets say we have <strong>3 worker nodes</strong> and our data is <strong>evenly distributed on it</strong>, so the operations above look like this:
<span class="center"><img src="./Remark07_files/shuffline.png" style="width: 95%;"></span></p>
</li>
<li><p>This shuffling is very expensive because of <span class="stress">latency</span></p>
</li>
<li><p>Can we do a <strong>better job</strong>?</p>
</li>
</ul><div class="remark-slide-number">9 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffles">Shuffles</h1>
<p>Perhaps we can <span class="stress">reduce before we shuffle</span> in order to greatly reduce the amount of data sent over network. We use <code class="remark remark-inline-code">reduceByKey</code>.</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases_per_client = (purchases</div><div class="remark-code-line">        .map(<span class="hljs-keyword">lambda</span> p: (p.client_id, (<span class="hljs-number">1</span>, p.price)))</div><div class="remark-code-line">        .reduceByKey(<span class="hljs-keyword">lambda</span> v1, v2: (v1[<span class="hljs-number">0</span>] + v2[<span class="hljs-number">0</span>], v1[<span class="hljs-number">1</span>] + v2[<span class="hljs-number">1</span>]))</div><div class="remark-code-line">        .collect()</div><div class="remark-code-line">    )</div></code></pre>
<p>This looks like on the cluster:
<span class="center"><img src="./Remark07_files/shuffline_2.png" style="width: 80%;"></span></p><div class="remark-slide-number">10 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffles">Shuffles</h1>
<ul>
<li><code class="remark remark-inline-code">groupByKey</code> (left) VS <code class="remark remark-inline-code">reduceByKey</code> (right) :</li>
</ul>
<div class="center"><p><img src="./Remark07_files/shuffline.png" style="width: 49%;">
<img src="./Remark07_files/shuffline_2.png" style="width: 49%;"></p>
</div>
<ul>
<li>With <code class="remark remark-inline-code">reduceByKey</code> we shuffle considerably less amount of data</li>
</ul>
<p><strong>Benefits of this approach:</strong> </p>
<ul>
<li>by <span class="stress">reducing the data first</span>, the amount of data sent during the shuffle is <strong>greatly reduced</strong>, leading to strong performance gains!</li>
<li>This is because <code class="remark remark-inline-code">groupByKey</code> requires collecting <strong>all key-value pairs with the same key on the same machine</strong> while <code class="remark remark-inline-code">reduceByKey</code> <strong>reduces locally</strong> before shuffling.</li>
</ul><div class="remark-slide-number">11 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-2-partitions">6.2. Partitions</h1><div class="remark-slide-number">12 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="partitioning">Partitioning</h1>
<p>How does Spark know which key to put on which machine?</p>
<ul>
<li>By default, Spark uses <span class="stress">hash partitioning</span> to determine <strong>which key-value pair</strong> should be sent to <strong>which machine</strong>.</li>
</ul>
<p>The data <strong>within an RDD</strong> is <span class="stress">split</span> into several <span class="stress">partitions</span>. Some properties of partitions:</p>
<ul>
<li>Partitions <strong>never</strong> span <span class="stress">multiple machines</span>, data in the <strong>same partition</strong> is always on the <strong>same worker machine</strong>.</li>
<li><strong>Each machine</strong> in the cluster contains <strong>one</strong> or <strong>more</strong> partitions.</li>
<li>The <span class="stress">number of partitions</span> to use is <strong>configurable</strong>. By default, it is the <span class="stress">total number of cores on all executor nodes</span>;  6 workers with 4 cores should lead to 24 partitions.</li>
</ul><div class="remark-slide-number">13 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="partitioning">Partitioning</h1>
<p>Two kinds of partitioning are available in Spark: </p>
<ul>
<li><span class="stress">Hash</span> partitioning</li>
<li><span class="stress">Range</span> partitioning</li>
</ul>
<p>Customizing a partitioning is only possible on a <code class="remark remark-inline-code">PairRDD</code> and <code class="remark remark-inline-code">DataFrame</code>, namely <strong>something with keys</strong>.</p>
<h3 id="hash-partitioning">Hash Partitioning</h3>
<p>Given a Pair RDD that should be grouped, <code class="remark remark-inline-code">groupByKey</code> first computes per tuple <code class="remark remark-inline-code">(k,v)</code> its partition <code class="remark remark-inline-code">p</code>:</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line">p = k.hashCode() % numPartitions</div></code></pre>
<p>Then, all tuples in the same partition <code class="remark remark-inline-code">p</code> are sent to the machine hosting <code class="remark remark-inline-code">p</code>.</p><div class="remark-slide-number">14 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="partitioning">Partitioning</h1>
<p><strong>Intuition:</strong> hash partitioning attempts to <span class="stress">spread data evenly</span> across partitions <strong>based on the key</strong>.</p>
<p>The other kind of partitioning is <span class="stress">range partitioning</span></p>
<h3 id="range-partitioning">Range Partitioning</h3>
<ul>
<li>Pair RDDs may contain keys that have an <span class="stress">ordering</span> defined, such as <code class="remark remark-inline-code">int</code>, <code class="remark remark-inline-code">String</code>, etc.</li>
<li>For such RDDs, <span class="stress">range partitioning</span> may be more efficient.</li>
</ul>
<p>Using a <strong>range partitioner</strong>, keys are partitioned according to 2 things:</p>
<ol>
<li>an <strong>ordering</strong> for keys</li>
<li>a set of <strong>sorted ranges</strong> of keys</li>
</ol>
<p>(key, value) pairs with keys in the <strong>same range</strong> end up in the <strong>same partition</strong>.</p><div class="remark-slide-number">15 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="partitioning">Partitioning</h1>
<p>Consider a Pair RDD with keys: <code class="remark remark-inline-code">[8, 96, 240, 400, 401, 800]</code>, and a desired number of partitions of 4.</p>
<p>With <strong>hash partitioning</strong></p>
<pre><code class="python hljs remark-code"><div class="remark-code-line">p = k.hashCode() % numPartitions</div><div class="remark-code-line">  = k % <span class="hljs-number">4</span></div></code></pre>
<p>leads to</p>
<ul>
<li>Partition 0: <code class="remark remark-inline-code">[8, 96, 240, 400, 800]</code></li>
<li>Partition 1: <code class="remark remark-inline-code">[401]</code></li>
<li>Partition 2: <code class="remark remark-inline-code">[]</code></li>
<li>Partition 3: <code class="remark remark-inline-code">[]</code></li>
</ul>
<p>This results in a <span class="stress">very unbalanced distribution</span> which <strong>hurts performance</strong>, since the data is <strong>spread mostly on 1 node</strong>, so not very parallel.</p><div class="remark-slide-number">16 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="partitioning">Partitioning</h1>
<p>In this case, using <strong>range partitioning</strong> can <span class="stress">improve the distribution</span> significantly.</p>
<ul>
<li>Assumptions: (a) keys are non-negative, (b) 800 is the biggest key</li>
<li>Ranges: <code class="remark remark-inline-code">[1-200], [201-400], [401-600], [601-800]</code></li>
</ul>
<p>Based on this the keys are distributed as follows:</p>
<ul>
<li>Partition 0: <code class="remark remark-inline-code">[8, 96]</code></li>
<li>Partition 1: <code class="remark remark-inline-code">[240, 400]</code></li>
<li>Partition 2: <code class="remark remark-inline-code">[401]</code></li>
<li>Partition 3: <code class="remark remark-inline-code">[800]</code></li>
</ul>
<p>This is <span class="stress">much more balanced</span>.</p><div class="remark-slide-number">17 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="partitioning">Partitioning</h1>
<p>How do we set a partitioning for our data?</p>
<ol>
<li>On a Pair RDD: call <code class="remark remark-inline-code">partitionBy</code>, providing an explicit <code class="remark remark-inline-code">Partitioner</code> (<code class="remark remark-inline-code">scala</code> only, use a partitioning function in <code class="remark remark-inline-code">pyspark</code>)</li>
<li>On a DataFrame: Call <code class="remark remark-inline-code">repartition</code> for <strong>hash partitioning</strong> and <code class="remark remark-inline-code">repartitionByRange</code> for <strong>range partitioning</strong></li>
<li>Using transformations that return a RDD or a DataFrame with <strong>specific partitioners</strong>.</li>
</ol>
<h3 id="partitioning-a-rdd-using-partitionby-">Partitioning a <code class="remark remark-inline-code">RDD</code> using <code class="remark remark-inline-code">partitionBy</code></h3>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>pairs = purchases.map(<span class="hljs-keyword">lambda</span> p: (p.client_id, p.price))</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>pairs = pairs.partitionBy(<span class="hljs-number">3</span>, <span class="hljs-string">"client_id"</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>pairs.getNumPartitions()</div><div class="remark-code-line"><span class="hljs-number">3</span></div></code></pre><div class="remark-slide-number">18 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="partitioning">Partitioning</h1>
<p>Using <code class="remark remark-inline-code">RangePartitioner</code> with <code class="remark remark-inline-code">pyspark</code> requires</p>
<ol>
<li>Specifying the desired number of partitions</li>
<li>Providing a DataFrame with <strong>orderable keys</strong></li>
</ol>
<pre><code class="python hljs remark-code"><div class="remark-code-line">pairs = purchases.map(<span class="hljs-keyword">lambda</span> p: (p.client_id, p.price))</div><div class="remark-code-line">pairs = spark.createDataFrame(pairs, [<span class="hljs-string">"id"</span>, <span class="hljs-string">"price"</span>])</div><div class="remark-code-line">pairs.repartitionByRange(<span class="hljs-number">3</span>, <span class="hljs-string">"price"</span>).persist()</div><div class="remark-code-line">pairs.show()</div></code></pre>
<h3 id="important">Important</h3>
<ul>
<li>The result of <code class="remark remark-inline-code">partitionBy</code>, <code class="remark remark-inline-code">repartition</code>, <code class="remark remark-inline-code">repartitionByRange</code> <span class="stress">should be persisted</span>. </li>
<li>Otherwise <strong>partitioning is repeatedly applied</strong> (with shuffling!) each time the partitioned data is used.</li>
</ul><div class="remark-slide-number">19 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="partitioning">Partitioning</h1>
<h3 id="partitioning-using-transformations">Partitioning using transformations</h3>
<ul>
<li>Pair RDDs that are <strong>result of a transformation</strong> on a <span class="stress">partitioned</span> Pair RDD use typically the <span class="stress">same</span> hash partitioner</li>
<li>Some operations on RDDs <strong>automatically</strong> result in an RDD with a <strong>known</strong> partitioner - when it makes sense. </li>
<li>Example: when using <code class="remark remark-inline-code">sortByKey</code>, a <code class="remark remark-inline-code">RangePartitioner</code> is used. With <code class="remark remark-inline-code">groupByKey</code>, a default hash partitioner is used.</li>
</ul>
<p>Operations on Pair RDDs that <strong>hold to</strong> and <strong>propagate</strong> a partitioner:</p>
<ul>
<li><code class="remark remark-inline-code">cogroup</code>, <code class="remark remark-inline-code">groupWith</code>, <code class="remark remark-inline-code">join</code>, <code class="remark remark-inline-code">leftOuterJoin</code>, <code class="remark remark-inline-code">rightOuterJoin</code></li>
<li><code class="remark remark-inline-code">[group,reduce,fold,combine]ByKey</code>, <code class="remark remark-inline-code">partitionBy</code>, <code class="remark remark-inline-code">sort</code></li>
<li><code class="remark remark-inline-code">mapValues</code>, <code class="remark remark-inline-code">flatMapValues</code>, <code class="remark remark-inline-code">filter</code> (if parent has a partitioner)</li>
</ul>
<p><strong>All other operations</strong> will produce a result <span class="stress">without partitioner</span>! Why ???</p><div class="remark-slide-number">20 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="partitioning">Partitioning</h1>
<p>Consider the <code class="remark remark-inline-code">map</code> transformation. Given that we have a hash-partitioned Pair RDD, <span class="stress">why loosing the partitioner</span> in its result RDD?</p>
<p>Because its possible for <code class="remark remark-inline-code">map</code> or <code class="remark remark-inline-code">flatMap</code> to <span class="stress">change</span> the key:</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line">hashPartitionedRdd.map(<span class="hljs-keyword">lambda</span> k, v: (<span class="hljs-string">"ooooops"</span>, v))</div></code></pre>
<p>If the <code class="remark remark-inline-code">map</code> transformation preserved the previous partitioner, it would no longer makes sense: the keys are all same after this <code class="remark remark-inline-code">map</code></p>
<p>Hence, use <code class="remark remark-inline-code">mapValues</code>, since it enables to do <code class="remark remark-inline-code">map</code> transformations <strong>without changing the keys</strong>, thereby preserving the partitioner.</p><div class="remark-slide-number">21 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-3-optimizing-shuffles-with-partitioning">6.3. Optimizing shuffles with partitioning</h1><div class="remark-slide-number">22 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="optimizing-with-partitioning">Optimizing with partitioning</h1>
<p><strong>Why would we want to repartition the data?</strong></p>
<ul>
<li><p>Because it can bring <span class="stress">substantial performance gains</span>, especially before <strong>shuffles</strong>.</p>
</li>
<li><p>We saw that using <code class="remark remark-inline-code">reduceByKey</code> instead of <code class="remark remark-inline-code">groupByKey</code> <span class="stress">localizes data better</span> due to different <strong>partitioning</strong> strategies and thus <strong>reduces latency</strong> to deliver <strong>performance gains</strong>.</p>
</li>
<li><p>By manually repartitioning the data for the same example as before, we can <span class="stress">improve the performance even further</span>.</p>
</li>
<li><p>By using <strong>range partitioners</strong> we can optimize the use of <code class="remark remark-inline-code">reduceByKey</code> in that example so that it <span class="stress">does not involve any shuffling</span> over the network at all!</p>
</li>
</ul><div class="remark-slide-number">23 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="optimizing-with-partitioning">Optimizing with partitioning</h1>
<p>Compared to what we did previously, we use <code class="remark remark-inline-code">sortByKey</code> to produce a range partitioner for the RDD that we immediately persist.</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>pairs = purchases.map(<span class="hljs-keyword">lambda</span> p: (p.client_id, (<span class="hljs-number">1</span>, p.price)))</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>pairs = pairs.sortByKey().persist()</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>pairs.reduceByKey(</div><div class="remark-code-line">       <span class="hljs-keyword">lambda</span> v1, v2: (v1[<span class="hljs-number">0</span>] + v2[<span class="hljs-number">0</span>], v1[<span class="hljs-number">1</span>] + v2[<span class="hljs-number">1</span>])</div><div class="remark-code-line">    ).collect()</div></code></pre>
<p>This typically leads to <span class="stress">much faster computations</span> in this case (for large RDD, not the small toy example from before).</p><div class="remark-slide-number">24 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-4-optimizing-with-broadcast-join">6.4. Optimizing with broadcast join</h1><div class="remark-slide-number">25 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="optimizing-with-broadcasting">Optimizing with broadcasting</h1>
<p>When joining two DataDrames, where one is small enough to <strong>fit in memory</strong>, it is <span class="stress">broadcasted</span> over <strong>all the workers</strong> where the large DataFrame resides (and a hash join is performed). This has two phases:</p>
<ul>
<li><strong>Broadcast</strong>: the smaller DataFrame is broadcasted across workers containing the large one</li>
<li><strong>Hash join</strong>: a standard hash join is executed on each workder</li>
</ul>
<p>There is therefore <span class="stress">no shuffling</span> involved and this can be <strong>much faster</strong> than a regular join.</p>
<p>The default threshold for broadcasting is</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>spark.conf.get(<span class="hljs-string">"spark.sql.autoBroadcastJoinThreshold"</span>)</div><div class="remark-code-line"><span class="hljs-string">'10485760'</span></div></code></pre>
<p>meaning 10MB</p><div class="remark-slide-number">26 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="optimizing-with-broadcasting">Optimizing with broadcasting</h1>
<p>Can be changed using</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>spark.conf.set(<span class="hljs-string">"spark.sql.autoBroadcastJoinThreshold"</span>, <span class="hljs-string">"20971520"</span>)</div></code></pre>
<p><code class="remark remark-inline-code">"spark.broadcast.compress"</code> can be used to configure whether to compress the data before sending it (<code class="remark remark-inline-code">True</code> by default). </p>
<p>It uses the compression specified in <code class="remark remark-inline-code">"spark.io.compression.codec config"</code> and the default is <code class="remark remark-inline-code">"lz4"</code>. We can use other compression codecs but what the hell. </p>
<p>More important: even though a DataFrame is small, sometimes Spark can't estimate the size of it. We can <strong>enforce</strong> using a <span class="stress">broadcast hint</span>:</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql.functions <span class="hljs-keyword">import</span> broadcast</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>largeDF.join(broadcast(smallDF))</div></code></pre><div class="remark-slide-number">27 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="optimizing-with-broadcasting">Optimizing with broadcasting</h1>
<ul>
<li><p>If a <strong>broadcast hint</strong> is specified, the side with the hint will be <span class="stress">broadcasted</span> irrespective of <code class="remark remark-inline-code">autoBroadcastJoinThreshold</code>. </p>
</li>
<li><p>If <strong>both sides</strong> have broadcast hints, the side <strong>with a smallest estimated size</strong> will be broadcasted. </p>
</li>
<li><p>If there is <strong>no hint</strong> and the estimated size of DataFrame &lt; <code class="remark remark-inline-code">autoBroadcastJoinThreshold</code>, that table is usually broadcasted</p>
</li>
<li><p>Spark has a <strong>BitTorrent-like</strong> implementation to perform broadcast. Allows to <strong>avoid the driver being the bottleneck</strong> when sending data to multiple executors. </p>
</li>
</ul><div class="remark-slide-number">28 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="optimizing-with-broadcasting">Optimizing with broadcasting</h1>
<ul>
<li><p><strong>Usually</strong>, a <strong>broadcast join</strong> performs <span class="stress">faster</span> than other join algorithms when the broadcast side is small enough. </p>
</li>
<li><p>However, broadcasting tables is <strong>network-intensive</strong> and can cause <code class="remark remark-inline-code">out of memory</code> errors or even <strong>perform worse</strong> than other joins if the <span class="stress">broadcasted table is too large</span>.</p>
</li>
<li><p>Broadcast join is <strong>not</strong> supported for a <strong>full outer join</strong>. For <strong>right outer join</strong>, only <strong>left side</strong> table can be broadcasted and for other <strong>left joins</strong> only the <strong>right table</strong> can be broadcasted.</p>
</li>
</ul><div class="remark-slide-number">29 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-5-shuffle-hash-vs-sort-merge-joins">6.5. Shuffle hash VS sort merge joins</h1><div class="remark-slide-number">30 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffle-hash-vs-sort-merge-joins">Shuffle hash VS sort merge joins</h1>
<p>Spark can use mainly <strong>two strategies</strong> for joining:</p>
<ul>
<li><span class="stress">Shuffle hash</span> join</li>
<li><span class="stress">Sort merge</span> join</li>
</ul>
<p>Sort merge join is the <strong>default join strategy</strong>, since it is very scalable and <span class="stress">performs better</span> than other joins <strong>most of the times</strong>.</p>
<p><strong>Shuffle hash join</strong> is used as the join strategy when: </p>
<ul>
<li><code class="remark remark-inline-code">"spark.sql.join.preferSortMergeJoin"</code> is set to <code class="remark remark-inline-code">False</code></li>
<li>the cost to build a hash map is <strong>less</strong> than sorting the data. </li>
</ul><div class="remark-slide-number">31 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffle-hash">Shuffle hash</h1>
<p><strong>Shuffle hash</strong> join has 2 phases:</p>
<ol>
<li>A <span class="stress">shuffle</span> phase, where data from the join tables are <strong>partitioned based on the join key</strong>. This <strong>shuffles data</strong> across the partitions. Data with the <span class="stress">same keys</span> end up in the <span class="stress">same partition</span>: the <strong>data required</strong> for joins is available in the <strong>same partition</strong>.</li>
<li><span class="stress">Hash join</span> phase: data on <strong>each partition</strong> performs a <strong>single node</strong> hash join.</li>
</ol>
<p>Thus, shuffle hash join <strong>breaks apart</strong> the big join of two tables into <strong>localized smaller chunks</strong>.</p>
<ul>
<li>Shuffle is <strong>very expensive</strong>, the creation of Hash tables is also <strong>expensive</strong> and <strong>memory bound</strong>. </li>
<li>Shuffle hash join is <strong>not suited</strong> for joins that <span class="stress">wouldn't fit in memory</span>.</li>
</ul><div class="remark-slide-number">32 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="shuffle-hash">Shuffle hash</h1>
<ul>
<li>The <strong>performance</strong> of shuffle hash join depends on the <span class="stress">distribution of the keys</span>. The <strong>greater</strong> number of <strong>unique</strong> join keys the <strong>better</strong> data distribution we get.</li>
<li>Maximum amount of <strong>achievable parallelism</strong> is proportional to the <strong>number of unique keys</strong>.</li>
</ul>
<p>By default, <strong>sort merge join</strong> is <span class="stress">preferred</span> over <strong>shuffle hash join</strong>.
<code class="remark remark-inline-code">ShuffledHashJoin</code> is still useful when:</p>
<ul>
<li>Any partition of the resulting table can <strong>fit in memory</strong></li>
<li>One table is <strong>much smaller</strong> than the other one, so that building a <strong>hash table</strong> of the <strong>small</strong> table is <span class="stress">smaller</span> than <strong>sorting the large table</strong>.</li>
</ul>
<p>This explains why this shuffle is used for <strong>broadcast joins</strong>.</p><div class="remark-slide-number">33 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="sort-merge-join">Sort merge join</h1>
<p><strong>Sort merge join</strong> is Spark's <span class="stress">default join strategy</span> if:</p>
<ul>
<li>matching join keys are <strong>sortable</strong> </li>
<li><strong>not eligible</strong> for <strong>broadcast join</strong> or <strong>shuffle hash join</strong>. </li>
</ul>
<p>It is <strong>very scalable</strong> and is an <strong>inheritance of Hadoop</strong> and map-reduce programs.
What makes it <strong>scalable</strong> is that it can <strong>spill data to the disk</strong> and doesn't require the <strong>entire data</strong> to <span class="stress">fit inside the memory</span>.</p>
<p>It has <strong>three</strong> phases:</p>
<ol>
<li><span class="stress">Shuffle</span> phase: the two large tables are <strong>(re)partitioned</strong> using the join key(s) across the partitions in the cluster.</li>
<li><span class="stress">Sort</span> phase: <strong>sort</strong> the data <strong>within each partition</strong> in parallel.</li>
<li><span class="stress">Merge</span> phase: <strong>join</strong> the <strong>sorted</strong> and <strong>partitioned</strong> data. This is simply <strong>merging the datasets</strong> by iterating over the elements and joining the rows having the <strong>same value for the join key</strong>.</li>
</ol><div class="remark-slide-number">34 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="sort-merge-join">Sort merge join</h1>
<ul>
<li>For ideal performance of the sort merge join, all rows <strong>with the same join key(s)</strong> are available in the <strong>same partition</strong>. This can help with the infamous partition exchange (shuffle) between workers.</li>
<li><strong>Collocated partitions</strong> can <span class="stress">avoid unnecessary data shuffle</span>. </li>
<li>Data needs to be <span class="stress">evenly distributed</span> in the join keys, so that they can be <strong>equally distributed across the cluster</strong> to achieve the <strong>maximum parallelism</strong> from the available partitions.</li>
</ul>
<h3 id="other-join-types">Other join types</h3>
<p>There are <strong>other join types</strong>, such as <code class="remark remark-inline-code">BroadcastNestedLoopJoin</code> in weird situations where <span class="stress">no joining keys are specified</span> and either there is a broadcast hint or the size of a table is &lt; <code class="remark remark-inline-code">autoBroadcastJoinThreshold</code>.</p>
<p>In summary: <span class="stress">don't use these</span>, if you see these in an execution plan or in the Spark UI, it usually means that something <strong>has been done poorly</strong>.</p><div class="remark-slide-number">35 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="take-home-messages-on-joins">Take home messages on joins</h1>
<ul>
<li><p><strong>Sort merge join</strong> is the <span class="stress">default</span> join and performs well in most of the scenarios.</p>
</li>
<li><p>In <strong>some</strong> cases, if you are confident enough that <strong>shuffle hash join</strong> is <span class="stress">better</span> than sort merge join, you can <strong>disable sort merge join</strong> for those scenarios. </p>
</li>
<li><p>Tune <code class="remark remark-inline-code">spark.sql.autoBroadcastJoinThreshold</code> accordingly if deemed necessary. Try to use <span class="stress">broadcast joins</span> wherever possible and <span class="stress">filter out the irrelevant rows</span> to the join key <strong>before</strong> the join to <strong>avoid unnecessary data shuffling</strong>.</p>
</li>
<li><p>Joins <strong>without unique join keys</strong> or <strong>no join keys</strong> can often be very expensive and <span class="stress">should be avoided</span>.</p>
</li>
</ul><div class="remark-slide-number">36 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="how-do-i-know-when-a-shuffle-will-occur-">How do I know when a shuffle will occur?</h1>
<p><strong>Rule of thumb</strong>: a shuffle <strong>can</strong> occur when the resulting data <span class="stress">depends on other data</span> (can be the same or another RDD/DataFrame).</p>
<p>We can also <strong>figure out</strong> if a <span class="stress">shuffle</span> has been <strong>planned</strong> or <strong>executed</strong> via:</p>
<ol>
<li>The return type of certain transformations (in <code class="remark remark-inline-code">scala</code> only)</li>
<li>By looking at the <span class="stress">Spark UI</span></li>
<li>Using <code class="remark remark-inline-code">toDebugString</code> on a RDD to see its execution plan: </li>
</ol>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>print(pairs.toDebugString().decode(<span class="hljs-string">"utf-8"</span>))</div><div class="remark-code-line">(<span class="hljs-number">3</span>) PythonRDD[<span class="hljs-number">157</span>] at RDD at PythonRDD.scala:<span class="hljs-number">53</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line"> |       CachedPartitions: <span class="hljs-number">3</span>; MemorySize: <span class="hljs-number">233.0</span> B; ExternalBlockStoreSize: <span class="hljs-number">0.0</span> B; DiskSize: <span class="hljs-number">0.0</span> B</div><div class="remark-code-line"> |  MapPartitionsRDD[<span class="hljs-number">156</span>] at mapPartitions at PythonRDD.scala:<span class="hljs-number">133</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line"> |  ShuffledRDD[<span class="hljs-number">155</span>] at partitionBy at &lt;unknown&gt;:<span class="hljs-number">0</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line"> +-(<span class="hljs-number">8</span>) PairwiseRDD[<span class="hljs-number">154</span>] at sortByKey at &lt;ipython-input<span class="hljs-number">-35</span><span class="hljs-number">-112008</span>c310ec&gt;:<span class="hljs-number">2</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line">    |  PythonRDD[<span class="hljs-number">153</span>] at sortByKey at &lt;ipython-input<span class="hljs-number">-35</span><span class="hljs-number">-112008</span>c310ec&gt;:<span class="hljs-number">2</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line">    |  ParallelCollectionRDD[<span class="hljs-number">0</span>] at parallelize at PythonRDD.scala:<span class="hljs-number">195</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div></code></pre><div class="remark-slide-number">37 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="how-do-i-know-when-a-shuffle-will-occur-">How do I know when a shuffle will occur?</h1>
<p>Operations that <strong>might</strong> cause a shuffle:</p>
<ul>
<li><code class="remark remark-inline-code">cogroup</code>, <code class="remark remark-inline-code">groupWith</code>, <code class="remark remark-inline-code">join</code>, <code class="remark remark-inline-code">leftOuterJoin</code>, <code class="remark remark-inline-code">rightOuterJoin</code>, <code class="remark remark-inline-code">groupByKey</code>, <code class="remark remark-inline-code">reduceByKey</code>, <code class="remark remark-inline-code">combineByKey</code>, <code class="remark remark-inline-code">distinct</code>, <code class="remark remark-inline-code">intersection</code>, <code class="remark remark-inline-code">repartition</code>, <code class="remark remark-inline-code">coalesce</code></li>
</ul>
<p>When can we <span class="stress">avoid shuffles</span> using <strong>partitioning</strong> ?</p>
<ol>
<li><code class="remark remark-inline-code">reduceByKey</code> running on a pre-partitioned RDD will cause the values to be computed <strong>locally</strong>, requiring only the final reduced value to be sent to the driver.</li>
<li><code class="remark remark-inline-code">join</code> called on 2 RDDs that are pre-partitioned with the same partitioner and cached on the same machine will cause the join to be computed <strong>locally</strong>, with no shuffling across the network.</li>
</ol><div class="remark-slide-number">38 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-6-wide-versus-narrow-dependencies">6.6. Wide versus narrow dependencies</h1><div class="remark-slide-number">39 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<ul>
<li><p>We have seen that some transformations are <strong>significantly more expensive (latency)</strong> than others</p>
</li>
<li><p>This is often explained by <span class="stress">wide</span> versus <span class="stress">narrow dependencies</span>, which dictate <strong>relationships between RDDs</strong> in <strong>graphs of computation</strong>, that has a lot to do with <span class="stress">shuffling</span></p>
</li>
</ul>
<h3 id="lineages">Lineages</h3>
<ul>
<li><p>Computations on RDDs are represented as a <span class="stress">lineage graph</span>: a <span class="stress">DAG</span> representing the <strong>computations done on the RDD</strong>. </p>
</li>
<li><p>This DAG is what Spark <strong>analyzes</strong> to do <strong>optimizations</strong>. Thanks to this, it is possible for an operation to step back and figure out how a result is derived from a particular point.</p>
</li>
</ul><div class="remark-slide-number">40 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<p><strong>Example</strong></p>
<pre><code class="python hljs remark-code"><div class="remark-code-line">rdd = sc.textFile(...)</div><div class="remark-code-line">filtered = rdd.map(...).filter(...).persist()</div><div class="remark-code-line">count = filtered.count()</div><div class="remark-code-line">reduced = filtered.reduce()</div></code></pre>
<p><span class="center"><img src="./Remark07_files/lineage_graph.png" style="width: 40%;"></span></p><div class="remark-slide-number">41 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<p>RDDs are made up of <strong>4 parts</strong>: </p>
<ul>
<li><strong>Partitions</strong>: <span class="stress">atomic pieces</span> of the dataset. <strong>One</strong> or <strong>many</strong> per worker.</li>
<li><strong>Dependencies</strong>: models <span class="stress">relationship</span> between <strong>this RDD</strong> and <strong>its partitions</strong> with the RDD(s) it was derived from (dependencies maybe modeled per partition). </li>
<li>A <strong>function</strong> for <span class="stress">computing the dataset</span> based on its parent RDDs.</li>
<li><strong>Metadata</strong> about it partitioning <span class="stress">scheme</span> and data placement.</li>
</ul>
<div class="center"><p><img src="./Remark07_files/rdd_anatomy_1.png" style="width: 30%;">
  <img src="https://stephanegaiffas.github.io/big_data_course/slides/slides07_spark-deeper-dive.html" style="width: 10%;">
  <img src="./Remark07_files/rdd_anatomy_2.png" style="width: 31%;"></p>
</div><div class="remark-slide-number">42 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<p><strong>RDD dependencies and shuffles</strong></p>
<ul>
<li>We saw a <strong>rule of thumb</strong>: a <span class="stress">shuffle</span> can occur when the <strong>resulting RDD depends on other elements</strong> from the same RDD or another RDD.</li>
<li>In fact, <span class="stress">RDD dependencies</span> <strong>encode</strong> when data <span class="stress">must be shuffled</span>.</li>
</ul>
<p>Transformations cause shuffles, and can have <strong>2 kinds of dependencies</strong>:</p>
<ul>
<li><strong>Narrow dependencies:</strong> each partition of the parent RDD is used by <span class="stress">at most</span> one partition of the child RDD. 
<div class="center"><pre><code class="bash hljs remark-code"><div class="remark-code-line">[parent RDD partition] --&gt; [child RDD partition]</div></code></pre>
</div>
<strong>Fast!</strong> <span class="stress">No shuffle</span> necessary. Optimizations like <strong>pipelining</strong> possible. <strong>Transformations with narrow dependencies are fast</strong>.</li>
</ul><div class="remark-slide-number">43 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<ul>
<li><strong>Wide dependencies:</strong> each partition of the parent RDD may be used by <span class="stress">multiple</span> child partitions<pre><code class="bash hljs remark-code"><div class="remark-code-line">                       ---&gt; [child RDD partition 1]</div><div class="remark-code-line">[parent RDD partition] ---&gt; [child RDD partition 2]</div><div class="remark-code-line">                       ---&gt; [child RDD partition 3]</div></code></pre>
<strong>Slow!</strong> <span class="stress">Shuffle necessary</span> for <strong>all</strong> or <strong>some</strong> data over the network. <strong>Transformations with wide dependencies are slow.</strong></li>
</ul><div class="remark-slide-number">44 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<div class="center"><p><img src="./Remark07_files/narrow_vs_wide_dependencies.png" style="width: 100%;"></p>
</div><div class="remark-slide-number">45 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<p>Assume that we have a following DAG: </p>
<p><span class="center"><img src="./Remark07_files/visual_dag.png" style="width: 55%;"></span></p><div class="remark-slide-number">46 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<p>What do the dependencies look like? Which is <strong>wide</strong> and which is <strong>narrow?</strong></p>
<p><span class="center"><img src="./Remark07_files/visual_dag_resolved.png" style="width: 85%;"></span></p>
<ul>
<li>The B to G <code class="remark remark-inline-code">join</code> is <span class="stress">narrow</span> because <code class="remark remark-inline-code">groupByKey</code> <strong>already partitions</strong> the keys and places them appropriately in B.</li>
<li>Thus, <code class="remark remark-inline-code">join</code> operations can be <span class="stress">narrow or wide</span> depending on <strong>lineage</strong></li>
</ul><div class="remark-slide-number">47 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<p>Transformations with (usually) <span class="stress">narrow</span> dependencies:</p>
<ul>
<li><code class="remark remark-inline-code">map</code>, <code class="remark remark-inline-code">mapValues</code>, <code class="remark remark-inline-code">flatMap</code>, <code class="remark remark-inline-code">filter</code>, <code class="remark remark-inline-code">mapPartitions</code>, <code class="remark remark-inline-code">mapPartitionsWithIndex</code></li>
</ul>
<p>Transformations with (usually) <span class="stress">wide</span> dependencies (might cause a <strong>shuffle</strong>):</p>
<ul>
<li><code class="remark remark-inline-code">cogroup</code>, <code class="remark remark-inline-code">groupWith</code>, <code class="remark remark-inline-code">join</code>, <code class="remark remark-inline-code">leftOuterJoin</code>, <code class="remark remark-inline-code">rightOuterJoin</code>, <code class="remark remark-inline-code">groupByKey</code>, <code class="remark remark-inline-code">reduceByKey</code>, <code class="remark remark-inline-code">combineByKey</code>, <code class="remark remark-inline-code">distinct</code>, <code class="remark remark-inline-code">intersection</code>, <code class="remark remark-inline-code">repartition</code>, <code class="remark remark-inline-code">coalesce</code></li>
</ul>
<p>These list are usually correct, but as seen above for <code class="remark remark-inline-code">join</code>, a correct answer <strong>depends on lineage</strong></p><div class="remark-slide-number">48 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<p>How do we <strong>find out</strong> if an operation is <strong>wide</strong> or <strong>narrow</strong>?</p>
<ul>
<li><p>Monitor the job with the <span class="stress">Spark UI</span> and check if <strong>ShuffleRDD</strong> are used.</p>
</li>
<li><p>Use the <code class="remark remark-inline-code">toDebugString</code> method. It prints the <strong>RDD lineage</strong> along with other information relevant to scheduling. Indentations separate <strong>groups of narrow transformations</strong> that may be <strong>pipelined</strong> together with wide transformations that require shuffles. These groupings are called <strong>stages</strong>.</p>
</li>
</ul>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>print(pairs.toDebugString().decode(<span class="hljs-string">"utf-8"</span>))</div><div class="remark-code-line">(<span class="hljs-number">3</span>) PythonRDD[<span class="hljs-number">157</span>] at RDD at PythonRDD.scala:<span class="hljs-number">53</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line"> |       CachedPartitions: <span class="hljs-number">3</span>; MemorySize: <span class="hljs-number">233.0</span> B; ExternalBlockStoreSize: <span class="hljs-number">0.0</span> B; DiskSize: <span class="hljs-number">0.0</span> B</div><div class="remark-code-line"> |  MapPartitionsRDD[<span class="hljs-number">156</span>] at mapPartitions at PythonRDD.scala:<span class="hljs-number">133</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line"> |  ShuffledRDD[<span class="hljs-number">155</span>] at partitionBy at &lt;unknown&gt;:<span class="hljs-number">0</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line"> +-(<span class="hljs-number">8</span>) PairwiseRDD[<span class="hljs-number">154</span>] at sortByKey at &lt;ipython-input<span class="hljs-number">-35</span><span class="hljs-number">-112008</span>c310ec&gt;:<span class="hljs-number">2</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line">    |  PythonRDD[<span class="hljs-number">153</span>] at sortByKey at &lt;ipython-input<span class="hljs-number">-35</span><span class="hljs-number">-112008</span>c310ec&gt;:<span class="hljs-number">2</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div><div class="remark-code-line">    |  ParallelCollectionRDD[<span class="hljs-number">0</span>] at parallelize at PythonRDD.scala:<span class="hljs-number">195</span> [Memory Serialized <span class="hljs-number">1</span>x Replicated]</div></code></pre><div class="remark-slide-number">49 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<ul>
<li>Check the <span class="stress">dependencies</span> (only with <code class="remark remark-inline-code">scala</code> and <code class="remark remark-inline-code">java</code> APIs): there is a <code class="remark remark-inline-code">dependencies</code> method on RDDs. It returns a sequence of <code class="remark remark-inline-code">Dependency</code> objects, which are the dependencies used by <strong>Spark's scheduler</strong> to know how this RDD <strong>depends on other (or itself) RDDs</strong>.</li>
</ul>
<p>The types of <strong>dependency objects</strong> that this method may return include:</p>
<ul>
<li><strong>Narrow</strong> dependency objects: <code class="remark remark-inline-code">OneToOneDependency</code>, <code class="remark remark-inline-code">PruneDependency</code>, <code class="remark remark-inline-code">RangeDependency</code></li>
<li><strong>Wide</strong> dependency objects: <code class="remark remark-inline-code">ShuffleDependency</code></li>
</ul>
<p>Example in <code class="remark remark-inline-code">scala</code>:</p>
<pre><code class="scala hljs remark-code"><div class="remark-code-line"><span class="hljs-keyword">val</span> wordsRDD = sc.parallelize(largeList)</div><div class="remark-code-line"><span class="hljs-keyword">val</span> pairs = wordsRdd.map(c=&gt;(c,<span class="hljs-number">1</span>))</div><div class="remark-code-line">                    .groupByKey</div><div class="remark-code-line">                    .dependencies</div><div class="remark-code-line"><span class="hljs-comment">// pairs: Seq[org.apache.spark.Dependency[_]] </span></div><div class="remark-code-line"><span class="hljs-comment">//   = List(org.apache.spark.ShuffleDependency@4294a23d)</span></div></code></pre><div class="remark-slide-number">50 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="wide-versus-narrow-dependencies">Wide versus narrow dependencies</h1>
<p>Also, <code class="remark remark-inline-code">toDebugString</code> is more precise with the <code class="remark remark-inline-code">scala</code> API:</p>
<pre><code class="scala hljs remark-code"><div class="remark-code-line"><span class="hljs-keyword">val</span> pairs = wordsRdd.map(c=&gt;(c,<span class="hljs-number">1</span>))</div><div class="remark-code-line">                    .groupByKey</div><div class="remark-code-line">                    .toDebugString</div><div class="remark-code-line"><span class="hljs-comment">// pairs: String =</span></div><div class="remark-code-line"><span class="hljs-comment">// (8) ShuffledRDD[219] at groupByKey at &lt;console&gt;:38 []</span></div><div class="remark-code-line"><span class="hljs-comment">//  +-(8) MapPartitionsRDD[218] at map at &lt;console&gt;:37 []</span></div><div class="remark-code-line"><span class="hljs-comment">//     | ParallelCollectionRDD[217] at parallelize at &lt;console&gt;:36 []</span></div></code></pre>
<p>We can see immediately that a <code class="remark remark-inline-code">ShuffledRDD</code> is used</p><div class="remark-slide-number">51 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-7-lineage-allows-fault-tolerance">6.7. Lineage allows fault tolerance</h1><div class="remark-slide-number">52 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="lineage-allows-fault-tolerance">Lineage allows fault tolerance</h1>
<p><strong>Lineages</strong> are the key to <span class="stress">fault tolerance</span> in Spark</p>
<p>Ideas from <strong>functional programming</strong> enable fault tolerance in Spark:</p>
<ul>
<li>RDDs are <span class="stress">immutable</span></li>
<li>Use <strong>higher order functions</strong> like <code class="remark remark-inline-code">map</code>, <code class="remark remark-inline-code">flatMap</code>, <code class="remark remark-inline-code">filter</code> to do <span class="stress">functional</span> transformations on this <strong>immutable</strong> data</li>
<li>A function for <strong>computing an RDD based on its parent RDDs</strong> is part the RDD's representation</li>
</ul>
<p>This is all done in Spark RDDs: a by product of these ideas is <span class="stress">fault tolerance</span>:</p>
<ul>
<li>We just need to <strong>keep the information</strong> required by these 3 properties.</li>
<li><strong>Recovering from failures</strong> is simply achieved by <span class="stress">recomputing lost partitions</span> using the lineage graph</li>
</ul><div class="remark-slide-number">53 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="lineage-allows-fault-tolerance">Lineage allows fault tolerance</h1>
<p>Aren't you amazed by this ?!?</p>
<ul>
<li>Spark provides <strong>fault tolerance</strong> <span class="stress">without having to write data on disk!</span> </li>
<li>Data can be <strong>rebuilt</strong> using the above information.<div class="pull-left-40"><p>If a partition <strong>fails</strong>:
<img src="./Remark07_files/fault_tol_1.png" style="width: 100%;"></p>
</div>
<div class="pull-right-40"><p>Spark <strong>recomputes it</strong> to get back on track:
<img src="./Remark07_files/fault_tol_2.png" style="width: 100%;"></p>
</div>
</li>
</ul><div class="remark-slide-number">54 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-8-catalyst-the-secret-weapon-of-spark-sql-">6.8. Catalyst: the secret weapon of <code class="remark remark-inline-code">spark.sql</code></h1><div class="remark-slide-number">55 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p>What is the <span class="stress">Catalyst</span> <strong>optimizer</strong> ?</p>
<ul>
<li><p>An <strong>optimizer</strong> that <strong>automatically finds</strong> out the <span class="stress">most efficient plan</span> to execute data operations specified in the user's program.</p>
</li>
<li><p>It <span class="stress">translates transformations</span> used to build the dataset to an <strong>optimized physical plan of execution</strong>, which is a DAG of <strong>low-level operations on RDDs</strong>.</p>
</li>
<li><p>A <span class="stress">precious tool</span> for <code class="remark remark-inline-code">spark.sql</code> in terms of <strong>performance</strong>. It understands the <strong>structure</strong> of the data used and of the <strong>operations</strong> made on it, so the optimizer <span class="stress">can make some decisions</span> helping to <strong>reduce execution time</strong>.</p>
</li>
</ul><div class="remark-slide-number">56 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p>Let's first define some terminology used in the optimizer</p>
<ul>
<li><span class="stress">Logical plan</span>: <strong>series of algebraic</strong> or <strong>language constructs</strong>, for example: SELECT, GROUP BY, UNION, etc. Usually <strong>represented as a DAG</strong> where <strong>nodes</strong> are the constructs.</li>
<li><span class="stress">Physical plan</span>: similar to the logical plan, also <strong>represented by a DAG</strong> but concerning <strong>low-level operations</strong> (operations on RDDs).</li>
<li><span class="stress">Unoptimized / optimized plans</span>:  a plan becomes <strong>optimized</strong> when the optimizer passed on it and <strong>made some optimizations</strong>, such as merging <code class="remark remark-inline-code">filter()</code> methods, replacing some instructions by faster another ones, etc.</li>
</ul>
<p>Catalyst helps to move from <strong>an unoptimized logical query plan</strong> to an <strong>optimized physical plan</strong> </p><div class="remark-slide-number">57 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer-how-it-works-">Catalyst optimizer: how it works?</h1>
<p><span class="center"><img src="./Remark07_files/catalyst01.png" style="width: 90%;"></span></p><div class="remark-slide-number">58 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer-how-it-works-">Catalyst optimizer: how it works?</h1>
<ul>
<li><p>Try to <span class="stress">optimize logical plan</span> through <strong>predefined rule-based optimizations</strong>. Some optimizations are:</p>
<ul>
<li><strong>predicate or projection pushdown</strong>, helps to eliminate data not respecting preconditions earlier in the computation;</li>
<li><strong>rearrange filter</strong>;</li>
<li><strong>conversion of decimals operations</strong> to long integer operations;</li>
<li><strong>replacement of some RegEx</strong> expressions by Java's methods <code class="remark remark-inline-code">startsWith</code> or <code class="remark remark-inline-code">contains</code>;</li>
<li><strong>if-else</strong> clauses simplification.</li>
</ul>
</li>
<li><p>Create the <strong>optimized logical plan</strong>.</p>
</li>
<li><p>Construct <span class="stress">multiple physical plans</span> from the <strong>optimized logical plan</strong>. These are also optimized, some examples are: <strong>merging</strong> different <code class="remark remark-inline-code">filter()</code>, sending <strong>predicate/projection pushdown</strong> to the <strong>data source</strong> to eliminate data directly from the source.</p>
</li>
</ul><div class="remark-slide-number">59 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer-how-it-works-">Catalyst optimizer: how it works?</h1>
<ul>
<li><p>Determine <strong>which physical plan</strong> has the <span class="stress">lowest cost of execution</span> and choses it as the <strong>physical plan used for the computation</strong>.</p>
</li>
<li><p>Generate <span class="stress">bytecode</span> for the <strong>best physical plan</strong> thanks to a <code class="remark remark-inline-code">scala</code> feature called <code class="remark remark-inline-code">quasiquotes</code>.</p>
</li>
<li><p>Once a physical plan is defined, its <span class="stress">executed</span> and retrieved data is put to the output DataFrame.</p>
</li>
</ul><div class="remark-slide-number">60 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p>Lets understand how Catalyst optimizer works for a given query</p>
<p><span class="center"><img src="./Remark07_files/catalyst02.png" style="width: 80%;"></span></p><div class="remark-slide-number">61 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst03.png" style="width: 100%;"></span></p><div class="remark-slide-number">62 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst04.png" style="width: 100%;"></span></p><div class="remark-slide-number">63 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst05.png" style="width: 100%;"></span></p><div class="remark-slide-number">64 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst06.png" style="width: 100%;"></span></p><div class="remark-slide-number">65 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst07.png" style="width: 100%;"></span></p><div class="remark-slide-number">66 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst08.png" style="width: 100%;"></span></p><div class="remark-slide-number">67 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst09.png" style="width: 100%;"></span></p><div class="remark-slide-number">68 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst10.png" style="width: 100%;"></span></p><div class="remark-slide-number">69 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst11.png" style="width: 100%;"></span></p><div class="remark-slide-number">70 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<p><span class="center"><img src="./Remark07_files/catalyst12.png" style="width: 100%;"></span></p><div class="remark-slide-number">71 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="catalyst-optimizer">Catalyst optimizer</h1>
<ul>
<li><p>By performing these <strong>transformations</strong>, Catalyst <span class="stress">improves the execution times</span> of relational queries and <strong>mitigates the importance of semantics</strong></p>
</li>
<li><p>Catalyst makes use of some <strong>powerful functional programming</strong> features from <code class="remark remark-inline-code">Scala</code> to allow developers to concisely specify complex relational optimizations.</p>
</li>
<li><p>Catalyst helps <span class="stress">but only when it can</span>: <strong>explicit</strong> schemas, <strong>precise function calls</strong>, <strong>clever</strong> order of operations <strong>can only help</strong> Catalyst.</p>
</li>
</ul><div class="remark-slide-number">72 / 73</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="thank-you-">Thank you !</h1><div class="remark-slide-number">73 / 73</div></div></div></div><div class="remark-slide-notes"></div></div></div>
<div class="remark-preview-area"><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="6-a-deeper-dive-into-spark">6. A deeper dive into Spark</h1><div class="remark-slide-number">2 / 73</div></div></div></div><div class="remark-slide-notes"></div></div></div>
<div class="remark-backdrop"></div>
<div class="remark-pause" style="transform: scale(1.09692); left: 277px; top: 0px;">
  <div class="remark-pause-lozenge">
    <span>Paused</span>
  </div>
</div>
<div class="remark-help" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;">
  <div class="remark-help-content">
    <h1>Help</h1>
    <p><b>Keyboard shortcuts</b></p>
    <table class="light-keys">
      <tbody><tr>
        <td>
          <span class="key"><b></b></span>,
          <span class="key"><b></b></span>,
          <span class="key">Pg Up</span>,
          <span class="key">k</span>
        </td>
        <td>Go to previous slide</td>
      </tr>
      <tr>
        <td>
          <span class="key"><b></b></span>,
          <span class="key"><b></b></span>,
          <span class="key">Pg Dn</span>,
          <span class="key">Space</span>,
          <span class="key">j</span>
        </td>
        <td>Go to next slide</td>
      </tr>
      <tr>
        <td>
          <span class="key">Home</span>
        </td>
        <td>Go to first slide</td>
      </tr>
      <tr>
        <td>
          <span class="key">End</span>
        </td>
        <td>Go to last slide</td>
      </tr>
      <tr>
        <td>
          Number + <span class="key">Return</span>
        </td>
        <td>Go to specific slide</td>
      </tr>
      <tr>
        <td>
          <span class="key">b</span>&nbsp;/
          <span class="key">m</span>&nbsp;/
          <span class="key">f</span>
        </td>
        <td>Toggle blackout / mirrored / fullscreen mode</td>
      </tr>
      <tr>
        <td>
          <span class="key">c</span>
        </td>
        <td>Clone slideshow</td>
      </tr>
      <tr>
        <td>
          <span class="key">p</span>
        </td>
        <td>Toggle presenter mode</td>
      </tr>
      <tr>
        <td>
          <span class="key">t</span>
        </td>
        <td>Restart the presentation timer</td>
      </tr>
      <tr>
        <td>
          <span class="key">?</span>,
          <span class="key">h</span>
        </td>
        <td>Toggle this help</td>
      </tr>
    </tbody></table>
  </div>
  <div class="content dismiss">
    <table class="light-keys">
      <tbody><tr>
        <td>
          <span class="key">Esc</span>
        </td>
        <td>Back to slideshow</td>
      </tr>
    </tbody></table>
  </div>
</div>

	<script type="text/x-mathjax-config">
	  MathJax.Hub.Config({
	    extensions: ["tex2jax.js", "AMSmath.js", "AMSsymbols.js", "autobold.js"],
	    jax: ["input/TeX", "output/HTML-CSS"],
	    tex2jax: {
	    	skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
	      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
	      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
	      processEscapes: true
	    },
	    "HTML-CSS": { availableFonts: ["TeX"] }
	  });
	</script>
	<script type="text/javascript" src="./Remark07_files/MathJax.js">
	</script>

  <link rel="stylesheet" href="./Remark07_files/pure-min.css">
  <style>
  .smaller-font { font-size:15.65px } 
  </style>
  

</body></html>