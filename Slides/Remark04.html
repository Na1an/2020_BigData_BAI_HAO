<!DOCTYPE html>
<!-- saved from url=(0081)https://stephanegaiffas.github.io/big_data_course/slides/slides04_sparksql.html#1 -->
<html class="remark-container"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css" title="remark">html.remark-container,body.remark-container{height:100%;width:100%;-webkit-print-color-adjust:exact}.remark-container{background:#d7d8d2;margin:0;overflow:hidden}.remark-container:focus{outline-style:solid;outline-width:1px}.remark-container:-webkit-full-screen{width:100%;height:100%}body:-webkit-full-screen{background:#000000}body:-moz-full-screen{background:#000000}body:fullscreen{background:#000000}.remark-slides-area{position:relative;height:100%;width:100%}.remark-slide-container{display:none;position:absolute;height:100%;width:100%;page-break-after:always}.remark-slide-scaler{background-color:transparent;overflow:hidden;position:absolute;-webkit-transform-origin:top left;-moz-transform-origin:top left;transform-origin:top-left;-moz-box-shadow:0 0 30px #888;-webkit-box-shadow:0 0 30px #888;box-shadow:0 0 30px #888}.remark-slide{height:100%;width:100%;display:table;table-layout:fixed}.remark-slide>.left{text-align:left}.remark-slide>.center{text-align:center}.remark-slide>.right{text-align:right}.remark-slide>.top{vertical-align:top}.remark-slide>.middle{vertical-align:middle}.remark-slide>.bottom{vertical-align:bottom}.remark-slide-content{background-color:#fff;background-position:center;background-repeat:no-repeat;display:table-cell;font-size:20px;padding:1em 4em 1em 4em}.remark-slide-content h1{font-size:55px}.remark-slide-content h2{font-size:45px}.remark-slide-content h3{font-size:35px}.remark-slide-content .left{display:block;text-align:left}.remark-slide-content .center{display:block;text-align:center}.remark-slide-content .right{display:block;text-align:right}.remark-slide-number{bottom:12px;opacity:.5;position:absolute;right:20px}.remark-slide-notes{border-top:3px solid black;position:absolute;display:none}.remark-code{font-size:18px}.remark-code-line{min-height:1em}.remark-code-line-highlighted{background-color:rgba(255,255,0,0.5)}.remark-code-span-highlighted{background-color:rgba(255,255,0,0.5);padding:1px 2px 2px 2px}.remark-visible{display:block;z-index:2}.remark-fading{display:block;z-index:1}.remark-fading .remark-slide-scaler{-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none}.remark-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;display:none;background:#000;z-index:2}.remark-pause{bottom:0;top:0;right:0;left:0;display:none;position:absolute;z-index:1000}.remark-pause .remark-pause-lozenge{margin-top:30%;text-align:center}.remark-pause .remark-pause-lozenge span{color:white;background:black;border:2px solid black;border-radius:20px;padding:20px 30px;font-family:Helvetica,arial,freesans,clean,sans-serif;font-size:42pt;font-weight:bold}.remark-container.remark-presenter-mode.remark-pause-mode .remark-pause{display:block}.remark-container.remark-presenter-mode.remark-pause-mode .remark-backdrop{display:block;opacity:.5}.remark-help{bottom:0;top:0;right:0;left:0;display:none;position:absolute;z-index:1000;-webkit-transform-origin:top left;-moz-transform-origin:top left;transform-origin:top-left}.remark-help .remark-help-content{color:white;font-family:Helvetica,arial,freesans,clean,sans-serif;font-size:12pt;position:absolute;top:5%;bottom:10%;height:10%;left:5%;width:90%}.remark-help .remark-help-content h1{font-size:36px}.remark-help .remark-help-content td{color:white;font-size:12pt;padding:10px}.remark-help .remark-help-content td:first-child{padding-left:0}.remark-help .remark-help-content .key{background:white;color:black;min-width:1em;display:inline-block;padding:3px 6px;text-align:center;border-radius:4px;font-size:14px}.remark-help .dismiss{top:85%}.remark-container.remark-help-mode .remark-help{display:block}.remark-container.remark-help-mode .remark-backdrop{display:block;opacity:.95}.remark-preview-area{bottom:2%;left:2%;display:none;opacity:.5;position:absolute;height:47.25%;width:48%}.remark-preview-area .remark-slide-container{display:block}.remark-notes-area{background:#fff;bottom:0;color:black;display:none;left:52%;overflow:hidden;position:absolute;right:0;top:0}.remark-notes-area .remark-top-area{height:50px;left:20px;position:absolute;right:10px;top:10px}.remark-notes-area .remark-bottom-area{position:absolute;top:75px;bottom:10px;left:20px;right:10px}.remark-notes-area .remark-bottom-area .remark-toggle{display:block;text-decoration:none;font-family:Helvetica,arial,freesans,clean,sans-serif;height:21px;font-size:.75em;text-transform:uppercase;color:#ccc}.remark-notes-area .remark-bottom-area .remark-notes-current-area{height:70%;position:relative}.remark-notes-area .remark-bottom-area .remark-notes-current-area .remark-notes{clear:both;border-top:1px solid #f5f5f5;position:absolute;top:22px;bottom:0;left:0;right:0;overflow-y:auto;margin-bottom:20px;padding-top:10px}.remark-notes-area .remark-bottom-area .remark-notes-preview-area{height:30%;position:relative}.remark-notes-area .remark-bottom-area .remark-notes-preview-area .remark-notes-preview{border-top:1px solid #f5f5f5;position:absolute;top:22px;bottom:0;left:0;right:0;overflow-y:auto}.remark-notes-area .remark-bottom-area .remark-notes>*:first-child,.remark-notes-area .remark-bottom-area .remark-notes-preview>*:first-child{margin-top:5px}.remark-notes-area .remark-bottom-area .remark-notes>*:last-child,.remark-notes-area .remark-bottom-area .remark-notes-preview>*:last-child{margin-bottom:0}.remark-toolbar{color:#979892;vertical-align:middle}.remark-toolbar .remark-toolbar-link{border:2px solid #d7d8d2;color:#979892;display:inline-block;padding:2px 2px;text-decoration:none;text-align:center;min-width:20px}.remark-toolbar .remark-toolbar-link:hover{border-color:#979892;color:#676862}.remark-toolbar .remark-toolbar-timer{border:2px solid black;border-radius:10px;background:black;color:white;display:inline-block;float:right;padding:5px 10px;font-family:sans-serif;font-weight:bold;font-size:175%;text-decoration:none;text-align:center}.remark-container.remark-presenter-mode .remark-slides-area{top:2%;left:2%;height:47.25%;width:48%}.remark-container.remark-presenter-mode .remark-preview-area{display:block}.remark-container.remark-presenter-mode .remark-notes-area{display:block}.remark-container.remark-blackout-mode:not(.remark-presenter-mode) .remark-backdrop{display:block;opacity:.99}.remark-container.remark-mirrored-mode:not(.remark-presenter-mode) .remark-slides-area{-webkit-transform:scaleX(-1);-moz-transform:scaleX(-1);-ms-transform:scaleX(-1);-o-transform:scaleX(-1)}@media print{.remark-container{overflow:visible;background-color:#fff}.remark-container.remark-presenter-mode .remark-slides-area{top:0;left:0;height:100%;width:681px}.remark-container.remark-presenter-mode .remark-preview-area,.remark-container.remark-presenter-mode .remark-notes-area{display:none}.remark-container.remark-presenter-mode .remark-slide-notes{display:block;margin-left:30px;width:621px}.remark-slide-container{display:block;position:relative}.remark-slide-scaler{-moz-box-shadow:none;-webkit-box-shadow:none;-webkit-transform-origin:initial;box-shadow:none}}@page{margin:0}.hljs-agate{/*! * Agate by Taufik Nurrohman <https://github.com/tovic> * ---------------------------------------------------- * * #ade5fc * #a2fca2 * #c6b4f0 * #d36363 * #fcc28c * #fc9b9b * #ffa * #fff * #333 * #62c8f3 * #888 * */}.hljs-agate .hljs{display:block;overflow-x:auto;padding:.5em;background:#333;color:white}.hljs-agate .hljs-name,.hljs-agate .hljs-strong{font-weight:bold}.hljs-agate .hljs-code,.hljs-agate .hljs-emphasis{font-style:italic}.hljs-agate .hljs-tag{color:#62c8f3}.hljs-agate .hljs-variable,.hljs-agate .hljs-template-variable,.hljs-agate .hljs-selector-id,.hljs-agate .hljs-selector-class{color:#ade5fc}.hljs-agate .hljs-string,.hljs-agate .hljs-bullet{color:#a2fca2}.hljs-agate .hljs-type,.hljs-agate .hljs-title,.hljs-agate .hljs-section,.hljs-agate .hljs-attribute,.hljs-agate .hljs-quote,.hljs-agate .hljs-built_in,.hljs-agate .hljs-builtin-name{color:#ffa}.hljs-agate .hljs-number,.hljs-agate .hljs-symbol,.hljs-agate .hljs-bullet{color:#d36363}.hljs-agate .hljs-keyword,.hljs-agate .hljs-selector-tag,.hljs-agate .hljs-literal{color:#fcc28c}.hljs-agate .hljs-comment,.hljs-agate .hljs-deletion,.hljs-agate .hljs-code{color:#888}.hljs-agate .hljs-regexp,.hljs-agate .hljs-link{color:#c6b4f0}.hljs-agate .hljs-meta{color:#fc9b9b}.hljs-agate .hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-agate .hljs-addition{background-color:#a2fca2;color:#333}.hljs-agate .hljs a{color:inherit}.hljs-agate .hljs a:focus,.hljs-agate .hljs a:hover{color:inherit;text-decoration:underline}.hljs-androidstudio .hljs{color:#a9b7c6;background:#282b2e;display:block;overflow-x:auto;padding:.5em}.hljs-androidstudio .hljs-number,.hljs-androidstudio .hljs-literal,.hljs-androidstudio .hljs-symbol,.hljs-androidstudio .hljs-bullet{color:#6897BB}.hljs-androidstudio .hljs-keyword,.hljs-androidstudio .hljs-selector-tag,.hljs-androidstudio .hljs-deletion{color:#cc7832}.hljs-androidstudio .hljs-variable,.hljs-androidstudio .hljs-template-variable,.hljs-androidstudio .hljs-link{color:#629755}.hljs-androidstudio .hljs-comment,.hljs-androidstudio .hljs-quote{color:#808080}.hljs-androidstudio .hljs-meta{color:#bbb529}.hljs-androidstudio .hljs-string,.hljs-androidstudio .hljs-attribute,.hljs-androidstudio .hljs-addition{color:#6A8759}.hljs-androidstudio .hljs-section,.hljs-androidstudio .hljs-title,.hljs-androidstudio .hljs-type{color:#ffc66d}.hljs-androidstudio .hljs-name,.hljs-androidstudio .hljs-selector-id,.hljs-androidstudio .hljs-selector-class{color:#e8bf6a}.hljs-androidstudio .hljs-emphasis{font-style:italic}.hljs-androidstudio .hljs-strong{font-weight:bold}.hljs-arduino-light .hljs{display:block;overflow-x:auto;padding:.5em;background:#FFFFFF}.hljs-arduino-light .hljs,.hljs-arduino-light .hljs-subst{color:#434f54}.hljs-arduino-light .hljs-keyword,.hljs-arduino-light .hljs-attribute,.hljs-arduino-light .hljs-selector-tag,.hljs-arduino-light .hljs-doctag,.hljs-arduino-light .hljs-name{color:#00979D}.hljs-arduino-light .hljs-built_in,.hljs-arduino-light .hljs-literal,.hljs-arduino-light .hljs-bullet,.hljs-arduino-light .hljs-code,.hljs-arduino-light .hljs-addition{color:#D35400}.hljs-arduino-light .hljs-regexp,.hljs-arduino-light .hljs-symbol,.hljs-arduino-light .hljs-variable,.hljs-arduino-light .hljs-template-variable,.hljs-arduino-light .hljs-link,.hljs-arduino-light .hljs-selector-attr,.hljs-arduino-light .hljs-selector-pseudo{color:#00979D}.hljs-arduino-light .hljs-type,.hljs-arduino-light .hljs-string,.hljs-arduino-light .hljs-selector-id,.hljs-arduino-light .hljs-selector-class,.hljs-arduino-light .hljs-quote,.hljs-arduino-light .hljs-template-tag,.hljs-arduino-light .hljs-deletion{color:#005C5F}.hljs-arduino-light .hljs-title,.hljs-arduino-light .hljs-section{color:#880000;font-weight:bold}.hljs-arduino-light .hljs-comment{color:rgba(149,165,166,0.8)}.hljs-arduino-light .hljs-meta-keyword{color:#728E00}.hljs-arduino-light .hljs-meta{color:#728E00;color:#434f54}.hljs-arduino-light .hljs-emphasis{font-style:italic}.hljs-arduino-light .hljs-strong{font-weight:bold}.hljs-arduino-light .hljs-function{color:#728E00}.hljs-arduino-light .hljs-number{color:#8A7B52}.hljs-arta .hljs{display:block;overflow-x:auto;padding:.5em;background:#222}.hljs-arta .hljs,.hljs-arta .hljs-subst{color:#aaa}.hljs-arta .hljs-section{color:#fff}.hljs-arta .hljs-comment,.hljs-arta .hljs-quote,.hljs-arta .hljs-meta{color:#444}.hljs-arta .hljs-string,.hljs-arta .hljs-symbol,.hljs-arta .hljs-bullet,.hljs-arta .hljs-regexp{color:#ffcc33}.hljs-arta .hljs-number,.hljs-arta .hljs-addition{color:#00cc66}.hljs-arta .hljs-built_in,.hljs-arta .hljs-builtin-name,.hljs-arta .hljs-literal,.hljs-arta .hljs-type,.hljs-arta .hljs-template-variable,.hljs-arta .hljs-attribute,.hljs-arta .hljs-link{color:#32aaee}.hljs-arta .hljs-keyword,.hljs-arta .hljs-selector-tag,.hljs-arta .hljs-name,.hljs-arta .hljs-selector-id,.hljs-arta .hljs-selector-class{color:#6644aa}.hljs-arta .hljs-title,.hljs-arta .hljs-variable,.hljs-arta .hljs-deletion,.hljs-arta .hljs-template-tag{color:#bb1166}.hljs-arta .hljs-section,.hljs-arta .hljs-doctag,.hljs-arta .hljs-strong{font-weight:bold}.hljs-arta .hljs-emphasis{font-style:italic}.hljs-ascetic .hljs{display:block;overflow-x:auto;padding:.5em;background:white;color:black}.hljs-ascetic .hljs-string,.hljs-ascetic .hljs-variable,.hljs-ascetic .hljs-template-variable,.hljs-ascetic .hljs-symbol,.hljs-ascetic .hljs-bullet,.hljs-ascetic .hljs-section,.hljs-ascetic .hljs-addition,.hljs-ascetic .hljs-attribute,.hljs-ascetic .hljs-link{color:#888}.hljs-ascetic .hljs-comment,.hljs-ascetic .hljs-quote,.hljs-ascetic .hljs-meta,.hljs-ascetic .hljs-deletion{color:#ccc}.hljs-ascetic .hljs-keyword,.hljs-ascetic .hljs-selector-tag,.hljs-ascetic .hljs-section,.hljs-ascetic .hljs-name,.hljs-ascetic .hljs-type,.hljs-ascetic .hljs-strong{font-weight:bold}.hljs-ascetic .hljs-emphasis{font-style:italic}.hljs-atelier-cave-dark .hljs-comment,.hljs-atelier-cave-dark .hljs-quote{color:#7e7887}.hljs-atelier-cave-dark .hljs-variable,.hljs-atelier-cave-dark .hljs-template-variable,.hljs-atelier-cave-dark .hljs-attribute,.hljs-atelier-cave-dark .hljs-regexp,.hljs-atelier-cave-dark .hljs-link,.hljs-atelier-cave-dark .hljs-tag,.hljs-atelier-cave-dark .hljs-name,.hljs-atelier-cave-dark .hljs-selector-id,.hljs-atelier-cave-dark .hljs-selector-class{color:#be4678}.hljs-atelier-cave-dark .hljs-number,.hljs-atelier-cave-dark .hljs-meta,.hljs-atelier-cave-dark .hljs-built_in,.hljs-atelier-cave-dark .hljs-builtin-name,.hljs-atelier-cave-dark .hljs-literal,.hljs-atelier-cave-dark .hljs-type,.hljs-atelier-cave-dark .hljs-params{color:#aa573c}.hljs-atelier-cave-dark .hljs-string,.hljs-atelier-cave-dark .hljs-symbol,.hljs-atelier-cave-dark .hljs-bullet{color:#2a9292}.hljs-atelier-cave-dark .hljs-title,.hljs-atelier-cave-dark .hljs-section{color:#576ddb}.hljs-atelier-cave-dark .hljs-keyword,.hljs-atelier-cave-dark .hljs-selector-tag{color:#955ae7}.hljs-atelier-cave-dark .hljs-deletion,.hljs-atelier-cave-dark .hljs-addition{color:#19171c;display:inline-block;width:100%}.hljs-atelier-cave-dark .hljs-deletion{background-color:#be4678}.hljs-atelier-cave-dark .hljs-addition{background-color:#2a9292}.hljs-atelier-cave-dark .hljs{display:block;overflow-x:auto;background:#19171c;color:#8b8792;padding:.5em}.hljs-atelier-cave-dark .hljs-emphasis{font-style:italic}.hljs-atelier-cave-dark .hljs-strong{font-weight:bold}.hljs-atelier-cave-light .hljs-comment,.hljs-atelier-cave-light .hljs-quote{color:#655f6d}.hljs-atelier-cave-light .hljs-variable,.hljs-atelier-cave-light .hljs-template-variable,.hljs-atelier-cave-light .hljs-attribute,.hljs-atelier-cave-light .hljs-tag,.hljs-atelier-cave-light .hljs-name,.hljs-atelier-cave-light .hljs-regexp,.hljs-atelier-cave-light .hljs-link,.hljs-atelier-cave-light .hljs-name,.hljs-atelier-cave-light .hljs-name,.hljs-atelier-cave-light .hljs-selector-id,.hljs-atelier-cave-light .hljs-selector-class{color:#be4678}.hljs-atelier-cave-light .hljs-number,.hljs-atelier-cave-light .hljs-meta,.hljs-atelier-cave-light .hljs-built_in,.hljs-atelier-cave-light .hljs-builtin-name,.hljs-atelier-cave-light .hljs-literal,.hljs-atelier-cave-light .hljs-type,.hljs-atelier-cave-light .hljs-params{color:#aa573c}.hljs-atelier-cave-light .hljs-string,.hljs-atelier-cave-light .hljs-symbol,.hljs-atelier-cave-light .hljs-bullet{color:#2a9292}.hljs-atelier-cave-light .hljs-title,.hljs-atelier-cave-light .hljs-section{color:#576ddb}.hljs-atelier-cave-light .hljs-keyword,.hljs-atelier-cave-light .hljs-selector-tag{color:#955ae7}.hljs-atelier-cave-light .hljs-deletion,.hljs-atelier-cave-light .hljs-addition{color:#19171c;display:inline-block;width:100%}.hljs-atelier-cave-light .hljs-deletion{background-color:#be4678}.hljs-atelier-cave-light .hljs-addition{background-color:#2a9292}.hljs-atelier-cave-light .hljs{display:block;overflow-x:auto;background:#efecf4;color:#585260;padding:.5em}.hljs-atelier-cave-light .hljs-emphasis{font-style:italic}.hljs-atelier-cave-light .hljs-strong{font-weight:bold}.hljs-atelier-dune-dark .hljs-comment,.hljs-atelier-dune-dark .hljs-quote{color:#999580}.hljs-atelier-dune-dark .hljs-variable,.hljs-atelier-dune-dark .hljs-template-variable,.hljs-atelier-dune-dark .hljs-attribute,.hljs-atelier-dune-dark .hljs-tag,.hljs-atelier-dune-dark .hljs-name,.hljs-atelier-dune-dark .hljs-regexp,.hljs-atelier-dune-dark .hljs-link,.hljs-atelier-dune-dark .hljs-name,.hljs-atelier-dune-dark .hljs-selector-id,.hljs-atelier-dune-dark .hljs-selector-class{color:#d73737}.hljs-atelier-dune-dark .hljs-number,.hljs-atelier-dune-dark .hljs-meta,.hljs-atelier-dune-dark .hljs-built_in,.hljs-atelier-dune-dark .hljs-builtin-name,.hljs-atelier-dune-dark .hljs-literal,.hljs-atelier-dune-dark .hljs-type,.hljs-atelier-dune-dark .hljs-params{color:#b65611}.hljs-atelier-dune-dark .hljs-string,.hljs-atelier-dune-dark .hljs-symbol,.hljs-atelier-dune-dark .hljs-bullet{color:#60ac39}.hljs-atelier-dune-dark .hljs-title,.hljs-atelier-dune-dark .hljs-section{color:#6684e1}.hljs-atelier-dune-dark .hljs-keyword,.hljs-atelier-dune-dark .hljs-selector-tag{color:#b854d4}.hljs-atelier-dune-dark .hljs{display:block;overflow-x:auto;background:#20201d;color:#a6a28c;padding:.5em}.hljs-atelier-dune-dark .hljs-emphasis{font-style:italic}.hljs-atelier-dune-dark .hljs-strong{font-weight:bold}.hljs-atelier-dune-light .hljs-comment,.hljs-atelier-dune-light .hljs-quote{color:#7d7a68}.hljs-atelier-dune-light .hljs-variable,.hljs-atelier-dune-light .hljs-template-variable,.hljs-atelier-dune-light .hljs-attribute,.hljs-atelier-dune-light .hljs-tag,.hljs-atelier-dune-light .hljs-name,.hljs-atelier-dune-light .hljs-regexp,.hljs-atelier-dune-light .hljs-link,.hljs-atelier-dune-light .hljs-name,.hljs-atelier-dune-light .hljs-selector-id,.hljs-atelier-dune-light .hljs-selector-class{color:#d73737}.hljs-atelier-dune-light .hljs-number,.hljs-atelier-dune-light .hljs-meta,.hljs-atelier-dune-light .hljs-built_in,.hljs-atelier-dune-light .hljs-builtin-name,.hljs-atelier-dune-light .hljs-literal,.hljs-atelier-dune-light .hljs-type,.hljs-atelier-dune-light .hljs-params{color:#b65611}.hljs-atelier-dune-light .hljs-string,.hljs-atelier-dune-light .hljs-symbol,.hljs-atelier-dune-light .hljs-bullet{color:#60ac39}.hljs-atelier-dune-light .hljs-title,.hljs-atelier-dune-light .hljs-section{color:#6684e1}.hljs-atelier-dune-light .hljs-keyword,.hljs-atelier-dune-light .hljs-selector-tag{color:#b854d4}.hljs-atelier-dune-light .hljs{display:block;overflow-x:auto;background:#fefbec;color:#6e6b5e;padding:.5em}.hljs-atelier-dune-light .hljs-emphasis{font-style:italic}.hljs-atelier-dune-light .hljs-strong{font-weight:bold}.hljs-atelier-estuary-dark .hljs-comment,.hljs-atelier-estuary-dark .hljs-quote{color:#878573}.hljs-atelier-estuary-dark .hljs-variable,.hljs-atelier-estuary-dark .hljs-template-variable,.hljs-atelier-estuary-dark .hljs-attribute,.hljs-atelier-estuary-dark .hljs-tag,.hljs-atelier-estuary-dark .hljs-name,.hljs-atelier-estuary-dark .hljs-regexp,.hljs-atelier-estuary-dark .hljs-link,.hljs-atelier-estuary-dark .hljs-name,.hljs-atelier-estuary-dark .hljs-selector-id,.hljs-atelier-estuary-dark .hljs-selector-class{color:#ba6236}.hljs-atelier-estuary-dark .hljs-number,.hljs-atelier-estuary-dark .hljs-meta,.hljs-atelier-estuary-dark .hljs-built_in,.hljs-atelier-estuary-dark .hljs-builtin-name,.hljs-atelier-estuary-dark .hljs-literal,.hljs-atelier-estuary-dark .hljs-type,.hljs-atelier-estuary-dark .hljs-params{color:#ae7313}.hljs-atelier-estuary-dark .hljs-string,.hljs-atelier-estuary-dark .hljs-symbol,.hljs-atelier-estuary-dark .hljs-bullet{color:#7d9726}.hljs-atelier-estuary-dark .hljs-title,.hljs-atelier-estuary-dark .hljs-section{color:#36a166}.hljs-atelier-estuary-dark .hljs-keyword,.hljs-atelier-estuary-dark .hljs-selector-tag{color:#5f9182}.hljs-atelier-estuary-dark .hljs-deletion,.hljs-atelier-estuary-dark .hljs-addition{color:#22221b;display:inline-block;width:100%}.hljs-atelier-estuary-dark .hljs-deletion{background-color:#ba6236}.hljs-atelier-estuary-dark .hljs-addition{background-color:#7d9726}.hljs-atelier-estuary-dark .hljs{display:block;overflow-x:auto;background:#22221b;color:#929181;padding:.5em}.hljs-atelier-estuary-dark .hljs-emphasis{font-style:italic}.hljs-atelier-estuary-dark .hljs-strong{font-weight:bold}.hljs-atelier-estuary-light .hljs-comment,.hljs-atelier-estuary-light .hljs-quote{color:#6c6b5a}.hljs-atelier-estuary-light .hljs-variable,.hljs-atelier-estuary-light .hljs-template-variable,.hljs-atelier-estuary-light .hljs-attribute,.hljs-atelier-estuary-light .hljs-tag,.hljs-atelier-estuary-light .hljs-name,.hljs-atelier-estuary-light .hljs-regexp,.hljs-atelier-estuary-light .hljs-link,.hljs-atelier-estuary-light .hljs-name,.hljs-atelier-estuary-light .hljs-selector-id,.hljs-atelier-estuary-light .hljs-selector-class{color:#ba6236}.hljs-atelier-estuary-light .hljs-number,.hljs-atelier-estuary-light .hljs-meta,.hljs-atelier-estuary-light .hljs-built_in,.hljs-atelier-estuary-light .hljs-builtin-name,.hljs-atelier-estuary-light .hljs-literal,.hljs-atelier-estuary-light .hljs-type,.hljs-atelier-estuary-light .hljs-params{color:#ae7313}.hljs-atelier-estuary-light .hljs-string,.hljs-atelier-estuary-light .hljs-symbol,.hljs-atelier-estuary-light .hljs-bullet{color:#7d9726}.hljs-atelier-estuary-light .hljs-title,.hljs-atelier-estuary-light .hljs-section{color:#36a166}.hljs-atelier-estuary-light .hljs-keyword,.hljs-atelier-estuary-light .hljs-selector-tag{color:#5f9182}.hljs-atelier-estuary-light .hljs-deletion,.hljs-atelier-estuary-light .hljs-addition{color:#22221b;display:inline-block;width:100%}.hljs-atelier-estuary-light .hljs-deletion{background-color:#ba6236}.hljs-atelier-estuary-light .hljs-addition{background-color:#7d9726}.hljs-atelier-estuary-light .hljs{display:block;overflow-x:auto;background:#f4f3ec;color:#5f5e4e;padding:.5em}.hljs-atelier-estuary-light .hljs-emphasis{font-style:italic}.hljs-atelier-estuary-light .hljs-strong{font-weight:bold}.hljs-atelier-forest-dark .hljs-comment,.hljs-atelier-forest-dark .hljs-quote{color:#9c9491}.hljs-atelier-forest-dark .hljs-variable,.hljs-atelier-forest-dark .hljs-template-variable,.hljs-atelier-forest-dark .hljs-attribute,.hljs-atelier-forest-dark .hljs-tag,.hljs-atelier-forest-dark .hljs-name,.hljs-atelier-forest-dark .hljs-regexp,.hljs-atelier-forest-dark .hljs-link,.hljs-atelier-forest-dark .hljs-name,.hljs-atelier-forest-dark .hljs-selector-id,.hljs-atelier-forest-dark .hljs-selector-class{color:#f22c40}.hljs-atelier-forest-dark .hljs-number,.hljs-atelier-forest-dark .hljs-meta,.hljs-atelier-forest-dark .hljs-built_in,.hljs-atelier-forest-dark .hljs-builtin-name,.hljs-atelier-forest-dark .hljs-literal,.hljs-atelier-forest-dark .hljs-type,.hljs-atelier-forest-dark .hljs-params{color:#df5320}.hljs-atelier-forest-dark .hljs-string,.hljs-atelier-forest-dark .hljs-symbol,.hljs-atelier-forest-dark .hljs-bullet{color:#7b9726}.hljs-atelier-forest-dark .hljs-title,.hljs-atelier-forest-dark .hljs-section{color:#407ee7}.hljs-atelier-forest-dark .hljs-keyword,.hljs-atelier-forest-dark .hljs-selector-tag{color:#6666ea}.hljs-atelier-forest-dark .hljs{display:block;overflow-x:auto;background:#1b1918;color:#a8a19f;padding:.5em}.hljs-atelier-forest-dark .hljs-emphasis{font-style:italic}.hljs-atelier-forest-dark .hljs-strong{font-weight:bold}.hljs-atelier-forest-light .hljs-comment,.hljs-atelier-forest-light .hljs-quote{color:#766e6b}.hljs-atelier-forest-light .hljs-variable,.hljs-atelier-forest-light .hljs-template-variable,.hljs-atelier-forest-light .hljs-attribute,.hljs-atelier-forest-light .hljs-tag,.hljs-atelier-forest-light .hljs-name,.hljs-atelier-forest-light .hljs-regexp,.hljs-atelier-forest-light .hljs-link,.hljs-atelier-forest-light .hljs-name,.hljs-atelier-forest-light .hljs-selector-id,.hljs-atelier-forest-light .hljs-selector-class{color:#f22c40}.hljs-atelier-forest-light .hljs-number,.hljs-atelier-forest-light .hljs-meta,.hljs-atelier-forest-light .hljs-built_in,.hljs-atelier-forest-light .hljs-builtin-name,.hljs-atelier-forest-light .hljs-literal,.hljs-atelier-forest-light .hljs-type,.hljs-atelier-forest-light .hljs-params{color:#df5320}.hljs-atelier-forest-light .hljs-string,.hljs-atelier-forest-light .hljs-symbol,.hljs-atelier-forest-light .hljs-bullet{color:#7b9726}.hljs-atelier-forest-light .hljs-title,.hljs-atelier-forest-light .hljs-section{color:#407ee7}.hljs-atelier-forest-light .hljs-keyword,.hljs-atelier-forest-light .hljs-selector-tag{color:#6666ea}.hljs-atelier-forest-light .hljs{display:block;overflow-x:auto;background:#f1efee;color:#68615e;padding:.5em}.hljs-atelier-forest-light .hljs-emphasis{font-style:italic}.hljs-atelier-forest-light .hljs-strong{font-weight:bold}.hljs-atelier-heath-dark .hljs-comment,.hljs-atelier-heath-dark .hljs-quote{color:#9e8f9e}.hljs-atelier-heath-dark .hljs-variable,.hljs-atelier-heath-dark .hljs-template-variable,.hljs-atelier-heath-dark .hljs-attribute,.hljs-atelier-heath-dark .hljs-tag,.hljs-atelier-heath-dark .hljs-name,.hljs-atelier-heath-dark .hljs-regexp,.hljs-atelier-heath-dark .hljs-link,.hljs-atelier-heath-dark .hljs-name,.hljs-atelier-heath-dark .hljs-selector-id,.hljs-atelier-heath-dark .hljs-selector-class{color:#ca402b}.hljs-atelier-heath-dark .hljs-number,.hljs-atelier-heath-dark .hljs-meta,.hljs-atelier-heath-dark .hljs-built_in,.hljs-atelier-heath-dark .hljs-builtin-name,.hljs-atelier-heath-dark .hljs-literal,.hljs-atelier-heath-dark .hljs-type,.hljs-atelier-heath-dark .hljs-params{color:#a65926}.hljs-atelier-heath-dark .hljs-string,.hljs-atelier-heath-dark .hljs-symbol,.hljs-atelier-heath-dark .hljs-bullet{color:#918b3b}.hljs-atelier-heath-dark .hljs-title,.hljs-atelier-heath-dark .hljs-section{color:#516aec}.hljs-atelier-heath-dark .hljs-keyword,.hljs-atelier-heath-dark .hljs-selector-tag{color:#7b59c0}.hljs-atelier-heath-dark .hljs{display:block;overflow-x:auto;background:#1b181b;color:#ab9bab;padding:.5em}.hljs-atelier-heath-dark .hljs-emphasis{font-style:italic}.hljs-atelier-heath-dark .hljs-strong{font-weight:bold}.hljs-atelier-heath-light .hljs-comment,.hljs-atelier-heath-light .hljs-quote{color:#776977}.hljs-atelier-heath-light .hljs-variable,.hljs-atelier-heath-light .hljs-template-variable,.hljs-atelier-heath-light .hljs-attribute,.hljs-atelier-heath-light .hljs-tag,.hljs-atelier-heath-light .hljs-name,.hljs-atelier-heath-light .hljs-regexp,.hljs-atelier-heath-light .hljs-link,.hljs-atelier-heath-light .hljs-name,.hljs-atelier-heath-light .hljs-selector-id,.hljs-atelier-heath-light .hljs-selector-class{color:#ca402b}.hljs-atelier-heath-light .hljs-number,.hljs-atelier-heath-light .hljs-meta,.hljs-atelier-heath-light .hljs-built_in,.hljs-atelier-heath-light .hljs-builtin-name,.hljs-atelier-heath-light .hljs-literal,.hljs-atelier-heath-light .hljs-type,.hljs-atelier-heath-light .hljs-params{color:#a65926}.hljs-atelier-heath-light .hljs-string,.hljs-atelier-heath-light .hljs-symbol,.hljs-atelier-heath-light .hljs-bullet{color:#918b3b}.hljs-atelier-heath-light .hljs-title,.hljs-atelier-heath-light .hljs-section{color:#516aec}.hljs-atelier-heath-light .hljs-keyword,.hljs-atelier-heath-light .hljs-selector-tag{color:#7b59c0}.hljs-atelier-heath-light .hljs{display:block;overflow-x:auto;background:#f7f3f7;color:#695d69;padding:.5em}.hljs-atelier-heath-light .hljs-emphasis{font-style:italic}.hljs-atelier-heath-light .hljs-strong{font-weight:bold}.hljs-atelier-lakeside-dark .hljs-comment,.hljs-atelier-lakeside-dark .hljs-quote{color:#7195a8}.hljs-atelier-lakeside-dark .hljs-variable,.hljs-atelier-lakeside-dark .hljs-template-variable,.hljs-atelier-lakeside-dark .hljs-attribute,.hljs-atelier-lakeside-dark .hljs-tag,.hljs-atelier-lakeside-dark .hljs-name,.hljs-atelier-lakeside-dark .hljs-regexp,.hljs-atelier-lakeside-dark .hljs-link,.hljs-atelier-lakeside-dark .hljs-name,.hljs-atelier-lakeside-dark .hljs-selector-id,.hljs-atelier-lakeside-dark .hljs-selector-class{color:#d22d72}.hljs-atelier-lakeside-dark .hljs-number,.hljs-atelier-lakeside-dark .hljs-meta,.hljs-atelier-lakeside-dark .hljs-built_in,.hljs-atelier-lakeside-dark .hljs-builtin-name,.hljs-atelier-lakeside-dark .hljs-literal,.hljs-atelier-lakeside-dark .hljs-type,.hljs-atelier-lakeside-dark .hljs-params{color:#935c25}.hljs-atelier-lakeside-dark .hljs-string,.hljs-atelier-lakeside-dark .hljs-symbol,.hljs-atelier-lakeside-dark .hljs-bullet{color:#568c3b}.hljs-atelier-lakeside-dark .hljs-title,.hljs-atelier-lakeside-dark .hljs-section{color:#257fad}.hljs-atelier-lakeside-dark .hljs-keyword,.hljs-atelier-lakeside-dark .hljs-selector-tag{color:#6b6bb8}.hljs-atelier-lakeside-dark .hljs{display:block;overflow-x:auto;background:#161b1d;color:#7ea2b4;padding:.5em}.hljs-atelier-lakeside-dark .hljs-emphasis{font-style:italic}.hljs-atelier-lakeside-dark .hljs-strong{font-weight:bold}.hljs-atelier-lakeside-light .hljs-comment,.hljs-atelier-lakeside-light .hljs-quote{color:#5a7b8c}.hljs-atelier-lakeside-light .hljs-variable,.hljs-atelier-lakeside-light .hljs-template-variable,.hljs-atelier-lakeside-light .hljs-attribute,.hljs-atelier-lakeside-light .hljs-tag,.hljs-atelier-lakeside-light .hljs-name,.hljs-atelier-lakeside-light .hljs-regexp,.hljs-atelier-lakeside-light .hljs-link,.hljs-atelier-lakeside-light .hljs-name,.hljs-atelier-lakeside-light .hljs-selector-id,.hljs-atelier-lakeside-light .hljs-selector-class{color:#d22d72}.hljs-atelier-lakeside-light .hljs-number,.hljs-atelier-lakeside-light .hljs-meta,.hljs-atelier-lakeside-light .hljs-built_in,.hljs-atelier-lakeside-light .hljs-builtin-name,.hljs-atelier-lakeside-light .hljs-literal,.hljs-atelier-lakeside-light .hljs-type,.hljs-atelier-lakeside-light .hljs-params{color:#935c25}.hljs-atelier-lakeside-light .hljs-string,.hljs-atelier-lakeside-light .hljs-symbol,.hljs-atelier-lakeside-light .hljs-bullet{color:#568c3b}.hljs-atelier-lakeside-light .hljs-title,.hljs-atelier-lakeside-light .hljs-section{color:#257fad}.hljs-atelier-lakeside-light .hljs-keyword,.hljs-atelier-lakeside-light .hljs-selector-tag{color:#6b6bb8}.hljs-atelier-lakeside-light .hljs{display:block;overflow-x:auto;background:#ebf8ff;color:#516d7b;padding:.5em}.hljs-atelier-lakeside-light .hljs-emphasis{font-style:italic}.hljs-atelier-lakeside-light .hljs-strong{font-weight:bold}.hljs-atelier-plateau-dark .hljs-comment,.hljs-atelier-plateau-dark .hljs-quote{color:#7e7777}.hljs-atelier-plateau-dark .hljs-variable,.hljs-atelier-plateau-dark .hljs-template-variable,.hljs-atelier-plateau-dark .hljs-attribute,.hljs-atelier-plateau-dark .hljs-tag,.hljs-atelier-plateau-dark .hljs-name,.hljs-atelier-plateau-dark .hljs-regexp,.hljs-atelier-plateau-dark .hljs-link,.hljs-atelier-plateau-dark .hljs-name,.hljs-atelier-plateau-dark .hljs-selector-id,.hljs-atelier-plateau-dark .hljs-selector-class{color:#ca4949}.hljs-atelier-plateau-dark .hljs-number,.hljs-atelier-plateau-dark .hljs-meta,.hljs-atelier-plateau-dark .hljs-built_in,.hljs-atelier-plateau-dark .hljs-builtin-name,.hljs-atelier-plateau-dark .hljs-literal,.hljs-atelier-plateau-dark .hljs-type,.hljs-atelier-plateau-dark .hljs-params{color:#b45a3c}.hljs-atelier-plateau-dark .hljs-string,.hljs-atelier-plateau-dark .hljs-symbol,.hljs-atelier-plateau-dark .hljs-bullet{color:#4b8b8b}.hljs-atelier-plateau-dark .hljs-title,.hljs-atelier-plateau-dark .hljs-section{color:#7272ca}.hljs-atelier-plateau-dark .hljs-keyword,.hljs-atelier-plateau-dark .hljs-selector-tag{color:#8464c4}.hljs-atelier-plateau-dark .hljs-deletion,.hljs-atelier-plateau-dark .hljs-addition{color:#1b1818;display:inline-block;width:100%}.hljs-atelier-plateau-dark .hljs-deletion{background-color:#ca4949}.hljs-atelier-plateau-dark .hljs-addition{background-color:#4b8b8b}.hljs-atelier-plateau-dark .hljs{display:block;overflow-x:auto;background:#1b1818;color:#8a8585;padding:.5em}.hljs-atelier-plateau-dark .hljs-emphasis{font-style:italic}.hljs-atelier-plateau-dark .hljs-strong{font-weight:bold}.hljs-atelier-plateau-light .hljs-comment,.hljs-atelier-plateau-light .hljs-quote{color:#655d5d}.hljs-atelier-plateau-light .hljs-variable,.hljs-atelier-plateau-light .hljs-template-variable,.hljs-atelier-plateau-light .hljs-attribute,.hljs-atelier-plateau-light .hljs-tag,.hljs-atelier-plateau-light .hljs-name,.hljs-atelier-plateau-light .hljs-regexp,.hljs-atelier-plateau-light .hljs-link,.hljs-atelier-plateau-light .hljs-name,.hljs-atelier-plateau-light .hljs-selector-id,.hljs-atelier-plateau-light .hljs-selector-class{color:#ca4949}.hljs-atelier-plateau-light .hljs-number,.hljs-atelier-plateau-light .hljs-meta,.hljs-atelier-plateau-light .hljs-built_in,.hljs-atelier-plateau-light .hljs-builtin-name,.hljs-atelier-plateau-light .hljs-literal,.hljs-atelier-plateau-light .hljs-type,.hljs-atelier-plateau-light .hljs-params{color:#b45a3c}.hljs-atelier-plateau-light .hljs-string,.hljs-atelier-plateau-light .hljs-symbol,.hljs-atelier-plateau-light .hljs-bullet{color:#4b8b8b}.hljs-atelier-plateau-light .hljs-title,.hljs-atelier-plateau-light .hljs-section{color:#7272ca}.hljs-atelier-plateau-light .hljs-keyword,.hljs-atelier-plateau-light .hljs-selector-tag{color:#8464c4}.hljs-atelier-plateau-light .hljs-deletion,.hljs-atelier-plateau-light .hljs-addition{color:#1b1818;display:inline-block;width:100%}.hljs-atelier-plateau-light .hljs-deletion{background-color:#ca4949}.hljs-atelier-plateau-light .hljs-addition{background-color:#4b8b8b}.hljs-atelier-plateau-light .hljs{display:block;overflow-x:auto;background:#f4ecec;color:#585050;padding:.5em}.hljs-atelier-plateau-light .hljs-emphasis{font-style:italic}.hljs-atelier-plateau-light .hljs-strong{font-weight:bold}.hljs-atelier-savanna-dark .hljs-comment,.hljs-atelier-savanna-dark .hljs-quote{color:#78877d}.hljs-atelier-savanna-dark .hljs-variable,.hljs-atelier-savanna-dark .hljs-template-variable,.hljs-atelier-savanna-dark .hljs-attribute,.hljs-atelier-savanna-dark .hljs-tag,.hljs-atelier-savanna-dark .hljs-name,.hljs-atelier-savanna-dark .hljs-regexp,.hljs-atelier-savanna-dark .hljs-link,.hljs-atelier-savanna-dark .hljs-name,.hljs-atelier-savanna-dark .hljs-selector-id,.hljs-atelier-savanna-dark .hljs-selector-class{color:#b16139}.hljs-atelier-savanna-dark .hljs-number,.hljs-atelier-savanna-dark .hljs-meta,.hljs-atelier-savanna-dark .hljs-built_in,.hljs-atelier-savanna-dark .hljs-builtin-name,.hljs-atelier-savanna-dark .hljs-literal,.hljs-atelier-savanna-dark .hljs-type,.hljs-atelier-savanna-dark .hljs-params{color:#9f713c}.hljs-atelier-savanna-dark .hljs-string,.hljs-atelier-savanna-dark .hljs-symbol,.hljs-atelier-savanna-dark .hljs-bullet{color:#489963}.hljs-atelier-savanna-dark .hljs-title,.hljs-atelier-savanna-dark .hljs-section{color:#478c90}.hljs-atelier-savanna-dark .hljs-keyword,.hljs-atelier-savanna-dark .hljs-selector-tag{color:#55859b}.hljs-atelier-savanna-dark .hljs-deletion,.hljs-atelier-savanna-dark .hljs-addition{color:#171c19;display:inline-block;width:100%}.hljs-atelier-savanna-dark .hljs-deletion{background-color:#b16139}.hljs-atelier-savanna-dark .hljs-addition{background-color:#489963}.hljs-atelier-savanna-dark .hljs{display:block;overflow-x:auto;background:#171c19;color:#87928a;padding:.5em}.hljs-atelier-savanna-dark .hljs-emphasis{font-style:italic}.hljs-atelier-savanna-dark .hljs-strong{font-weight:bold}.hljs-atelier-savanna-light .hljs-comment,.hljs-atelier-savanna-light .hljs-quote{color:#5f6d64}.hljs-atelier-savanna-light .hljs-variable,.hljs-atelier-savanna-light .hljs-template-variable,.hljs-atelier-savanna-light .hljs-attribute,.hljs-atelier-savanna-light .hljs-tag,.hljs-atelier-savanna-light .hljs-name,.hljs-atelier-savanna-light .hljs-regexp,.hljs-atelier-savanna-light .hljs-link,.hljs-atelier-savanna-light .hljs-name,.hljs-atelier-savanna-light .hljs-selector-id,.hljs-atelier-savanna-light .hljs-selector-class{color:#b16139}.hljs-atelier-savanna-light .hljs-number,.hljs-atelier-savanna-light .hljs-meta,.hljs-atelier-savanna-light .hljs-built_in,.hljs-atelier-savanna-light .hljs-builtin-name,.hljs-atelier-savanna-light .hljs-literal,.hljs-atelier-savanna-light .hljs-type,.hljs-atelier-savanna-light .hljs-params{color:#9f713c}.hljs-atelier-savanna-light .hljs-string,.hljs-atelier-savanna-light .hljs-symbol,.hljs-atelier-savanna-light .hljs-bullet{color:#489963}.hljs-atelier-savanna-light .hljs-title,.hljs-atelier-savanna-light .hljs-section{color:#478c90}.hljs-atelier-savanna-light .hljs-keyword,.hljs-atelier-savanna-light .hljs-selector-tag{color:#55859b}.hljs-atelier-savanna-light .hljs-deletion,.hljs-atelier-savanna-light .hljs-addition{color:#171c19;display:inline-block;width:100%}.hljs-atelier-savanna-light .hljs-deletion{background-color:#b16139}.hljs-atelier-savanna-light .hljs-addition{background-color:#489963}.hljs-atelier-savanna-light .hljs{display:block;overflow-x:auto;background:#ecf4ee;color:#526057;padding:.5em}.hljs-atelier-savanna-light .hljs-emphasis{font-style:italic}.hljs-atelier-savanna-light .hljs-strong{font-weight:bold}.hljs-atelier-seaside-dark .hljs-comment,.hljs-atelier-seaside-dark .hljs-quote{color:#809980}.hljs-atelier-seaside-dark .hljs-variable,.hljs-atelier-seaside-dark .hljs-template-variable,.hljs-atelier-seaside-dark .hljs-attribute,.hljs-atelier-seaside-dark .hljs-tag,.hljs-atelier-seaside-dark .hljs-name,.hljs-atelier-seaside-dark .hljs-regexp,.hljs-atelier-seaside-dark .hljs-link,.hljs-atelier-seaside-dark .hljs-name,.hljs-atelier-seaside-dark .hljs-selector-id,.hljs-atelier-seaside-dark .hljs-selector-class{color:#e6193c}.hljs-atelier-seaside-dark .hljs-number,.hljs-atelier-seaside-dark .hljs-meta,.hljs-atelier-seaside-dark .hljs-built_in,.hljs-atelier-seaside-dark .hljs-builtin-name,.hljs-atelier-seaside-dark .hljs-literal,.hljs-atelier-seaside-dark .hljs-type,.hljs-atelier-seaside-dark .hljs-params{color:#87711d}.hljs-atelier-seaside-dark .hljs-string,.hljs-atelier-seaside-dark .hljs-symbol,.hljs-atelier-seaside-dark .hljs-bullet{color:#29a329}.hljs-atelier-seaside-dark .hljs-title,.hljs-atelier-seaside-dark .hljs-section{color:#3d62f5}.hljs-atelier-seaside-dark .hljs-keyword,.hljs-atelier-seaside-dark .hljs-selector-tag{color:#ad2bee}.hljs-atelier-seaside-dark .hljs{display:block;overflow-x:auto;background:#131513;color:#8ca68c;padding:.5em}.hljs-atelier-seaside-dark .hljs-emphasis{font-style:italic}.hljs-atelier-seaside-dark .hljs-strong{font-weight:bold}.hljs-atelier-seaside-light .hljs-comment,.hljs-atelier-seaside-light .hljs-quote{color:#687d68}.hljs-atelier-seaside-light .hljs-variable,.hljs-atelier-seaside-light .hljs-template-variable,.hljs-atelier-seaside-light .hljs-attribute,.hljs-atelier-seaside-light .hljs-tag,.hljs-atelier-seaside-light .hljs-name,.hljs-atelier-seaside-light .hljs-regexp,.hljs-atelier-seaside-light .hljs-link,.hljs-atelier-seaside-light .hljs-name,.hljs-atelier-seaside-light .hljs-selector-id,.hljs-atelier-seaside-light .hljs-selector-class{color:#e6193c}.hljs-atelier-seaside-light .hljs-number,.hljs-atelier-seaside-light .hljs-meta,.hljs-atelier-seaside-light .hljs-built_in,.hljs-atelier-seaside-light .hljs-builtin-name,.hljs-atelier-seaside-light .hljs-literal,.hljs-atelier-seaside-light .hljs-type,.hljs-atelier-seaside-light .hljs-params{color:#87711d}.hljs-atelier-seaside-light .hljs-string,.hljs-atelier-seaside-light .hljs-symbol,.hljs-atelier-seaside-light .hljs-bullet{color:#29a329}.hljs-atelier-seaside-light .hljs-title,.hljs-atelier-seaside-light .hljs-section{color:#3d62f5}.hljs-atelier-seaside-light .hljs-keyword,.hljs-atelier-seaside-light .hljs-selector-tag{color:#ad2bee}.hljs-atelier-seaside-light .hljs{display:block;overflow-x:auto;background:#f4fbf4;color:#5e6e5e;padding:.5em}.hljs-atelier-seaside-light .hljs-emphasis{font-style:italic}.hljs-atelier-seaside-light .hljs-strong{font-weight:bold}.hljs-atelier-sulphurpool-dark .hljs-comment,.hljs-atelier-sulphurpool-dark .hljs-quote{color:#898ea4}.hljs-atelier-sulphurpool-dark .hljs-variable,.hljs-atelier-sulphurpool-dark .hljs-template-variable,.hljs-atelier-sulphurpool-dark .hljs-attribute,.hljs-atelier-sulphurpool-dark .hljs-tag,.hljs-atelier-sulphurpool-dark .hljs-name,.hljs-atelier-sulphurpool-dark .hljs-regexp,.hljs-atelier-sulphurpool-dark .hljs-link,.hljs-atelier-sulphurpool-dark .hljs-name,.hljs-atelier-sulphurpool-dark .hljs-selector-id,.hljs-atelier-sulphurpool-dark .hljs-selector-class{color:#c94922}.hljs-atelier-sulphurpool-dark .hljs-number,.hljs-atelier-sulphurpool-dark .hljs-meta,.hljs-atelier-sulphurpool-dark .hljs-built_in,.hljs-atelier-sulphurpool-dark .hljs-builtin-name,.hljs-atelier-sulphurpool-dark .hljs-literal,.hljs-atelier-sulphurpool-dark .hljs-type,.hljs-atelier-sulphurpool-dark .hljs-params{color:#c76b29}.hljs-atelier-sulphurpool-dark .hljs-string,.hljs-atelier-sulphurpool-dark .hljs-symbol,.hljs-atelier-sulphurpool-dark .hljs-bullet{color:#ac9739}.hljs-atelier-sulphurpool-dark .hljs-title,.hljs-atelier-sulphurpool-dark .hljs-section{color:#3d8fd1}.hljs-atelier-sulphurpool-dark .hljs-keyword,.hljs-atelier-sulphurpool-dark .hljs-selector-tag{color:#6679cc}.hljs-atelier-sulphurpool-dark .hljs{display:block;overflow-x:auto;background:#202746;color:#979db4;padding:.5em}.hljs-atelier-sulphurpool-dark .hljs-emphasis{font-style:italic}.hljs-atelier-sulphurpool-dark .hljs-strong{font-weight:bold}.hljs-atelier-sulphurpool-light .hljs-comment,.hljs-atelier-sulphurpool-light .hljs-quote{color:#6b7394}.hljs-atelier-sulphurpool-light .hljs-variable,.hljs-atelier-sulphurpool-light .hljs-template-variable,.hljs-atelier-sulphurpool-light .hljs-attribute,.hljs-atelier-sulphurpool-light .hljs-tag,.hljs-atelier-sulphurpool-light .hljs-name,.hljs-atelier-sulphurpool-light .hljs-regexp,.hljs-atelier-sulphurpool-light .hljs-link,.hljs-atelier-sulphurpool-light .hljs-name,.hljs-atelier-sulphurpool-light .hljs-selector-id,.hljs-atelier-sulphurpool-light .hljs-selector-class{color:#c94922}.hljs-atelier-sulphurpool-light .hljs-number,.hljs-atelier-sulphurpool-light .hljs-meta,.hljs-atelier-sulphurpool-light .hljs-built_in,.hljs-atelier-sulphurpool-light .hljs-builtin-name,.hljs-atelier-sulphurpool-light .hljs-literal,.hljs-atelier-sulphurpool-light .hljs-type,.hljs-atelier-sulphurpool-light .hljs-params{color:#c76b29}.hljs-atelier-sulphurpool-light .hljs-string,.hljs-atelier-sulphurpool-light .hljs-symbol,.hljs-atelier-sulphurpool-light .hljs-bullet{color:#ac9739}.hljs-atelier-sulphurpool-light .hljs-title,.hljs-atelier-sulphurpool-light .hljs-section{color:#3d8fd1}.hljs-atelier-sulphurpool-light .hljs-keyword,.hljs-atelier-sulphurpool-light .hljs-selector-tag{color:#6679cc}.hljs-atelier-sulphurpool-light .hljs{display:block;overflow-x:auto;background:#f5f7ff;color:#5e6687;padding:.5em}.hljs-atelier-sulphurpool-light .hljs-emphasis{font-style:italic}.hljs-atelier-sulphurpool-light .hljs-strong{font-weight:bold}.hljs-atom-one-dark .hljs{display:block;overflow-x:auto;padding:.5em;color:#abb2bf;background:#282c34}.hljs-atom-one-dark .hljs-comment,.hljs-atom-one-dark .hljs-quote{color:#5c6370;font-style:italic}.hljs-atom-one-dark .hljs-doctag,.hljs-atom-one-dark .hljs-keyword,.hljs-atom-one-dark .hljs-formula{color:#c678dd}.hljs-atom-one-dark .hljs-section,.hljs-atom-one-dark .hljs-name,.hljs-atom-one-dark .hljs-selector-tag,.hljs-atom-one-dark .hljs-deletion,.hljs-atom-one-dark .hljs-subst{color:#e06c75}.hljs-atom-one-dark .hljs-literal{color:#56b6c2}.hljs-atom-one-dark .hljs-string,.hljs-atom-one-dark .hljs-regexp,.hljs-atom-one-dark .hljs-addition,.hljs-atom-one-dark .hljs-attribute,.hljs-atom-one-dark .hljs-meta-string{color:#98c379}.hljs-atom-one-dark .hljs-built_in,.hljs-atom-one-dark .hljs-class .hljs-title{color:#e6c07b}.hljs-atom-one-dark .hljs-variable,.hljs-atom-one-dark .hljs-template-variable,.hljs-atom-one-dark .hljs-type,.hljs-atom-one-dark .hljs-selector-class,.hljs-atom-one-dark .hljs-selector-attr,.hljs-atom-one-dark .hljs-selector-pseudo,.hljs-atom-one-dark .hljs-number{color:#d19a66}.hljs-atom-one-dark .hljs-symbol,.hljs-atom-one-dark .hljs-bullet,.hljs-atom-one-dark .hljs-link,.hljs-atom-one-dark .hljs-meta,.hljs-atom-one-dark .hljs-selector-id,.hljs-atom-one-dark .hljs-title{color:#61aeee}.hljs-atom-one-dark .hljs-emphasis{font-style:italic}.hljs-atom-one-dark .hljs-strong{font-weight:bold}.hljs-atom-one-dark .hljs-link{text-decoration:underline}.hljs-atom-one-light .hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-atom-one-light .hljs-comment,.hljs-atom-one-light .hljs-quote{color:#a0a1a7;font-style:italic}.hljs-atom-one-light .hljs-doctag,.hljs-atom-one-light .hljs-keyword,.hljs-atom-one-light .hljs-formula{color:#a626a4}.hljs-atom-one-light .hljs-section,.hljs-atom-one-light .hljs-name,.hljs-atom-one-light .hljs-selector-tag,.hljs-atom-one-light .hljs-deletion,.hljs-atom-one-light .hljs-subst{color:#e45649}.hljs-atom-one-light .hljs-literal{color:#0184bb}.hljs-atom-one-light .hljs-string,.hljs-atom-one-light .hljs-regexp,.hljs-atom-one-light .hljs-addition,.hljs-atom-one-light .hljs-attribute,.hljs-atom-one-light .hljs-meta-string{color:#50a14f}.hljs-atom-one-light .hljs-built_in,.hljs-atom-one-light .hljs-class .hljs-title{color:#c18401}.hljs-atom-one-light .hljs-variable,.hljs-atom-one-light .hljs-template-variable,.hljs-atom-one-light .hljs-type,.hljs-atom-one-light .hljs-selector-class,.hljs-atom-one-light .hljs-selector-attr,.hljs-atom-one-light .hljs-selector-pseudo,.hljs-atom-one-light .hljs-number{color:#986801}.hljs-atom-one-light .hljs-symbol,.hljs-atom-one-light .hljs-bullet,.hljs-atom-one-light .hljs-link,.hljs-atom-one-light .hljs-meta,.hljs-atom-one-light .hljs-selector-id,.hljs-atom-one-light .hljs-title{color:#4078f2}.hljs-atom-one-light .hljs-emphasis{font-style:italic}.hljs-atom-one-light .hljs-strong{font-weight:bold}.hljs-atom-one-light .hljs-link{text-decoration:underline}.hljs-brown-paper .hljs{display:block;overflow-x:auto;padding:.5em;background:#b7a68e url(brown-papersq.png)}.hljs-brown-paper .hljs-keyword,.hljs-brown-paper .hljs-selector-tag,.hljs-brown-paper .hljs-literal{color:#005599;font-weight:bold}.hljs-brown-paper .hljs,.hljs-brown-paper .hljs-subst{color:#363c69}.hljs-brown-paper .hljs-string,.hljs-brown-paper .hljs-title,.hljs-brown-paper .hljs-section,.hljs-brown-paper .hljs-type,.hljs-brown-paper .hljs-attribute,.hljs-brown-paper .hljs-symbol,.hljs-brown-paper .hljs-bullet,.hljs-brown-paper .hljs-built_in,.hljs-brown-paper .hljs-addition,.hljs-brown-paper .hljs-variable,.hljs-brown-paper .hljs-template-tag,.hljs-brown-paper .hljs-template-variable,.hljs-brown-paper .hljs-link,.hljs-brown-paper .hljs-name{color:#2c009f}.hljs-brown-paper .hljs-comment,.hljs-brown-paper .hljs-quote,.hljs-brown-paper .hljs-meta,.hljs-brown-paper .hljs-deletion{color:#802022}.hljs-brown-paper .hljs-keyword,.hljs-brown-paper .hljs-selector-tag,.hljs-brown-paper .hljs-literal,.hljs-brown-paper .hljs-doctag,.hljs-brown-paper .hljs-title,.hljs-brown-paper .hljs-section,.hljs-brown-paper .hljs-type,.hljs-brown-paper .hljs-name,.hljs-brown-paper .hljs-strong{font-weight:bold}.hljs-brown-paper .hljs-emphasis{font-style:italic}.hljs-codepen-embed .hljs{display:block;overflow-x:auto;padding:.5em;background:#222;color:#fff}.hljs-codepen-embed .hljs-comment,.hljs-codepen-embed .hljs-quote{color:#777}.hljs-codepen-embed .hljs-variable,.hljs-codepen-embed .hljs-template-variable,.hljs-codepen-embed .hljs-tag,.hljs-codepen-embed .hljs-regexp,.hljs-codepen-embed .hljs-meta,.hljs-codepen-embed .hljs-number,.hljs-codepen-embed .hljs-built_in,.hljs-codepen-embed .hljs-builtin-name,.hljs-codepen-embed .hljs-literal,.hljs-codepen-embed .hljs-params,.hljs-codepen-embed .hljs-symbol,.hljs-codepen-embed .hljs-bullet,.hljs-codepen-embed .hljs-link,.hljs-codepen-embed .hljs-deletion{color:#ab875d}.hljs-codepen-embed .hljs-section,.hljs-codepen-embed .hljs-title,.hljs-codepen-embed .hljs-name,.hljs-codepen-embed .hljs-selector-id,.hljs-codepen-embed .hljs-selector-class,.hljs-codepen-embed .hljs-type,.hljs-codepen-embed .hljs-attribute{color:#9b869b}.hljs-codepen-embed .hljs-string,.hljs-codepen-embed .hljs-keyword,.hljs-codepen-embed .hljs-selector-tag,.hljs-codepen-embed .hljs-addition{color:#8f9c6c}.hljs-codepen-embed .hljs-emphasis{font-style:italic}.hljs-codepen-embed .hljs-strong{font-weight:bold}.hljs-color-brewer .hljs{display:block;overflow-x:auto;padding:.5em;background:#fff}.hljs-color-brewer .hljs,.hljs-color-brewer .hljs-subst{color:#000}.hljs-color-brewer .hljs-string,.hljs-color-brewer .hljs-meta,.hljs-color-brewer .hljs-symbol,.hljs-color-brewer .hljs-template-tag,.hljs-color-brewer .hljs-template-variable,.hljs-color-brewer .hljs-addition{color:#756bb1}.hljs-color-brewer .hljs-comment,.hljs-color-brewer .hljs-quote{color:#636363}.hljs-color-brewer .hljs-number,.hljs-color-brewer .hljs-regexp,.hljs-color-brewer .hljs-literal,.hljs-color-brewer .hljs-bullet,.hljs-color-brewer .hljs-link{color:#31a354}.hljs-color-brewer .hljs-deletion,.hljs-color-brewer .hljs-variable{color:#88f}.hljs-color-brewer .hljs-keyword,.hljs-color-brewer .hljs-selector-tag,.hljs-color-brewer .hljs-title,.hljs-color-brewer .hljs-section,.hljs-color-brewer .hljs-built_in,.hljs-color-brewer .hljs-doctag,.hljs-color-brewer .hljs-type,.hljs-color-brewer .hljs-tag,.hljs-color-brewer .hljs-name,.hljs-color-brewer .hljs-selector-id,.hljs-color-brewer .hljs-selector-class,.hljs-color-brewer .hljs-strong{color:#3182bd}.hljs-color-brewer .hljs-emphasis{font-style:italic}.hljs-color-brewer .hljs-attribute{color:#e6550d}.hljs-darcula .hljs{display:block;overflow-x:auto;padding:.5em;background:#2b2b2b}.hljs-darcula .hljs{color:#bababa}.hljs-darcula .hljs-strong,.hljs-darcula .hljs-emphasis{color:#a8a8a2}.hljs-darcula .hljs-bullet,.hljs-darcula .hljs-quote,.hljs-darcula .hljs-link,.hljs-darcula .hljs-number,.hljs-darcula .hljs-regexp,.hljs-darcula .hljs-literal{color:#6896ba}.hljs-darcula .hljs-code,.hljs-darcula .hljs-selector-class{color:#a6e22e}.hljs-darcula .hljs-emphasis{font-style:italic}.hljs-darcula .hljs-keyword,.hljs-darcula .hljs-selector-tag,.hljs-darcula .hljs-section,.hljs-darcula .hljs-attribute,.hljs-darcula .hljs-name,.hljs-darcula .hljs-variable{color:#cb7832}.hljs-darcula .hljs-params{color:#b9b9b9}.hljs-darcula .hljs-string{color:#6a8759}.hljs-darcula .hljs-subst,.hljs-darcula .hljs-type,.hljs-darcula .hljs-built_in,.hljs-darcula .hljs-builtin-name,.hljs-darcula .hljs-symbol,.hljs-darcula .hljs-selector-id,.hljs-darcula .hljs-selector-attr,.hljs-darcula .hljs-selector-pseudo,.hljs-darcula .hljs-template-tag,.hljs-darcula .hljs-template-variable,.hljs-darcula .hljs-addition{color:#e0c46c}.hljs-darcula .hljs-comment,.hljs-darcula .hljs-deletion,.hljs-darcula .hljs-meta{color:#7f7f7f}.hljs-dark .hljs{display:block;overflow-x:auto;padding:.5em;background:#444}.hljs-dark .hljs-keyword,.hljs-dark .hljs-selector-tag,.hljs-dark .hljs-literal,.hljs-dark .hljs-section,.hljs-dark .hljs-link{color:white}.hljs-dark .hljs,.hljs-dark .hljs-subst{color:#ddd}.hljs-dark .hljs-string,.hljs-dark .hljs-title,.hljs-dark .hljs-name,.hljs-dark .hljs-type,.hljs-dark .hljs-attribute,.hljs-dark .hljs-symbol,.hljs-dark .hljs-bullet,.hljs-dark .hljs-built_in,.hljs-dark .hljs-addition,.hljs-dark .hljs-variable,.hljs-dark .hljs-template-tag,.hljs-dark .hljs-template-variable{color:#d88}.hljs-dark .hljs-comment,.hljs-dark .hljs-quote,.hljs-dark .hljs-deletion,.hljs-dark .hljs-meta{color:#777}.hljs-dark .hljs-keyword,.hljs-dark .hljs-selector-tag,.hljs-dark .hljs-literal,.hljs-dark .hljs-title,.hljs-dark .hljs-section,.hljs-dark .hljs-doctag,.hljs-dark .hljs-type,.hljs-dark .hljs-name,.hljs-dark .hljs-strong{font-weight:bold}.hljs-dark .hljs-emphasis{font-style:italic}.hljs-darkula{@import url('darcula.css');}.hljs-default .hljs{display:block;overflow-x:auto;padding:.5em;background:#F0F0F0}.hljs-default .hljs,.hljs-default .hljs-subst{color:#444}.hljs-default .hljs-comment{color:#888888}.hljs-default .hljs-keyword,.hljs-default .hljs-attribute,.hljs-default .hljs-selector-tag,.hljs-default .hljs-meta-keyword,.hljs-default .hljs-doctag,.hljs-default .hljs-name{font-weight:bold}.hljs-default .hljs-type,.hljs-default .hljs-string,.hljs-default .hljs-number,.hljs-default .hljs-selector-id,.hljs-default .hljs-selector-class,.hljs-default .hljs-quote,.hljs-default .hljs-template-tag,.hljs-default .hljs-deletion{color:#880000}.hljs-default .hljs-title,.hljs-default .hljs-section{color:#880000;font-weight:bold}.hljs-default .hljs-regexp,.hljs-default .hljs-symbol,.hljs-default .hljs-variable,.hljs-default .hljs-template-variable,.hljs-default .hljs-link,.hljs-default .hljs-selector-attr,.hljs-default .hljs-selector-pseudo{color:#BC6060}.hljs-default .hljs-literal{color:#78A960}.hljs-default .hljs-built_in,.hljs-default .hljs-bullet,.hljs-default .hljs-code,.hljs-default .hljs-addition{color:#397300}.hljs-default .hljs-meta{color:#1f7199}.hljs-default .hljs-meta-string{color:#4d99bf}.hljs-default .hljs-emphasis{font-style:italic}.hljs-default .hljs-strong{font-weight:bold}.hljs-docco .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}.hljs-docco .hljs-comment,.hljs-docco .hljs-quote{color:#408080;font-style:italic}.hljs-docco .hljs-keyword,.hljs-docco .hljs-selector-tag,.hljs-docco .hljs-literal,.hljs-docco .hljs-subst{color:#954121}.hljs-docco .hljs-number{color:#40a070}.hljs-docco .hljs-string,.hljs-docco .hljs-doctag{color:#219161}.hljs-docco .hljs-selector-id,.hljs-docco .hljs-selector-class,.hljs-docco .hljs-section,.hljs-docco .hljs-type{color:#19469d}.hljs-docco .hljs-params{color:#00f}.hljs-docco .hljs-title{color:#458;font-weight:bold}.hljs-docco .hljs-tag,.hljs-docco .hljs-name,.hljs-docco .hljs-attribute{color:#000080;font-weight:normal}.hljs-docco .hljs-variable,.hljs-docco .hljs-template-variable{color:#008080}.hljs-docco .hljs-regexp,.hljs-docco .hljs-link{color:#b68}.hljs-docco .hljs-symbol,.hljs-docco .hljs-bullet{color:#990073}.hljs-docco .hljs-built_in,.hljs-docco .hljs-builtin-name{color:#0086b3}.hljs-docco .hljs-meta{color:#999;font-weight:bold}.hljs-docco .hljs-deletion{background:#fdd}.hljs-docco .hljs-addition{background:#dfd}.hljs-docco .hljs-emphasis{font-style:italic}.hljs-docco .hljs-strong{font-weight:bold}.hljs-dracula .hljs{display:block;overflow-x:auto;padding:.5em;background:#282a36}.hljs-dracula .hljs-keyword,.hljs-dracula .hljs-selector-tag,.hljs-dracula .hljs-literal,.hljs-dracula .hljs-section,.hljs-dracula .hljs-link{color:#8be9fd}.hljs-dracula .hljs-function .hljs-keyword{color:#ff79c6}.hljs-dracula .hljs,.hljs-dracula .hljs-subst{color:#f8f8f2}.hljs-dracula .hljs-string,.hljs-dracula .hljs-title,.hljs-dracula .hljs-name,.hljs-dracula .hljs-type,.hljs-dracula .hljs-attribute,.hljs-dracula .hljs-symbol,.hljs-dracula .hljs-bullet,.hljs-dracula .hljs-addition,.hljs-dracula .hljs-variable,.hljs-dracula .hljs-template-tag,.hljs-dracula .hljs-template-variable{color:#f1fa8c}.hljs-dracula .hljs-comment,.hljs-dracula .hljs-quote,.hljs-dracula .hljs-deletion,.hljs-dracula .hljs-meta{color:#6272a4}.hljs-dracula .hljs-keyword,.hljs-dracula .hljs-selector-tag,.hljs-dracula .hljs-literal,.hljs-dracula .hljs-title,.hljs-dracula .hljs-section,.hljs-dracula .hljs-doctag,.hljs-dracula .hljs-type,.hljs-dracula .hljs-name,.hljs-dracula .hljs-strong{font-weight:bold}.hljs-dracula .hljs-emphasis{font-style:italic}.hljs-far .hljs{display:block;overflow-x:auto;padding:.5em;background:#000080}.hljs-far .hljs,.hljs-far .hljs-subst{color:#0ff}.hljs-far .hljs-string,.hljs-far .hljs-attribute,.hljs-far .hljs-symbol,.hljs-far .hljs-bullet,.hljs-far .hljs-built_in,.hljs-far .hljs-builtin-name,.hljs-far .hljs-template-tag,.hljs-far .hljs-template-variable,.hljs-far .hljs-addition{color:#ff0}.hljs-far .hljs-keyword,.hljs-far .hljs-selector-tag,.hljs-far .hljs-section,.hljs-far .hljs-type,.hljs-far .hljs-name,.hljs-far .hljs-selector-id,.hljs-far .hljs-selector-class,.hljs-far .hljs-variable{color:#fff}.hljs-far .hljs-comment,.hljs-far .hljs-quote,.hljs-far .hljs-doctag,.hljs-far .hljs-deletion{color:#888}.hljs-far .hljs-number,.hljs-far .hljs-regexp,.hljs-far .hljs-literal,.hljs-far .hljs-link{color:#0f0}.hljs-far .hljs-meta{color:#008080}.hljs-far .hljs-keyword,.hljs-far .hljs-selector-tag,.hljs-far .hljs-title,.hljs-far .hljs-section,.hljs-far .hljs-name,.hljs-far .hljs-strong{font-weight:bold}.hljs-far .hljs-emphasis{font-style:italic}.hljs-foundation .hljs{display:block;overflow-x:auto;padding:.5em;background:#eee;color:black}.hljs-foundation .hljs-link,.hljs-foundation .hljs-emphasis,.hljs-foundation .hljs-attribute,.hljs-foundation .hljs-addition{color:#070}.hljs-foundation .hljs-emphasis{font-style:italic}.hljs-foundation .hljs-strong,.hljs-foundation .hljs-string,.hljs-foundation .hljs-deletion{color:#d14}.hljs-foundation .hljs-strong{font-weight:bold}.hljs-foundation .hljs-quote,.hljs-foundation .hljs-comment{color:#998;font-style:italic}.hljs-foundation .hljs-section,.hljs-foundation .hljs-title{color:#900}.hljs-foundation .hljs-class .hljs-title,.hljs-foundation .hljs-type{color:#458}.hljs-foundation .hljs-variable,.hljs-foundation .hljs-template-variable{color:#336699}.hljs-foundation .hljs-bullet{color:#997700}.hljs-foundation .hljs-meta{color:#3344bb}.hljs-foundation .hljs-code,.hljs-foundation .hljs-number,.hljs-foundation .hljs-literal,.hljs-foundation .hljs-keyword,.hljs-foundation .hljs-selector-tag{color:#099}.hljs-foundation .hljs-regexp{background-color:#fff0ff;color:#880088}.hljs-foundation .hljs-symbol{color:#990073}.hljs-foundation .hljs-tag,.hljs-foundation .hljs-name,.hljs-foundation .hljs-selector-id,.hljs-foundation .hljs-selector-class{color:#007700}.hljs-github-gist .hljs{display:block;background:white;padding:.5em;color:#333333;overflow-x:auto}.hljs-github-gist .hljs-comment,.hljs-github-gist .hljs-meta{color:#969896}.hljs-github-gist .hljs-string,.hljs-github-gist .hljs-variable,.hljs-github-gist .hljs-template-variable,.hljs-github-gist .hljs-strong,.hljs-github-gist .hljs-emphasis,.hljs-github-gist .hljs-quote{color:#df5000}.hljs-github-gist .hljs-keyword,.hljs-github-gist .hljs-selector-tag,.hljs-github-gist .hljs-type{color:#a71d5d}.hljs-github-gist .hljs-literal,.hljs-github-gist .hljs-symbol,.hljs-github-gist .hljs-bullet,.hljs-github-gist .hljs-attribute{color:#0086b3}.hljs-github-gist .hljs-section,.hljs-github-gist .hljs-name{color:#63a35c}.hljs-github-gist .hljs-tag{color:#333333}.hljs-github-gist .hljs-title,.hljs-github-gist .hljs-attr,.hljs-github-gist .hljs-selector-id,.hljs-github-gist .hljs-selector-class,.hljs-github-gist .hljs-selector-attr,.hljs-github-gist .hljs-selector-pseudo{color:#795da3}.hljs-github-gist .hljs-addition{color:#55a532;background-color:#eaffea}.hljs-github-gist .hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-github-gist .hljs-link{text-decoration:underline}.hljs-github .hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-github .hljs-comment,.hljs-github .hljs-quote{color:#998;font-style:italic}.hljs-github .hljs-keyword,.hljs-github .hljs-selector-tag,.hljs-github .hljs-subst{color:#333;font-weight:bold}.hljs-github .hljs-number,.hljs-github .hljs-literal,.hljs-github .hljs-variable,.hljs-github .hljs-template-variable,.hljs-github .hljs-tag .hljs-attr{color:#008080}.hljs-github .hljs-string,.hljs-github .hljs-doctag{color:#d14}.hljs-github .hljs-title,.hljs-github .hljs-section,.hljs-github .hljs-selector-id{color:#900;font-weight:bold}.hljs-github .hljs-subst{font-weight:normal}.hljs-github .hljs-type,.hljs-github .hljs-class .hljs-title{color:#458;font-weight:bold}.hljs-github .hljs-tag,.hljs-github .hljs-name,.hljs-github .hljs-attribute{color:#000080;font-weight:normal}.hljs-github .hljs-regexp,.hljs-github .hljs-link{color:#009926}.hljs-github .hljs-symbol,.hljs-github .hljs-bullet{color:#990073}.hljs-github .hljs-built_in,.hljs-github .hljs-builtin-name{color:#0086b3}.hljs-github .hljs-meta{color:#999;font-weight:bold}.hljs-github .hljs-deletion{background:#fdd}.hljs-github .hljs-addition{background:#dfd}.hljs-github .hljs-emphasis{font-style:italic}.hljs-github .hljs-strong{font-weight:bold}.hljs-googlecode .hljs{display:block;overflow-x:auto;padding:.5em;background:white;color:black}.hljs-googlecode .hljs-comment,.hljs-googlecode .hljs-quote{color:#800}.hljs-googlecode .hljs-keyword,.hljs-googlecode .hljs-selector-tag,.hljs-googlecode .hljs-section,.hljs-googlecode .hljs-title,.hljs-googlecode .hljs-name{color:#008}.hljs-googlecode .hljs-variable,.hljs-googlecode .hljs-template-variable{color:#660}.hljs-googlecode .hljs-string,.hljs-googlecode .hljs-selector-attr,.hljs-googlecode .hljs-selector-pseudo,.hljs-googlecode .hljs-regexp{color:#080}.hljs-googlecode .hljs-literal,.hljs-googlecode .hljs-symbol,.hljs-googlecode .hljs-bullet,.hljs-googlecode .hljs-meta,.hljs-googlecode .hljs-number,.hljs-googlecode .hljs-link{color:#066}.hljs-googlecode .hljs-title,.hljs-googlecode .hljs-doctag,.hljs-googlecode .hljs-type,.hljs-googlecode .hljs-attr,.hljs-googlecode .hljs-built_in,.hljs-googlecode .hljs-builtin-name,.hljs-googlecode .hljs-params{color:#606}.hljs-googlecode .hljs-attribute,.hljs-googlecode .hljs-subst{color:#000}.hljs-googlecode .hljs-formula{background-color:#eee;font-style:italic}.hljs-googlecode .hljs-selector-id,.hljs-googlecode .hljs-selector-class{color:#9B703F}.hljs-googlecode .hljs-addition{background-color:#baeeba}.hljs-googlecode .hljs-deletion{background-color:#ffc8bd}.hljs-googlecode .hljs-doctag,.hljs-googlecode .hljs-strong{font-weight:bold}.hljs-googlecode .hljs-emphasis{font-style:italic}.hljs-grayscale .hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#fff}.hljs-grayscale .hljs-comment,.hljs-grayscale .hljs-quote{color:#777;font-style:italic}.hljs-grayscale .hljs-keyword,.hljs-grayscale .hljs-selector-tag,.hljs-grayscale .hljs-subst{color:#333;font-weight:bold}.hljs-grayscale .hljs-number,.hljs-grayscale .hljs-literal{color:#777}.hljs-grayscale .hljs-string,.hljs-grayscale .hljs-doctag,.hljs-grayscale .hljs-formula{color:#333;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAJ0lEQVQIW2O8e/fufwYGBgZBQUEQxcCIIfDu3Tuwivfv30NUoAsAALHpFMMLqZlPAAAAAElFTkSuQmCC) repeat}.hljs-grayscale .hljs-title,.hljs-grayscale .hljs-section,.hljs-grayscale .hljs-selector-id{color:#000;font-weight:bold}.hljs-grayscale .hljs-subst{font-weight:normal}.hljs-grayscale .hljs-class .hljs-title,.hljs-grayscale .hljs-type,.hljs-grayscale .hljs-name{color:#333;font-weight:bold}.hljs-grayscale .hljs-tag{color:#333}.hljs-grayscale .hljs-regexp{color:#333;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAAPUlEQVQYV2NkQAN37979r6yszIgujiIAU4RNMVwhuiQ6H6wQl3XI4oy4FMHcCJPHcDS6J2A2EqUQpJhohQDexSef15DBCwAAAABJRU5ErkJggg==) repeat}.hljs-grayscale .hljs-symbol,.hljs-grayscale .hljs-bullet,.hljs-grayscale .hljs-link{color:#000;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAKElEQVQIW2NkQAO7d+/+z4gsBhJwdXVlhAvCBECKwIIwAbhKZBUwBQA6hBpm5efZsgAAAABJRU5ErkJggg==) repeat}.hljs-grayscale .hljs-built_in,.hljs-grayscale .hljs-builtin-name{color:#000;text-decoration:underline}.hljs-grayscale .hljs-meta{color:#999;font-weight:bold}.hljs-grayscale .hljs-deletion{color:#fff;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAADCAYAAABS3WWCAAAAE0lEQVQIW2MMDQ39zzhz5kwIAQAyxweWgUHd1AAAAABJRU5ErkJggg==) repeat}.hljs-grayscale .hljs-addition{color:#000;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAALUlEQVQYV2N89+7dfwYk8P79ewZBQUFkIQZGOiu6e/cuiptQHAPl0NtNxAQBAM97Oejj3Dg7AAAAAElFTkSuQmCC) repeat}.hljs-grayscale .hljs-emphasis{font-style:italic}.hljs-grayscale .hljs-strong{font-weight:bold}.hljs-gruvbox-dark .hljs{display:block;overflow-x:auto;padding:.5em;background:#282828}.hljs-gruvbox-dark .hljs,.hljs-gruvbox-dark .hljs-subst{color:#ebdbb2}.hljs-gruvbox-dark .hljs-deletion,.hljs-gruvbox-dark .hljs-formula,.hljs-gruvbox-dark .hljs-keyword,.hljs-gruvbox-dark .hljs-link,.hljs-gruvbox-dark .hljs-selector-tag{color:#fb4934}.hljs-gruvbox-dark .hljs-built_in,.hljs-gruvbox-dark .hljs-emphasis,.hljs-gruvbox-dark .hljs-name,.hljs-gruvbox-dark .hljs-quote,.hljs-gruvbox-dark .hljs-strong,.hljs-gruvbox-dark .hljs-title,.hljs-gruvbox-dark .hljs-variable{color:#83a598}.hljs-gruvbox-dark .hljs-attr,.hljs-gruvbox-dark .hljs-params,.hljs-gruvbox-dark .hljs-template-tag,.hljs-gruvbox-dark .hljs-type{color:#fabd2f}.hljs-gruvbox-dark .hljs-builtin-name,.hljs-gruvbox-dark .hljs-doctag,.hljs-gruvbox-dark .hljs-literal,.hljs-gruvbox-dark .hljs-number{color:#8f3f71}.hljs-gruvbox-dark .hljs-code,.hljs-gruvbox-dark .hljs-meta,.hljs-gruvbox-dark .hljs-regexp,.hljs-gruvbox-dark .hljs-selector-id,.hljs-gruvbox-dark .hljs-template-variable{color:#fe8019}.hljs-gruvbox-dark .hljs-addition,.hljs-gruvbox-dark .hljs-meta-string,.hljs-gruvbox-dark .hljs-section,.hljs-gruvbox-dark .hljs-selector-attr,.hljs-gruvbox-dark .hljs-selector-class,.hljs-gruvbox-dark .hljs-string,.hljs-gruvbox-dark .hljs-symbol{color:#b8bb26}.hljs-gruvbox-dark .hljs-attribute,.hljs-gruvbox-dark .hljs-bullet,.hljs-gruvbox-dark .hljs-class,.hljs-gruvbox-dark .hljs-function,.hljs-gruvbox-dark .hljs-function .hljs-keyword,.hljs-gruvbox-dark .hljs-meta-keyword,.hljs-gruvbox-dark .hljs-selector-pseudo,.hljs-gruvbox-dark .hljs-tag{color:#8ec07c}.hljs-gruvbox-dark .hljs-comment{color:#928374}.hljs-gruvbox-dark .hljs-link_label,.hljs-gruvbox-dark .hljs-literal,.hljs-gruvbox-dark .hljs-number{color:#d3869b}.hljs-gruvbox-dark .hljs-comment,.hljs-gruvbox-dark .hljs-emphasis{font-style:italic}.hljs-gruvbox-dark .hljs-section,.hljs-gruvbox-dark .hljs-strong,.hljs-gruvbox-dark .hljs-tag{font-weight:bold}.hljs-gruvbox-light .hljs{display:block;overflow-x:auto;padding:.5em;background:#fbf1c7}.hljs-gruvbox-light .hljs,.hljs-gruvbox-light .hljs-subst{color:#3c3836}.hljs-gruvbox-light .hljs-deletion,.hljs-gruvbox-light .hljs-formula,.hljs-gruvbox-light .hljs-keyword,.hljs-gruvbox-light .hljs-link,.hljs-gruvbox-light .hljs-selector-tag{color:#9d0006}.hljs-gruvbox-light .hljs-built_in,.hljs-gruvbox-light .hljs-emphasis,.hljs-gruvbox-light .hljs-name,.hljs-gruvbox-light .hljs-quote,.hljs-gruvbox-light .hljs-strong,.hljs-gruvbox-light .hljs-title,.hljs-gruvbox-light .hljs-variable{color:#076678}.hljs-gruvbox-light .hljs-attr,.hljs-gruvbox-light .hljs-params,.hljs-gruvbox-light .hljs-template-tag,.hljs-gruvbox-light .hljs-type{color:#b57614}.hljs-gruvbox-light .hljs-builtin-name,.hljs-gruvbox-light .hljs-doctag,.hljs-gruvbox-light .hljs-literal,.hljs-gruvbox-light .hljs-number{color:#8f3f71}.hljs-gruvbox-light .hljs-code,.hljs-gruvbox-light .hljs-meta,.hljs-gruvbox-light .hljs-regexp,.hljs-gruvbox-light .hljs-selector-id,.hljs-gruvbox-light .hljs-template-variable{color:#af3a03}.hljs-gruvbox-light .hljs-addition,.hljs-gruvbox-light .hljs-meta-string,.hljs-gruvbox-light .hljs-section,.hljs-gruvbox-light .hljs-selector-attr,.hljs-gruvbox-light .hljs-selector-class,.hljs-gruvbox-light .hljs-string,.hljs-gruvbox-light .hljs-symbol{color:#79740e}.hljs-gruvbox-light .hljs-attribute,.hljs-gruvbox-light .hljs-bullet,.hljs-gruvbox-light .hljs-class,.hljs-gruvbox-light .hljs-function,.hljs-gruvbox-light .hljs-function .hljs-keyword,.hljs-gruvbox-light .hljs-meta-keyword,.hljs-gruvbox-light .hljs-selector-pseudo,.hljs-gruvbox-light .hljs-tag{color:#427b58}.hljs-gruvbox-light .hljs-comment{color:#928374}.hljs-gruvbox-light .hljs-link_label,.hljs-gruvbox-light .hljs-literal,.hljs-gruvbox-light .hljs-number{color:#8f3f71}.hljs-gruvbox-light .hljs-comment,.hljs-gruvbox-light .hljs-emphasis{font-style:italic}.hljs-gruvbox-light .hljs-section,.hljs-gruvbox-light .hljs-strong,.hljs-gruvbox-light .hljs-tag{font-weight:bold}.hljs-hopscotch .hljs-comment,.hljs-hopscotch .hljs-quote{color:#989498}.hljs-hopscotch .hljs-variable,.hljs-hopscotch .hljs-template-variable,.hljs-hopscotch .hljs-attribute,.hljs-hopscotch .hljs-tag,.hljs-hopscotch .hljs-name,.hljs-hopscotch .hljs-selector-id,.hljs-hopscotch .hljs-selector-class,.hljs-hopscotch .hljs-regexp,.hljs-hopscotch .hljs-link,.hljs-hopscotch .hljs-deletion{color:#dd464c}.hljs-hopscotch .hljs-number,.hljs-hopscotch .hljs-built_in,.hljs-hopscotch .hljs-builtin-name,.hljs-hopscotch .hljs-literal,.hljs-hopscotch .hljs-type,.hljs-hopscotch .hljs-params{color:#fd8b19}.hljs-hopscotch .hljs-class .hljs-title{color:#fdcc59}.hljs-hopscotch .hljs-string,.hljs-hopscotch .hljs-symbol,.hljs-hopscotch .hljs-bullet,.hljs-hopscotch .hljs-addition{color:#8fc13e}.hljs-hopscotch .hljs-meta{color:#149b93}.hljs-hopscotch .hljs-function,.hljs-hopscotch .hljs-section,.hljs-hopscotch .hljs-title{color:#1290bf}.hljs-hopscotch .hljs-keyword,.hljs-hopscotch .hljs-selector-tag{color:#c85e7c}.hljs-hopscotch .hljs{display:block;background:#322931;color:#b9b5b8;padding:.5em}.hljs-hopscotch .hljs-emphasis{font-style:italic}.hljs-hopscotch .hljs-strong{font-weight:bold}.hljs-hybrid .hljs{display:block;overflow-x:auto;padding:.5em;background:#1d1f21}.hljs-hybrid .hljs::selection,.hljs-hybrid .hljs span::selection{background:#373b41}.hljs-hybrid .hljs::-moz-selection,.hljs-hybrid .hljs span::-moz-selection{background:#373b41}.hljs-hybrid .hljs{color:#c5c8c6}.hljs-hybrid .hljs-title,.hljs-hybrid .hljs-name{color:#f0c674}.hljs-hybrid .hljs-comment,.hljs-hybrid .hljs-meta,.hljs-hybrid .hljs-meta .hljs-keyword{color:#707880}.hljs-hybrid .hljs-number,.hljs-hybrid .hljs-symbol,.hljs-hybrid .hljs-literal,.hljs-hybrid .hljs-deletion,.hljs-hybrid .hljs-link{color:#cc6666}.hljs-hybrid .hljs-string,.hljs-hybrid .hljs-doctag,.hljs-hybrid .hljs-addition,.hljs-hybrid .hljs-regexp,.hljs-hybrid .hljs-selector-attr,.hljs-hybrid .hljs-selector-pseudo{color:#b5bd68}.hljs-hybrid .hljs-attribute,.hljs-hybrid .hljs-code,.hljs-hybrid .hljs-selector-id{color:#b294bb}.hljs-hybrid .hljs-keyword,.hljs-hybrid .hljs-selector-tag,.hljs-hybrid .hljs-bullet,.hljs-hybrid .hljs-tag{color:#81a2be}.hljs-hybrid .hljs-subst,.hljs-hybrid .hljs-variable,.hljs-hybrid .hljs-template-tag,.hljs-hybrid .hljs-template-variable{color:#8abeb7}.hljs-hybrid .hljs-type,.hljs-hybrid .hljs-built_in,.hljs-hybrid .hljs-builtin-name,.hljs-hybrid .hljs-quote,.hljs-hybrid .hljs-section,.hljs-hybrid .hljs-selector-class{color:#de935f}.hljs-hybrid .hljs-emphasis{font-style:italic}.hljs-hybrid .hljs-strong{font-weight:bold}.hljs-idea .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#fff}.hljs-idea .hljs-subst,.hljs-idea .hljs-title{font-weight:normal;color:#000}.hljs-idea .hljs-comment,.hljs-idea .hljs-quote{color:#808080;font-style:italic}.hljs-idea .hljs-meta{color:#808000}.hljs-idea .hljs-tag{background:#efefef}.hljs-idea .hljs-section,.hljs-idea .hljs-name,.hljs-idea .hljs-literal,.hljs-idea .hljs-keyword,.hljs-idea .hljs-selector-tag,.hljs-idea .hljs-type,.hljs-idea .hljs-selector-id,.hljs-idea .hljs-selector-class{font-weight:bold;color:#000080}.hljs-idea .hljs-attribute,.hljs-idea .hljs-number,.hljs-idea .hljs-regexp,.hljs-idea .hljs-link{font-weight:bold;color:#0000ff}.hljs-idea .hljs-number,.hljs-idea .hljs-regexp,.hljs-idea .hljs-link{font-weight:normal}.hljs-idea .hljs-string{color:#008000;font-weight:bold}.hljs-idea .hljs-symbol,.hljs-idea .hljs-bullet,.hljs-idea .hljs-formula{color:#000;background:#d0eded;font-style:italic}.hljs-idea .hljs-doctag{text-decoration:underline}.hljs-idea .hljs-variable,.hljs-idea .hljs-template-variable{color:#660e7a}.hljs-idea .hljs-addition{background:#baeeba}.hljs-idea .hljs-deletion{background:#ffc8bd}.hljs-idea .hljs-emphasis{font-style:italic}.hljs-idea .hljs-strong{font-weight:bold}.hljs-ir-black .hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}.hljs-ir-black .hljs-comment,.hljs-ir-black .hljs-quote,.hljs-ir-black .hljs-meta{color:#7c7c7c}.hljs-ir-black .hljs-keyword,.hljs-ir-black .hljs-selector-tag,.hljs-ir-black .hljs-tag,.hljs-ir-black .hljs-name{color:#96cbfe}.hljs-ir-black .hljs-attribute,.hljs-ir-black .hljs-selector-id{color:#ffffb6}.hljs-ir-black .hljs-string,.hljs-ir-black .hljs-selector-attr,.hljs-ir-black .hljs-selector-pseudo,.hljs-ir-black .hljs-addition{color:#a8ff60}.hljs-ir-black .hljs-subst{color:#daefa3}.hljs-ir-black .hljs-regexp,.hljs-ir-black .hljs-link{color:#e9c062}.hljs-ir-black .hljs-title,.hljs-ir-black .hljs-section,.hljs-ir-black .hljs-type,.hljs-ir-black .hljs-doctag{color:#ffffb6}.hljs-ir-black .hljs-symbol,.hljs-ir-black .hljs-bullet,.hljs-ir-black .hljs-variable,.hljs-ir-black .hljs-template-variable,.hljs-ir-black .hljs-literal{color:#c6c5fe}.hljs-ir-black .hljs-number,.hljs-ir-black .hljs-deletion{color:#ff73fd}.hljs-ir-black .hljs-emphasis{font-style:italic}.hljs-ir-black .hljs-strong{font-weight:bold}.hljs-kimbie.dark .hljs-comment,.hljs-kimbie.dark .hljs-quote{color:#d6baad}.hljs-kimbie.dark .hljs-variable,.hljs-kimbie.dark .hljs-template-variable,.hljs-kimbie.dark .hljs-tag,.hljs-kimbie.dark .hljs-name,.hljs-kimbie.dark .hljs-selector-id,.hljs-kimbie.dark .hljs-selector-class,.hljs-kimbie.dark .hljs-regexp,.hljs-kimbie.dark .hljs-meta{color:#dc3958}.hljs-kimbie.dark .hljs-number,.hljs-kimbie.dark .hljs-built_in,.hljs-kimbie.dark .hljs-builtin-name,.hljs-kimbie.dark .hljs-literal,.hljs-kimbie.dark .hljs-type,.hljs-kimbie.dark .hljs-params,.hljs-kimbie.dark .hljs-deletion,.hljs-kimbie.dark .hljs-link{color:#f79a32}.hljs-kimbie.dark .hljs-title,.hljs-kimbie.dark .hljs-section,.hljs-kimbie.dark .hljs-attribute{color:#f06431}.hljs-kimbie.dark .hljs-string,.hljs-kimbie.dark .hljs-symbol,.hljs-kimbie.dark .hljs-bullet,.hljs-kimbie.dark .hljs-addition{color:#889b4a}.hljs-kimbie.dark .hljs-keyword,.hljs-kimbie.dark .hljs-selector-tag,.hljs-kimbie.dark .hljs-function{color:#98676a}.hljs-kimbie.dark .hljs{display:block;overflow-x:auto;background:#221a0f;color:#d3af86;padding:.5em}.hljs-kimbie.dark .hljs-emphasis{font-style:italic}.hljs-kimbie.dark .hljs-strong{font-weight:bold}.hljs-kimbie.light .hljs-comment,.hljs-kimbie.light .hljs-quote{color:#a57a4c}.hljs-kimbie.light .hljs-variable,.hljs-kimbie.light .hljs-template-variable,.hljs-kimbie.light .hljs-tag,.hljs-kimbie.light .hljs-name,.hljs-kimbie.light .hljs-selector-id,.hljs-kimbie.light .hljs-selector-class,.hljs-kimbie.light .hljs-regexp,.hljs-kimbie.light .hljs-meta{color:#dc3958}.hljs-kimbie.light .hljs-number,.hljs-kimbie.light .hljs-built_in,.hljs-kimbie.light .hljs-builtin-name,.hljs-kimbie.light .hljs-literal,.hljs-kimbie.light .hljs-type,.hljs-kimbie.light .hljs-params,.hljs-kimbie.light .hljs-deletion,.hljs-kimbie.light .hljs-link{color:#f79a32}.hljs-kimbie.light .hljs-title,.hljs-kimbie.light .hljs-section,.hljs-kimbie.light .hljs-attribute{color:#f06431}.hljs-kimbie.light .hljs-string,.hljs-kimbie.light .hljs-symbol,.hljs-kimbie.light .hljs-bullet,.hljs-kimbie.light .hljs-addition{color:#889b4a}.hljs-kimbie.light .hljs-keyword,.hljs-kimbie.light .hljs-selector-tag,.hljs-kimbie.light .hljs-function{color:#98676a}.hljs-kimbie.light .hljs{display:block;overflow-x:auto;background:#fbebd4;color:#84613d;padding:.5em}.hljs-kimbie.light .hljs-emphasis{font-style:italic}.hljs-kimbie.light .hljs-strong{font-weight:bold}.hljs-magula .hljs{display:block;overflow-x:auto;padding:.5em;background-color:#f4f4f4}.hljs-magula .hljs,.hljs-magula .hljs-subst{color:black}.hljs-magula .hljs-string,.hljs-magula .hljs-title,.hljs-magula .hljs-symbol,.hljs-magula .hljs-bullet,.hljs-magula .hljs-attribute,.hljs-magula .hljs-addition,.hljs-magula .hljs-variable,.hljs-magula .hljs-template-tag,.hljs-magula .hljs-template-variable{color:#050}.hljs-magula .hljs-comment,.hljs-magula .hljs-quote{color:#777}.hljs-magula .hljs-number,.hljs-magula .hljs-regexp,.hljs-magula .hljs-literal,.hljs-magula .hljs-type,.hljs-magula .hljs-link{color:#800}.hljs-magula .hljs-deletion,.hljs-magula .hljs-meta{color:#00e}.hljs-magula .hljs-keyword,.hljs-magula .hljs-selector-tag,.hljs-magula .hljs-doctag,.hljs-magula .hljs-title,.hljs-magula .hljs-section,.hljs-magula .hljs-built_in,.hljs-magula .hljs-tag,.hljs-magula .hljs-name{font-weight:bold;color:navy}.hljs-magula .hljs-emphasis{font-style:italic}.hljs-magula .hljs-strong{font-weight:bold}.hljs-mono-blue .hljs{display:block;overflow-x:auto;padding:.5em;background:#eaeef3}.hljs-mono-blue .hljs{color:#00193a}.hljs-mono-blue .hljs-keyword,.hljs-mono-blue .hljs-selector-tag,.hljs-mono-blue .hljs-title,.hljs-mono-blue .hljs-section,.hljs-mono-blue .hljs-doctag,.hljs-mono-blue .hljs-name,.hljs-mono-blue .hljs-strong{font-weight:bold}.hljs-mono-blue .hljs-comment{color:#738191}.hljs-mono-blue .hljs-string,.hljs-mono-blue .hljs-title,.hljs-mono-blue .hljs-section,.hljs-mono-blue .hljs-built_in,.hljs-mono-blue .hljs-literal,.hljs-mono-blue .hljs-type,.hljs-mono-blue .hljs-addition,.hljs-mono-blue .hljs-tag,.hljs-mono-blue .hljs-quote,.hljs-mono-blue .hljs-name,.hljs-mono-blue .hljs-selector-id,.hljs-mono-blue .hljs-selector-class{color:#0048ab}.hljs-mono-blue .hljs-meta,.hljs-mono-blue .hljs-subst,.hljs-mono-blue .hljs-symbol,.hljs-mono-blue .hljs-regexp,.hljs-mono-blue .hljs-attribute,.hljs-mono-blue .hljs-deletion,.hljs-mono-blue .hljs-variable,.hljs-mono-blue .hljs-template-variable,.hljs-mono-blue .hljs-link,.hljs-mono-blue .hljs-bullet{color:#4c81c9}.hljs-mono-blue .hljs-emphasis{font-style:italic}.hljs-monokai-sublime .hljs{display:block;overflow-x:auto;padding:.5em;background:#23241f}.hljs-monokai-sublime .hljs,.hljs-monokai-sublime .hljs-tag,.hljs-monokai-sublime .hljs-subst{color:#f8f8f2}.hljs-monokai-sublime .hljs-strong,.hljs-monokai-sublime .hljs-emphasis{color:#a8a8a2}.hljs-monokai-sublime .hljs-bullet,.hljs-monokai-sublime .hljs-quote,.hljs-monokai-sublime .hljs-number,.hljs-monokai-sublime .hljs-regexp,.hljs-monokai-sublime .hljs-literal,.hljs-monokai-sublime .hljs-link{color:#ae81ff}.hljs-monokai-sublime .hljs-code,.hljs-monokai-sublime .hljs-title,.hljs-monokai-sublime .hljs-section,.hljs-monokai-sublime .hljs-selector-class{color:#a6e22e}.hljs-monokai-sublime .hljs-strong{font-weight:bold}.hljs-monokai-sublime .hljs-emphasis{font-style:italic}.hljs-monokai-sublime .hljs-keyword,.hljs-monokai-sublime .hljs-selector-tag,.hljs-monokai-sublime .hljs-name,.hljs-monokai-sublime .hljs-attr{color:#f92672}.hljs-monokai-sublime .hljs-symbol,.hljs-monokai-sublime .hljs-attribute{color:#66d9ef}.hljs-monokai-sublime .hljs-params,.hljs-monokai-sublime .hljs-class .hljs-title{color:#f8f8f2}.hljs-monokai-sublime .hljs-string,.hljs-monokai-sublime .hljs-type,.hljs-monokai-sublime .hljs-built_in,.hljs-monokai-sublime .hljs-builtin-name,.hljs-monokai-sublime .hljs-selector-id,.hljs-monokai-sublime .hljs-selector-attr,.hljs-monokai-sublime .hljs-selector-pseudo,.hljs-monokai-sublime .hljs-addition,.hljs-monokai-sublime .hljs-variable,.hljs-monokai-sublime .hljs-template-variable{color:#e6db74}.hljs-monokai-sublime .hljs-comment,.hljs-monokai-sublime .hljs-deletion,.hljs-monokai-sublime .hljs-meta{color:#75715e}.hljs-monokai .hljs{display:block;overflow-x:auto;padding:.5em;background:#272822;color:#ddd}.hljs-monokai .hljs-tag,.hljs-monokai .hljs-keyword,.hljs-monokai .hljs-selector-tag,.hljs-monokai .hljs-literal,.hljs-monokai .hljs-strong,.hljs-monokai .hljs-name{color:#f92672}.hljs-monokai .hljs-code{color:#66d9ef}.hljs-monokai .hljs-class .hljs-title{color:white}.hljs-monokai .hljs-attribute,.hljs-monokai .hljs-symbol,.hljs-monokai .hljs-regexp,.hljs-monokai .hljs-link{color:#bf79db}.hljs-monokai .hljs-string,.hljs-monokai .hljs-bullet,.hljs-monokai .hljs-subst,.hljs-monokai .hljs-title,.hljs-monokai .hljs-section,.hljs-monokai .hljs-emphasis,.hljs-monokai .hljs-type,.hljs-monokai .hljs-built_in,.hljs-monokai .hljs-builtin-name,.hljs-monokai .hljs-selector-attr,.hljs-monokai .hljs-selector-pseudo,.hljs-monokai .hljs-addition,.hljs-monokai .hljs-variable,.hljs-monokai .hljs-template-tag,.hljs-monokai .hljs-template-variable{color:#a6e22e}.hljs-monokai .hljs-comment,.hljs-monokai .hljs-quote,.hljs-monokai .hljs-deletion,.hljs-monokai .hljs-meta{color:#75715e}.hljs-monokai .hljs-keyword,.hljs-monokai .hljs-selector-tag,.hljs-monokai .hljs-literal,.hljs-monokai .hljs-doctag,.hljs-monokai .hljs-title,.hljs-monokai .hljs-section,.hljs-monokai .hljs-type,.hljs-monokai .hljs-selector-id{font-weight:bold}.hljs-obsidian .hljs{display:block;overflow-x:auto;padding:.5em;background:#282b2e}.hljs-obsidian .hljs-keyword,.hljs-obsidian .hljs-selector-tag,.hljs-obsidian .hljs-literal,.hljs-obsidian .hljs-selector-id{color:#93c763}.hljs-obsidian .hljs-number{color:#ffcd22}.hljs-obsidian .hljs{color:#e0e2e4}.hljs-obsidian .hljs-attribute{color:#668bb0}.hljs-obsidian .hljs-code,.hljs-obsidian .hljs-class .hljs-title,.hljs-obsidian .hljs-section{color:white}.hljs-obsidian .hljs-regexp,.hljs-obsidian .hljs-link{color:#d39745}.hljs-obsidian .hljs-meta{color:#557182}.hljs-obsidian .hljs-tag,.hljs-obsidian .hljs-name,.hljs-obsidian .hljs-bullet,.hljs-obsidian .hljs-subst,.hljs-obsidian .hljs-emphasis,.hljs-obsidian .hljs-type,.hljs-obsidian .hljs-built_in,.hljs-obsidian .hljs-selector-attr,.hljs-obsidian .hljs-selector-pseudo,.hljs-obsidian .hljs-addition,.hljs-obsidian .hljs-variable,.hljs-obsidian .hljs-template-tag,.hljs-obsidian .hljs-template-variable{color:#8cbbad}.hljs-obsidian .hljs-string,.hljs-obsidian .hljs-symbol{color:#ec7600}.hljs-obsidian .hljs-comment,.hljs-obsidian .hljs-quote,.hljs-obsidian .hljs-deletion{color:#818e96}.hljs-obsidian .hljs-selector-class{color:#A082BD}.hljs-obsidian .hljs-keyword,.hljs-obsidian .hljs-selector-tag,.hljs-obsidian .hljs-literal,.hljs-obsidian .hljs-doctag,.hljs-obsidian .hljs-title,.hljs-obsidian .hljs-section,.hljs-obsidian .hljs-type,.hljs-obsidian .hljs-name,.hljs-obsidian .hljs-strong{font-weight:bold}.hljs-ocean .hljs-comment,.hljs-ocean .hljs-quote{color:#65737e}.hljs-ocean .hljs-variable,.hljs-ocean .hljs-template-variable,.hljs-ocean .hljs-tag,.hljs-ocean .hljs-name,.hljs-ocean .hljs-selector-id,.hljs-ocean .hljs-selector-class,.hljs-ocean .hljs-regexp,.hljs-ocean .hljs-deletion{color:#bf616a}.hljs-ocean .hljs-number,.hljs-ocean .hljs-built_in,.hljs-ocean .hljs-builtin-name,.hljs-ocean .hljs-literal,.hljs-ocean .hljs-type,.hljs-ocean .hljs-params,.hljs-ocean .hljs-meta,.hljs-ocean .hljs-link{color:#d08770}.hljs-ocean .hljs-attribute{color:#ebcb8b}.hljs-ocean .hljs-string,.hljs-ocean .hljs-symbol,.hljs-ocean .hljs-bullet,.hljs-ocean .hljs-addition{color:#a3be8c}.hljs-ocean .hljs-title,.hljs-ocean .hljs-section{color:#8fa1b3}.hljs-ocean .hljs-keyword,.hljs-ocean .hljs-selector-tag{color:#b48ead}.hljs-ocean .hljs{display:block;overflow-x:auto;background:#2b303b;color:#c0c5ce;padding:.5em}.hljs-ocean .hljs-emphasis{font-style:italic}.hljs-ocean .hljs-strong{font-weight:bold}.hljs-paraiso-dark .hljs-comment,.hljs-paraiso-dark .hljs-quote{color:#8d8687}.hljs-paraiso-dark .hljs-variable,.hljs-paraiso-dark .hljs-template-variable,.hljs-paraiso-dark .hljs-tag,.hljs-paraiso-dark .hljs-name,.hljs-paraiso-dark .hljs-selector-id,.hljs-paraiso-dark .hljs-selector-class,.hljs-paraiso-dark .hljs-regexp,.hljs-paraiso-dark .hljs-link,.hljs-paraiso-dark .hljs-meta{color:#ef6155}.hljs-paraiso-dark .hljs-number,.hljs-paraiso-dark .hljs-built_in,.hljs-paraiso-dark .hljs-builtin-name,.hljs-paraiso-dark .hljs-literal,.hljs-paraiso-dark .hljs-type,.hljs-paraiso-dark .hljs-params,.hljs-paraiso-dark .hljs-deletion{color:#f99b15}.hljs-paraiso-dark .hljs-title,.hljs-paraiso-dark .hljs-section,.hljs-paraiso-dark .hljs-attribute{color:#fec418}.hljs-paraiso-dark .hljs-string,.hljs-paraiso-dark .hljs-symbol,.hljs-paraiso-dark .hljs-bullet,.hljs-paraiso-dark .hljs-addition{color:#48b685}.hljs-paraiso-dark .hljs-keyword,.hljs-paraiso-dark .hljs-selector-tag{color:#815ba4}.hljs-paraiso-dark .hljs{display:block;overflow-x:auto;background:#2f1e2e;color:#a39e9b;padding:.5em}.hljs-paraiso-dark .hljs-emphasis{font-style:italic}.hljs-paraiso-dark .hljs-strong{font-weight:bold}.hljs-paraiso-light .hljs-comment,.hljs-paraiso-light .hljs-quote{color:#776e71}.hljs-paraiso-light .hljs-variable,.hljs-paraiso-light .hljs-template-variable,.hljs-paraiso-light .hljs-tag,.hljs-paraiso-light .hljs-name,.hljs-paraiso-light .hljs-selector-id,.hljs-paraiso-light .hljs-selector-class,.hljs-paraiso-light .hljs-regexp,.hljs-paraiso-light .hljs-link,.hljs-paraiso-light .hljs-meta{color:#ef6155}.hljs-paraiso-light .hljs-number,.hljs-paraiso-light .hljs-built_in,.hljs-paraiso-light .hljs-builtin-name,.hljs-paraiso-light .hljs-literal,.hljs-paraiso-light .hljs-type,.hljs-paraiso-light .hljs-params,.hljs-paraiso-light .hljs-deletion{color:#f99b15}.hljs-paraiso-light .hljs-title,.hljs-paraiso-light .hljs-section,.hljs-paraiso-light .hljs-attribute{color:#fec418}.hljs-paraiso-light .hljs-string,.hljs-paraiso-light .hljs-symbol,.hljs-paraiso-light .hljs-bullet,.hljs-paraiso-light .hljs-addition{color:#48b685}.hljs-paraiso-light .hljs-keyword,.hljs-paraiso-light .hljs-selector-tag{color:#815ba4}.hljs-paraiso-light .hljs{display:block;overflow-x:auto;background:#e7e9db;color:#4f424c;padding:.5em}.hljs-paraiso-light .hljs-emphasis{font-style:italic}.hljs-paraiso-light .hljs-strong{font-weight:bold}.hljs-purebasic .hljs{display:block;overflow-x:auto;padding:.5em;background:#FFFFDF}.hljs-purebasic .hljs,.hljs-purebasic .hljs-type,.hljs-purebasic .hljs-function,.hljs-purebasic .hljs-name,.hljs-purebasic .hljs-number,.hljs-purebasic .hljs-attr,.hljs-purebasic .hljs-params,.hljs-purebasic .hljs-subst{color:#000000}.hljs-purebasic .hljs-comment,.hljs-purebasic .hljs-regexp,.hljs-purebasic .hljs-section,.hljs-purebasic .hljs-selector-pseudo,.hljs-purebasic .hljs-addition{color:#00AAAA}.hljs-purebasic .hljs-title,.hljs-purebasic .hljs-tag,.hljs-purebasic .hljs-variable,.hljs-purebasic .hljs-code{color:#006666}.hljs-purebasic .hljs-keyword,.hljs-purebasic .hljs-class,.hljs-purebasic .hljs-meta-keyword,.hljs-purebasic .hljs-selector-class,.hljs-purebasic .hljs-built_in,.hljs-purebasic .hljs-builtin-name{color:#006666;font-weight:bold}.hljs-purebasic .hljs-string,.hljs-purebasic .hljs-selector-attr{color:#0080FF}.hljs-purebasic .hljs-symbol,.hljs-purebasic .hljs-link,.hljs-purebasic .hljs-deletion,.hljs-purebasic .hljs-attribute{color:#924B72}.hljs-purebasic .hljs-meta,.hljs-purebasic .hljs-literal,.hljs-purebasic .hljs-selector-id{color:#924B72;font-weight:bold}.hljs-purebasic .hljs-strong,.hljs-purebasic .hljs-name{font-weight:bold}.hljs-purebasic .hljs-emphasis{font-style:italic}.hljs-qtcreator_dark .hljs{display:block;overflow-x:auto;padding:.5em;background:#000000}.hljs-qtcreator_dark .hljs,.hljs-qtcreator_dark .hljs-subst,.hljs-qtcreator_dark .hljs-tag,.hljs-qtcreator_dark .hljs-title{color:#aaaaaa}.hljs-qtcreator_dark .hljs-strong,.hljs-qtcreator_dark .hljs-emphasis{color:#a8a8a2}.hljs-qtcreator_dark .hljs-bullet,.hljs-qtcreator_dark .hljs-quote,.hljs-qtcreator_dark .hljs-number,.hljs-qtcreator_dark .hljs-regexp,.hljs-qtcreator_dark .hljs-literal{color:#ff55ff}.hljs-qtcreator_dark .hljs-code .hljs-selector-class{color:#aaaaff}.hljs-qtcreator_dark .hljs-emphasis,.hljs-qtcreator_dark .hljs-stronge,.hljs-qtcreator_dark .hljs-type{font-style:italic}.hljs-qtcreator_dark .hljs-keyword,.hljs-qtcreator_dark .hljs-selector-tag,.hljs-qtcreator_dark .hljs-function,.hljs-qtcreator_dark .hljs-section,.hljs-qtcreator_dark .hljs-symbol,.hljs-qtcreator_dark .hljs-name{color:#ffff55}.hljs-qtcreator_dark .hljs-attribute{color:#ff5555}.hljs-qtcreator_dark .hljs-variable,.hljs-qtcreator_dark .hljs-params,.hljs-qtcreator_dark .hljs-class .hljs-title{color:#8888ff}.hljs-qtcreator_dark .hljs-string,.hljs-qtcreator_dark .hljs-selector-id,.hljs-qtcreator_dark .hljs-selector-attr,.hljs-qtcreator_dark .hljs-selector-pseudo,.hljs-qtcreator_dark .hljs-type,.hljs-qtcreator_dark .hljs-built_in,.hljs-qtcreator_dark .hljs-builtin-name,.hljs-qtcreator_dark .hljs-template-tag,.hljs-qtcreator_dark .hljs-template-variable,.hljs-qtcreator_dark .hljs-addition,.hljs-qtcreator_dark .hljs-link{color:#ff55ff}.hljs-qtcreator_dark .hljs-comment,.hljs-qtcreator_dark .hljs-meta,.hljs-qtcreator_dark .hljs-deletion{color:#55ffff}.hljs-qtcreator_light .hljs{display:block;overflow-x:auto;padding:.5em;background:#ffffff}.hljs-qtcreator_light .hljs,.hljs-qtcreator_light .hljs-subst,.hljs-qtcreator_light .hljs-tag,.hljs-qtcreator_light .hljs-title{color:#000000}.hljs-qtcreator_light .hljs-strong,.hljs-qtcreator_light .hljs-emphasis{color:#000000}.hljs-qtcreator_light .hljs-bullet,.hljs-qtcreator_light .hljs-quote,.hljs-qtcreator_light .hljs-number,.hljs-qtcreator_light .hljs-regexp,.hljs-qtcreator_light .hljs-literal{color:#000080}.hljs-qtcreator_light .hljs-code .hljs-selector-class{color:#800080}.hljs-qtcreator_light .hljs-emphasis,.hljs-qtcreator_light .hljs-stronge,.hljs-qtcreator_light .hljs-type{font-style:italic}.hljs-qtcreator_light .hljs-keyword,.hljs-qtcreator_light .hljs-selector-tag,.hljs-qtcreator_light .hljs-function,.hljs-qtcreator_light .hljs-section,.hljs-qtcreator_light .hljs-symbol,.hljs-qtcreator_light .hljs-name{color:#808000}.hljs-qtcreator_light .hljs-attribute{color:#800000}.hljs-qtcreator_light .hljs-variable,.hljs-qtcreator_light .hljs-params,.hljs-qtcreator_light .hljs-class .hljs-title{color:#0055AF}.hljs-qtcreator_light .hljs-string,.hljs-qtcreator_light .hljs-selector-id,.hljs-qtcreator_light .hljs-selector-attr,.hljs-qtcreator_light .hljs-selector-pseudo,.hljs-qtcreator_light .hljs-type,.hljs-qtcreator_light .hljs-built_in,.hljs-qtcreator_light .hljs-builtin-name,.hljs-qtcreator_light .hljs-template-tag,.hljs-qtcreator_light .hljs-template-variable,.hljs-qtcreator_light .hljs-addition,.hljs-qtcreator_light .hljs-link{color:#008000}.hljs-qtcreator_light .hljs-comment,.hljs-qtcreator_light .hljs-meta,.hljs-qtcreator_light .hljs-deletion{color:#008000}.hljs-railscasts .hljs{display:block;overflow-x:auto;padding:.5em;background:#232323;color:#e6e1dc}.hljs-railscasts .hljs-comment,.hljs-railscasts .hljs-quote{color:#bc9458;font-style:italic}.hljs-railscasts .hljs-keyword,.hljs-railscasts .hljs-selector-tag{color:#c26230}.hljs-railscasts .hljs-string,.hljs-railscasts .hljs-number,.hljs-railscasts .hljs-regexp,.hljs-railscasts .hljs-variable,.hljs-railscasts .hljs-template-variable{color:#a5c261}.hljs-railscasts .hljs-subst{color:#519f50}.hljs-railscasts .hljs-tag,.hljs-railscasts .hljs-name{color:#e8bf6a}.hljs-railscasts .hljs-type{color:#da4939}.hljs-railscasts .hljs-symbol,.hljs-railscasts .hljs-bullet,.hljs-railscasts .hljs-built_in,.hljs-railscasts .hljs-builtin-name,.hljs-railscasts .hljs-attr,.hljs-railscasts .hljs-link{color:#6d9cbe}.hljs-railscasts .hljs-params{color:#d0d0ff}.hljs-railscasts .hljs-attribute{color:#cda869}.hljs-railscasts .hljs-meta{color:#9b859d}.hljs-railscasts .hljs-title,.hljs-railscasts .hljs-section{color:#ffc66d}.hljs-railscasts .hljs-addition{background-color:#144212;color:#e6e1dc;display:inline-block;width:100%}.hljs-railscasts .hljs-deletion{background-color:#600;color:#e6e1dc;display:inline-block;width:100%}.hljs-railscasts .hljs-selector-class{color:#9b703f}.hljs-railscasts .hljs-selector-id{color:#8b98ab}.hljs-railscasts .hljs-emphasis{font-style:italic}.hljs-railscasts .hljs-strong{font-weight:bold}.hljs-railscasts .hljs-link{text-decoration:underline}.hljs-rainbow .hljs{display:block;overflow-x:auto;padding:.5em;background:#474949;color:#d1d9e1}.hljs-rainbow .hljs-comment,.hljs-rainbow .hljs-quote{color:#969896;font-style:italic}.hljs-rainbow .hljs-keyword,.hljs-rainbow .hljs-selector-tag,.hljs-rainbow .hljs-literal,.hljs-rainbow .hljs-type,.hljs-rainbow .hljs-addition{color:#cc99cc}.hljs-rainbow .hljs-number,.hljs-rainbow .hljs-selector-attr,.hljs-rainbow .hljs-selector-pseudo{color:#f99157}.hljs-rainbow .hljs-string,.hljs-rainbow .hljs-doctag,.hljs-rainbow .hljs-regexp{color:#8abeb7}.hljs-rainbow .hljs-title,.hljs-rainbow .hljs-name,.hljs-rainbow .hljs-section,.hljs-rainbow .hljs-built_in{color:#b5bd68}.hljs-rainbow .hljs-variable,.hljs-rainbow .hljs-template-variable,.hljs-rainbow .hljs-selector-id,.hljs-rainbow .hljs-class .hljs-title{color:#ffcc66}.hljs-rainbow .hljs-section,.hljs-rainbow .hljs-name,.hljs-rainbow .hljs-strong{font-weight:bold}.hljs-rainbow .hljs-symbol,.hljs-rainbow .hljs-bullet,.hljs-rainbow .hljs-subst,.hljs-rainbow .hljs-meta,.hljs-rainbow .hljs-link{color:#f99157}.hljs-rainbow .hljs-deletion{color:#dc322f}.hljs-rainbow .hljs-formula{background:#eee8d5}.hljs-rainbow .hljs-attr,.hljs-rainbow .hljs-attribute{color:#81a2be}.hljs-rainbow .hljs-emphasis{font-style:italic}.hljs-school-book .hljs{display:block;overflow-x:auto;padding:15px .5em .5em 30px;font-size:11px;line-height:16px}.hljs-school-book pre{background:#f6f6ae url(school-book.png);border-top:solid 2px #d2e8b9;border-bottom:solid 1px #d2e8b9}.hljs-school-book .hljs-keyword,.hljs-school-book .hljs-selector-tag,.hljs-school-book .hljs-literal{color:#005599;font-weight:bold}.hljs-school-book .hljs,.hljs-school-book .hljs-subst{color:#3e5915}.hljs-school-book .hljs-string,.hljs-school-book .hljs-title,.hljs-school-book .hljs-section,.hljs-school-book .hljs-type,.hljs-school-book .hljs-symbol,.hljs-school-book .hljs-bullet,.hljs-school-book .hljs-attribute,.hljs-school-book .hljs-built_in,.hljs-school-book .hljs-builtin-name,.hljs-school-book .hljs-addition,.hljs-school-book .hljs-variable,.hljs-school-book .hljs-template-tag,.hljs-school-book .hljs-template-variable,.hljs-school-book .hljs-link{color:#2c009f}.hljs-school-book .hljs-comment,.hljs-school-book .hljs-quote,.hljs-school-book .hljs-deletion,.hljs-school-book .hljs-meta{color:#e60415}.hljs-school-book .hljs-keyword,.hljs-school-book .hljs-selector-tag,.hljs-school-book .hljs-literal,.hljs-school-book .hljs-doctag,.hljs-school-book .hljs-title,.hljs-school-book .hljs-section,.hljs-school-book .hljs-type,.hljs-school-book .hljs-name,.hljs-school-book .hljs-selector-id,.hljs-school-book .hljs-strong{font-weight:bold}.hljs-school-book .hljs-emphasis{font-style:italic}.hljs-solarized-dark .hljs{display:block;overflow-x:auto;padding:.5em;background:#002b36;color:#839496}.hljs-solarized-dark .hljs-comment,.hljs-solarized-dark .hljs-quote{color:#586e75}.hljs-solarized-dark .hljs-keyword,.hljs-solarized-dark .hljs-selector-tag,.hljs-solarized-dark .hljs-addition{color:#859900}.hljs-solarized-dark .hljs-number,.hljs-solarized-dark .hljs-string,.hljs-solarized-dark .hljs-meta .hljs-meta-string,.hljs-solarized-dark .hljs-literal,.hljs-solarized-dark .hljs-doctag,.hljs-solarized-dark .hljs-regexp{color:#2aa198}.hljs-solarized-dark .hljs-title,.hljs-solarized-dark .hljs-section,.hljs-solarized-dark .hljs-name,.hljs-solarized-dark .hljs-selector-id,.hljs-solarized-dark .hljs-selector-class{color:#268bd2}.hljs-solarized-dark .hljs-attribute,.hljs-solarized-dark .hljs-attr,.hljs-solarized-dark .hljs-variable,.hljs-solarized-dark .hljs-template-variable,.hljs-solarized-dark .hljs-class .hljs-title,.hljs-solarized-dark .hljs-type{color:#b58900}.hljs-solarized-dark .hljs-symbol,.hljs-solarized-dark .hljs-bullet,.hljs-solarized-dark .hljs-subst,.hljs-solarized-dark .hljs-meta,.hljs-solarized-dark .hljs-meta .hljs-keyword,.hljs-solarized-dark .hljs-selector-attr,.hljs-solarized-dark .hljs-selector-pseudo,.hljs-solarized-dark .hljs-link{color:#cb4b16}.hljs-solarized-dark .hljs-built_in,.hljs-solarized-dark .hljs-deletion{color:#dc322f}.hljs-solarized-dark .hljs-formula{background:#073642}.hljs-solarized-dark .hljs-emphasis{font-style:italic}.hljs-solarized-dark .hljs-strong{font-weight:bold}.hljs-solarized-light .hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83}.hljs-solarized-light .hljs-comment,.hljs-solarized-light .hljs-quote{color:#93a1a1}.hljs-solarized-light .hljs-keyword,.hljs-solarized-light .hljs-selector-tag,.hljs-solarized-light .hljs-addition{color:#859900}.hljs-solarized-light .hljs-number,.hljs-solarized-light .hljs-string,.hljs-solarized-light .hljs-meta .hljs-meta-string,.hljs-solarized-light .hljs-literal,.hljs-solarized-light .hljs-doctag,.hljs-solarized-light .hljs-regexp{color:#2aa198}.hljs-solarized-light .hljs-title,.hljs-solarized-light .hljs-section,.hljs-solarized-light .hljs-name,.hljs-solarized-light .hljs-selector-id,.hljs-solarized-light .hljs-selector-class{color:#268bd2}.hljs-solarized-light .hljs-attribute,.hljs-solarized-light .hljs-attr,.hljs-solarized-light .hljs-variable,.hljs-solarized-light .hljs-template-variable,.hljs-solarized-light .hljs-class .hljs-title,.hljs-solarized-light .hljs-type{color:#b58900}.hljs-solarized-light .hljs-symbol,.hljs-solarized-light .hljs-bullet,.hljs-solarized-light .hljs-subst,.hljs-solarized-light .hljs-meta,.hljs-solarized-light .hljs-meta .hljs-keyword,.hljs-solarized-light .hljs-selector-attr,.hljs-solarized-light .hljs-selector-pseudo,.hljs-solarized-light .hljs-link{color:#cb4b16}.hljs-solarized-light .hljs-built_in,.hljs-solarized-light .hljs-deletion{color:#dc322f}.hljs-solarized-light .hljs-formula{background:#eee8d5}.hljs-solarized-light .hljs-emphasis{font-style:italic}.hljs-solarized-light .hljs-strong{font-weight:bold}.hljs-sunburst .hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}.hljs-sunburst .hljs-comment,.hljs-sunburst .hljs-quote{color:#aeaeae;font-style:italic}.hljs-sunburst .hljs-keyword,.hljs-sunburst .hljs-selector-tag,.hljs-sunburst .hljs-type{color:#e28964}.hljs-sunburst .hljs-string{color:#65b042}.hljs-sunburst .hljs-subst{color:#daefa3}.hljs-sunburst .hljs-regexp,.hljs-sunburst .hljs-link{color:#e9c062}.hljs-sunburst .hljs-title,.hljs-sunburst .hljs-section,.hljs-sunburst .hljs-tag,.hljs-sunburst .hljs-name{color:#89bdff}.hljs-sunburst .hljs-class .hljs-title,.hljs-sunburst .hljs-doctag{text-decoration:underline}.hljs-sunburst .hljs-symbol,.hljs-sunburst .hljs-bullet,.hljs-sunburst .hljs-number{color:#3387cc}.hljs-sunburst .hljs-params,.hljs-sunburst .hljs-variable,.hljs-sunburst .hljs-template-variable{color:#3e87e3}.hljs-sunburst .hljs-attribute{color:#cda869}.hljs-sunburst .hljs-meta{color:#8996a8}.hljs-sunburst .hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}.hljs-sunburst .hljs-addition{background-color:#253b22;color:#f8f8f8}.hljs-sunburst .hljs-deletion{background-color:#420e09;color:#f8f8f8}.hljs-sunburst .hljs-selector-class{color:#9b703f}.hljs-sunburst .hljs-selector-id{color:#8b98ab}.hljs-sunburst .hljs-emphasis{font-style:italic}.hljs-sunburst .hljs-strong{font-weight:bold}.hljs-tomorrow-night-blue .hljs-comment,.hljs-tomorrow-night-blue .hljs-quote{color:#7285b7}.hljs-tomorrow-night-blue .hljs-variable,.hljs-tomorrow-night-blue .hljs-template-variable,.hljs-tomorrow-night-blue .hljs-tag,.hljs-tomorrow-night-blue .hljs-name,.hljs-tomorrow-night-blue .hljs-selector-id,.hljs-tomorrow-night-blue .hljs-selector-class,.hljs-tomorrow-night-blue .hljs-regexp,.hljs-tomorrow-night-blue .hljs-deletion{color:#ff9da4}.hljs-tomorrow-night-blue .hljs-number,.hljs-tomorrow-night-blue .hljs-built_in,.hljs-tomorrow-night-blue .hljs-builtin-name,.hljs-tomorrow-night-blue .hljs-literal,.hljs-tomorrow-night-blue .hljs-type,.hljs-tomorrow-night-blue .hljs-params,.hljs-tomorrow-night-blue .hljs-meta,.hljs-tomorrow-night-blue .hljs-link{color:#ffc58f}.hljs-tomorrow-night-blue .hljs-attribute{color:#ffeead}.hljs-tomorrow-night-blue .hljs-string,.hljs-tomorrow-night-blue .hljs-symbol,.hljs-tomorrow-night-blue .hljs-bullet,.hljs-tomorrow-night-blue .hljs-addition{color:#d1f1a9}.hljs-tomorrow-night-blue .hljs-title,.hljs-tomorrow-night-blue .hljs-section{color:#bbdaff}.hljs-tomorrow-night-blue .hljs-keyword,.hljs-tomorrow-night-blue .hljs-selector-tag{color:#ebbbff}.hljs-tomorrow-night-blue .hljs{display:block;overflow-x:auto;background:#002451;color:white;padding:.5em}.hljs-tomorrow-night-blue .hljs-emphasis{font-style:italic}.hljs-tomorrow-night-blue .hljs-strong{font-weight:bold}.hljs-tomorrow-night-bright .hljs-comment,.hljs-tomorrow-night-bright .hljs-quote{color:#969896}.hljs-tomorrow-night-bright .hljs-variable,.hljs-tomorrow-night-bright .hljs-template-variable,.hljs-tomorrow-night-bright .hljs-tag,.hljs-tomorrow-night-bright .hljs-name,.hljs-tomorrow-night-bright .hljs-selector-id,.hljs-tomorrow-night-bright .hljs-selector-class,.hljs-tomorrow-night-bright .hljs-regexp,.hljs-tomorrow-night-bright .hljs-deletion{color:#d54e53}.hljs-tomorrow-night-bright .hljs-number,.hljs-tomorrow-night-bright .hljs-built_in,.hljs-tomorrow-night-bright .hljs-builtin-name,.hljs-tomorrow-night-bright .hljs-literal,.hljs-tomorrow-night-bright .hljs-type,.hljs-tomorrow-night-bright .hljs-params,.hljs-tomorrow-night-bright .hljs-meta,.hljs-tomorrow-night-bright .hljs-link{color:#e78c45}.hljs-tomorrow-night-bright .hljs-attribute{color:#e7c547}.hljs-tomorrow-night-bright .hljs-string,.hljs-tomorrow-night-bright .hljs-symbol,.hljs-tomorrow-night-bright .hljs-bullet,.hljs-tomorrow-night-bright .hljs-addition{color:#b9ca4a}.hljs-tomorrow-night-bright .hljs-title,.hljs-tomorrow-night-bright .hljs-section{color:#7aa6da}.hljs-tomorrow-night-bright .hljs-keyword,.hljs-tomorrow-night-bright .hljs-selector-tag{color:#c397d8}.hljs-tomorrow-night-bright .hljs{display:block;overflow-x:auto;background:black;color:#eaeaea;padding:.5em}.hljs-tomorrow-night-bright .hljs-emphasis{font-style:italic}.hljs-tomorrow-night-bright .hljs-strong{font-weight:bold}.hljs-tomorrow-night-eighties .hljs-comment,.hljs-tomorrow-night-eighties .hljs-quote{color:#999999}.hljs-tomorrow-night-eighties .hljs-variable,.hljs-tomorrow-night-eighties .hljs-template-variable,.hljs-tomorrow-night-eighties .hljs-tag,.hljs-tomorrow-night-eighties .hljs-name,.hljs-tomorrow-night-eighties .hljs-selector-id,.hljs-tomorrow-night-eighties .hljs-selector-class,.hljs-tomorrow-night-eighties .hljs-regexp,.hljs-tomorrow-night-eighties .hljs-deletion{color:#f2777a}.hljs-tomorrow-night-eighties .hljs-number,.hljs-tomorrow-night-eighties .hljs-built_in,.hljs-tomorrow-night-eighties .hljs-builtin-name,.hljs-tomorrow-night-eighties .hljs-literal,.hljs-tomorrow-night-eighties .hljs-type,.hljs-tomorrow-night-eighties .hljs-params,.hljs-tomorrow-night-eighties .hljs-meta,.hljs-tomorrow-night-eighties .hljs-link{color:#f99157}.hljs-tomorrow-night-eighties .hljs-attribute{color:#ffcc66}.hljs-tomorrow-night-eighties .hljs-string,.hljs-tomorrow-night-eighties .hljs-symbol,.hljs-tomorrow-night-eighties .hljs-bullet,.hljs-tomorrow-night-eighties .hljs-addition{color:#99cc99}.hljs-tomorrow-night-eighties .hljs-title,.hljs-tomorrow-night-eighties .hljs-section{color:#6699cc}.hljs-tomorrow-night-eighties .hljs-keyword,.hljs-tomorrow-night-eighties .hljs-selector-tag{color:#cc99cc}.hljs-tomorrow-night-eighties .hljs{display:block;overflow-x:auto;background:#2d2d2d;color:#cccccc;padding:.5em}.hljs-tomorrow-night-eighties .hljs-emphasis{font-style:italic}.hljs-tomorrow-night-eighties .hljs-strong{font-weight:bold}.hljs-tomorrow-night .hljs-comment,.hljs-tomorrow-night .hljs-quote{color:#969896}.hljs-tomorrow-night .hljs-variable,.hljs-tomorrow-night .hljs-template-variable,.hljs-tomorrow-night .hljs-tag,.hljs-tomorrow-night .hljs-name,.hljs-tomorrow-night .hljs-selector-id,.hljs-tomorrow-night .hljs-selector-class,.hljs-tomorrow-night .hljs-regexp,.hljs-tomorrow-night .hljs-deletion{color:#cc6666}.hljs-tomorrow-night .hljs-number,.hljs-tomorrow-night .hljs-built_in,.hljs-tomorrow-night .hljs-builtin-name,.hljs-tomorrow-night .hljs-literal,.hljs-tomorrow-night .hljs-type,.hljs-tomorrow-night .hljs-params,.hljs-tomorrow-night .hljs-meta,.hljs-tomorrow-night .hljs-link{color:#de935f}.hljs-tomorrow-night .hljs-attribute{color:#f0c674}.hljs-tomorrow-night .hljs-string,.hljs-tomorrow-night .hljs-symbol,.hljs-tomorrow-night .hljs-bullet,.hljs-tomorrow-night .hljs-addition{color:#b5bd68}.hljs-tomorrow-night .hljs-title,.hljs-tomorrow-night .hljs-section{color:#81a2be}.hljs-tomorrow-night .hljs-keyword,.hljs-tomorrow-night .hljs-selector-tag{color:#b294bb}.hljs-tomorrow-night .hljs{display:block;overflow-x:auto;background:#1d1f21;color:#c5c8c6;padding:.5em}.hljs-tomorrow-night .hljs-emphasis{font-style:italic}.hljs-tomorrow-night .hljs-strong{font-weight:bold}.hljs-tomorrow .hljs-comment,.hljs-tomorrow .hljs-quote{color:#8e908c}.hljs-tomorrow .hljs-variable,.hljs-tomorrow .hljs-template-variable,.hljs-tomorrow .hljs-tag,.hljs-tomorrow .hljs-name,.hljs-tomorrow .hljs-selector-id,.hljs-tomorrow .hljs-selector-class,.hljs-tomorrow .hljs-regexp,.hljs-tomorrow .hljs-deletion{color:#c82829}.hljs-tomorrow .hljs-number,.hljs-tomorrow .hljs-built_in,.hljs-tomorrow .hljs-builtin-name,.hljs-tomorrow .hljs-literal,.hljs-tomorrow .hljs-type,.hljs-tomorrow .hljs-params,.hljs-tomorrow .hljs-meta,.hljs-tomorrow .hljs-link{color:#f5871f}.hljs-tomorrow .hljs-attribute{color:#eab700}.hljs-tomorrow .hljs-string,.hljs-tomorrow .hljs-symbol,.hljs-tomorrow .hljs-bullet,.hljs-tomorrow .hljs-addition{color:#718c00}.hljs-tomorrow .hljs-title,.hljs-tomorrow .hljs-section{color:#4271ae}.hljs-tomorrow .hljs-keyword,.hljs-tomorrow .hljs-selector-tag{color:#8959a8}.hljs-tomorrow .hljs{display:block;overflow-x:auto;background:white;color:#4d4d4c;padding:.5em}.hljs-tomorrow .hljs-emphasis{font-style:italic}.hljs-tomorrow .hljs-strong{font-weight:bold}.hljs-vs .hljs{display:block;overflow-x:auto;padding:.5em;background:white;color:black}.hljs-vs .hljs-comment,.hljs-vs .hljs-quote,.hljs-vs .hljs-variable{color:#008000}.hljs-vs .hljs-keyword,.hljs-vs .hljs-selector-tag,.hljs-vs .hljs-built_in,.hljs-vs .hljs-name,.hljs-vs .hljs-tag{color:#00f}.hljs-vs .hljs-string,.hljs-vs .hljs-title,.hljs-vs .hljs-section,.hljs-vs .hljs-attribute,.hljs-vs .hljs-literal,.hljs-vs .hljs-template-tag,.hljs-vs .hljs-template-variable,.hljs-vs .hljs-type,.hljs-vs .hljs-addition{color:#a31515}.hljs-vs .hljs-deletion,.hljs-vs .hljs-selector-attr,.hljs-vs .hljs-selector-pseudo,.hljs-vs .hljs-meta{color:#2b91af}.hljs-vs .hljs-doctag{color:#808080}.hljs-vs .hljs-attr{color:#f00}.hljs-vs .hljs-symbol,.hljs-vs .hljs-bullet,.hljs-vs .hljs-link{color:#00b0e8}.hljs-vs .hljs-emphasis{font-style:italic}.hljs-vs .hljs-strong{font-weight:bold}.hljs-xcode .hljs{display:block;overflow-x:auto;padding:.5em;background:#fff;color:black}.hljs-xcode .hljs-comment,.hljs-xcode .hljs-quote{color:#006a00}.hljs-xcode .hljs-keyword,.hljs-xcode .hljs-selector-tag,.hljs-xcode .hljs-literal{color:#aa0d91}.hljs-xcode .hljs-name{color:#008}.hljs-xcode .hljs-variable,.hljs-xcode .hljs-template-variable{color:#660}.hljs-xcode .hljs-string{color:#c41a16}.hljs-xcode .hljs-regexp,.hljs-xcode .hljs-link{color:#080}.hljs-xcode .hljs-title,.hljs-xcode .hljs-tag,.hljs-xcode .hljs-symbol,.hljs-xcode .hljs-bullet,.hljs-xcode .hljs-number,.hljs-xcode .hljs-meta{color:#1c00cf}.hljs-xcode .hljs-section,.hljs-xcode .hljs-class .hljs-title,.hljs-xcode .hljs-type,.hljs-xcode .hljs-attr,.hljs-xcode .hljs-built_in,.hljs-xcode .hljs-builtin-name,.hljs-xcode .hljs-params{color:#5c2699}.hljs-xcode .hljs-attribute,.hljs-xcode .hljs-subst{color:#000}.hljs-xcode .hljs-formula{background-color:#eee;font-style:italic}.hljs-xcode .hljs-addition{background-color:#baeeba}.hljs-xcode .hljs-deletion{background-color:#ffc8bd}.hljs-xcode .hljs-selector-id,.hljs-xcode .hljs-selector-class{color:#9b703f}.hljs-xcode .hljs-doctag,.hljs-xcode .hljs-strong{font-weight:bold}.hljs-xcode .hljs-emphasis{font-style:italic}.hljs-xt256 .hljs{display:block;overflow-x:auto;color:#eaeaea;background:#000;padding:.5}.hljs-xt256 .hljs-subst{color:#eaeaea}.hljs-xt256 .hljs-emphasis{font-style:italic}.hljs-xt256 .hljs-strong{font-weight:bold}.hljs-xt256 .hljs-builtin-name,.hljs-xt256 .hljs-type{color:#eaeaea}.hljs-xt256 .hljs-params{color:#da0000}.hljs-xt256 .hljs-literal,.hljs-xt256 .hljs-number,.hljs-xt256 .hljs-name{color:#ff0000;font-weight:bolder}.hljs-xt256 .hljs-comment{color:#969896}.hljs-xt256 .hljs-selector-id,.hljs-xt256 .hljs-quote{color:#00ffff}.hljs-xt256 .hljs-template-variable,.hljs-xt256 .hljs-variable,.hljs-xt256 .hljs-title{color:#00ffff;font-weight:bold}.hljs-xt256 .hljs-selector-class,.hljs-xt256 .hljs-keyword,.hljs-xt256 .hljs-symbol{color:#fff000}.hljs-xt256 .hljs-string,.hljs-xt256 .hljs-bullet{color:#00ff00}.hljs-xt256 .hljs-tag,.hljs-xt256 .hljs-section{color:#000fff}.hljs-xt256 .hljs-selector-tag{color:#000fff;font-weight:bold}.hljs-xt256 .hljs-attribute,.hljs-xt256 .hljs-built_in,.hljs-xt256 .hljs-regexp,.hljs-xt256 .hljs-link{color:#ff00ff}.hljs-xt256 .hljs-meta{color:#fff;font-weight:bolder}.hljs-zenburn .hljs{display:block;overflow-x:auto;padding:.5em;background:#3f3f3f;color:#dcdcdc}.hljs-zenburn .hljs-keyword,.hljs-zenburn .hljs-selector-tag,.hljs-zenburn .hljs-tag{color:#e3ceab}.hljs-zenburn .hljs-template-tag{color:#dcdcdc}.hljs-zenburn .hljs-number{color:#8cd0d3}.hljs-zenburn .hljs-variable,.hljs-zenburn .hljs-template-variable,.hljs-zenburn .hljs-attribute{color:#efdcbc}.hljs-zenburn .hljs-literal{color:#efefaf}.hljs-zenburn .hljs-subst{color:#8f8f8f}.hljs-zenburn .hljs-title,.hljs-zenburn .hljs-name,.hljs-zenburn .hljs-selector-id,.hljs-zenburn .hljs-selector-class,.hljs-zenburn .hljs-section,.hljs-zenburn .hljs-type{color:#efef8f}.hljs-zenburn .hljs-symbol,.hljs-zenburn .hljs-bullet,.hljs-zenburn .hljs-link{color:#dca3a3}.hljs-zenburn .hljs-deletion,.hljs-zenburn .hljs-string,.hljs-zenburn .hljs-built_in,.hljs-zenburn .hljs-builtin-name{color:#cc9393}.hljs-zenburn .hljs-addition,.hljs-zenburn .hljs-comment,.hljs-zenburn .hljs-quote,.hljs-zenburn .hljs-meta{color:#7f9f7f}.hljs-zenburn .hljs-emphasis{font-style:italic}.hljs-zenburn .hljs-strong{font-weight:bold}</style>
    
    <meta name="keywords" content="remark,remarkjs,markdown,slideshow,presentation">
    <meta name="description" content="A simple, in-browser, markdown-driven slideshow tool.">
    <title>Remark</title>
    <style>
      /* modified to point to our local separate files */
      @import url("common/fonts.css");
      @import url("common/style.css"); 
    </style>
  </head>

  <body class="remark-container">

<textarea id="source" style="display: none;">class: center, middle

# Big Data Technologies

## Master Mathematics and Informatics

.medium[Stphane Gaffas - Stphane Boucheron]

.center[
    &lt;img src="figs/lpsm.png" style="height: 160px;" /&gt;
    &lt;img src="" style="width: 30px;" /&gt;
    &lt;img src="figs/paris-diderot.png" style="height: 90px;" /&gt;
    &lt;img src="" style="width: 30px;" /&gt;
    &lt;img src="figs/uparis.png" style="height: 120px;" /&gt;
]

---

layout: true
class: top

---

class: center, middle, inverse

# 3. `spark.sql`

---

# Overview

- `Spark SQL` is a library included in `Spark` since version 1.3

- It provides an .stress[easier interface to process tabular data]

- Instead of `RDD`s, we deal with `DataFrame`s

- Since `Spark` 1.6, there is also the concept of `Dataset`s, but only for `Scala` and `Java`

---

# `SparkContext` and `SparkSession`

- Before `Spark 2`, there was only `SparkContext` and `SQLContext`

- All core functionality was accessed with `SparkContext`

- All `SQL` functionality needed the `SQLContext`, which can be created from an `SparkContext`

- Since `Spark 2`, there is now the `SparkSession` class

- `SparkSession` is now the .stress[global entry-point] for everything `Spark`-related


---

# `SparkContext` and `SparkSession`

Before `Spark 2`
```python
&gt;&gt;&gt; from pyspark import SparkConf, SparkContext
&gt;&gt;&gt; from pyspark.sql import SQLContext

&gt;&gt;&gt; conf = SparkConf().setAppName(appName).setMaster(master)
&gt;&gt;&gt; sc = SparkContext(conf = conf)
&gt;&gt;&gt; sql_context = new SQLContext(sc)
```

Since `Spark 2`
```python
&gt;&gt;&gt; from pyspark.sql import SparkSession

&gt;&gt;&gt; spark = SparkSession \
        .builder \
        .appName(appName) \
        .master(master) \
        .config("spark.some.config.option", "some-value") \
        .getOrCreate()
```

---

class: center, middle, inverse

# 3.1. `DataFrame`

---

# `DataFrame`

- The main entity of `Spark SQL` is the `DataFrame`

- A DataFrame is actually an `RDD` of `Row`s with a .stress[schema]

- A schema gives the **names of the columns** and their **types**

- `Row` is a class representing a row of the `DataFrame`.

- It can be used almost as a `python` `list`, with its size equal to the number of columns in the schema.

---

# `DataFrame`

```python
&gt;&gt;&gt; from pyspark.sql import Row

&gt;&gt;&gt; row1 = Row(name="John", age=21)
&gt;&gt;&gt; row2 = Row(name="James", age=32)
&gt;&gt;&gt; row3 = Row(name="Jane", age=18)
&gt;&gt;&gt; row1['name']
'John'
```

```python
&gt;&gt;&gt; df = spark.createDataFrame([row1, row2, row3])
&gt;&gt;&gt; df
DataFrame[age: bigint, name: string]
```

```python
&gt;&gt;&gt; df.show()
+-----+---+
| name|age|
+-----+---+
| John| 21|
|James| 32|
| Jane| 18|
+-----+---+
```

---

# `DataFrame`

```python
&gt;&gt;&gt; df.printSchema()
root
 |-- age: long (nullable = true)
 |-- name: string (nullable = true)

```

You can ccess to the underlying `RDD` object using `.rdd`

```python
&gt;&gt;&gt; print(df.rdd.toDebugString().decode("utf-8"))
(6) MapPartitionsRDD[16] at javaToPython at NativeMethodAccessorImpl.java:0 []
 |  MapPartitionsRDD[15] at javaToPython at NativeMethodAccessorImpl.java:0 []
 |  MapPartitionsRDD[14] at javaToPython at NativeMethodAccessorImpl.java:0 []
 |  MapPartitionsRDD[13] at applySchemaToPythonRDD at NativeMethodAccessorImpl.java:0 []
 |  MapPartitionsRDD[12] at map at SerDeUtil.scala:137 []
 |  MapPartitionsRDD[11] at mapPartitions at SerDeUtil.scala:184 []
 |  PythonRDD[10] at RDD at PythonRDD.scala:53 []
 |  ParallelCollectionRDD[9] at parallelize at PythonRDD.scala:195 []
```

```python
&gt;&gt;&gt; df.rdd.getNumPartitions()
6
```

---

# Creating DataFrames

- We can use the method `createDataFrame` from the SparkSession instance

- Can be used to create a `Spark` `DataFrame` from:

  - a `pandas.DataFrame` object

  - a local python list

  - an RDD

- Full documentation can be found in the [[API docs]](http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.SparkSession.createDataFrame)

---

# Creating DataFrames

```python
&gt;&gt;&gt; rows = [
        Row(name="John", age=21, gender="male"),
        Row(name="James", age=25, gender="female"),
        Row(name="Albert", age=46, gender="male")
    ]
&gt;&gt;&gt; df = spark.createDataFrame(rows)
&gt;&gt;&gt; df.show()
+---+------+------+
|age|gender|  name|
+---+------+------+
| 21|  male|  John|
| 25|female| James|
| 46|  male|Albert|
+---+------+------+
```

---

# Creating DataFrames

```python
&gt;&gt;&gt; column_names = ["name", "age", "gender"]
&gt;&gt;&gt; rows = [
        ["John", 21, "male"],
        ["James", 25, "female"],
        ["Albert", 46, "male"]
    ]
&gt;&gt;&gt; df = spark.createDataFrame(rows, column_names)
&gt;&gt;&gt; df.show()
+------+---+------+
|  name|age|gender|
+------+---+------+
|  John| 21|  male|
| James| 25|female|
|Albert| 46|  male|
+------+---+------+
```

---

# Creating DataFrames

```python
&gt;&gt;&gt; column_names = ["name", "age", "gender"]
&gt;&gt;&gt; rdd = sc.parallelize([
        ("John", 21, "male"),
        ("James", 25, "female"),
        ("Albert", 46, "male")
    ])
&gt;&gt;&gt; df = spark.createDataFrame(rdd, column_names)
&gt;&gt;&gt; df.show()
+------+---+------+
|  name|age|gender|
+------+---+------+
|  John| 21|  male|
| James| 25|female|
|Albert| 46|  male|
+------+---+------+
```

---

class: center, middle, inverse

# 3.2. Schemas and types

---

# Schema and Types

- A `DataFrame` always contains a .stress[schema]

- The schema defines the **column names** and **types**

- In all previous examples, the schema was .stress[inferred]

- The schema of a `DataFrame` is represented by the class `types.StructType` [[API doc]](http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.types.StructType)

- When creating a `DataFrame`, the schema can be either **inferred** or **defined by the user**

```python
&gt;&gt;&gt; df.schema
StructType(List(StructField(name,StringType,true),StructField(age,IntegerType,true),StructField(gender,StringType,true)))
```

---

# Creating a custom Schema

```python
&gt;&gt;&gt; from pyspark.sql.types import *

&gt;&gt;&gt; schema = StructType([
        StructField("name", StringType(), True),
        StructField("age", IntegerType(), True),
        StructField("gender", StringType(), True)
    ])
&gt;&gt;&gt; rows = [("John", 21, "male")]
&gt;&gt;&gt; df = spark.createDataFrame(rows, schema)
&gt;&gt;&gt; df.printSchema()
&gt;&gt;&gt; df.show()
root
|-- name: string (nullable = true)
|-- age: integer (nullable = true)
|-- gender: string (nullable = true)

+----+---+------+
|name|age|gender|
+----+---+------+
|John| 21|  male|
+----+---+------+
```

---

# Types supported by `Spark SQL`

- `StringType`
- `IntegerType`
- `LongType`
- `FloatType`
- `DoubleType`
- `BooleanType`
- `DateType`
- `TimestampType`
- `...`
- The full list of types can be found in [[API doc]](https://spark.apache.org/docs/latest/api/python/pyspark.sql.html#module-pyspark.sql.types)

---

class: center, middle, inverse

# 3.3. Reading data

---

# Reading data from sources

- Data is usually read from .stress[external sources]&lt;br&gt;
(move the **algorithms**, not the **data**)

- `Spark SQL` provides .stress[connectors] to read from many different sources:

  - Text files (`CSV`, `JSON`)

  - Distributed tabular files (`Parquet`, `ORC`)

  - In-memory data sources (`Apache Arrow`)

  - General relational Databases (via `JDBC`)

  - Third-party connectors to connect to many other databases

  - And you can create your own connector for `Spark` (in `Scala`)

---

# Reading data from sources

- In all cases, the syntax is similar: &lt;br&gt; `spark.read.{source}(path)`

- Spark supports different .stress[file systems] to look for the data:

  - Local files: `"file://path/to/file"` or just `"path/to/file"`

  - `HDFS` (Hadoop filesystem): `"hdfs://path/to/file"`

  - `Amazon S3`: `"s3://path/to/file"`

---

# Reading from a `CSV` file

```python
&gt;&gt;&gt; df = spark.read.csv("/path/to/file.csv")
```

```python
&gt;&gt;&gt; path = "/path/to/file.csv"
&gt;&gt;&gt; df = spark.read.option("header", "true").csv(path)
```

```python
&gt;&gt;&gt; df = (spark.read
        .format('csv')
        .option('header', 'true')
        .option('sep', ";")
        .load("/path/to/file.csv")
    )
```

```python
&gt;&gt;&gt; df = spark.read.csv(path, sep=";", header=True)
```

---

# Reading from a `CSV` file  

## Main Options

Some important options of the `CSV` reader are listed here:

.pure-table.pure-table-striped[
| option | description |
| :- | :- |
| `sep` | The separator character |
| `header` | If "true", the first line contains the column names |
| `inferSchema` | If "true", the column types will be guessed from the contents |
| `dateFormat` | A string representing the format of the date columns |
]

The full list of options can be found in the [API Docs](http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.DataFrameReader.csv)

---

# Reading from other file types

```python
# JSON file
&gt;&gt;&gt; df = spark.read.json("/path/to/file.json")
&gt;&gt;&gt; df = spark.read.format("json").load("/path/to/file.json")
```

```python
# Parquet file (distributed tabular data)
&gt;&gt;&gt; df = spark.read.parquet("hdfs://path/to/file.parquet")
&gt;&gt;&gt; df = spark.read.format("parquet").load("hdfs://path/to/file.parquet")
```

```python
# ORC file (distributed tabular data)
&gt;&gt;&gt; df = spark.read.orc("hdfs://path/to/file.orc")
&gt;&gt;&gt; df = spark.read.format("orc").load("hdfs://path/to/file.orc")
```

---

# Reading from external databases

- We can use `JDBC` drivers (Java) to read from relational databases

- Examples of databases: `Oracle`, `PostgreSQL`, `MySQL`, etc.

- The `java` driver file must be uploaded to the cluster before trying to access

- This operation can be **very heavy**. When available, specific connectors should be used

- Specific connectors are often provided by **third-party libraries**

---

# Reading from external databases

```python
&gt;&gt;&gt; df = spark.read.format("jdbc") \
        .option("url", "jdbc:postgresql:dbserver") \
        .option("dbtable", "schema.tablename") \
        .option("user", "username") \
        .option("password", "p4ssw0rd") \
        .load()
```
or
```python
&gt;&gt;&gt; df = spark.read.jdbc(
        url="jdbc:postgresql:dbserver",
        table="schema.tablename"
        properties={
            "user": "username",
            "password": "p4ssw0rd"
        }
    )
```

---

class: center, middle, inverse

# 3.4. Queries in `spark.sql`

---

# Performing queries

- `Spark SQL` was created to be compatible with SQL queries

- So it supports actual `SQL` queries to be performed on `DataFrame`s 

- First, the `DataFrame` must be .stress[tagged as a temporary view]

- Then, the queries can be applied using `spark.sql`

---

# Performing queries

```python
&gt;&gt;&gt; column_names = ["name", "age", "gender"]
&gt;&gt;&gt; rows = [
        ["John", 21, "male"],
        ["Jane", 25, "female"]
    ]
&gt;&gt;&gt; df = spark.createDataFrame(rows, column_names)

# Create a temporary view from the DataFrame
&gt;&gt;&gt; df.createOrReplaceTempView("new_view")

# Apply the query
&gt;&gt;&gt; query = "SELECT name, age FROM new_view WHERE gender='male'"
&gt;&gt;&gt; men_df = spark.sql(query)
&gt;&gt;&gt; men_df.show()
+----+---+
|name|age|
+----+---+
|John| 21|
+----+---+
```

---

# Using the API

- Although allowing `SQL` queries is a very powerful feature, it's .stress[not the best way] to code a complex logic

- Errors are **harder to find** in strings

- Using queries makes the code **less modularizable**

- So `Spark SQL` provides a .stress[full API] with **SQL-like operations**

- It's .stress[the best way] to code complex logic when using `Spark SQL`

---

# Basic Operations

.pure-table.pure-table-striped[
| operation | description |
| :- | :- |
| `select` | Chooses columns from the table |
| `where` | Filters rows based on a boolean rule |
| `limit` | Limits the number of rows |
| `orderBy` | Sorts the DataFrame based on one or more columns |
| `alias` | Changes the name of a column |
| `cast` | Changes the type of a column |
| `withColumn` | Adds a new column |
]

---

# `SELECT`

```python
# In a SQL query:
&gt;&gt;&gt; query = "SELECT name, age FROM table"

# Using Spark SQL API:
&gt;&gt;&gt; df.select("name", "age").show()
+-----+---+
| name|age|
+-----+---+
| John| 21|
| Jane| 25|
+-----+---+
```

---

# `WHERE`

```python
# In a SQL query:
&gt;&gt;&gt; query = "SELECT * FROM table WHERE age &gt; 21"

# Using Spark SQL API:
&gt;&gt;&gt; df.where("age &gt; 21").show()

# Alternatively:
&gt;&gt;&gt; df.where(df['age'] &gt; 21).show()
&gt;&gt;&gt; df.where(df.age &gt; 21).show()
&gt;&gt;&gt; df.select("*").where("age &gt; 21").show()
+----+---+------+
|name|age|gender|
+----+---+------+
|Jane| 25|female|
+----+---+------+
```

---

# `LIMIT`

```python
# In a SQL query:
&gt;&gt;&gt; query = "SELECT * FROM table LIMIT 1"

# Using Spark SQL API:
&gt;&gt;&gt; df.limit(1).show()

# Or even
&gt;&gt;&gt; df.select("*").limit(1).show()
+----+---+------+
|name|age|gender|
+----+---+------+
|Jane| 25|female|
+----+---+------+

# Note: The result is not deterministic!
```

---

# `ORDER BY`

```python
# In a SQL query:
&gt;&gt;&gt; query = "SELECT * FROM table ORDER BY name ASC"

# Using Spark SQL API:
&gt;&gt;&gt; df.orderBy(df.name.asc()).show()
+----+---+------+
|name|age|gender|
+----+---+------+
|Jane| 25|female|
|John| 21|  male|
+----+---+------+
```

---

# `ALIAS` (name change)

```python
# In a SQL query:
&gt;&gt;&gt; query = "SELECT name, age, gender AS sex FROM table"

# Using Spark SQL API:
&gt;&gt;&gt; df.select(df.name, df.age, df.gender.alias('sex')).show()
+----+---+------+
|name|age|   sex|
+----+---+------+
|John| 21|  male|
|Jane| 25|female|
+----+---+------+
```

---

# `CAST` (type change)

```python
# In a SQL query:
&gt;&gt;&gt; query = "SELECT name, cast(age AS float) AS age_f FROM table"

# Using Spark SQL API:
&gt;&gt;&gt; df.select(df.name, df.age.cast("float").alias("age_f")).show()

# Or
&gt;&gt;&gt; new_age_col = df.age.cast("float").alias("age_f")
&gt;&gt;&gt; df.select(df.name, new_age_col).show()
+----+-----+
|name|age_f|
+----+-----+
|John| 21.0|
|Jane| 25.0|
+----+-----+
```

---

# Adding new columns

```python
# In a SQL query:
&gt;&gt;&gt; query = "SELECT *, 12*age AS age_months FROM table"

# Using Spark SQL API:
&gt;&gt;&gt; df.withColumn("age_months", df.age * 12).show()

# Or
&gt;&gt;&gt; df.select("*", (df.age * 12).alias("age_months")).show()
+----+---+------+----------+
|name|age|gender|(age * 12)|
+----+---+------+----------+
|John| 21|  male|       252|
|Jane| 25|female|       300|
+----+---+------+----------+

# Note: Using withColumn is preferable
```

---

# Basic operations

- The .stress[full list of operations] that can be applied to a `DataFrame` can be found in the [[DataFrame doc]](http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.DataFrame)

- The .stress[list of operations on columns] can be found in the [[Column docs]](http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.Column)

---

class: center, middle, inverse

# 3.5. Column functions

---

# Column functions

- Oftentimes, we need to make many .stress[transformations using one or more functions]

- `Spark SQL` has a package called `functions` with many functions available for that

- Some of those functions are only for **aggregations** &lt;br&gt; Examples: `avg`, `sum`, etc. We will cover them later

- Some others are for **column transformation** or **operations** &lt;br&gt; Examples:  `substr`, `concat`, `datediff`, `floor`, etc.

- The full list is, once again, in the [[API docs]](http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#module-pyspark.sql.functions)

---

# Column functions

To use these functions, we first need to import them:

```python
&gt;&gt;&gt; from pyspark.sql import functions as fn
```

**Note**: the "`as fn`" part is important to **avoid confusion** with native `Python` functions such as "sum"

---

# Numeric functions examples

```python
&gt;&gt;&gt; from pyspark.sql import functions as fn

&gt;&gt;&gt; columns = ["brand", "cost"]
&gt;&gt;&gt; df = spark.createDataFrame([
        ("garnier", 3.49),
        ("elseve", 2.71)
        ], columns)

&gt;&gt;&gt; round_cost = fn.round(df.cost, 1)
&gt;&gt;&gt; floor_cost = fn.floor(df.cost)
&gt;&gt;&gt; ceil_cost = fn.ceil(df.cost)

&gt;&gt;&gt; df.withColumn('round', round_cost)\
        .withColumn('floor', floor_cost)\
        .withColumn('ceil', ceil_cost)\
        .show()
+-------+----+-----+-----+----+
|  brand|cost|round|floor|ceil|
+-------+----+-----+-----+----+
|garnier|3.49|  3.5|    3|   4|
| elseve|2.71|  2.7|    2|   3|
+-------+----+-----+-----+----+
```

---

# String functions examples

```python
&gt;&gt;&gt; from pyspark.sql import functions as fn

&gt;&gt;&gt; columns = ["first_name", "last_name"]

&gt;&gt;&gt; df = spark.createDataFrame([
        ("John", "Doe"),
        ("Mary", "Jane")
        ], columns)

&gt;&gt;&gt; last_name_initial = fn.substring(df.last_name, 0, 1)
&gt;&gt;&gt; name = fn.concat_ws(" ", df.first_name, last_name_initial)
&gt;&gt;&gt; df.withColumn("name", name).show()
+----------+---------+------+
|first_name|last_name|  name|
+----------+---------+------+
|      John|      Doe|John D|
|      Mary|     Jane|Mary J|
+----------+---------+------+
```

---

# Date functions examples

```python
&gt;&gt;&gt; from datetime import date
&gt;&gt;&gt; from pyspark.sql import functions as fn

&gt;&gt;&gt; df = spark.createDataFrame([
        (date(2015, 1, 1), date(2015, 1, 15)),
        (date(2015, 2, 21), date(2015, 3, 8)),
        ], ["start_date", "end_date"]
    )

&gt;&gt;&gt; days_between = fn.datediff(df.end_date, df.start_date)
&gt;&gt;&gt; start_month = fn.month(df.start_date)

&gt;&gt;&gt; df.withColumn('days_between', days_between)\
        .withColumn('start_month', start_month)\
        .show()
+----------+----------+------------+-----------+
|start_date|  end_date|days_between|start_month|
+----------+----------+------------+-----------+
|2015-01-01|2015-01-15|          14|          1|
|2015-02-21|2015-03-08|          15|          2|
+----------+----------+------------+-----------+
```

---

# Conditional transformations

- In the `functions` package is a .stress[special function] called `when`

- This function is used to .stress[create a new column] which value **depends on the value of other columns**

- `otherwise` is used to match "the rest"

- Combination between conditions can be done using `"&amp;"` for "and" and `"|"` for "or"


---

# Examples

```python
&gt;&gt;&gt; df = spark.createDataFrame([
        ("John", 21, "male"),
        ("Jane", 25, "female"),
        ("Albert", 46, "male"),
        ("Brad", 49, "super-hero")
    ], ["name", "age", "gender"])

&gt;&gt;&gt; supervisor = fn.when(df.gender == 'male', 'Mr. Smith')\
        .when(df.gender == 'female', 'Miss Jones')\
        .otherwise('NA')

&gt;&gt;&gt; df.withColumn("supervisor", supervisor).show()
+------+---+----------+----------+
|  name|age|    gender|supervisor|
+------+---+----------+----------+
|  John| 21|      male| Mr. Smith|
|  Jane| 25|    female|Miss Jones|
|Albert| 46|      male| Mr. Smith|
|  Brad| 49|super-hero|        NA|
+------+---+----------+----------+
```

---

# User-defined functions

- When you need a **transformation** that is **not available** in the `functions` package, you can create a .stress[User Defined Function] (UDF)

- **Warning**: the performance of this can be .stress[very very low]

- So, it should be used **only** when you are **sure** the operation .stress[cannot be done] with available functions

- To create an UDF, use `functions.udf`, passing a lambda or a named functions

- It is similar to the `map` operation of RDDs

---

# Example

```python
&gt;&gt;&gt; from pyspark.sql import functions as fn
&gt;&gt;&gt; from pyspark.sql.types import StringType

&gt;&gt;&gt; df = spark.createDataFrame([(1, 3), (4, 2)], ["first", "second"])

&gt;&gt;&gt; def my_func(col_1, col_2):
        if (col_1 &gt; col_2):
            return "{} is bigger than {}".format(col_1, col_2)
        else:
            return "{} is bigger than {}".format(col_2, col_1)

&gt;&gt;&gt; my_udf = fn.udf(my_func, StringType())

&gt;&gt;&gt; df.withColumn("udf", my_udf(df['first'], df['second'])).show()
+-----+------+------------------+
|first|second|               udf|
+-----+------+------------------+
|    1|     3|3 is bigger than 1|
|    4|     2|4 is bigger than 2|
+-----+------+------------------+
```

---

class: center, middle, inverse

# 3.6. Joins

---

# Performing joins

- `Spark SQL` supports .stress[joins] between two `DataFrame`

- As in normal `SQL`, a join **rule** must be defined

- The **rule** can either be a set of **join keys**, or a **conditional rule**

- Join with conditional rules in `Spark` can be .stress[very heavy]

- **Several types of joins** are available, default is `"inner"`

Syntax is simple:
```python
&gt;&gt;&gt; left_df.join(other=right_df, on=cols, how=join_type)
```
- `cols` contains a column name or a list of column names
- `join_type` is the type of join


---

# Examples

```python
&gt;&gt;&gt; from datetime import date

&gt;&gt;&gt; products = spark.createDataFrame([
        ('1', 'mouse', 'microsoft', 39.99),
        ('2', 'keyboard', 'logitech', 59.99),
    ], ['prod_id', 'prod_cat', 'prod_brand', 'prod_value'])

&gt;&gt;&gt; purchases = spark.createDataFrame([
        (date(2017, 11, 1), 2, '1'),
        (date(2017, 11, 2), 1, '1'),
        (date(2017, 11, 5), 1, '2'),
    ], ['date', 'quantity', 'prod_id'])

&gt;&gt;&gt; # The default join type is the "INNER" join
&gt;&gt;&gt; purchases.join(products, 'prod_id').show()
+-------+----------+--------+--------+----------+----------+
|prod_id|      date|quantity|prod_cat|prod_brand|prod_value|
+-------+----------+--------+--------+----------+----------+
|      1|2017-11-01|       2|   mouse| microsoft|     39.99|
|      1|2017-11-02|       1|   mouse| microsoft|     39.99|
|      2|2017-11-05|       1|keyboard|  logitech|     59.99|
+-------+----------+--------+--------+----------+----------+
```

---

# Examples

```python
&gt;&gt;&gt; # We can also use a query string (not recommended)
&gt;&gt;&gt; products.createOrReplaceTempView("products")
&gt;&gt;&gt; purchases.createOrReplaceTempView("purchases")

&gt;&gt;&gt; query = """SELECT * FROM
    (purchases AS prc INNER JOIN products AS prd 
    on prc.prod_id = prd.prod_id)
    """

&gt;&gt;&gt; spark.sql(query).show()
+----------+--------+-------+-------+--------+----------+----------+
|      date|quantity|prod_id|prod_id|prod_cat|prod_brand|prod_value|
+----------+--------+-------+-------+--------+----------+----------+
|2017-11-01|       2|      1|      1|   mouse| microsoft|     39.99|
|2017-11-02|       1|      1|      1|   mouse| microsoft|     39.99|
|2017-11-05|       1|      2|      2|keyboard|  logitech|     59.99|
+----------+--------+-------+-------+--------+----------+----------+
```

---

# Examples

```python
&gt;&gt;&gt; new_purchases = spark.createDataFrame([
        (date(2017, 11, 1), 2, '1'),
        (date(2017, 11, 2), 1, '3'),
    ], ['date', 'quantity', 'prod_id_x'])

&gt;&gt;&gt; join_rule = new_purchases.prod_id_x == products.prod_id

&gt;&gt;&gt; new_purchases.join(products, join_rule, 'left').show()
+----------+--------+---------+-------+--------+----------+----------+
|      date|quantity|prod_id_x|prod_id|prod_cat|prod_brand|prod_value|
+----------+--------+---------+-------+--------+----------+----------+
|2017-11-02|       1|        3|   null|    null|      null|      null|
|2017-11-01|       2|        1|      1|   mouse| microsoft|     39.99|
+----------+--------+---------+-------+--------+----------+----------+
```


---

# Performing joins: some remarks

- Spark .stress[removes the duplicated column] in the `DataFrame` it outputs after a join operation

- When joining using columns .stress[with nulls], `Spark` just skips those

```scala
&gt;&gt;&gt; df1.show()               &gt;&gt;&gt; df2.show()
+----+-----+                 +----+-----+
|  id| name|                 |  id| dept|
+----+-----+                 +----+-----+
| 123|name1|                 |null|sales|
| 456|name3|                 | 223|Legal|
|null|name2|                 | 456|   IT|
+----+-----+                 +----+-----+

&gt;&gt;&gt; df1.join(df2, "id").show
+---+-----+-----+
| id| name| dept|
+---+-----+-----+
|123|name1|sales|
|456|name3|   IT|
+---+-----+-----+
```

---

# Join types

.pure-table.pure-table-striped[
| SQL Join Type | In Spark (synonyms)                | Description          |
|---------------|------------------------------------|----------------------|
| INNER         | `"inner"`                          | Data from left and right matching both ways (intersection) |
| FULL OUTER    | `"outer"`, `"full"`, `"fullouter"` | All rows from left and right with extra data if present (union) |
| LEFT OUTER    | `"leftouter"`, `"left"`            | Rows from left with extra data from right if present |
| RIGHT OUTER   | `"rightouter"`, `"right"`          | Rows from right with extra data from left if present |
| LEFT SEMI     | `"leftsemi"`                       | Data from left with a match with right |
| LEFT ANTI     | `"leftanti"`                       | Data from left with no match with right |
| CROSS         | `"cross"`                          | Cartesian product of left and right (never used) |
]

---

# Join types

.center[
  &lt;img width="700px" src="http://kirillpavlov.com/images/join-types.png"/&gt;
]

---

# Inner join ("inner")

```python
&gt;&gt;&gt; inner = df_left.join(df_right, "id", "inner")

df_left                df_right             
+---+-----+            +---+-----+
| id|value|            | id|value|
+---+-----+            +---+-----+
|  1|   A1|            |  3|   A3|
|  2|   A2|            |  4| A4_1|
|  3|   A3|            |  4|   A4|
|  4|   A4|            |  5|   A5|
+---+-----+            |  6|   A6|
                       +---+-----+
inner
+---+-----+-----+
| id|value|value|
+---+-----+-----+
|  3|   A3|   A3|
|  4|   A4|   A4|
|  4|   A4| A4_1|
+---+-----+-----+
```

---

# Outer join ("outer", "full" or "fullouter")

```python
&gt;&gt;&gt; outer = df_left.join(df_right, "id", "outer")
df_left                df_right             
+---+-----+            +---+-----+
| id|value|            | id|value|
+---+-----+            +---+-----+
|  1|   A1|            |  3|   A3|
|  2|   A2|            |  4| A4_1|
|  3|   A3|            |  4|   A4|
|  4|   A4|            |  5|   A5|
+---+-----+            |  6|   A6|
                       +---+-----+
outer
+---+-----+-----+
| id|value|value|
+---+-----+-----+
|  1|   A1| null|
|  2|   A2| null|
|  3|   A3|   A3|
|  4|   A4|   A4|
|  4|   A4| A4_1|
|  5| null|   A5|
|  6| null|   A6|
+---+-----+-----+
```

---

# Left join ("leftouter" or "left" )

```python
&gt;&gt;&gt; left = df_left.join(df_right, "id", "left")

df_left                df_right             
+---+-----+            +---+-----+
| id|value|            | id|value|
+---+-----+            +---+-----+
|  1|   A1|            |  3|   A3|
|  2|   A2|            |  4| A4_1|
|  3|   A3|            |  4|   A4|
|  4|   A4|            |  5|   A5|
+---+-----+            |  6|   A6|
                       +---+-----+
left
+---+-----+-----+
| id|value|value|
+---+-----+-----+
|  1|   A1| null|
|  2|   A2| null|
|  3|   A3|   A3|
|  4|   A4|   A4|
|  4|   A4| A4_1|
+---+-----+-----+
```

---

# Right ("rightouter" or "right")

```python
&gt;&gt;&gt; right = df_left.join(df_right, "id", "right")

df_left                df_right             
+---+-----+            +---+-----+
| id|value|            | id|value|
+---+-----+            +---+-----+
|  1|   A1|            |  3|   A3|
|  2|   A2|            |  4| A4_1|
|  3|   A3|            |  4|   A4|
|  4|   A4|            |  5|   A5|
+---+-----+            |  6|   A6|
                       +---+-----+
right
+---+-----+-----+
| id|value|value|
+---+-----+-----+
|  3|   A3|   A3|
|  4|   A4|   A4|
|  4|   A4| A4_1|
|  5| null|   A5|
|  6| null|   A6|
+---+-----+-----+
```

---

# Left semi join ("leftsemi")

```python
&gt;&gt;&gt; left_semi = df_left.join(df_right, "id", "leftsemi")

df_left                df_right             
+---+-----+            +---+-----+
| id|value|            | id|value|
+---+-----+            +---+-----+
|  1|   A1|            |  3|   A3|
|  2|   A2|            |  4| A4_1|
|  3|   A3|            |  4|   A4|
|  4|   A4|            |  5|   A5|
+---+-----+            |  6|   A6|
                       +---+-----+
left_semi
+---+-----+
| id|value|
+---+-----+
|  3|   A3|
|  4|   A4|
+---+-----+
```

---

# Left anti joint ("leftanti")

```python
&gt;&gt;&gt; left_anti = df_left.join(df_right, "id", "leftanti")

df_left                df_right             
+---+-----+            +---+-----+
| id|value|            | id|value|
+---+-----+            +---+-----+
|  1|   A1|            |  3|   A3|
|  2|   A2|            |  4| A4_1|
|  3|   A3|            |  4|   A4|
|  4|   A4|            |  5|   A5|
+---+-----+            |  6|   A6|
                       +---+-----+
left_anti
+---+-----+
| id|value|
+---+-----+
|  1|   A1|
|  2|   A2|
+---+-----+
```

---

class: center, middle, inverse

# 3.7. Aggregations

---

# Performing aggregations

- Maybe .stress[the most used operations] in `SQL` and `Spark SQL`

- Similar to `SQL`, we use `"group by"` to perform .stress[aggregations]

- We usually can call the aggregation function just after `groupBy` &lt;br&gt; 
Namely, we use `groupBy().agg()`

- .stress[Many aggregation functions] in `pyspark.sql.functions`

- Some examples:

  - Numerical: `fn.avg`, `fn.sum`, `fn.min`, `fn.max`, etc.

  - General: `fn.first`, `fn.last`, `fn.count`, `fn.countDistinct`, etc.

---

# Examples

```python
&gt;&gt;&gt; from pyspark.sql import functions as fn

&gt;&gt;&gt; products = spark.createDataFrame([
        ('1', 'mouse', 'microsoft', 39.99),
        ('2', 'mouse', 'microsoft', 59.99),
        ('3', 'keyboard', 'microsoft', 59.99),
        ('4', 'keyboard', 'logitech', 59.99),
        ('5', 'mouse', 'logitech', 29.99),
    ], ['prod_id', 'prod_cat', 'prod_brand', 'prod_value'])

&gt;&gt;&gt; products.groupBy('prod_cat').avg('prod_value').show()

&gt;&gt;&gt; # Or
&gt;&gt;&gt; products.groupBy('prod_cat').agg(fn.avg('prod_value')).show()
+--------+-----------------+
|prod_cat|  avg(prod_value)|
+--------+-----------------+
|keyboard|            54.99|
|   mouse|43.32333333333333|
+--------+-----------------+
```

---

# Examples

```python
&gt;&gt;&gt; from pyspark.sql import functions as fn

&gt;&gt;&gt; products.groupBy('prod_brand', 'prod_cat')\
        .agg(fn.avg('prod_value')).show()
+----------+--------+---------------+
|prod_brand|prod_cat|avg(prod_value)|
+----------+--------+---------------+
| microsoft|   mouse|          49.99|
|  logitech|keyboard|          49.99|
| microsoft|keyboard|          59.99|
|  logitech|   mouse|          29.99|
+----------+--------+---------------+
```


---

# Examples

```python
&gt;&gt;&gt; from pyspark.sql import functions as fn

&gt;&gt;&gt; products.groupBy('prod_brand').agg(
        fn.round(fn.avg('prod_value'), 1).alias('average'),
        fn.ceil(fn.sum('prod_value')).alias('sum'),
        fn.min('prod_value').alias('min')
    ).show()
+----------+-------+---+-----+
|prod_brand|average|sum|  min|
+----------+-------+---+-----+
|  logitech|   40.0| 80|29.99|
| microsoft|   53.3|160|39.99|
+----------+-------+---+-----+
```

---

# Examples
```python
&gt;&gt;&gt; # Using an SQL query
&gt;&gt;&gt; products.createOrReplaceTempView("products")

&gt;&gt;&gt; query = """
    SELECT
    prod_brand,
    round(avg(prod_value), 1) AS average,
    min(prod_value) AS min
    FROM products
    GROUP BY prod_brand
    """

&gt;&gt;&gt; spark.sql(query).show()
+----------+-------+-----+
|prod_brand|average|  min|
+----------+-------+-----+
|  logitech|   40.0|29.99|
| microsoft|   53.3|39.99|
+----------+-------+-----+
```

---

class: center, middle, inverse

# 3.8. Window functions

---

# Window functions

- A very, very .stress[powerful feature]

- They allow to solve .stress[complex problems]

- They exist in some relational databases
- A good article about this feature is [[here]](https://databricks.com/blog/2015/07/15/introducing-window-functions-in-spark-sql.html)

---

# Window functions

- It's .stress[similar to aggregations], but the **number of rows doesn't change**

- Instead, .stress[new columns are created], and the **aggregated values are duplicated** for values of the same "group"

- There are "tradictional" aggregations, such as `min`, `max`, `avg`, `sum`

- and "special" types, such as `lag`, `lead`, `rank`

---

# Numerical window functions

```python
&gt;&gt;&gt; from pyspark.sql import Window
&gt;&gt;&gt; from pyspark.sql import functions as fn

&gt;&gt;&gt; # First, we create the Window definition
&gt;&gt;&gt; window = Window.partitionBy('prod_brand')

&gt;&gt;&gt; # Then, we can use "over" to aggregate on this window
&gt;&gt;&gt; avg = fn.avg('prod_value').over(window)

&gt;&gt;&gt; # Finally, we can it as a classical column
&gt;&gt;&gt; products.withColumn('avg_brand_value', fn.round(avg, 2)).show()
+-------+--------+----------+----------+---------------+
|prod_id|prod_cat|prod_brand|prod_value|avg_brand_value|
+-------+--------+----------+----------+---------------+
|      4|keyboard|  logitech|     49.99|          39.99|
|      5|   mouse|  logitech|     29.99|          39.99|
|      1|   mouse| microsoft|     39.99|          53.32|
|      2|   mouse| microsoft|     59.99|          53.32|
|      3|keyboard| microsoft|     59.99|          53.32|
+-------+--------+----------+----------+---------------+
```

---

# Numerical window functions

```python
&gt;&gt;&gt; from pyspark.sql import Window
&gt;&gt;&gt; from pyspark.sql import functions as fn

&gt;&gt;&gt; # The window can be defined on multiple columns
&gt;&gt;&gt; window = Window.partitionBy('prod_brand', 'prod_cat')

&gt;&gt;&gt; avg = fn.avg('prod_value').over(window)

&gt;&gt;&gt; products.withColumn('avg_value', fn.round(avg, 2)).show()
+-------+--------+----------+----------+---------+
|prod_id|prod_cat|prod_brand|prod_value|avg_value|
+-------+--------+----------+----------+---------+
|      1|   mouse| microsoft|     39.99|    49.99|
|      2|   mouse| microsoft|     59.99|    49.99|
|      4|keyboard|  logitech|     49.99|    49.99|
|      3|keyboard| microsoft|     59.99|    59.99|
|      5|   mouse|  logitech|     29.99|    29.99|
+-------+--------+----------+----------+---------+
```

---

# Numerical window functions

```python
&gt;&gt;&gt; from pyspark.sql import Window
&gt;&gt;&gt; from pyspark.sql import functions as fn

&gt;&gt;&gt; # Multiple windows can be defined
&gt;&gt;&gt; window1 = Window.partitionBy('prod_brand')
&gt;&gt;&gt; window2 = Window.partitionBy('prod_cat')

&gt;&gt;&gt; avg_brand = fn.avg('prod_value').over(window1)
&gt;&gt;&gt; avg_cat = fn.avg('prod_value').over(window2)

&gt;&gt;&gt; products \
        .withColumn('avg_by_brand', fn.round(avg_brand, 2)) \
        .withColumn('avg_by_cat', fn.round(avg_cat, 2)) \
        .show()
+-------+--------+----------+----------+------------+----------+
|prod_id|prod_cat|prod_brand|prod_value|avg_by_brand|avg_by_cat|
+-------+--------+----------+----------+------------+----------+
|      4|keyboard|  logitech|     49.99|       39.99|     54.99|
|      3|keyboard| microsoft|     59.99|       53.32|     54.99|
|      5|   mouse|  logitech|     29.99|       39.99|     43.32|
|      1|   mouse| microsoft|     39.99|       53.32|     43.32|
|      2|   mouse| microsoft|     59.99|       53.32|     43.32|
+-------+--------+----------+----------+------------+----------+
```

---

# Lag and Lead

- `lag` and `lead` are special functions used over an .stress[ordered window]

- They are used to **take the "previous" and "next" value** within the window

- Very useful in datasets with a date column for instance

---

# Lag and Lead

```python
&gt;&gt;&gt; purchases = spark.createDataFrame([
        (date(2017, 11, 1), 'mouse'),
        (date(2017, 11, 2), 'mouse'),
        (date(2017, 11, 4), 'keyboard'),
        (date(2017, 11, 6), 'keyboard'),
        (date(2017, 11, 9), 'keyboard'),
        (date(2017, 11, 12), 'mouse'),
        (date(2017, 11, 18), 'keyboard')
    ], ['date', 'prod_cat'])
&gt;&gt;&gt; purchases.show()
+----------+--------+
|      date|prod_cat|
+----------+--------+
|2017-11-01|   mouse|
|2017-11-02|   mouse|
|2017-11-04|keyboard|
|2017-11-06|keyboard|
|2017-11-09|keyboard|
|2017-11-12|   mouse|
|2017-11-18|keyboard|
+----------+--------+
```

---

# Lag and Lead

```python
&gt;&gt;&gt; window = Window.partitionBy('prod_cat').orderBy('date')

&gt;&gt;&gt; prev_purch = fn.lag('date', 1).over(window)
&gt;&gt;&gt; next_purch = fn.lead('date', 1).over(window)

&gt;&gt;&gt; purchases\
        .withColumn('prev', prev_purch)\
        .withColumn('next', next_purch)\
        .orderBy('prod_cat', 'date')\
        .show()
+--------+----------+----------+----------+
|prod_cat|      date|      prev|      next|
+--------+----------+----------+----------+
|keyboard|2017-11-04|      null|2017-11-06|
|keyboard|2017-11-06|2017-11-04|2017-11-09|
|keyboard|2017-11-09|2017-11-06|2017-11-18|
|keyboard|2017-11-18|2017-11-09|      null|
|   mouse|2017-11-01|      null|2017-11-02|
|   mouse|2017-11-02|2017-11-01|2017-11-12|
|   mouse|2017-11-12|2017-11-02|      null|
+--------+----------+----------+----------+
```

---

# Rank, DenseRank and RowNumber

- Another set of **useful "special" functions**

- Also used on .stress[ordered windows]

- They create a **rank**, or an **order** of the items within the window

---

# Rank and RowNumber

```python
&gt;&gt;&gt; contestants = spark.createDataFrame([
        ('veterans', 'John', 3000),
        ('veterans', 'Bob', 3200),
        ('veterans', 'Mary', 4000),
        ('young', 'Jane', 4000),
        ('young', 'April', 3100),
        ('young', 'Alice', 3700),
        ('young', 'Micheal', 4000),
    ], ['category', 'name', 'points'])

&gt;&gt;&gt; contestants.show()
+--------+-------+------+
|category|   name|points|
+--------+-------+------+
|veterans|   John|  3000|
|veterans|    Bob|  3200|
|veterans|   Mary|  4000|
|   young|   Jane|  4000|
|   young|  April|  3100|
|   young|  Alice|  3700|
|   young|Micheal|  4000|
+--------+-------+------+
```

---

# Rank and RowNumber

```python
&gt;&gt;&gt; window = Window.partitionBy('category')\
        .orderBy(contestants.points.desc())

&gt;&gt;&gt; rank = fn.rank().over(window)
&gt;&gt;&gt; dense_rank = fn.dense_rank().over(window)
&gt;&gt;&gt; row_number = fn.row_number().over(window)

&gt;&gt;&gt; contestants\
        .withColumn('rank', rank)\
        .withColumn('dense_rank', dense_rank)\
        .withColumn('row_number', row_number)\
        .orderBy('category', fn.col('points').desc())\
        .show()
+--------+-------+------+----+----------+----------+
|category|   name|points|rank|dense_rank|row_number|
+--------+-------+------+----+----------+----------+
|veterans|   Mary|  4000|   1|         1|         1|
|veterans|    Bob|  3200|   2|         2|         2|
|veterans|   John|  3000|   3|         3|         3|
|   young|   Jane|  4000|   1|         1|         1|
|   young|Micheal|  4000|   1|         1|         2|
|   young|  Alice|  3700|   3|         2|         3|
|   young|  April|  3100|   4|         3|         4|
+--------+-------+------+----+----------+----------+
```
---

class: center, middle, inverse

# 3.9. Writing dataframes

---

# Writing dataframes

- Very .stress[similar to reading]. Output formats are the same: `csv`, `json`, `parquet`, `orc`, `jdbc`, etc. Note that `write` .stress[is an action]

- Instead of `df.read.{source}` use `df.write.{target}`

- Main option is `mode` with possible values:

  - `"append"`: append contents of this `DataFrame` to existing data.
  - `"overwrite"`: overwrite existing data
  - `"error"`: throw an exception if data already exists
  - `"ignore"`: silently ignore this operation if data already exists.

Example
```python
&gt;&gt;&gt; products.write.csv('/products.csv')
&gt;&gt;&gt; products.write.mode('overwrite').parquet('/file.parquet')
&gt;&gt;&gt; products.write.format('parquet').save('/file.parquet')
```

---

class: center, middle, inverse

# 3.10. Under the hood...

---

# Query planning and optimization

A .stress[lot happens under the hood] when executing an **action** on a `DataFrame`.
The query goes through the following **exectution stages**:

1. Logical Analysis
1. Caching Replacement
1. Logical Query Optimization (using rule-based and cost-based optimizations)
1. Physical Planning
1. Physical Optimization (e.g. Whole-Stage Java Code Generation or Adaptive Query Execution)
1. Constructing the RDD of Internal Binary Rows (that represents the structured query in terms of Spark Cores RDD API)

.footnote[
[https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html](https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html)]

---

# Query planning and optimization

.center[
  &lt;img width="550px", src="figs/QueryExecution-execution-pipeline.png"/&gt;
]

.footnote[
[https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html](https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html)]

---

class: center, middle, inverse

# Thank you !

</textarea>

  <script src="./Remark04_files/remark-latest.min.js"></script>
  <!-- <script>mermaid.initialize({startOnLoad:true});</script>  -->
    <script>
      var hljs = remark.highlighter.engine;
    </script>
   <script>
      var slideshow = remark.create({
          /* sourceUrl: './slides.md', */
          highlightLanguage: 'remark',
          highlightLines: true 
        });
    </script><div class="remark-notes-area">
  <div class="remark-top-area">
    <div class="remark-toolbar">
      <a class="remark-toolbar-link" href="https://stephanegaiffas.github.io/big_data_course/slides/slides04_sparksql.html#increase">+</a>
      <a class="remark-toolbar-link" href="https://stephanegaiffas.github.io/big_data_course/slides/slides04_sparksql.html#decrease">-</a>
      <span class="remark-toolbar-timer">0:00:00</span>
    </div>
  </div>
  <div class="remark-bottom-area">
    <div class="remark-notes-current-area">
      <div class="remark-toggle">Notes for current slide</div>
      <div class="remark-notes"></div>
    </div>
    <div class="remark-notes-preview-area">
      <div class="remark-toggle">Notes for next slide</div>
      <div class="remark-notes-preview"></div>
    </div>
  </div>
</div>
<div class="remark-slides-area"><div class="remark-slide-container remark-visible"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content center middle hljs-default"><h1 id="big-data-technologies">Big Data Technologies</h1>
<h2 id="master-mathematics-and-informatics">Master Mathematics and Informatics</h2>
<p><span class="medium">Stphane Gaffas - Stphane Boucheron</span></p>
<div class="center"><p><img src="./Remark04_files/lpsm.png" style="height: 160px;">
    <img src="https://stephanegaiffas.github.io/big_data_course/slides/slides04_sparksql.html" style="width: 30px;">
    <img src="./Remark04_files/paris-diderot.png" style="height: 90px;">
    <img src="https://stephanegaiffas.github.io/big_data_course/slides/slides04_sparksql.html" style="width: 30px;">
    <img src="./Remark04_files/uparis.png" style="height: 120px;"></p>
</div><div class="remark-slide-number">1 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-spark-sql-">3. <code class="remark remark-inline-code">spark.sql</code></h1><div class="remark-slide-number">2 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="overview">Overview</h1>
<ul>
<li><p><code class="remark remark-inline-code">Spark SQL</code> is a library included in <code class="remark remark-inline-code">Spark</code> since version 1.3</p>
</li>
<li><p>It provides an <span class="stress">easier interface to process tabular data</span></p>
</li>
<li><p>Instead of <code class="remark remark-inline-code">RDD</code>s, we deal with <code class="remark remark-inline-code">DataFrame</code>s</p>
</li>
<li><p>Since <code class="remark remark-inline-code">Spark</code> 1.6, there is also the concept of <code class="remark remark-inline-code">Dataset</code>s, but only for <code class="remark remark-inline-code">Scala</code> and <code class="remark remark-inline-code">Java</code></p>
</li>
</ul><div class="remark-slide-number">3 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-sparkcontext-and-sparksession-"><code class="remark remark-inline-code">SparkContext</code> and <code class="remark remark-inline-code">SparkSession</code></h1>
<ul>
<li><p>Before <code class="remark remark-inline-code">Spark 2</code>, there was only <code class="remark remark-inline-code">SparkContext</code> and <code class="remark remark-inline-code">SQLContext</code></p>
</li>
<li><p>All core functionality was accessed with <code class="remark remark-inline-code">SparkContext</code></p>
</li>
<li><p>All <code class="remark remark-inline-code">SQL</code> functionality needed the <code class="remark remark-inline-code">SQLContext</code>, which can be created from an <code class="remark remark-inline-code">SparkContext</code></p>
</li>
<li><p>Since <code class="remark remark-inline-code">Spark 2</code>, there is now the <code class="remark remark-inline-code">SparkSession</code> class</p>
</li>
<li><p><code class="remark remark-inline-code">SparkSession</code> is now the <span class="stress">global entry-point</span> for everything <code class="remark remark-inline-code">Spark</code>-related</p>
</li>
</ul><div class="remark-slide-number">4 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-sparkcontext-and-sparksession-"><code class="remark remark-inline-code">SparkContext</code> and <code class="remark remark-inline-code">SparkSession</code></h1>
<p>Before <code class="remark remark-inline-code">Spark 2</code></p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark <span class="hljs-keyword">import</span> SparkConf, SparkContext</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SQLContext</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>conf = SparkConf().setAppName(appName).setMaster(master)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>sc = SparkContext(conf = conf)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>sql_context = new SQLContext(sc)</div></code></pre>
<p>Since <code class="remark remark-inline-code">Spark 2</code></p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>spark = SparkSession \</div><div class="remark-code-line">        .builder \</div><div class="remark-code-line">        .appName(appName) \</div><div class="remark-code-line">        .master(master) \</div><div class="remark-code-line">        .config(<span class="hljs-string">"spark.some.config.option"</span>, <span class="hljs-string">"some-value"</span>) \</div><div class="remark-code-line">        .getOrCreate()</div></code></pre><div class="remark-slide-number">5 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-1-dataframe-">3.1. <code class="remark remark-inline-code">DataFrame</code></h1><div class="remark-slide-number">6 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-dataframe-"><code class="remark remark-inline-code">DataFrame</code></h1>
<ul>
<li><p>The main entity of <code class="remark remark-inline-code">Spark SQL</code> is the <code class="remark remark-inline-code">DataFrame</code></p>
</li>
<li><p>A DataFrame is actually an <code class="remark remark-inline-code">RDD</code> of <code class="remark remark-inline-code">Row</code>s with a <span class="stress">schema</span></p>
</li>
<li><p>A schema gives the <strong>names of the columns</strong> and their <strong>types</strong></p>
</li>
<li><p><code class="remark remark-inline-code">Row</code> is a class representing a row of the <code class="remark remark-inline-code">DataFrame</code>.</p>
</li>
<li><p>It can be used almost as a <code class="remark remark-inline-code">python</code> <code class="remark remark-inline-code">list</code>, with its size equal to the number of columns in the schema.</p>
</li>
</ul><div class="remark-slide-number">7 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-dataframe-"><code class="remark remark-inline-code">DataFrame</code></h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> Row</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>row1 = Row(name=<span class="hljs-string">"John"</span>, age=<span class="hljs-number">21</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>row2 = Row(name=<span class="hljs-string">"James"</span>, age=<span class="hljs-number">32</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>row3 = Row(name=<span class="hljs-string">"Jane"</span>, age=<span class="hljs-number">18</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>row1[<span class="hljs-string">'name'</span>]</div><div class="remark-code-line"><span class="hljs-string">'John'</span></div></code></pre>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame([row1, row2, row3])</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df</div><div class="remark-code-line">DataFrame[age: bigint, name: string]</div></code></pre>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.show()</div><div class="remark-code-line">+-----+---+</div><div class="remark-code-line">| name|age|</div><div class="remark-code-line">+-----+---+</div><div class="remark-code-line">| John| <span class="hljs-number">21</span>|</div><div class="remark-code-line">|James| <span class="hljs-number">32</span>|</div><div class="remark-code-line">| Jane| <span class="hljs-number">18</span>|</div><div class="remark-code-line">+-----+---+</div></code></pre><div class="remark-slide-number">8 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-dataframe-"><code class="remark remark-inline-code">DataFrame</code></h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.printSchema()</div><div class="remark-code-line">root</div><div class="remark-code-line"> |-- age: long (nullable = true)</div><div class="remark-code-line"> |-- name: string (nullable = true)</div></code></pre>
<p>You can ccess to the underlying <code class="remark remark-inline-code">RDD</code> object using <code class="remark remark-inline-code">.rdd</code></p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>print(df.rdd.toDebugString().decode(<span class="hljs-string">"utf-8"</span>))</div><div class="remark-code-line">(<span class="hljs-number">6</span>) MapPartitionsRDD[<span class="hljs-number">16</span>] at javaToPython at NativeMethodAccessorImpl.java:<span class="hljs-number">0</span> []</div><div class="remark-code-line"> |  MapPartitionsRDD[<span class="hljs-number">15</span>] at javaToPython at NativeMethodAccessorImpl.java:<span class="hljs-number">0</span> []</div><div class="remark-code-line"> |  MapPartitionsRDD[<span class="hljs-number">14</span>] at javaToPython at NativeMethodAccessorImpl.java:<span class="hljs-number">0</span> []</div><div class="remark-code-line"> |  MapPartitionsRDD[<span class="hljs-number">13</span>] at applySchemaToPythonRDD at NativeMethodAccessorImpl.java:<span class="hljs-number">0</span> []</div><div class="remark-code-line"> |  MapPartitionsRDD[<span class="hljs-number">12</span>] at map at SerDeUtil.scala:<span class="hljs-number">137</span> []</div><div class="remark-code-line"> |  MapPartitionsRDD[<span class="hljs-number">11</span>] at mapPartitions at SerDeUtil.scala:<span class="hljs-number">184</span> []</div><div class="remark-code-line"> |  PythonRDD[<span class="hljs-number">10</span>] at RDD at PythonRDD.scala:<span class="hljs-number">53</span> []</div><div class="remark-code-line"> |  ParallelCollectionRDD[<span class="hljs-number">9</span>] at parallelize at PythonRDD.scala:<span class="hljs-number">195</span> []</div></code></pre>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.rdd.getNumPartitions()</div><div class="remark-code-line"><span class="hljs-number">6</span></div></code></pre><div class="remark-slide-number">9 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="creating-dataframes">Creating DataFrames</h1>
<ul>
<li><p>We can use the method <code class="remark remark-inline-code">createDataFrame</code> from the SparkSession instance</p>
</li>
<li><p>Can be used to create a <code class="remark remark-inline-code">Spark</code> <code class="remark remark-inline-code">DataFrame</code> from:</p>
<ul>
<li><p>a <code class="remark remark-inline-code">pandas.DataFrame</code> object</p>
</li>
<li><p>a local python list</p>
</li>
<li><p>an RDD</p>
</li>
</ul>
</li>
<li><p>Full documentation can be found in the <a href="http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.SparkSession.createDataFrame">[API docs]</a></p>
</li>
</ul><div class="remark-slide-number">10 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="creating-dataframes">Creating DataFrames</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>rows = [</div><div class="remark-code-line">        Row(name=<span class="hljs-string">"John"</span>, age=<span class="hljs-number">21</span>, gender=<span class="hljs-string">"male"</span>),</div><div class="remark-code-line">        Row(name=<span class="hljs-string">"James"</span>, age=<span class="hljs-number">25</span>, gender=<span class="hljs-string">"female"</span>),</div><div class="remark-code-line">        Row(name=<span class="hljs-string">"Albert"</span>, age=<span class="hljs-number">46</span>, gender=<span class="hljs-string">"male"</span>)</div><div class="remark-code-line">    ]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame(rows)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.show()</div><div class="remark-code-line">+---+------+------+</div><div class="remark-code-line">|age|gender|  name|</div><div class="remark-code-line">+---+------+------+</div><div class="remark-code-line">| <span class="hljs-number">21</span>|  male|  John|</div><div class="remark-code-line">| <span class="hljs-number">25</span>|female| James|</div><div class="remark-code-line">| <span class="hljs-number">46</span>|  male|Albert|</div><div class="remark-code-line">+---+------+------+</div></code></pre><div class="remark-slide-number">11 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="creating-dataframes">Creating DataFrames</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>column_names = [<span class="hljs-string">"name"</span>, <span class="hljs-string">"age"</span>, <span class="hljs-string">"gender"</span>]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>rows = [</div><div class="remark-code-line">        [<span class="hljs-string">"John"</span>, <span class="hljs-number">21</span>, <span class="hljs-string">"male"</span>],</div><div class="remark-code-line">        [<span class="hljs-string">"James"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"female"</span>],</div><div class="remark-code-line">        [<span class="hljs-string">"Albert"</span>, <span class="hljs-number">46</span>, <span class="hljs-string">"male"</span>]</div><div class="remark-code-line">    ]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame(rows, column_names)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.show()</div><div class="remark-code-line">+------+---+------+</div><div class="remark-code-line">|  name|age|gender|</div><div class="remark-code-line">+------+---+------+</div><div class="remark-code-line">|  John| <span class="hljs-number">21</span>|  male|</div><div class="remark-code-line">| James| <span class="hljs-number">25</span>|female|</div><div class="remark-code-line">|Albert| <span class="hljs-number">46</span>|  male|</div><div class="remark-code-line">+------+---+------+</div></code></pre><div class="remark-slide-number">12 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="creating-dataframes">Creating DataFrames</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>column_names = [<span class="hljs-string">"name"</span>, <span class="hljs-string">"age"</span>, <span class="hljs-string">"gender"</span>]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([</div><div class="remark-code-line">        (<span class="hljs-string">"John"</span>, <span class="hljs-number">21</span>, <span class="hljs-string">"male"</span>),</div><div class="remark-code-line">        (<span class="hljs-string">"James"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"female"</span>),</div><div class="remark-code-line">        (<span class="hljs-string">"Albert"</span>, <span class="hljs-number">46</span>, <span class="hljs-string">"male"</span>)</div><div class="remark-code-line">    ])</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame(rdd, column_names)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.show()</div><div class="remark-code-line">+------+---+------+</div><div class="remark-code-line">|  name|age|gender|</div><div class="remark-code-line">+------+---+------+</div><div class="remark-code-line">|  John| <span class="hljs-number">21</span>|  male|</div><div class="remark-code-line">| James| <span class="hljs-number">25</span>|female|</div><div class="remark-code-line">|Albert| <span class="hljs-number">46</span>|  male|</div><div class="remark-code-line">+------+---+------+</div></code></pre><div class="remark-slide-number">13 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-2-schemas-and-types">3.2. Schemas and types</h1><div class="remark-slide-number">14 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="schema-and-types">Schema and Types</h1>
<ul>
<li><p>A <code class="remark remark-inline-code">DataFrame</code> always contains a <span class="stress">schema</span></p>
</li>
<li><p>The schema defines the <strong>column names</strong> and <strong>types</strong></p>
</li>
<li><p>In all previous examples, the schema was <span class="stress">inferred</span></p>
</li>
<li><p>The schema of a <code class="remark remark-inline-code">DataFrame</code> is represented by the class <code class="remark remark-inline-code">types.StructType</code> <a href="http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.types.StructType">[API doc]</a></p>
</li>
<li><p>When creating a <code class="remark remark-inline-code">DataFrame</code>, the schema can be either <strong>inferred</strong> or <strong>defined by the user</strong></p>
</li>
</ul>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.schema</div><div class="remark-code-line">StructType(List(StructField(name,StringType,true),StructField(age,IntegerType,true),StructField(gender,StringType,true)))</div></code></pre><div class="remark-slide-number">15 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="creating-a-custom-schema">Creating a custom Schema</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql.types <span class="hljs-keyword">import</span> *</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>schema = StructType([</div><div class="remark-code-line">        StructField(<span class="hljs-string">"name"</span>, StringType(), <span class="hljs-keyword">True</span>),</div><div class="remark-code-line">        StructField(<span class="hljs-string">"age"</span>, IntegerType(), <span class="hljs-keyword">True</span>),</div><div class="remark-code-line">        StructField(<span class="hljs-string">"gender"</span>, StringType(), <span class="hljs-keyword">True</span>)</div><div class="remark-code-line">    ])</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>rows = [(<span class="hljs-string">"John"</span>, <span class="hljs-number">21</span>, <span class="hljs-string">"male"</span>)]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame(rows, schema)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.printSchema()</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.show()</div><div class="remark-code-line">root</div><div class="remark-code-line">|-- name: string (nullable = true)</div><div class="remark-code-line">|-- age: integer (nullable = true)</div><div class="remark-code-line">|-- gender: string (nullable = true)</div><div class="remark-code-line"></div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|name|age|gender|</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|John| <span class="hljs-number">21</span>|  male|</div><div class="remark-code-line">+----+---+------+</div></code></pre><div class="remark-slide-number">16 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="types-supported-by-spark-sql-">Types supported by <code class="remark remark-inline-code">Spark SQL</code></h1>
<ul>
<li><code class="remark remark-inline-code">StringType</code></li>
<li><code class="remark remark-inline-code">IntegerType</code></li>
<li><code class="remark remark-inline-code">LongType</code></li>
<li><code class="remark remark-inline-code">FloatType</code></li>
<li><code class="remark remark-inline-code">DoubleType</code></li>
<li><code class="remark remark-inline-code">BooleanType</code></li>
<li><code class="remark remark-inline-code">DateType</code></li>
<li><code class="remark remark-inline-code">TimestampType</code></li>
<li><code class="remark remark-inline-code">...</code></li>
<li>The full list of types can be found in <a href="https://spark.apache.org/docs/latest/api/python/pyspark.sql.html#module-pyspark.sql.types">[API doc]</a></li>
</ul><div class="remark-slide-number">17 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-3-reading-data">3.3. Reading data</h1><div class="remark-slide-number">18 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="reading-data-from-sources">Reading data from sources</h1>
<ul>
<li><p>Data is usually read from <span class="stress">external sources</span><br>
(move the <strong>algorithms</strong>, not the <strong>data</strong>)</p>
</li>
<li><p><code class="remark remark-inline-code">Spark SQL</code> provides <span class="stress">connectors</span> to read from many different sources:</p>
<ul>
<li><p>Text files (<code class="remark remark-inline-code">CSV</code>, <code class="remark remark-inline-code">JSON</code>)</p>
</li>
<li><p>Distributed tabular files (<code class="remark remark-inline-code">Parquet</code>, <code class="remark remark-inline-code">ORC</code>)</p>
</li>
<li><p>In-memory data sources (<code class="remark remark-inline-code">Apache Arrow</code>)</p>
</li>
<li><p>General relational Databases (via <code class="remark remark-inline-code">JDBC</code>)</p>
</li>
<li><p>Third-party connectors to connect to many other databases</p>
</li>
<li><p>And you can create your own connector for <code class="remark remark-inline-code">Spark</code> (in <code class="remark remark-inline-code">Scala</code>)</p>
</li>
</ul>
</li>
</ul><div class="remark-slide-number">19 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="reading-data-from-sources">Reading data from sources</h1>
<ul>
<li><p>In all cases, the syntax is similar: <br> <code class="remark remark-inline-code">spark.read.{source}(path)</code></p>
</li>
<li><p>Spark supports different <span class="stress">file systems</span> to look for the data:</p>
<ul>
<li><p>Local files: <code class="remark remark-inline-code">"file://path/to/file"</code> or just <code class="remark remark-inline-code">"path/to/file"</code></p>
</li>
<li><p><code class="remark remark-inline-code">HDFS</code> (Hadoop filesystem): <code class="remark remark-inline-code">"hdfs://path/to/file"</code></p>
</li>
<li><p><code class="remark remark-inline-code">Amazon S3</code>: <code class="remark remark-inline-code">"s3://path/to/file"</code></p>
</li>
</ul>
</li>
</ul><div class="remark-slide-number">20 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="reading-from-a-csv-file">Reading from a <code class="remark remark-inline-code">CSV</code> file</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.csv(<span class="hljs-string">"/path/to/file.csv"</span>)</div></code></pre>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>path = <span class="hljs-string">"/path/to/file.csv"</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.option(<span class="hljs-string">"header"</span>, <span class="hljs-string">"true"</span>).csv(path)</div></code></pre>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = (spark.read</div><div class="remark-code-line">        .format(<span class="hljs-string">'csv'</span>)</div><div class="remark-code-line">        .option(<span class="hljs-string">'header'</span>, <span class="hljs-string">'true'</span>)</div><div class="remark-code-line">        .option(<span class="hljs-string">'sep'</span>, <span class="hljs-string">";"</span>)</div><div class="remark-code-line">        .load(<span class="hljs-string">"/path/to/file.csv"</span>)</div><div class="remark-code-line">    )</div></code></pre>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.csv(path, sep=<span class="hljs-string">";"</span>, header=<span class="hljs-keyword">True</span>)</div></code></pre><div class="remark-slide-number">21 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="reading-from-a-csv-file">Reading from a <code class="remark remark-inline-code">CSV</code> file</h1>
<h2 id="main-options">Main Options</h2>
<p>Some important options of the <code class="remark remark-inline-code">CSV</code> reader are listed here:</p>
<div class="pure-table pure-table-striped"><table>
<thead>
<tr>
<th style="text-align:left">option</th>
<th style="text-align:left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">sep</code></td>
<td style="text-align:left">The separator character</td>
</tr>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">header</code></td>
<td style="text-align:left">If "true", the first line contains the column names</td>
</tr>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">inferSchema</code></td>
<td style="text-align:left">If "true", the column types will be guessed from the contents</td>
</tr>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">dateFormat</code></td>
<td style="text-align:left">A string representing the format of the date columns</td>
</tr>
</tbody>
</table>
</div>

<p>The full list of options can be found in the <a href="http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.DataFrameReader.csv">API Docs</a></p><div class="remark-slide-number">22 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="reading-from-other-file-types">Reading from other file types</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># JSON file</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.json(<span class="hljs-string">"/path/to/file.json"</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.format(<span class="hljs-string">"json"</span>).load(<span class="hljs-string">"/path/to/file.json"</span>)</div></code></pre>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># Parquet file (distributed tabular data)</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.parquet(<span class="hljs-string">"hdfs://path/to/file.parquet"</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.format(<span class="hljs-string">"parquet"</span>).load(<span class="hljs-string">"hdfs://path/to/file.parquet"</span>)</div></code></pre>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># ORC file (distributed tabular data)</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.orc(<span class="hljs-string">"hdfs://path/to/file.orc"</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.format(<span class="hljs-string">"orc"</span>).load(<span class="hljs-string">"hdfs://path/to/file.orc"</span>)</div></code></pre><div class="remark-slide-number">23 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="reading-from-external-databases">Reading from external databases</h1>
<ul>
<li><p>We can use <code class="remark remark-inline-code">JDBC</code> drivers (Java) to read from relational databases</p>
</li>
<li><p>Examples of databases: <code class="remark remark-inline-code">Oracle</code>, <code class="remark remark-inline-code">PostgreSQL</code>, <code class="remark remark-inline-code">MySQL</code>, etc.</p>
</li>
<li><p>The <code class="remark remark-inline-code">java</code> driver file must be uploaded to the cluster before trying to access</p>
</li>
<li><p>This operation can be <strong>very heavy</strong>. When available, specific connectors should be used</p>
</li>
<li><p>Specific connectors are often provided by <strong>third-party libraries</strong></p>
</li>
</ul><div class="remark-slide-number">24 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="reading-from-external-databases">Reading from external databases</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.format(<span class="hljs-string">"jdbc"</span>) \</div><div class="remark-code-line">        .option(<span class="hljs-string">"url"</span>, <span class="hljs-string">"jdbc:postgresql:dbserver"</span>) \</div><div class="remark-code-line">        .option(<span class="hljs-string">"dbtable"</span>, <span class="hljs-string">"schema.tablename"</span>) \</div><div class="remark-code-line">        .option(<span class="hljs-string">"user"</span>, <span class="hljs-string">"username"</span>) \</div><div class="remark-code-line">        .option(<span class="hljs-string">"password"</span>, <span class="hljs-string">"p4ssw0rd"</span>) \</div><div class="remark-code-line">        .load()</div></code></pre>
<p>or</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.read.jdbc(</div><div class="remark-code-line">        url=<span class="hljs-string">"jdbc:postgresql:dbserver"</span>,</div><div class="remark-code-line">        table=<span class="hljs-string">"schema.tablename"</span></div><div class="remark-code-line">        properties={</div><div class="remark-code-line">            <span class="hljs-string">"user"</span>: <span class="hljs-string">"username"</span>,</div><div class="remark-code-line">            <span class="hljs-string">"password"</span>: <span class="hljs-string">"p4ssw0rd"</span></div><div class="remark-code-line">        }</div><div class="remark-code-line">    )</div></code></pre><div class="remark-slide-number">25 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-4-queries-in-spark-sql-">3.4. Queries in <code class="remark remark-inline-code">spark.sql</code></h1><div class="remark-slide-number">26 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="performing-queries">Performing queries</h1>
<ul>
<li><p><code class="remark remark-inline-code">Spark SQL</code> was created to be compatible with SQL queries</p>
</li>
<li><p>So it supports actual <code class="remark remark-inline-code">SQL</code> queries to be performed on <code class="remark remark-inline-code">DataFrame</code>s </p>
</li>
<li><p>First, the <code class="remark remark-inline-code">DataFrame</code> must be <span class="stress">tagged as a temporary view</span></p>
</li>
<li><p>Then, the queries can be applied using <code class="remark remark-inline-code">spark.sql</code></p>
</li>
</ul><div class="remark-slide-number">27 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="performing-queries">Performing queries</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>column_names = [<span class="hljs-string">"name"</span>, <span class="hljs-string">"age"</span>, <span class="hljs-string">"gender"</span>]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>rows = [</div><div class="remark-code-line">        [<span class="hljs-string">"John"</span>, <span class="hljs-number">21</span>, <span class="hljs-string">"male"</span>],</div><div class="remark-code-line">        [<span class="hljs-string">"Jane"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"female"</span>]</div><div class="remark-code-line">    ]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame(rows, column_names)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Create a temporary view from the DataFrame</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.createOrReplaceTempView(<span class="hljs-string">"new_view"</span>)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Apply the query</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"SELECT name, age FROM new_view WHERE gender='male'"</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>men_df = spark.sql(query)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>men_df.show()</div><div class="remark-code-line">+----+---+</div><div class="remark-code-line">|name|age|</div><div class="remark-code-line">+----+---+</div><div class="remark-code-line">|John| <span class="hljs-number">21</span>|</div><div class="remark-code-line">+----+---+</div></code></pre><div class="remark-slide-number">28 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="using-the-api">Using the API</h1>
<ul>
<li><p>Although allowing <code class="remark remark-inline-code">SQL</code> queries is a very powerful feature, it's <span class="stress">not the best way</span> to code a complex logic</p>
</li>
<li><p>Errors are <strong>harder to find</strong> in strings</p>
</li>
<li><p>Using queries makes the code <strong>less modularizable</strong></p>
</li>
<li><p>So <code class="remark remark-inline-code">Spark SQL</code> provides a <span class="stress">full API</span> with <strong>SQL-like operations</strong></p>
</li>
<li><p>It's <span class="stress">the best way</span> to code complex logic when using <code class="remark remark-inline-code">Spark SQL</code></p>
</li>
</ul><div class="remark-slide-number">29 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="basic-operations">Basic Operations</h1>
<div class="pure-table pure-table-striped"><table>
<thead>
<tr>
<th style="text-align:left">operation</th>
<th style="text-align:left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">select</code></td>
<td style="text-align:left">Chooses columns from the table</td>
</tr>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">where</code></td>
<td style="text-align:left">Filters rows based on a boolean rule</td>
</tr>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">limit</code></td>
<td style="text-align:left">Limits the number of rows</td>
</tr>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">orderBy</code></td>
<td style="text-align:left">Sorts the DataFrame based on one or more columns</td>
</tr>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">alias</code></td>
<td style="text-align:left">Changes the name of a column</td>
</tr>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">cast</code></td>
<td style="text-align:left">Changes the type of a column</td>
</tr>
<tr>
<td style="text-align:left"><code class="remark remark-inline-code">withColumn</code></td>
<td style="text-align:left">Adds a new column</td>
</tr>
</tbody>
</table>
</div><div class="remark-slide-number">30 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-select-"><code class="remark remark-inline-code">SELECT</code></h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># In a SQL query:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"SELECT name, age FROM table"</span></div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Using Spark SQL API:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.select(<span class="hljs-string">"name"</span>, <span class="hljs-string">"age"</span>).show()</div><div class="remark-code-line">+-----+---+</div><div class="remark-code-line">| name|age|</div><div class="remark-code-line">+-----+---+</div><div class="remark-code-line">| John| <span class="hljs-number">21</span>|</div><div class="remark-code-line">| Jane| <span class="hljs-number">25</span>|</div><div class="remark-code-line">+-----+---+</div></code></pre><div class="remark-slide-number">31 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-where-"><code class="remark remark-inline-code">WHERE</code></h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># In a SQL query:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"SELECT * FROM table WHERE age &gt; 21"</span></div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Using Spark SQL API:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.where(<span class="hljs-string">"age &gt; 21"</span>).show()</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Alternatively:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.where(df[<span class="hljs-string">'age'</span>] &gt; <span class="hljs-number">21</span>).show()</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.where(df.age &gt; <span class="hljs-number">21</span>).show()</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.select(<span class="hljs-string">"*"</span>).where(<span class="hljs-string">"age &gt; 21"</span>).show()</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|name|age|gender|</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|Jane| <span class="hljs-number">25</span>|female|</div><div class="remark-code-line">+----+---+------+</div></code></pre><div class="remark-slide-number">32 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-limit-"><code class="remark remark-inline-code">LIMIT</code></h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># In a SQL query:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"SELECT * FROM table LIMIT 1"</span></div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Using Spark SQL API:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.limit(<span class="hljs-number">1</span>).show()</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Or even</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.select(<span class="hljs-string">"*"</span>).limit(<span class="hljs-number">1</span>).show()</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|name|age|gender|</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|Jane| <span class="hljs-number">25</span>|female|</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Note: The result is not deterministic!</span></div></code></pre><div class="remark-slide-number">33 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-order-by-"><code class="remark remark-inline-code">ORDER BY</code></h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># In a SQL query:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"SELECT * FROM table ORDER BY name ASC"</span></div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Using Spark SQL API:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.orderBy(df.name.asc()).show()</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|name|age|gender|</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|Jane| <span class="hljs-number">25</span>|female|</div><div class="remark-code-line">|John| <span class="hljs-number">21</span>|  male|</div><div class="remark-code-line">+----+---+------+</div></code></pre><div class="remark-slide-number">34 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-alias-name-change-"><code class="remark remark-inline-code">ALIAS</code> (name change)</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># In a SQL query:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"SELECT name, age, gender AS sex FROM table"</span></div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Using Spark SQL API:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.select(df.name, df.age, df.gender.alias(<span class="hljs-string">'sex'</span>)).show()</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|name|age|   sex|</div><div class="remark-code-line">+----+---+------+</div><div class="remark-code-line">|John| <span class="hljs-number">21</span>|  male|</div><div class="remark-code-line">|Jane| <span class="hljs-number">25</span>|female|</div><div class="remark-code-line">+----+---+------+</div></code></pre><div class="remark-slide-number">35 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="-cast-type-change-"><code class="remark remark-inline-code">CAST</code> (type change)</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># In a SQL query:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"SELECT name, cast(age AS float) AS age_f FROM table"</span></div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Using Spark SQL API:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.select(df.name, df.age.cast(<span class="hljs-string">"float"</span>).alias(<span class="hljs-string">"age_f"</span>)).show()</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Or</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>new_age_col = df.age.cast(<span class="hljs-string">"float"</span>).alias(<span class="hljs-string">"age_f"</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.select(df.name, new_age_col).show()</div><div class="remark-code-line">+----+-----+</div><div class="remark-code-line">|name|age_f|</div><div class="remark-code-line">+----+-----+</div><div class="remark-code-line">|John| <span class="hljs-number">21.0</span>|</div><div class="remark-code-line">|Jane| <span class="hljs-number">25.0</span>|</div><div class="remark-code-line">+----+-----+</div></code></pre><div class="remark-slide-number">36 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="adding-new-columns">Adding new columns</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-comment"># In a SQL query:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"SELECT *, 12*age AS age_months FROM table"</span></div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Using Spark SQL API:</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.withColumn(<span class="hljs-string">"age_months"</span>, df.age * <span class="hljs-number">12</span>).show()</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Or</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.select(<span class="hljs-string">"*"</span>, (df.age * <span class="hljs-number">12</span>).alias(<span class="hljs-string">"age_months"</span>)).show()</div><div class="remark-code-line">+----+---+------+----------+</div><div class="remark-code-line">|name|age|gender|(age * <span class="hljs-number">12</span>)|</div><div class="remark-code-line">+----+---+------+----------+</div><div class="remark-code-line">|John| <span class="hljs-number">21</span>|  male|       <span class="hljs-number">252</span>|</div><div class="remark-code-line">|Jane| <span class="hljs-number">25</span>|female|       <span class="hljs-number">300</span>|</div><div class="remark-code-line">+----+---+------+----------+</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-comment"># Note: Using withColumn is preferable</span></div></code></pre><div class="remark-slide-number">37 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="basic-operations">Basic operations</h1>
<ul>
<li><p>The <span class="stress">full list of operations</span> that can be applied to a <code class="remark remark-inline-code">DataFrame</code> can be found in the <a href="http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.DataFrame">[DataFrame doc]</a></p>
</li>
<li><p>The <span class="stress">list of operations on columns</span> can be found in the <a href="http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.Column">[Column docs]</a></p>
</li>
</ul><div class="remark-slide-number">38 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-5-column-functions">3.5. Column functions</h1><div class="remark-slide-number">39 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="column-functions">Column functions</h1>
<ul>
<li><p>Oftentimes, we need to make many <span class="stress">transformations using one or more functions</span></p>
</li>
<li><p><code class="remark remark-inline-code">Spark SQL</code> has a package called <code class="remark remark-inline-code">functions</code> with many functions available for that</p>
</li>
<li><p>Some of those functions are only for <strong>aggregations</strong> <br> Examples: <code class="remark remark-inline-code">avg</code>, <code class="remark remark-inline-code">sum</code>, etc. We will cover them later</p>
</li>
<li><p>Some others are for <strong>column transformation</strong> or <strong>operations</strong> <br> Examples:  <code class="remark remark-inline-code">substr</code>, <code class="remark remark-inline-code">concat</code>, <code class="remark remark-inline-code">datediff</code>, <code class="remark remark-inline-code">floor</code>, etc.</p>
</li>
<li><p>The full list is, once again, in the <a href="http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#module-pyspark.sql.functions">[API docs]</a></p>
</li>
</ul><div class="remark-slide-number">40 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="column-functions">Column functions</h1>
<p>To use these functions, we first need to import them:</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div></code></pre>
<p><strong>Note</strong>: the "<code class="remark remark-inline-code">as fn</code>" part is important to <strong>avoid confusion</strong> with native <code class="remark remark-inline-code">Python</code> functions such as "sum"</p><div class="remark-slide-number">41 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="numeric-functions-examples">Numeric functions examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>columns = [<span class="hljs-string">"brand"</span>, <span class="hljs-string">"cost"</span>]</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame([</div><div class="remark-code-line">        (<span class="hljs-string">"garnier"</span>, <span class="hljs-number">3.49</span>),</div><div class="remark-code-line">        (<span class="hljs-string">"elseve"</span>, <span class="hljs-number">2.71</span>)</div><div class="remark-code-line">        ], columns)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>round_cost = fn.round(df.cost, <span class="hljs-number">1</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>floor_cost = fn.floor(df.cost)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>ceil_cost = fn.ceil(df.cost)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.withColumn(<span class="hljs-string">'round'</span>, round_cost)\</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'floor'</span>, floor_cost)\</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'ceil'</span>, ceil_cost)\</div><div class="remark-code-line">        .show()</div><div class="remark-code-line">+-------+----+-----+-----+----+</div><div class="remark-code-line">|  brand|cost|round|floor|ceil|</div><div class="remark-code-line">+-------+----+-----+-----+----+</div><div class="remark-code-line">|garnier|<span class="hljs-number">3.49</span>|  <span class="hljs-number">3.5</span>|    <span class="hljs-number">3</span>|   <span class="hljs-number">4</span>|</div><div class="remark-code-line">| elseve|<span class="hljs-number">2.71</span>|  <span class="hljs-number">2.7</span>|    <span class="hljs-number">2</span>|   <span class="hljs-number">3</span>|</div><div class="remark-code-line">+-------+----+-----+-----+----+</div></code></pre><div class="remark-slide-number">42 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="string-functions-examples">String functions examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>columns = [<span class="hljs-string">"first_name"</span>, <span class="hljs-string">"last_name"</span>]</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame([</div><div class="remark-code-line">        (<span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span>),</div><div class="remark-code-line">        (<span class="hljs-string">"Mary"</span>, <span class="hljs-string">"Jane"</span>)</div><div class="remark-code-line">        ], columns)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>last_name_initial = fn.substring(df.last_name, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>name = fn.concat_ws(<span class="hljs-string">" "</span>, df.first_name, last_name_initial)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.withColumn(<span class="hljs-string">"name"</span>, name).show()</div><div class="remark-code-line">+----------+---------+------+</div><div class="remark-code-line">|first_name|last_name|  name|</div><div class="remark-code-line">+----------+---------+------+</div><div class="remark-code-line">|      John|      Doe|John D|</div><div class="remark-code-line">|      Mary|     Jane|Mary J|</div><div class="remark-code-line">+----------+---------+------+</div></code></pre><div class="remark-slide-number">43 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="date-functions-examples">Date functions examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> date</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame([</div><div class="remark-code-line">        (date(<span class="hljs-number">2015</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>), date(<span class="hljs-number">2015</span>, <span class="hljs-number">1</span>, <span class="hljs-number">15</span>)),</div><div class="remark-code-line">        (date(<span class="hljs-number">2015</span>, <span class="hljs-number">2</span>, <span class="hljs-number">21</span>), date(<span class="hljs-number">2015</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>)),</div><div class="remark-code-line">        ], [<span class="hljs-string">"start_date"</span>, <span class="hljs-string">"end_date"</span>]</div><div class="remark-code-line">    )</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>days_between = fn.datediff(df.end_date, df.start_date)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>start_month = fn.month(df.start_date)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.withColumn(<span class="hljs-string">'days_between'</span>, days_between)\</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'start_month'</span>, start_month)\</div><div class="remark-code-line">        .show()</div><div class="remark-code-line">+----------+----------+------------+-----------+</div><div class="remark-code-line">|start_date|  end_date|days_between|start_month|</div><div class="remark-code-line">+----------+----------+------------+-----------+</div><div class="remark-code-line">|<span class="hljs-number">2015</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>|<span class="hljs-number">2015</span><span class="hljs-number">-01</span><span class="hljs-number">-15</span>|          <span class="hljs-number">14</span>|          <span class="hljs-number">1</span>|</div><div class="remark-code-line">|<span class="hljs-number">2015</span><span class="hljs-number">-02</span><span class="hljs-number">-21</span>|<span class="hljs-number">2015</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>|          <span class="hljs-number">15</span>|          <span class="hljs-number">2</span>|</div><div class="remark-code-line">+----------+----------+------------+-----------+</div></code></pre><div class="remark-slide-number">44 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="conditional-transformations">Conditional transformations</h1>
<ul>
<li><p>In the <code class="remark remark-inline-code">functions</code> package is a <span class="stress">special function</span> called <code class="remark remark-inline-code">when</code></p>
</li>
<li><p>This function is used to <span class="stress">create a new column</span> which value <strong>depends on the value of other columns</strong></p>
</li>
<li><p><code class="remark remark-inline-code">otherwise</code> is used to match "the rest"</p>
</li>
<li><p>Combination between conditions can be done using <code class="remark remark-inline-code">"&amp;"</code> for "and" and <code class="remark remark-inline-code">"|"</code> for "or"</p>
</li>
</ul><div class="remark-slide-number">45 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="examples">Examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame([</div><div class="remark-code-line">        (<span class="hljs-string">"John"</span>, <span class="hljs-number">21</span>, <span class="hljs-string">"male"</span>),</div><div class="remark-code-line">        (<span class="hljs-string">"Jane"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"female"</span>),</div><div class="remark-code-line">        (<span class="hljs-string">"Albert"</span>, <span class="hljs-number">46</span>, <span class="hljs-string">"male"</span>),</div><div class="remark-code-line">        (<span class="hljs-string">"Brad"</span>, <span class="hljs-number">49</span>, <span class="hljs-string">"super-hero"</span>)</div><div class="remark-code-line">    ], [<span class="hljs-string">"name"</span>, <span class="hljs-string">"age"</span>, <span class="hljs-string">"gender"</span>])</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>supervisor = fn.when(df.gender == <span class="hljs-string">'male'</span>, <span class="hljs-string">'Mr. Smith'</span>)\</div><div class="remark-code-line">        .when(df.gender == <span class="hljs-string">'female'</span>, <span class="hljs-string">'Miss Jones'</span>)\</div><div class="remark-code-line">        .otherwise(<span class="hljs-string">'NA'</span>)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.withColumn(<span class="hljs-string">"supervisor"</span>, supervisor).show()</div><div class="remark-code-line">+------+---+----------+----------+</div><div class="remark-code-line">|  name|age|    gender|supervisor|</div><div class="remark-code-line">+------+---+----------+----------+</div><div class="remark-code-line">|  John| <span class="hljs-number">21</span>|      male| Mr. Smith|</div><div class="remark-code-line">|  Jane| <span class="hljs-number">25</span>|    female|Miss Jones|</div><div class="remark-code-line">|Albert| <span class="hljs-number">46</span>|      male| Mr. Smith|</div><div class="remark-code-line">|  Brad| <span class="hljs-number">49</span>|super-hero|        NA|</div><div class="remark-code-line">+------+---+----------+----------+</div></code></pre><div class="remark-slide-number">46 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="user-defined-functions">User-defined functions</h1>
<ul>
<li><p>When you need a <strong>transformation</strong> that is <strong>not available</strong> in the <code class="remark remark-inline-code">functions</code> package, you can create a <span class="stress">User Defined Function</span> (UDF)</p>
</li>
<li><p><strong>Warning</strong>: the performance of this can be <span class="stress">very very low</span></p>
</li>
<li><p>So, it should be used <strong>only</strong> when you are <strong>sure</strong> the operation <span class="stress">cannot be done</span> with available functions</p>
</li>
<li><p>To create an UDF, use <code class="remark remark-inline-code">functions.udf</code>, passing a lambda or a named functions</p>
</li>
<li><p>It is similar to the <code class="remark remark-inline-code">map</code> operation of RDDs</p>
</li>
</ul><div class="remark-slide-number">47 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="example">Example</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql.types <span class="hljs-keyword">import</span> StringType</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df = spark.createDataFrame([(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">4</span>, <span class="hljs-number">2</span>)], [<span class="hljs-string">"first"</span>, <span class="hljs-string">"second"</span>])</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">my_func</span><span class="hljs-params">(col_1, col_2)</span>:</span></div><div class="remark-code-line">        <span class="hljs-keyword">if</span> (col_1 &gt; col_2):</div><div class="remark-code-line">            <span class="hljs-keyword">return</span> <span class="hljs-string">"{} is bigger than {}"</span>.format(col_1, col_2)</div><div class="remark-code-line">        <span class="hljs-keyword">else</span>:</div><div class="remark-code-line">            <span class="hljs-keyword">return</span> <span class="hljs-string">"{} is bigger than {}"</span>.format(col_2, col_1)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>my_udf = fn.udf(my_func, StringType())</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>df.withColumn(<span class="hljs-string">"udf"</span>, my_udf(df[<span class="hljs-string">'first'</span>], df[<span class="hljs-string">'second'</span>])).show()</div><div class="remark-code-line">+-----+------+------------------+</div><div class="remark-code-line">|first|second|               udf|</div><div class="remark-code-line">+-----+------+------------------+</div><div class="remark-code-line">|    <span class="hljs-number">1</span>|     <span class="hljs-number">3</span>|<span class="hljs-number">3</span> <span class="hljs-keyword">is</span> bigger than <span class="hljs-number">1</span>|</div><div class="remark-code-line">|    <span class="hljs-number">4</span>|     <span class="hljs-number">2</span>|<span class="hljs-number">4</span> <span class="hljs-keyword">is</span> bigger than <span class="hljs-number">2</span>|</div><div class="remark-code-line">+-----+------+------------------+</div></code></pre><div class="remark-slide-number">48 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-6-joins">3.6. Joins</h1><div class="remark-slide-number">49 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="performing-joins">Performing joins</h1>
<ul>
<li><p><code class="remark remark-inline-code">Spark SQL</code> supports <span class="stress">joins</span> between two <code class="remark remark-inline-code">DataFrame</code></p>
</li>
<li><p>As in normal <code class="remark remark-inline-code">SQL</code>, a join <strong>rule</strong> must be defined</p>
</li>
<li><p>The <strong>rule</strong> can either be a set of <strong>join keys</strong>, or a <strong>conditional rule</strong></p>
</li>
<li><p>Join with conditional rules in <code class="remark remark-inline-code">Spark</code> can be <span class="stress">very heavy</span></p>
</li>
<li><p><strong>Several types of joins</strong> are available, default is <code class="remark remark-inline-code">"inner"</code></p>
</li>
</ul>
<p>Syntax is simple:</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>left_df.join(other=right_df, on=cols, how=join_type)</div></code></pre>
<ul>
<li><code class="remark remark-inline-code">cols</code> contains a column name or a list of column names</li>
<li><code class="remark remark-inline-code">join_type</code> is the type of join</li>
</ul><div class="remark-slide-number">50 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="examples">Examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> date</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products = spark.createDataFrame([</div><div class="remark-code-line">        (<span class="hljs-string">'1'</span>, <span class="hljs-string">'mouse'</span>, <span class="hljs-string">'microsoft'</span>, <span class="hljs-number">39.99</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'2'</span>, <span class="hljs-string">'keyboard'</span>, <span class="hljs-string">'logitech'</span>, <span class="hljs-number">59.99</span>),</div><div class="remark-code-line">    ], [<span class="hljs-string">'prod_id'</span>, <span class="hljs-string">'prod_cat'</span>, <span class="hljs-string">'prod_brand'</span>, <span class="hljs-string">'prod_value'</span>])</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases = spark.createDataFrame([</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">1</span>), <span class="hljs-number">2</span>, <span class="hljs-string">'1'</span>),</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>), <span class="hljs-number">1</span>, <span class="hljs-string">'1'</span>),</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">5</span>), <span class="hljs-number">1</span>, <span class="hljs-string">'2'</span>),</div><div class="remark-code-line">    ], [<span class="hljs-string">'date'</span>, <span class="hljs-string">'quantity'</span>, <span class="hljs-string">'prod_id'</span>])</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># The default join type is the "INNER" join</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases.join(products, <span class="hljs-string">'prod_id'</span>).show()</div><div class="remark-code-line">+-------+----------+--------+--------+----------+----------+</div><div class="remark-code-line">|prod_id|      date|quantity|prod_cat|prod_brand|prod_value|</div><div class="remark-code-line">+-------+----------+--------+--------+----------+----------+</div><div class="remark-code-line">|      <span class="hljs-number">1</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-01</span>|       <span class="hljs-number">2</span>|   mouse| microsoft|     <span class="hljs-number">39.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">1</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-02</span>|       <span class="hljs-number">1</span>|   mouse| microsoft|     <span class="hljs-number">39.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">2</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span>|       <span class="hljs-number">1</span>|keyboard|  logitech|     <span class="hljs-number">59.99</span>|</div><div class="remark-code-line">+-------+----------+--------+--------+----------+----------+</div></code></pre><div class="remark-slide-number">51 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="examples">Examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># We can also use a query string (not recommended)</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.createOrReplaceTempView(<span class="hljs-string">"products"</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases.createOrReplaceTempView(<span class="hljs-string">"purchases"</span>)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"""SELECT * FROM</span></div><div class="remark-code-line">    (purchases AS prc INNER JOIN products AS prd </div><div class="remark-code-line">    on prc.prod_id = prd.prod_id)</div><div class="remark-code-line">    """</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>spark.sql(query).show()</div><div class="remark-code-line">+----------+--------+-------+-------+--------+----------+----------+</div><div class="remark-code-line">|      date|quantity|prod_id|prod_id|prod_cat|prod_brand|prod_value|</div><div class="remark-code-line">+----------+--------+-------+-------+--------+----------+----------+</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-01</span>|       <span class="hljs-number">2</span>|      <span class="hljs-number">1</span>|      <span class="hljs-number">1</span>|   mouse| microsoft|     <span class="hljs-number">39.99</span>|</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-02</span>|       <span class="hljs-number">1</span>|      <span class="hljs-number">1</span>|      <span class="hljs-number">1</span>|   mouse| microsoft|     <span class="hljs-number">39.99</span>|</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span>|       <span class="hljs-number">1</span>|      <span class="hljs-number">2</span>|      <span class="hljs-number">2</span>|keyboard|  logitech|     <span class="hljs-number">59.99</span>|</div><div class="remark-code-line">+----------+--------+-------+-------+--------+----------+----------+</div></code></pre><div class="remark-slide-number">52 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="examples">Examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>new_purchases = spark.createDataFrame([</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">1</span>), <span class="hljs-number">2</span>, <span class="hljs-string">'1'</span>),</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>), <span class="hljs-number">1</span>, <span class="hljs-string">'3'</span>),</div><div class="remark-code-line">    ], [<span class="hljs-string">'date'</span>, <span class="hljs-string">'quantity'</span>, <span class="hljs-string">'prod_id_x'</span>])</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>join_rule = new_purchases.prod_id_x == products.prod_id</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>new_purchases.join(products, join_rule, <span class="hljs-string">'left'</span>).show()</div><div class="remark-code-line">+----------+--------+---------+-------+--------+----------+----------+</div><div class="remark-code-line">|      date|quantity|prod_id_x|prod_id|prod_cat|prod_brand|prod_value|</div><div class="remark-code-line">+----------+--------+---------+-------+--------+----------+----------+</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-02</span>|       <span class="hljs-number">1</span>|        <span class="hljs-number">3</span>|   null|    null|      null|      null|</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-01</span>|       <span class="hljs-number">2</span>|        <span class="hljs-number">1</span>|      <span class="hljs-number">1</span>|   mouse| microsoft|     <span class="hljs-number">39.99</span>|</div><div class="remark-code-line">+----------+--------+---------+-------+--------+----------+----------+</div></code></pre><div class="remark-slide-number">53 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="performing-joins-some-remarks">Performing joins: some remarks</h1>
<ul>
<li><p>Spark <span class="stress">removes the duplicated column</span> in the <code class="remark remark-inline-code">DataFrame</code> it outputs after a join operation</p>
</li>
<li><p>When joining using columns <span class="stress">with nulls</span>, <code class="remark remark-inline-code">Spark</code> just skips those</p>
</li>
</ul>
<pre><code class="scala hljs remark-code"><div class="remark-code-line">&gt;&gt;&gt; df1.show()               &gt;&gt;&gt; df2.show()</div><div class="remark-code-line">+----+-----+                 +----+-----+</div><div class="remark-code-line">|  id| name|                 |  id| dept|</div><div class="remark-code-line">+----+-----+                 +----+-----+</div><div class="remark-code-line">| <span class="hljs-number">123</span>|name1|                 |<span class="hljs-literal">null</span>|sales|</div><div class="remark-code-line">| <span class="hljs-number">456</span>|name3|                 | <span class="hljs-number">223</span>|<span class="hljs-type">Legal</span>|</div><div class="remark-code-line">|<span class="hljs-literal">null</span>|name2|                 | <span class="hljs-number">456</span>|   <span class="hljs-type">IT</span>|</div><div class="remark-code-line">+----+-----+                 +----+-----+</div><div class="remark-code-line"></div><div class="remark-code-line">&gt;&gt;&gt; df1.join(df2, <span class="hljs-string">"id"</span>).show</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">| id| name| dept|</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">|<span class="hljs-number">123</span>|name1|sales|</div><div class="remark-code-line">|<span class="hljs-number">456</span>|name3|   <span class="hljs-type">IT</span>|</div><div class="remark-code-line">+---+-----+-----+</div></code></pre><div class="remark-slide-number">54 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="join-types">Join types</h1>
<div class="pure-table pure-table-striped"><table>
<thead>
<tr>
<th>SQL Join Type</th>
<th>In Spark (synonyms)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>INNER</td>
<td><code class="remark remark-inline-code">"inner"</code></td>
<td>Data from left and right matching both ways (intersection)</td>
</tr>
<tr>
<td>FULL OUTER</td>
<td><code class="remark remark-inline-code">"outer"</code>, <code class="remark remark-inline-code">"full"</code>, <code class="remark remark-inline-code">"fullouter"</code></td>
<td>All rows from left and right with extra data if present (union)</td>
</tr>
<tr>
<td>LEFT OUTER</td>
<td><code class="remark remark-inline-code">"leftouter"</code>, <code class="remark remark-inline-code">"left"</code></td>
<td>Rows from left with extra data from right if present</td>
</tr>
<tr>
<td>RIGHT OUTER</td>
<td><code class="remark remark-inline-code">"rightouter"</code>, <code class="remark remark-inline-code">"right"</code></td>
<td>Rows from right with extra data from left if present</td>
</tr>
<tr>
<td>LEFT SEMI</td>
<td><code class="remark remark-inline-code">"leftsemi"</code></td>
<td>Data from left with a match with right</td>
</tr>
<tr>
<td>LEFT ANTI</td>
<td><code class="remark remark-inline-code">"leftanti"</code></td>
<td>Data from left with no match with right</td>
</tr>
<tr>
<td>CROSS</td>
<td><code class="remark remark-inline-code">"cross"</code></td>
<td>Cartesian product of left and right (never used)</td>
</tr>
</tbody>
</table>
</div><div class="remark-slide-number">55 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="join-types">Join types</h1>
<div class="center"><p><img width="700px" src="./Remark04_files/join-types.png"></p>
</div><div class="remark-slide-number">56 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="inner-join-inner-">Inner join ("inner")</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>inner = df_left.join(df_right, <span class="hljs-string">"id"</span>, <span class="hljs-string">"inner"</span>)</div><div class="remark-code-line"></div><div class="remark-code-line">df_left                df_right             </div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">| id|value|            | id|value|</div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">|  <span class="hljs-number">1</span>|   A1|            |  <span class="hljs-number">3</span>|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">2</span>|   A2|            |  <span class="hljs-number">4</span>| A4_1|</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|            |  <span class="hljs-number">4</span>|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|            |  <span class="hljs-number">5</span>|   A5|</div><div class="remark-code-line">+---+-----+            |  <span class="hljs-number">6</span>|   A6|</div><div class="remark-code-line">                       +---+-----+</div><div class="remark-code-line">inner</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">| id|value|value|</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4| A4_1|</div><div class="remark-code-line">+---+-----+-----+</div></code></pre><div class="remark-slide-number">57 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="outer-join-outer-full-or-fullouter-">Outer join ("outer", "full" or "fullouter")</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>outer = df_left.join(df_right, <span class="hljs-string">"id"</span>, <span class="hljs-string">"outer"</span>)</div><div class="remark-code-line">df_left                df_right             </div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">| id|value|            | id|value|</div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">|  <span class="hljs-number">1</span>|   A1|            |  <span class="hljs-number">3</span>|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">2</span>|   A2|            |  <span class="hljs-number">4</span>| A4_1|</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|            |  <span class="hljs-number">4</span>|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|            |  <span class="hljs-number">5</span>|   A5|</div><div class="remark-code-line">+---+-----+            |  <span class="hljs-number">6</span>|   A6|</div><div class="remark-code-line">                       +---+-----+</div><div class="remark-code-line">outer</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">| id|value|value|</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">|  <span class="hljs-number">1</span>|   A1| null|</div><div class="remark-code-line">|  <span class="hljs-number">2</span>|   A2| null|</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4| A4_1|</div><div class="remark-code-line">|  <span class="hljs-number">5</span>| null|   A5|</div><div class="remark-code-line">|  <span class="hljs-number">6</span>| null|   A6|</div><div class="remark-code-line">+---+-----+-----+</div></code></pre><div class="remark-slide-number">58 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="left-join-leftouter-or-left-">Left join ("leftouter" or "left" )</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>left = df_left.join(df_right, <span class="hljs-string">"id"</span>, <span class="hljs-string">"left"</span>)</div><div class="remark-code-line"></div><div class="remark-code-line">df_left                df_right             </div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">| id|value|            | id|value|</div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">|  <span class="hljs-number">1</span>|   A1|            |  <span class="hljs-number">3</span>|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">2</span>|   A2|            |  <span class="hljs-number">4</span>| A4_1|</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|            |  <span class="hljs-number">4</span>|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|            |  <span class="hljs-number">5</span>|   A5|</div><div class="remark-code-line">+---+-----+            |  <span class="hljs-number">6</span>|   A6|</div><div class="remark-code-line">                       +---+-----+</div><div class="remark-code-line">left</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">| id|value|value|</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">|  <span class="hljs-number">1</span>|   A1| null|</div><div class="remark-code-line">|  <span class="hljs-number">2</span>|   A2| null|</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4| A4_1|</div><div class="remark-code-line">+---+-----+-----+</div></code></pre><div class="remark-slide-number">59 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="right-rightouter-or-right-">Right ("rightouter" or "right")</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>right = df_left.join(df_right, <span class="hljs-string">"id"</span>, <span class="hljs-string">"right"</span>)</div><div class="remark-code-line"></div><div class="remark-code-line">df_left                df_right             </div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">| id|value|            | id|value|</div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">|  <span class="hljs-number">1</span>|   A1|            |  <span class="hljs-number">3</span>|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">2</span>|   A2|            |  <span class="hljs-number">4</span>| A4_1|</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|            |  <span class="hljs-number">4</span>|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|            |  <span class="hljs-number">5</span>|   A5|</div><div class="remark-code-line">+---+-----+            |  <span class="hljs-number">6</span>|   A6|</div><div class="remark-code-line">                       +---+-----+</div><div class="remark-code-line">right</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">| id|value|value|</div><div class="remark-code-line">+---+-----+-----+</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4| A4_1|</div><div class="remark-code-line">|  <span class="hljs-number">5</span>| null|   A5|</div><div class="remark-code-line">|  <span class="hljs-number">6</span>| null|   A6|</div><div class="remark-code-line">+---+-----+-----+</div></code></pre><div class="remark-slide-number">60 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="left-semi-join-leftsemi-">Left semi join ("leftsemi")</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>left_semi = df_left.join(df_right, <span class="hljs-string">"id"</span>, <span class="hljs-string">"leftsemi"</span>)</div><div class="remark-code-line"></div><div class="remark-code-line">df_left                df_right             </div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">| id|value|            | id|value|</div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">|  <span class="hljs-number">1</span>|   A1|            |  <span class="hljs-number">3</span>|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">2</span>|   A2|            |  <span class="hljs-number">4</span>| A4_1|</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|            |  <span class="hljs-number">4</span>|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|            |  <span class="hljs-number">5</span>|   A5|</div><div class="remark-code-line">+---+-----+            |  <span class="hljs-number">6</span>|   A6|</div><div class="remark-code-line">                       +---+-----+</div><div class="remark-code-line">left_semi</div><div class="remark-code-line">+---+-----+</div><div class="remark-code-line">| id|value|</div><div class="remark-code-line">+---+-----+</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|</div><div class="remark-code-line">+---+-----+</div></code></pre><div class="remark-slide-number">61 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="left-anti-joint-leftanti-">Left anti joint ("leftanti")</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>left_anti = df_left.join(df_right, <span class="hljs-string">"id"</span>, <span class="hljs-string">"leftanti"</span>)</div><div class="remark-code-line"></div><div class="remark-code-line">df_left                df_right             </div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">| id|value|            | id|value|</div><div class="remark-code-line">+---+-----+            +---+-----+</div><div class="remark-code-line">|  <span class="hljs-number">1</span>|   A1|            |  <span class="hljs-number">3</span>|   A3|</div><div class="remark-code-line">|  <span class="hljs-number">2</span>|   A2|            |  <span class="hljs-number">4</span>| A4_1|</div><div class="remark-code-line">|  <span class="hljs-number">3</span>|   A3|            |  <span class="hljs-number">4</span>|   A4|</div><div class="remark-code-line">|  <span class="hljs-number">4</span>|   A4|            |  <span class="hljs-number">5</span>|   A5|</div><div class="remark-code-line">+---+-----+            |  <span class="hljs-number">6</span>|   A6|</div><div class="remark-code-line">                       +---+-----+</div><div class="remark-code-line">left_anti</div><div class="remark-code-line">+---+-----+</div><div class="remark-code-line">| id|value|</div><div class="remark-code-line">+---+-----+</div><div class="remark-code-line">|  <span class="hljs-number">1</span>|   A1|</div><div class="remark-code-line">|  <span class="hljs-number">2</span>|   A2|</div><div class="remark-code-line">+---+-----+</div></code></pre><div class="remark-slide-number">62 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-7-aggregations">3.7. Aggregations</h1><div class="remark-slide-number">63 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="performing-aggregations">Performing aggregations</h1>
<ul>
<li><p>Maybe <span class="stress">the most used operations</span> in <code class="remark remark-inline-code">SQL</code> and <code class="remark remark-inline-code">Spark SQL</code></p>
</li>
<li><p>Similar to <code class="remark remark-inline-code">SQL</code>, we use <code class="remark remark-inline-code">"group by"</code> to perform <span class="stress">aggregations</span></p>
</li>
<li><p>We usually can call the aggregation function just after <code class="remark remark-inline-code">groupBy</code> <br> 
Namely, we use <code class="remark remark-inline-code">groupBy().agg()</code></p>
</li>
<li><p><span class="stress">Many aggregation functions</span> in <code class="remark remark-inline-code">pyspark.sql.functions</code></p>
</li>
<li><p>Some examples:</p>
<ul>
<li><p>Numerical: <code class="remark remark-inline-code">fn.avg</code>, <code class="remark remark-inline-code">fn.sum</code>, <code class="remark remark-inline-code">fn.min</code>, <code class="remark remark-inline-code">fn.max</code>, etc.</p>
</li>
<li><p>General: <code class="remark remark-inline-code">fn.first</code>, <code class="remark remark-inline-code">fn.last</code>, <code class="remark remark-inline-code">fn.count</code>, <code class="remark remark-inline-code">fn.countDistinct</code>, etc.</p>
</li>
</ul>
</li>
</ul><div class="remark-slide-number">64 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="examples">Examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products = spark.createDataFrame([</div><div class="remark-code-line">        (<span class="hljs-string">'1'</span>, <span class="hljs-string">'mouse'</span>, <span class="hljs-string">'microsoft'</span>, <span class="hljs-number">39.99</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'2'</span>, <span class="hljs-string">'mouse'</span>, <span class="hljs-string">'microsoft'</span>, <span class="hljs-number">59.99</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'3'</span>, <span class="hljs-string">'keyboard'</span>, <span class="hljs-string">'microsoft'</span>, <span class="hljs-number">59.99</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'4'</span>, <span class="hljs-string">'keyboard'</span>, <span class="hljs-string">'logitech'</span>, <span class="hljs-number">59.99</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'5'</span>, <span class="hljs-string">'mouse'</span>, <span class="hljs-string">'logitech'</span>, <span class="hljs-number">29.99</span>),</div><div class="remark-code-line">    ], [<span class="hljs-string">'prod_id'</span>, <span class="hljs-string">'prod_cat'</span>, <span class="hljs-string">'prod_brand'</span>, <span class="hljs-string">'prod_value'</span>])</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.groupBy(<span class="hljs-string">'prod_cat'</span>).avg(<span class="hljs-string">'prod_value'</span>).show()</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># Or</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.groupBy(<span class="hljs-string">'prod_cat'</span>).agg(fn.avg(<span class="hljs-string">'prod_value'</span>)).show()</div><div class="remark-code-line">+--------+-----------------+</div><div class="remark-code-line">|prod_cat|  avg(prod_value)|</div><div class="remark-code-line">+--------+-----------------+</div><div class="remark-code-line">|keyboard|            <span class="hljs-number">54.99</span>|</div><div class="remark-code-line">|   mouse|<span class="hljs-number">43.32333333333333</span>|</div><div class="remark-code-line">+--------+-----------------+</div></code></pre><div class="remark-slide-number">65 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="examples">Examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.groupBy(<span class="hljs-string">'prod_brand'</span>, <span class="hljs-string">'prod_cat'</span>)\</div><div class="remark-code-line">        .agg(fn.avg(<span class="hljs-string">'prod_value'</span>)).show()</div><div class="remark-code-line">+----------+--------+---------------+</div><div class="remark-code-line">|prod_brand|prod_cat|avg(prod_value)|</div><div class="remark-code-line">+----------+--------+---------------+</div><div class="remark-code-line">| microsoft|   mouse|          <span class="hljs-number">49.99</span>|</div><div class="remark-code-line">|  logitech|keyboard|          <span class="hljs-number">49.99</span>|</div><div class="remark-code-line">| microsoft|keyboard|          <span class="hljs-number">59.99</span>|</div><div class="remark-code-line">|  logitech|   mouse|          <span class="hljs-number">29.99</span>|</div><div class="remark-code-line">+----------+--------+---------------+</div></code></pre><div class="remark-slide-number">66 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="examples">Examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.groupBy(<span class="hljs-string">'prod_brand'</span>).agg(</div><div class="remark-code-line">        fn.round(fn.avg(<span class="hljs-string">'prod_value'</span>), <span class="hljs-number">1</span>).alias(<span class="hljs-string">'average'</span>),</div><div class="remark-code-line">        fn.ceil(fn.sum(<span class="hljs-string">'prod_value'</span>)).alias(<span class="hljs-string">'sum'</span>),</div><div class="remark-code-line">        fn.min(<span class="hljs-string">'prod_value'</span>).alias(<span class="hljs-string">'min'</span>)</div><div class="remark-code-line">    ).show()</div><div class="remark-code-line">+----------+-------+---+-----+</div><div class="remark-code-line">|prod_brand|average|sum|  min|</div><div class="remark-code-line">+----------+-------+---+-----+</div><div class="remark-code-line">|  logitech|   <span class="hljs-number">40.0</span>| <span class="hljs-number">80</span>|<span class="hljs-number">29.99</span>|</div><div class="remark-code-line">| microsoft|   <span class="hljs-number">53.3</span>|<span class="hljs-number">160</span>|<span class="hljs-number">39.99</span>|</div><div class="remark-code-line">+----------+-------+---+-----+</div></code></pre><div class="remark-slide-number">67 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="examples">Examples</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># Using an SQL query</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.createOrReplaceTempView(<span class="hljs-string">"products"</span>)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>query = <span class="hljs-string">"""</span></div><div class="remark-code-line">    SELECT</div><div class="remark-code-line">    prod_brand,</div><div class="remark-code-line">    round(avg(prod_value), 1) AS average,</div><div class="remark-code-line">    min(prod_value) AS min</div><div class="remark-code-line">    FROM products</div><div class="remark-code-line">    GROUP BY prod_brand</div><div class="remark-code-line">    """</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>spark.sql(query).show()</div><div class="remark-code-line">+----------+-------+-----+</div><div class="remark-code-line">|prod_brand|average|  min|</div><div class="remark-code-line">+----------+-------+-----+</div><div class="remark-code-line">|  logitech|   <span class="hljs-number">40.0</span>|<span class="hljs-number">29.99</span>|</div><div class="remark-code-line">| microsoft|   <span class="hljs-number">53.3</span>|<span class="hljs-number">39.99</span>|</div><div class="remark-code-line">+----------+-------+-----+</div></code></pre><div class="remark-slide-number">68 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-8-window-functions">3.8. Window functions</h1><div class="remark-slide-number">69 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="window-functions">Window functions</h1>
<ul>
<li><p>A very, very <span class="stress">powerful feature</span></p>
</li>
<li><p>They allow to solve <span class="stress">complex problems</span></p>
</li>
<li><p>They exist in some relational databases</p>
</li>
<li>A good article about this feature is <a href="https://databricks.com/blog/2015/07/15/introducing-window-functions-in-spark-sql.html">[here]</a></li>
</ul><div class="remark-slide-number">70 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="window-functions">Window functions</h1>
<ul>
<li><p>It's <span class="stress">similar to aggregations</span>, but the <strong>number of rows doesn't change</strong></p>
</li>
<li><p>Instead, <span class="stress">new columns are created</span>, and the <strong>aggregated values are duplicated</strong> for values of the same "group"</p>
</li>
<li><p>There are "tradictional" aggregations, such as <code class="remark remark-inline-code">min</code>, <code class="remark remark-inline-code">max</code>, <code class="remark remark-inline-code">avg</code>, <code class="remark remark-inline-code">sum</code></p>
</li>
<li><p>and "special" types, such as <code class="remark remark-inline-code">lag</code>, <code class="remark remark-inline-code">lead</code>, <code class="remark remark-inline-code">rank</code></p>
</li>
</ul><div class="remark-slide-number">71 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="numerical-window-functions">Numerical window functions</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> Window</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># First, we create the Window definition</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>window = Window.partitionBy(<span class="hljs-string">'prod_brand'</span>)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># Then, we can use "over" to aggregate on this window</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>avg = fn.avg(<span class="hljs-string">'prod_value'</span>).over(window)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># Finally, we can it as a classical column</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.withColumn(<span class="hljs-string">'avg_brand_value'</span>, fn.round(avg, <span class="hljs-number">2</span>)).show()</div><div class="remark-code-line">+-------+--------+----------+----------+---------------+</div><div class="remark-code-line">|prod_id|prod_cat|prod_brand|prod_value|avg_brand_value|</div><div class="remark-code-line">+-------+--------+----------+----------+---------------+</div><div class="remark-code-line">|      <span class="hljs-number">4</span>|keyboard|  logitech|     <span class="hljs-number">49.99</span>|          <span class="hljs-number">39.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">5</span>|   mouse|  logitech|     <span class="hljs-number">29.99</span>|          <span class="hljs-number">39.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">1</span>|   mouse| microsoft|     <span class="hljs-number">39.99</span>|          <span class="hljs-number">53.32</span>|</div><div class="remark-code-line">|      <span class="hljs-number">2</span>|   mouse| microsoft|     <span class="hljs-number">59.99</span>|          <span class="hljs-number">53.32</span>|</div><div class="remark-code-line">|      <span class="hljs-number">3</span>|keyboard| microsoft|     <span class="hljs-number">59.99</span>|          <span class="hljs-number">53.32</span>|</div><div class="remark-code-line">+-------+--------+----------+----------+---------------+</div></code></pre><div class="remark-slide-number">72 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="numerical-window-functions">Numerical window functions</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> Window</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># The window can be defined on multiple columns</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>window = Window.partitionBy(<span class="hljs-string">'prod_brand'</span>, <span class="hljs-string">'prod_cat'</span>)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>avg = fn.avg(<span class="hljs-string">'prod_value'</span>).over(window)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.withColumn(<span class="hljs-string">'avg_value'</span>, fn.round(avg, <span class="hljs-number">2</span>)).show()</div><div class="remark-code-line">+-------+--------+----------+----------+---------+</div><div class="remark-code-line">|prod_id|prod_cat|prod_brand|prod_value|avg_value|</div><div class="remark-code-line">+-------+--------+----------+----------+---------+</div><div class="remark-code-line">|      <span class="hljs-number">1</span>|   mouse| microsoft|     <span class="hljs-number">39.99</span>|    <span class="hljs-number">49.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">2</span>|   mouse| microsoft|     <span class="hljs-number">59.99</span>|    <span class="hljs-number">49.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">4</span>|keyboard|  logitech|     <span class="hljs-number">49.99</span>|    <span class="hljs-number">49.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">3</span>|keyboard| microsoft|     <span class="hljs-number">59.99</span>|    <span class="hljs-number">59.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">5</span>|   mouse|  logitech|     <span class="hljs-number">29.99</span>|    <span class="hljs-number">29.99</span>|</div><div class="remark-code-line">+-------+--------+----------+----------+---------+</div></code></pre><div class="remark-slide-number">73 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="numerical-window-functions">Numerical window functions</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> Window</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> functions <span class="hljs-keyword">as</span> fn</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># Multiple windows can be defined</span></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>window1 = Window.partitionBy(<span class="hljs-string">'prod_brand'</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>window2 = Window.partitionBy(<span class="hljs-string">'prod_cat'</span>)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>avg_brand = fn.avg(<span class="hljs-string">'prod_value'</span>).over(window1)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>avg_cat = fn.avg(<span class="hljs-string">'prod_value'</span>).over(window2)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products \</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'avg_by_brand'</span>, fn.round(avg_brand, <span class="hljs-number">2</span>)) \</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'avg_by_cat'</span>, fn.round(avg_cat, <span class="hljs-number">2</span>)) \</div><div class="remark-code-line">        .show()</div><div class="remark-code-line">+-------+--------+----------+----------+------------+----------+</div><div class="remark-code-line">|prod_id|prod_cat|prod_brand|prod_value|avg_by_brand|avg_by_cat|</div><div class="remark-code-line">+-------+--------+----------+----------+------------+----------+</div><div class="remark-code-line">|      <span class="hljs-number">4</span>|keyboard|  logitech|     <span class="hljs-number">49.99</span>|       <span class="hljs-number">39.99</span>|     <span class="hljs-number">54.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">3</span>|keyboard| microsoft|     <span class="hljs-number">59.99</span>|       <span class="hljs-number">53.32</span>|     <span class="hljs-number">54.99</span>|</div><div class="remark-code-line">|      <span class="hljs-number">5</span>|   mouse|  logitech|     <span class="hljs-number">29.99</span>|       <span class="hljs-number">39.99</span>|     <span class="hljs-number">43.32</span>|</div><div class="remark-code-line">|      <span class="hljs-number">1</span>|   mouse| microsoft|     <span class="hljs-number">39.99</span>|       <span class="hljs-number">53.32</span>|     <span class="hljs-number">43.32</span>|</div><div class="remark-code-line">|      <span class="hljs-number">2</span>|   mouse| microsoft|     <span class="hljs-number">59.99</span>|       <span class="hljs-number">53.32</span>|     <span class="hljs-number">43.32</span>|</div><div class="remark-code-line">+-------+--------+----------+----------+------------+----------+</div></code></pre><div class="remark-slide-number">74 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="lag-and-lead">Lag and Lead</h1>
<ul>
<li><p><code class="remark remark-inline-code">lag</code> and <code class="remark remark-inline-code">lead</code> are special functions used over an <span class="stress">ordered window</span></p>
</li>
<li><p>They are used to <strong>take the "previous" and "next" value</strong> within the window</p>
</li>
<li><p>Very useful in datasets with a date column for instance</p>
</li>
</ul><div class="remark-slide-number">75 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="lag-and-lead">Lag and Lead</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases = spark.createDataFrame([</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">1</span>), <span class="hljs-string">'mouse'</span>),</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>), <span class="hljs-string">'mouse'</span>),</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">4</span>), <span class="hljs-string">'keyboard'</span>),</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">6</span>), <span class="hljs-string">'keyboard'</span>),</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">9</span>), <span class="hljs-string">'keyboard'</span>),</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>), <span class="hljs-string">'mouse'</span>),</div><div class="remark-code-line">        (date(<span class="hljs-number">2017</span>, <span class="hljs-number">11</span>, <span class="hljs-number">18</span>), <span class="hljs-string">'keyboard'</span>)</div><div class="remark-code-line">    ], [<span class="hljs-string">'date'</span>, <span class="hljs-string">'prod_cat'</span>])</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases.show()</div><div class="remark-code-line">+----------+--------+</div><div class="remark-code-line">|      date|prod_cat|</div><div class="remark-code-line">+----------+--------+</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-01</span>|   mouse|</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-02</span>|   mouse|</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-04</span>|keyboard|</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-06</span>|keyboard|</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-09</span>|keyboard|</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-12</span>|   mouse|</div><div class="remark-code-line">|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-18</span>|keyboard|</div><div class="remark-code-line">+----------+--------+</div></code></pre><div class="remark-slide-number">76 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="lag-and-lead">Lag and Lead</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>window = Window.partitionBy(<span class="hljs-string">'prod_cat'</span>).orderBy(<span class="hljs-string">'date'</span>)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>prev_purch = fn.lag(<span class="hljs-string">'date'</span>, <span class="hljs-number">1</span>).over(window)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>next_purch = fn.lead(<span class="hljs-string">'date'</span>, <span class="hljs-number">1</span>).over(window)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>purchases\</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'prev'</span>, prev_purch)\</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'next'</span>, next_purch)\</div><div class="remark-code-line">        .orderBy(<span class="hljs-string">'prod_cat'</span>, <span class="hljs-string">'date'</span>)\</div><div class="remark-code-line">        .show()</div><div class="remark-code-line">+--------+----------+----------+----------+</div><div class="remark-code-line">|prod_cat|      date|      prev|      next|</div><div class="remark-code-line">+--------+----------+----------+----------+</div><div class="remark-code-line">|keyboard|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-04</span>|      null|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-06</span>|</div><div class="remark-code-line">|keyboard|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-06</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-04</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-09</span>|</div><div class="remark-code-line">|keyboard|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-09</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-06</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-18</span>|</div><div class="remark-code-line">|keyboard|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-18</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-09</span>|      null|</div><div class="remark-code-line">|   mouse|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-01</span>|      null|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-02</span>|</div><div class="remark-code-line">|   mouse|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-02</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-01</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-12</span>|</div><div class="remark-code-line">|   mouse|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-12</span>|<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-02</span>|      null|</div><div class="remark-code-line">+--------+----------+----------+----------+</div></code></pre><div class="remark-slide-number">77 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="rank-denserank-and-rownumber">Rank, DenseRank and RowNumber</h1>
<ul>
<li><p>Another set of <strong>useful "special" functions</strong></p>
</li>
<li><p>Also used on <span class="stress">ordered windows</span></p>
</li>
<li><p>They create a <strong>rank</strong>, or an <strong>order</strong> of the items within the window</p>
</li>
</ul><div class="remark-slide-number">78 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="rank-and-rownumber">Rank and RowNumber</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>contestants = spark.createDataFrame([</div><div class="remark-code-line">        (<span class="hljs-string">'veterans'</span>, <span class="hljs-string">'John'</span>, <span class="hljs-number">3000</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'veterans'</span>, <span class="hljs-string">'Bob'</span>, <span class="hljs-number">3200</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'veterans'</span>, <span class="hljs-string">'Mary'</span>, <span class="hljs-number">4000</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'young'</span>, <span class="hljs-string">'Jane'</span>, <span class="hljs-number">4000</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'young'</span>, <span class="hljs-string">'April'</span>, <span class="hljs-number">3100</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'young'</span>, <span class="hljs-string">'Alice'</span>, <span class="hljs-number">3700</span>),</div><div class="remark-code-line">        (<span class="hljs-string">'young'</span>, <span class="hljs-string">'Micheal'</span>, <span class="hljs-number">4000</span>),</div><div class="remark-code-line">    ], [<span class="hljs-string">'category'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'points'</span>])</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>contestants.show()</div><div class="remark-code-line">+--------+-------+------+</div><div class="remark-code-line">|category|   name|points|</div><div class="remark-code-line">+--------+-------+------+</div><div class="remark-code-line">|veterans|   John|  <span class="hljs-number">3000</span>|</div><div class="remark-code-line">|veterans|    Bob|  <span class="hljs-number">3200</span>|</div><div class="remark-code-line">|veterans|   Mary|  <span class="hljs-number">4000</span>|</div><div class="remark-code-line">|   young|   Jane|  <span class="hljs-number">4000</span>|</div><div class="remark-code-line">|   young|  April|  <span class="hljs-number">3100</span>|</div><div class="remark-code-line">|   young|  Alice|  <span class="hljs-number">3700</span>|</div><div class="remark-code-line">|   young|Micheal|  <span class="hljs-number">4000</span>|</div><div class="remark-code-line">+--------+-------+------+</div></code></pre><div class="remark-slide-number">79 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="rank-and-rownumber">Rank and RowNumber</h1>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>window = Window.partitionBy(<span class="hljs-string">'category'</span>)\</div><div class="remark-code-line">        .orderBy(contestants.points.desc())</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>rank = fn.rank().over(window)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>dense_rank = fn.dense_rank().over(window)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>row_number = fn.row_number().over(window)</div><div class="remark-code-line"></div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>contestants\</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'rank'</span>, rank)\</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'dense_rank'</span>, dense_rank)\</div><div class="remark-code-line">        .withColumn(<span class="hljs-string">'row_number'</span>, row_number)\</div><div class="remark-code-line">        .orderBy(<span class="hljs-string">'category'</span>, fn.col(<span class="hljs-string">'points'</span>).desc())\</div><div class="remark-code-line">        .show()</div><div class="remark-code-line">+--------+-------+------+----+----------+----------+</div><div class="remark-code-line">|category|   name|points|rank|dense_rank|row_number|</div><div class="remark-code-line">+--------+-------+------+----+----------+----------+</div><div class="remark-code-line">|veterans|   Mary|  <span class="hljs-number">4000</span>|   <span class="hljs-number">1</span>|         <span class="hljs-number">1</span>|         <span class="hljs-number">1</span>|</div><div class="remark-code-line">|veterans|    Bob|  <span class="hljs-number">3200</span>|   <span class="hljs-number">2</span>|         <span class="hljs-number">2</span>|         <span class="hljs-number">2</span>|</div><div class="remark-code-line">|veterans|   John|  <span class="hljs-number">3000</span>|   <span class="hljs-number">3</span>|         <span class="hljs-number">3</span>|         <span class="hljs-number">3</span>|</div><div class="remark-code-line">|   young|   Jane|  <span class="hljs-number">4000</span>|   <span class="hljs-number">1</span>|         <span class="hljs-number">1</span>|         <span class="hljs-number">1</span>|</div><div class="remark-code-line">|   young|Micheal|  <span class="hljs-number">4000</span>|   <span class="hljs-number">1</span>|         <span class="hljs-number">1</span>|         <span class="hljs-number">2</span>|</div><div class="remark-code-line">|   young|  Alice|  <span class="hljs-number">3700</span>|   <span class="hljs-number">3</span>|         <span class="hljs-number">2</span>|         <span class="hljs-number">3</span>|</div><div class="remark-code-line">|   young|  April|  <span class="hljs-number">3100</span>|   <span class="hljs-number">4</span>|         <span class="hljs-number">3</span>|         <span class="hljs-number">4</span>|</div><div class="remark-code-line">+--------+-------+------+----+----------+----------+</div></code></pre><div class="remark-slide-number">80 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-9-writing-dataframes">3.9. Writing dataframes</h1><div class="remark-slide-number">81 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="writing-dataframes">Writing dataframes</h1>
<ul>
<li><p>Very <span class="stress">similar to reading</span>. Output formats are the same: <code class="remark remark-inline-code">csv</code>, <code class="remark remark-inline-code">json</code>, <code class="remark remark-inline-code">parquet</code>, <code class="remark remark-inline-code">orc</code>, <code class="remark remark-inline-code">jdbc</code>, etc. Note that <code class="remark remark-inline-code">write</code> <span class="stress">is an action</span></p>
</li>
<li><p>Instead of <code class="remark remark-inline-code">df.read.{source}</code> use <code class="remark remark-inline-code">df.write.{target}</code></p>
</li>
<li><p>Main option is <code class="remark remark-inline-code">mode</code> with possible values:</p>
<ul>
<li><code class="remark remark-inline-code">"append"</code>: append contents of this <code class="remark remark-inline-code">DataFrame</code> to existing data.</li>
<li><code class="remark remark-inline-code">"overwrite"</code>: overwrite existing data</li>
<li><code class="remark remark-inline-code">"error"</code>: throw an exception if data already exists</li>
<li><code class="remark remark-inline-code">"ignore"</code>: silently ignore this operation if data already exists.</li>
</ul>
</li>
</ul>
<p>Example</p>
<pre><code class="python hljs remark-code"><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.write.csv(<span class="hljs-string">'/products.csv'</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.write.mode(<span class="hljs-string">'overwrite'</span>).parquet(<span class="hljs-string">'/file.parquet'</span>)</div><div class="remark-code-line"><span class="hljs-meta">&gt;&gt;&gt; </span>products.write.format(<span class="hljs-string">'parquet'</span>).save(<span class="hljs-string">'/file.parquet'</span>)</div></code></pre><div class="remark-slide-number">82 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-10-under-the-hood-">3.10. Under the hood...</h1><div class="remark-slide-number">83 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="query-planning-and-optimization">Query planning and optimization</h1>
<p>A <span class="stress">lot happens under the hood</span> when executing an <strong>action</strong> on a <code class="remark remark-inline-code">DataFrame</code>.
The query goes through the following <strong>exectution stages</strong>:</p>
<ol>
<li>Logical Analysis</li>
<li>Caching Replacement</li>
<li>Logical Query Optimization (using rule-based and cost-based optimizations)</li>
<li>Physical Planning</li>
<li>Physical Optimization (e.g. Whole-Stage Java Code Generation or Adaptive Query Execution)</li>
<li>Constructing the RDD of Internal Binary Rows (that represents the structured query in terms of Spark Cores RDD API)</li>
</ol>
<div class="footnote"><p><a href="https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html"></a><a href="https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html">https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html</a></p>
</div><div class="remark-slide-number">84 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top hljs-default"><h1 id="query-planning-and-optimization">Query planning and optimization</h1>
<div class="center"><p><img width="550px" ,="" src="./Remark04_files/QueryExecution-execution-pipeline.png"></p>
</div>

<div class="footnote"><p><a href="https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html"></a><a href="https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html">https://jaceklaskowski.gitbooks.io/mastering-spark-sql/spark-sql.html</a></p>
</div><div class="remark-slide-number">85 / 86</div></div></div></div><div class="remark-slide-notes"></div></div><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="thank-you-">Thank you !</h1><div class="remark-slide-number">86 / 86</div></div></div></div><div class="remark-slide-notes"></div></div></div>
<div class="remark-preview-area"><div class="remark-slide-container"><div class="remark-slide-scaler" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;"><div class="remark-slide"><div class="remark-slide-content top center middle inverse hljs-default"><h1 id="3-spark-sql-">3. <code class="remark remark-inline-code">spark.sql</code></h1><div class="remark-slide-number">2 / 86</div></div></div></div><div class="remark-slide-notes"></div></div></div>
<div class="remark-backdrop"></div>
<div class="remark-pause" style="transform: scale(1.09692); left: 277px; top: 0px;">
  <div class="remark-pause-lozenge">
    <span>Paused</span>
  </div>
</div>
<div class="remark-help" style="width: 908px; height: 681px; transform: scale(1.09692); left: 277px; top: 0px;">
  <div class="remark-help-content">
    <h1>Help</h1>
    <p><b>Keyboard shortcuts</b></p>
    <table class="light-keys">
      <tbody><tr>
        <td>
          <span class="key"><b></b></span>,
          <span class="key"><b></b></span>,
          <span class="key">Pg Up</span>,
          <span class="key">k</span>
        </td>
        <td>Go to previous slide</td>
      </tr>
      <tr>
        <td>
          <span class="key"><b></b></span>,
          <span class="key"><b></b></span>,
          <span class="key">Pg Dn</span>,
          <span class="key">Space</span>,
          <span class="key">j</span>
        </td>
        <td>Go to next slide</td>
      </tr>
      <tr>
        <td>
          <span class="key">Home</span>
        </td>
        <td>Go to first slide</td>
      </tr>
      <tr>
        <td>
          <span class="key">End</span>
        </td>
        <td>Go to last slide</td>
      </tr>
      <tr>
        <td>
          Number + <span class="key">Return</span>
        </td>
        <td>Go to specific slide</td>
      </tr>
      <tr>
        <td>
          <span class="key">b</span>&nbsp;/
          <span class="key">m</span>&nbsp;/
          <span class="key">f</span>
        </td>
        <td>Toggle blackout / mirrored / fullscreen mode</td>
      </tr>
      <tr>
        <td>
          <span class="key">c</span>
        </td>
        <td>Clone slideshow</td>
      </tr>
      <tr>
        <td>
          <span class="key">p</span>
        </td>
        <td>Toggle presenter mode</td>
      </tr>
      <tr>
        <td>
          <span class="key">t</span>
        </td>
        <td>Restart the presentation timer</td>
      </tr>
      <tr>
        <td>
          <span class="key">?</span>,
          <span class="key">h</span>
        </td>
        <td>Toggle this help</td>
      </tr>
    </tbody></table>
  </div>
  <div class="content dismiss">
    <table class="light-keys">
      <tbody><tr>
        <td>
          <span class="key">Esc</span>
        </td>
        <td>Back to slideshow</td>
      </tr>
    </tbody></table>
  </div>
</div>

	<script type="text/x-mathjax-config">
	  MathJax.Hub.Config({
	    extensions: ["tex2jax.js", "AMSmath.js", "AMSsymbols.js", "autobold.js"],
	    jax: ["input/TeX", "output/HTML-CSS"],
	    tex2jax: {
	    	skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
	      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
	      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
	      processEscapes: true
	    },
	    "HTML-CSS": { availableFonts: ["TeX"] }
	  });
	</script>
	<script type="text/javascript" src="./Remark04_files/MathJax.js">
	</script>

  <link rel="stylesheet" href="./Remark04_files/pure-min.css">
  <style>
  .smaller-font { font-size:15.65px } 
  </style>
  



</body></html>